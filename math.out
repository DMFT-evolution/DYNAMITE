RowBox[{RowBox[{"len", "=", "512"}], ";"}]
RowBox[{RowBox[{"Tmax", "=", RowBox[{"10", "^", "5"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x_", "]"}], ":=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Delta]", "=", RowBox[{"1", "/", RowBox[{"(", RowBox[{"10", "\[Pi]", "Tmax"}], ")"}]}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Eta]", "=", RowBox[{"Rationalize", "[", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{"1", "/", "len"}], ")"}]}], "2", RowBox[{"ProductLog", "[", RowBox[{RowBox[{"-", "1"}], ",", RowBox[{RowBox[{"-", "\[Pi]"}], "\[Delta]"}]}], "]"}]}], "]"}]}], "}"}], ",", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"x", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}], "-", RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}]}], ")"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}], "]"}]}], "-", RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}]}], "\[Eta]"}], ")"}]}], "]"}]}]}], ")"}]}]}], "]"}]}], "]"}], ",", "40"}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"inv\[Theta]", "[", "x_", "]"}], "=", RowBox[{"Quiet", "[", RowBox[{RowBox[{"InverseFunction", "[", "\[Theta]func", "]"}], "[", "x", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"\[Theta]points", "=", RowBox[{"\[Theta]func", "[", RowBox[{"Range", "[", "len", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"len", "=", "512"}], ";"}]
RowBox[{RowBox[{"Tmax", "=", RowBox[{"10.", "^", "5"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x_", "]"}], ":=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Delta]", "=", RowBox[{"1", "/", RowBox[{"(", RowBox[{"10", "\[Pi]", "Tmax"}], ")"}]}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Eta]", "=", RowBox[{"Rationalize", "[", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{"1", "/", "len"}], ")"}]}], "2", RowBox[{"ProductLog", "[", RowBox[{RowBox[{"-", "1"}], ",", RowBox[{RowBox[{"-", "\[Pi]"}], "\[Delta]"}]}], "]"}]}], "]"}]}], "}"}], ",", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"x", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}], "-", RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}]}], ")"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}], "]"}]}], "-", RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}]}], "\[Eta]"}], ")"}]}], "]"}]}]}], ")"}]}]}], "]"}]}], "]"}], ",", "40"}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"inv\[Theta]", "[", "x_", "]"}], "=", RowBox[{"Quiet", "[", RowBox[{RowBox[{"InverseFunction", "[", "\[Theta]func", "]"}], "[", "x", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"\[Theta]points", "=", RowBox[{"\[Theta]func", "[", RowBox[{"Range", "[", "len", "]"}], "]"}]}], ";"}]
RowBox[{"\[Theta]points"}]
RowBox[{RowBox[{"len", "=", "512"}], ";"}]
RowBox[{RowBox[{"Tmax", "=", RowBox[{"10.", "^", "5"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x_", "]"}], ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Delta]", "=", RowBox[{"1", "/", RowBox[{"(", RowBox[{"10", "\[Pi]", "Tmax"}], ")"}]}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Eta]", "=", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{"1", "/", "len"}], ")"}]}], "2", RowBox[{"ProductLog", "[", RowBox[{RowBox[{"-", "1"}], ",", RowBox[{RowBox[{"-", "\[Pi]"}], "\[Delta]"}]}], "]"}]}]}], "}"}], ",", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"x", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}], "-", RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}]}], ")"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}], "]"}]}], "-", RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}]}], "\[Eta]"}], ")"}]}], "]"}]}]}], ")"}]}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"inv\[Theta]", "[", "x_", "]"}], "=", RowBox[{"Quiet", "[", RowBox[{RowBox[{"InverseFunction", "[", "\[Theta]func", "]"}], "[", "x", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"\[Theta]points", "=", RowBox[{"\[Theta]func", "[", RowBox[{"Range", "[", "len", "]"}], "]"}]}], ";"}]
RowBox[{"\[Theta]points"}]
RowBox[{RowBox[{"len", "=", "512"}], ";"}]
RowBox[{RowBox[{"Tmax", "=", RowBox[{"10.", "^", "5"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x_", "]"}], ":=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Delta]", "=", RowBox[{"1", "/", RowBox[{"(", RowBox[{"10", "\[Pi]", "Tmax"}], ")"}]}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Eta]", "=", RowBox[{"Rationalize", "[", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{"1", "/", "len"}], ")"}]}], "2", RowBox[{"ProductLog", "[", RowBox[{RowBox[{"-", "1"}], ",", RowBox[{RowBox[{"-", "\[Pi]"}], "\[Delta]"}]}], "]"}]}], "]"}]}], "}"}], ",", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"x", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}], "-", RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}]}], ")"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}], "]"}]}], "-", RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}]}], "\[Eta]"}], ")"}]}], "]"}]}]}], ")"}]}]}], "]"}]}], "]"}], ",", "40"}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"inv\[Theta]", "[", "x_", "]"}], "=", RowBox[{"Quiet", "[", RowBox[{RowBox[{"InverseFunction", "[", "\[Theta]func", "]"}], "[", "x", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"\[Theta]points2", "=", RowBox[{"\[Theta]func", "[", RowBox[{"Range", "[", "len", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"len", "=", "512"}], ";"}]
RowBox[{RowBox[{"Tmax", "=", RowBox[{"10.", "^", "5"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"\[Theta]func2", "[", "x_", "]"}], ":=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Delta]", "=", RowBox[{"1", "/", RowBox[{"(", RowBox[{"10", "\[Pi]", "Tmax"}], ")"}]}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Eta]", "=", RowBox[{"Rationalize", "[", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{"1", "/", "len"}], ")"}]}], "2", RowBox[{"ProductLog", "[", RowBox[{RowBox[{"-", "1"}], ",", RowBox[{RowBox[{"-", "\[Pi]"}], "\[Delta]"}]}], "]"}]}], "]"}]}], "}"}], ",", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"x", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}], "-", RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}]}], ")"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}], "]"}]}], "-", RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}]}], "\[Eta]"}], ")"}]}], "]"}]}]}], ")"}]}]}], "]"}]}], "]"}], ",", "40"}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"inv\[Theta]", "[", "x_", "]"}], "=", RowBox[{"Quiet", "[", RowBox[{RowBox[{"InverseFunction", "[", "\[Theta]func", "]"}], "[", "x", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"\[Theta]points2", "=", RowBox[{"\[Theta]func", "[", RowBox[{"Range", "[", "len", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"len", "=", "512"}], ";"}]
RowBox[{RowBox[{"Tmax", "=", RowBox[{"10.", "^", "5"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"\[Theta]func2", "[", "x_", "]"}], ":=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Delta]", "=", RowBox[{"1", "/", RowBox[{"(", RowBox[{"10", "\[Pi]", "Tmax"}], ")"}]}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Eta]", "=", RowBox[{"Rationalize", "[", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{"1", "/", "len"}], ")"}]}], "2", RowBox[{"ProductLog", "[", RowBox[{RowBox[{"-", "1"}], ",", RowBox[{RowBox[{"-", "\[Pi]"}], "\[Delta]"}]}], "]"}]}], "]"}]}], "}"}], ",", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"x", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}], "-", RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}]}], ")"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}], "]"}]}], "-", RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}]}], "\[Eta]"}], ")"}]}], "]"}]}]}], ")"}]}]}], "]"}]}], "]"}], ",", "40"}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x_", "]"}], ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Delta]", "=", RowBox[{"1", "/", RowBox[{"(", RowBox[{"10", "\[Pi]", "Tmax"}], ")"}]}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Eta]", "=", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{"1", "/", "len"}], ")"}]}], "2", RowBox[{"ProductLog", "[", RowBox[{RowBox[{"-", "1"}], ",", RowBox[{RowBox[{"-", "\[Pi]"}], "\[Delta]"}]}], "]"}]}]}], "}"}], ",", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"x", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}], "-", RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}]}], ")"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}], "]"}]}], "-", RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}]}], "\[Eta]"}], ")"}]}], "]"}]}]}], ")"}]}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"inv\[Theta]", "[", "x_", "]"}], "=", RowBox[{"Quiet", "[", RowBox[{RowBox[{"InverseFunction", "[", "\[Theta]func", "]"}], "[", "x", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"\[Theta]points", "=", RowBox[{"\[Theta]func", "[", RowBox[{"Range", "[", "len", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"\[Theta]points2", "=", RowBox[{"\[Theta]func2", "[", RowBox[{"Range", "[", "len", "]"}], "]"}]}], ";"}]
RowBox[{"\[Theta]points"}]
RowBox[{"\[Theta]points", "-", "\[Theta]points2"}]
RowBox[{RowBox[{"data", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/int.dat\"", "]"}]}], ";"}]
RowBox[{"data", "[", RowBox[{"[", "1", "]"}], "]"}]
RowBox[{"2", "*", RowBox[{"data", "[", RowBox[{"[", "1", "]"}], "]"}]}]
RowBox[{"Dimensions", "[", "data", "]"}]
RowBox[{RowBox[{"data", "=", RowBox[{"Flatten", "[", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/int.dat\"", "]"}], "]"}]}], ";"}]
RowBox[{"Total", "[", "data", "]"}]
RowBox[{RowBox[{"Total", "[", "data", "]"}], "-", "1"}]
RowBox[{"Total", "[", RowBox[{"\[Theta]points", "*", "data"}], "]"}]
RowBox[{"Total", "[", RowBox[{SuperscriptBox["\[Theta]points", "2"], "*", "data"}], "]"}]
RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{SuperscriptBox["\[Theta]points", "n"], "*", "data"}], "]"}], "-", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}]
RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", SuperscriptBox["\[Theta]points", "n"], ",", "1"}], "]"}], "*", "data"}], "]"}], "-", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}]
RowBox[{RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", SuperscriptBox["\[Theta]points", "n"], ",", "1"}], "]"}], "*", "data"}], "]"}], "-", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}], "//", "Chop"}]
RowBox[{RowBox[{"data", "=", RowBox[{"Flatten", "[", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/int.dat\"", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", SuperscriptBox["\[Theta]points", "n"], ",", "1"}], "]"}], "*", "data"}], "]"}], "-", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}], "//", "Chop"}]
RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", SuperscriptBox["\[Theta]points", "n"], ",", "1"}], "]"}], "*", "data"}], "]"}], "-", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}]
RowBox[{RowBox[{"Sin", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], ".", "data"}]
RowBox[{RowBox[{"txt", "=", RowBox[{"$InputFileName", "!=", "\"\""}]}], ";"}]
RowBox[{RowBox[{"dir", "=", RowBox[{"If", "[", RowBox[{"txt", ",", RowBox[{"DirectoryName", "[", "$InputFileName", "]"}], ",", RowBox[{"NotebookDirectory", "[", "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"scratch", "=", RowBox[{"If", "[", RowBox[{RowBox[{"DirectoryQ", "[", "\"/media/jlang/Desk SSD/\"", "]"}], ",", "\"/media/jlang/Desk SSD/\"", ",", RowBox[{"If", "[", RowBox[{RowBox[{"DirectoryQ", "[", "\"/nobackups/jlang/\"", "]"}], ",", "\"/nobackups/jlang/\"", ",", "dir"}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"AppendTo", "[", RowBox[{"$Path", ",", "dir"}], "]"}], ";"}]
RowBox[{RowBox[{"Needs", "[", "\"Libraryfast`\"", "]"}], ";"}]
RowBox[{RowBox[{"multithread", "=", "True"}], ";"}]
RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"$VersionNumber", ">=", "13.3"}], ",", RowBox[{"realvaluedQ", "=", "RealValuedNumericQ"}], ",", RowBox[{"realvaluedQ", "=", "Internal`RealValuedNumericQ"}]}], "]"}], ";"}]
RowBox[{RowBox[{"version", "=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"string", "=", RowBox[{"FileNameTake", "[", RowBox[{RowBox[{"If", "[", RowBox[{"txt", ",", "$InputFileName", ",", RowBox[{"NotebookFileName", "[", "]"}]}], "]"}], ",", RowBox[{"-", "1"}]}], "]"}]}], "}"}], ",", RowBox[{"ToExpression", "[", RowBox[{"StringTake", "[", RowBox[{"string", ",", RowBox[{"{", RowBox[{RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"string", ",", "\"_\""}], "]"}], "[", RowBox[{"[", RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", "1"}], ",", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"string", ",", "\".\""}], "]"}], "[", RowBox[{"[", RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Needs", "[", "\"MaTeX`\"", "]"}], ";"}]
RowBox[{RowBox[{"texStyle", "=", RowBox[{"{", RowBox[{RowBox[{"FontFamily", "->", "\"Latin Modern Roman\""}], ",", RowBox[{"FontSize", "->", "14"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{"style", ":=", RowBox[{"{", RowBox[{RowBox[{"PlotStyle", "->", RowBox[{"Join", "[", RowBox[{RowBox[{RowBox[{RowBox[{"Lighter", "[", RowBox[{"Red", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Most", "[", RowBox[{"Subdivide", "[", RowBox[{"0.7", ",", "0.", ",", "10"}], "]"}], "]"}]}], ",", RowBox[{RowBox[{RowBox[{"Darker", "[", RowBox[{"Red", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Most", "[", RowBox[{"Subdivide", "[", RowBox[{"0", ",", "0.7", ",", "10"}], "]"}], "]"}]}]}], "]"}]}], ",", RowBox[{"Axes", "->", "False"}], ",", RowBox[{"AxesStyle", "->", RowBox[{"Directive", "[", RowBox[{"Black", ",", RowBox[{"FontSize", "->", "15"}], ",", RowBox[{"FontFamily", "->", "\"Times\""}]}], "]"}]}], ",", RowBox[{"Frame", "->", "True"}], ",", RowBox[{"FrameTicks", "->", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Automatic", ",", "Automatic"}], "}"}], ",", RowBox[{"{", RowBox[{"Automatic", ",", "Automatic"}], "}"}]}], "}"}]}], ",", RowBox[{"FrameTicksStyle", "->", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{RowBox[{"Directive", "[", RowBox[{RowBox[{"FontFamily", "->", "\"Times New Roman\""}], ",", RowBox[{"FontSize", "->", "20"}], ",", "Black"}], "]"}], ",", RowBox[{"Directive", "[", RowBox[{RowBox[{"FontOpacity", "->", "0"}], ",", RowBox[{"FontSize", "->", "0"}]}], "]"}]}], "}"}], ",", RowBox[{"{", RowBox[{RowBox[{"Directive", "[", RowBox[{RowBox[{"FontFamily", "->", "\"Times New Roman\""}], ",", RowBox[{"FontSize", "->", "20"}], ",", "Black"}], "]"}], ",", RowBox[{"Directive", "[", RowBox[{RowBox[{"FontOpacity", "->", "0"}], ",", RowBox[{"FontSize", "->", "0"}]}], "]"}]}], "}"}]}], "}"}]}], ",", RowBox[{"ImageSize", "->", "Large"}], ",", RowBox[{"FrameStyle", "->", RowBox[{"Directive", "[", RowBox[{"Black", ",", RowBox[{"Thickness", "[", ".003", "]"}]}], "]"}]}]}], "}"}]}], ";"}]
RowBox[{RowBox[{"liststyle", ":=", RowBox[{"{", RowBox[{RowBox[{"PlotStyle", "->", RowBox[{"Join", "[", RowBox[{RowBox[{RowBox[{RowBox[{"Lighter", "[", RowBox[{"Red", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Most", "[", RowBox[{"Subdivide", "[", RowBox[{"0.7", ",", "0.", ",", "10"}], "]"}], "]"}]}], ",", RowBox[{RowBox[{RowBox[{"Darker", "[", RowBox[{"Red", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Most", "[", RowBox[{"Subdivide", "[", RowBox[{"0", ",", "0.7", ",", "10"}], "]"}], "]"}]}]}], "]"}]}], ",", RowBox[{"Axes", "->", "False"}], ",", RowBox[{"AxesStyle", "->", RowBox[{"Directive", "[", RowBox[{"Black", ",", RowBox[{"FontSize", "->", "15"}], ",", RowBox[{"FontFamily", "->", "\"Times\""}]}], "]"}]}], ",", RowBox[{"Frame", "->", "True"}], ",", RowBox[{"FrameTicks", "->", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Automatic", ",", "Automatic"}], "}"}], ",", RowBox[{"{", RowBox[{"Automatic", ",", "Automatic"}], "}"}]}], "}"}]}], ",", RowBox[{"FrameTicksStyle", "->", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{RowBox[{"Directive", "[", RowBox[{RowBox[{"FontFamily", "->", "\"Times New Roman\""}], ",", RowBox[{"FontSize", "->", "20"}], ",", "Black"}], "]"}], ",", RowBox[{"Directive", "[", RowBox[{RowBox[{"FontOpacity", "->", "0"}], ",", RowBox[{"FontSize", "->", "0"}]}], "]"}]}], "}"}], ",", RowBox[{"{", RowBox[{RowBox[{"Directive", "[", RowBox[{RowBox[{"FontFamily", "->", "\"Times New Roman\""}], ",", RowBox[{"FontSize", "->", "20"}], ",", "Black"}], "]"}], ",", RowBox[{"Directive", "[", RowBox[{RowBox[{"FontOpacity", "->", "0"}], ",", RowBox[{"FontSize", "->", "0"}]}], "]"}]}], "}"}]}], "}"}]}], ",", RowBox[{"ImageSize", "->", "Large"}], ",", RowBox[{"Joined", "->", "True"}], ",", RowBox[{"FrameStyle", "->", RowBox[{"Directive", "[", RowBox[{"Black", ",", RowBox[{"Thickness", "[", ".003", "]"}]}], "]"}]}]}], "}"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "string", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"string", "[", RowBox[{"x_", ",", RowBox[{"len_", ":", "3"}]}], "]"}], ":=", RowBox[{"ToString", "[", RowBox[{"NumberForm", "[", RowBox[{RowBox[{"Round", "[", RowBox[{"x", ",", RowBox[{"1.", "/", RowBox[{"10", "^", "len"}]}]}], "]"}], ",", RowBox[{"{", RowBox[{"Infinity", ",", RowBox[{"If", "[", RowBox[{RowBox[{"x", "!=", RowBox[{"Round", "[", "x", "]"}]}], ",", RowBox[{"Max", "[", RowBox[{RowBox[{"len", "-", RowBox[{"Max", "[", RowBox[{RowBox[{"Floor", "[", RowBox[{"Log", "[", RowBox[{"10", ",", RowBox[{"Abs", "[", "x", "]"}]}], "]"}], "]"}], ",", "0"}], "]"}]}], ",", "0"}], "]"}], ",", "1"}], "]"}]}], "}"}], ",", RowBox[{"ExponentFunction", "->", RowBox[{"(", RowBox[{"Null", "&"}], ")"}]}]}], "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "attachString", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"attachString", "[", RowBox[{"x_", ",", "str_"}], "]"}], ":=", RowBox[{RowBox[{RowBox[{"ToExpression", "[", RowBox[{RowBox[{"ToString", "[", RowBox[{"Extract", "[", RowBox[{"x", ",", RowBox[{"{", RowBox[{"1", ",", "#"}], "}"}], ",", "HoldForm"}], "]"}], "]"}], "<>", "str"}], "]"}], "&"}], "/@", RowBox[{"Range", "[", RowBox[{"Length", "[", RowBox[{"ReleaseHold", "[", "x", "]"}], "]"}], "]"}]}]}], ";"}]
RowBox[{RowBox[{"infos", ":=", RowBox[{"StringJoin", "[", RowBox[{"\"Running on machine: \"", "<>", "$MachineName", "<>", "\"\\nStatus: \"", "<>", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ">=", "tmax"}], ",", "\"finished\"", ",", "\"running\""}], "]"}], "<>", "\"\\nCurrent runtime: \"", "<>", RowBox[{"ToString", "[", RowBox[{RowBox[{"1.", RowBox[{"AbsoluteTime", "[", "]"}]}], "-", "time"}], "]"}], "<>", "\"\\nCurrent simulated time: \"", "<>", RowBox[{"string", "[", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "]"}], "<>", "\"\\nCurrent step: \"", "<>", RowBox[{"ToString", "[", "loop", "]"}], "<>", "\"\\nCurrent step size: \"", "<>", RowBox[{"ToString", "[", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], "]"}], "<>", "\"\\nCurrent time per step: \"", "<>", RowBox[{"ToString", "[", RowBox[{RowBox[{"times", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"times", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], "]"}], "<>", "\" s\"", "<>", "\"\\nCurrent Time: \"", "<>", RowBox[{"DateString", "[", "Now", "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "loadparams", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"loadparams", "[", "file_", "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"params", "=", RowBox[{"Import", "[", "file", "]"}]}], "}"}], ",", RowBox[{RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"newlines", "=", RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"\\n\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ",", RowBox[{"equals", "=", RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"=\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"expressions", "=", RowBox[{RowBox[{RowBox[{"StringTrim", "[", "#", "]"}], "&"}], "/@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{"params", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{RowBox[{"Prepend", "[", RowBox[{"newlines", ",", "0"}], "]"}], "+", "1"}], ",", RowBox[{"equals", "-", "1"}]}], "}"}], "]"}]}], ")"}]}]}], "}"}], ",", RowBox[{RowBox[{"Clear", "@@", "expressions"}], ";", RowBox[{RowBox[{"Evaluate", "[", RowBox[{"ToExpression", "[", "expressions", "]"}], "]"}], "=", RowBox[{"ToExpression", "[", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{"params", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"equals", "+", "1"}], ",", RowBox[{"Append", "[", RowBox[{"newlines", ",", RowBox[{"-", "1"}]}], "]"}]}], "}"}], "]"}]}], "]"}]}], ";", RowBox[{"len", "=", RowBox[{"Round", "[", "len", "]"}]}], ";", RowBox[{"ord", "=", RowBox[{"Round", "[", "ord", "]"}]}], ";", RowBox[{"method", "=", RowBox[{"Round", "[", "method", "]"}]}]}]}], "]"}]}], "]"}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "checkparams", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"checkparams", "[", "file_", "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"params", "=", RowBox[{"Import", "[", "file", "]"}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"newlines", "=", RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"\\n\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ",", RowBox[{"equals", "=", RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"=\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"expressions", "=", RowBox[{RowBox[{RowBox[{"StringTrim", "[", "#", "]"}], "&"}], "/@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{"params", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{RowBox[{"Prepend", "[", RowBox[{"newlines", ",", "0"}], "]"}], "+", "1"}], ",", RowBox[{"equals", "-", "1"}]}], "}"}], "]"}]}], ")"}]}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"localVals", "=", RowBox[{"Most", "[", RowBox[{"Evaluate", "[", RowBox[{"ToExpression", "[", "expressions", "]"}], "]"}], "]"}]}], ",", RowBox[{"loadedVals", "=", RowBox[{"Most", "[", RowBox[{"ToExpression", "[", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{"params", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"equals", "+", "1"}], ",", RowBox[{"Append", "[", RowBox[{"newlines", ",", RowBox[{"-", "1"}]}], "]"}]}], "}"}], "]"}]}], "]"}], "]"}]}], ",", RowBox[{"length", "=", RowBox[{"If", "[", RowBox[{"PhysParamsOnly", ",", "17", ",", "10"}], "]"}]}]}], "}"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{"PhysParamsOnly", ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "loadedVals", "]"}], "==", "17"}], ",", RowBox[{RowBox[{"loadedVals", "=", RowBox[{"loadedVals", "[", RowBox[{"[", RowBox[{"1", ";;", "10"}], "]"}], "]"}]}], ";", RowBox[{"localVals", "=", RowBox[{"localVals", "[", RowBox[{"[", RowBox[{"1", ";;", "10"}], "]"}], "]"}]}]}], ",", RowBox[{RowBox[{"loadedVals", "=", RowBox[{"loadedVals", "[", RowBox[{"[", RowBox[{"1", ";;", "9"}], "]"}], "]"}]}], ";", RowBox[{"localVals", "=", RowBox[{"localVals", "[", RowBox[{"[", RowBox[{"1", ";;", "9"}], "]"}], "]"}]}]}]}], "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{RowBox[{"Length", "[", "loadedVals", "]"}], "==", "length"}], "&&", RowBox[{RowBox[{"loadedVals", "[", RowBox[{"[", "3", "]"}], "]"}], "==", "\[Infinity]"}]}], ",", RowBox[{"loadedVals", "=", RowBox[{"Join", "[", RowBox[{RowBox[{"loadedVals", "[", RowBox[{"[", RowBox[{"1", ";;", "2"}], "]"}], "]"}], ",", RowBox[{"loadedVals", "[", RowBox[{"[", RowBox[{"4", ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{RowBox[{"Length", "[", "localVals", "]"}], "==", "length"}], "&&", RowBox[{RowBox[{"localVals", "[", RowBox[{"[", "3", "]"}], "]"}], "==", "\[Infinity]"}]}], ",", RowBox[{"localVals", "=", RowBox[{"Join", "[", RowBox[{RowBox[{"localVals", "[", RowBox[{"[", RowBox[{"1", ";;", "2"}], "]"}], "]"}], ",", RowBox[{"localVals", "[", RowBox[{"[", RowBox[{"4", ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"p2", "==", "p"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "loadedVals", "]"}], "==", RowBox[{"length", "-", "1"}]}], ",", RowBox[{"loadedVals", "=", RowBox[{"Join", "[", RowBox[{RowBox[{"loadedVals", "[", RowBox[{"[", RowBox[{"1", ";;", "4"}], "]"}], "]"}], ",", RowBox[{"loadedVals", "[", RowBox[{"[", RowBox[{"6", ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], "]"}]}], ",", RowBox[{"loadedVals", "=", RowBox[{"Join", "[", RowBox[{RowBox[{"loadedVals", "[", RowBox[{"[", RowBox[{"1", ";;", "5"}], "]"}], "]"}], ",", RowBox[{"loadedVals", "[", RowBox[{"[", RowBox[{"7", ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "localVals", "]"}], "==", RowBox[{"length", "-", "1"}]}], ",", RowBox[{"localVals", "=", RowBox[{"Join", "[", RowBox[{RowBox[{"localVals", "[", RowBox[{"[", RowBox[{"1", ";;", "4"}], "]"}], "]"}], ",", RowBox[{"localVals", "[", RowBox[{"[", RowBox[{"6", ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], "]"}]}], ",", RowBox[{"localVals", "=", RowBox[{"Join", "[", RowBox[{RowBox[{"localVals", "[", RowBox[{"[", RowBox[{"1", ";;", "5"}], "]"}], "]"}], ",", RowBox[{"localVals", "[", RowBox[{"[", RowBox[{"7", ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], "]"}]}]}], "]"}]}]}], "]"}], ";", RowBox[{"l1", "=", "localVals"}], ";", RowBox[{"l2", "=", "loadedVals"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"versionCheck", "&&", RowBox[{"!", "PhysParamsOnly"}]}], ",", RowBox[{"loadedVals", "==", "localVals"}], ",", RowBox[{RowBox[{RowBox[{"Rest", "[", "loadedVals", "]"}], "==", RowBox[{"Rest", "[", "localVals", "]"}]}], "&&", RowBox[{RowBox[{"loadedVals", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "36"}]}]}], "]"}]}]}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "export", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"export", "[", "dir_", "]"}], ":=", RowBox[{"(", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"(", RowBox[{RowBox[{"ValueQ", "[", "tstart", "]"}], "&&", RowBox[{"tstart", "==", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}]}], ")"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"ValueQ", "[", "append", "]"}], ",", RowBox[{"OutputNClear", "[", "]"}]}], "]"}], ";", RowBox[{"Export", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"params.txt\""}], "}"}], "]"}], ",", "params"}], "]"}], ";", RowBox[{"Export", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"info.txt\""}], "}"}], "]"}], ",", "infos"}], "]"}], ";", RowBox[{"Export", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"QK.wxf\""}], "}"}], "]"}], ",", "QK"}], "]"}], ";", RowBox[{"Export", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"QR.wxf\""}], "}"}], "]"}], ",", "QR"}], "]"}], ";", RowBox[{"Export", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"dQK.wxf\""}], "}"}], "]"}], ",", "dQK"}], "]"}], ";", RowBox[{"Export", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"dQR.wxf\""}], "}"}], "]"}], ",", "dQR"}], "]"}], ";", RowBox[{"Export", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"t1grid.wxf\""}], "}"}], "]"}], ",", "t1grid"}], "]"}], ";", RowBox[{"Export", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"rvec.wxf\""}], "}"}], "]"}], ",", "rvec"}], "]"}], ";", RowBox[{"Export", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"drvec.wxf\""}], "}"}], "]"}], ",", "drvec"}], "]"}], ";", RowBox[{"Export", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"dtratio.wxf\""}], "}"}], "]"}], ",", "\[Delta]tratio"}], "]"}], ";", RowBox[{"Export", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"time.wxf\""}], "}"}], "]"}], ",", "times"}], "]"}], ";", RowBox[{"Export", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"Energy.wxf\""}], "}"}], "]"}], ",", "etab"}], "]"}], ";", RowBox[{"Export", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"QK0.wxf\""}], "}"}], "]"}], ",", "QK0"}], "]"}], ";", RowBox[{"Export", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"QR0.wxf\""}], "}"}], "]"}], ",", "QR0"}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"ValueQ", "[", "append", "]"}], ",", RowBox[{"buildLowMem", "[", "]"}]}], "]"}]}]}], "]"}], ")"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "import", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"import", "[", RowBox[{"dir_", ",", RowBox[{"padding_", ":", "0"}]}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"paramnames", "=", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"Results_HPC\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}]}], "}"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"paramnames", "==", RowBox[{"{", "}"}]}], ",", RowBox[{"dirdate", "=", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"Results_HPC\"", ",", RowBox[{RowBox[{"StringJoin", "[", RowBox[{"Riffle", "[", RowBox[{RowBox[{"Append", "[", RowBox[{RowBox[{RowBox[{RowBox[{"ToString", "[", "#", "]"}], "&"}], "/@", RowBox[{"Reverse", "[", RowBox[{RowBox[{"Date", "[", "]"}], "[", RowBox[{"[", RowBox[{"1", ";;", "3"}], "]"}], "]"}], "]"}]}], ",", RowBox[{"StringJoin", "[", RowBox[{RowBox[{RowBox[{RowBox[{RowBox[{"ToString", "[", "#", "]"}], "&"}], "/@", RowBox[{"IntegerString", "[", RowBox[{"#", ",", "10", ",", "2"}], "]"}]}], "&"}], "/@", RowBox[{RowBox[{"Date", "[", "]"}], "[", RowBox[{"[", RowBox[{"4", ";;", "5"}], "]"}], "]"}]}], "]"}]}], "]"}], ",", "\"_\""}], "]"}], "]"}], "<>", "\"_p=\"", "<>", RowBox[{"string", "[", "p", "]"}], "<>", "\"_p2=\"", "<>", RowBox[{"string", "[", "p2", "]"}], "<>", "\"_lambda=\"", "<>", RowBox[{"string", "[", RowBox[{"\[Lambda]", ",", "2"}], "]"}], "<>", "\"_T0=\"", "<>", RowBox[{"string", "[", RowBox[{"T0", ",", "4"}], "]"}]}]}], "}"}], "]"}]}], ",", RowBox[{"Do", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"checkparams", "[", RowBox[{"paramnames", "[", RowBox[{"[", "n", "]"}], "]"}], "]"}], ",", RowBox[{RowBox[{"dirdate", "=", RowBox[{"FileNameDrop", "[", RowBox[{RowBox[{"paramnames", "[", RowBox[{"[", "n", "]"}], "]"}], ",", RowBox[{"-", "1"}]}], "]"}]}], ";", RowBox[{"loadData", "[", RowBox[{"dirdate", ",", "padding"}], "]"}], ";", RowBox[{"Return", "[", "]"}]}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"n", "==", RowBox[{"Length", "[", "paramnames", "]"}]}], ",", RowBox[{"dirdate", "=", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"Results_HPC\"", ",", RowBox[{RowBox[{"StringJoin", "[", RowBox[{"Riffle", "[", RowBox[{RowBox[{"Append", "[", RowBox[{RowBox[{RowBox[{RowBox[{"ToString", "[", "#", "]"}], "&"}], "/@", RowBox[{"Reverse", "[", RowBox[{RowBox[{"Date", "[", "]"}], "[", RowBox[{"[", RowBox[{"1", ";;", "3"}], "]"}], "]"}], "]"}]}], ",", RowBox[{"StringJoin", "[", RowBox[{RowBox[{RowBox[{RowBox[{RowBox[{"ToString", "[", "#", "]"}], "&"}], "/@", RowBox[{"IntegerString", "[", RowBox[{"#", ",", "10", ",", "2"}], "]"}]}], "&"}], "/@", RowBox[{RowBox[{"Date", "[", "]"}], "[", RowBox[{"[", RowBox[{"4", ";;", "5"}], "]"}], "]"}]}], "]"}]}], "]"}], ",", "\"_\""}], "]"}], "]"}], "<>", "\"_p=\"", "<>", RowBox[{"string", "[", "p", "]"}], "<>", "\"_p2=\"", "<>", RowBox[{"string", "[", "p2", "]"}], "<>", "\"_lambda=\"", "<>", RowBox[{"string", "[", RowBox[{"\[Lambda]", ",", "2"}], "]"}], "<>", "\"_T0=\"", "<>", RowBox[{"string", "[", RowBox[{"T0", ",", "4"}], "]"}]}]}], "}"}], "]"}]}]}], "]"}]}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", RowBox[{"Length", "[", "paramnames", "]"}]}], "}"}]}], "]"}]}], "]"}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "loadData", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"loadData", "[", RowBox[{"dir_", ",", RowBox[{"padding_", ":", "0"}]}], "]"}], ":=", RowBox[{"(", RowBox[{RowBox[{"loadparams", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"params.txt\""}], "}"}], "]"}], "]"}], ";", RowBox[{"QK", "=", RowBox[{"Import", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"QK.wxf\""}], "}"}], "]"}], "]"}]}], ";", RowBox[{"QR", "=", RowBox[{"Import", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"QR.wxf\""}], "}"}], "]"}], "]"}]}], ";", RowBox[{"dQK", "=", RowBox[{"Import", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"dQK.wxf\""}], "}"}], "]"}], "]"}]}], ";", RowBox[{"dQR", "=", RowBox[{"Import", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"dQR.wxf\""}], "}"}], "]"}], "]"}]}], ";", RowBox[{"t1grid", "=", RowBox[{"Import", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"t1grid.wxf\""}], "}"}], "]"}], "]"}]}], ";", RowBox[{"rvec", "=", RowBox[{"Import", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"rvec.wxf\""}], "}"}], "]"}], "]"}]}], ";", RowBox[{"drvec", "=", RowBox[{"Import", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"drvec.wxf\""}], "}"}], "]"}], "]"}]}], ";", RowBox[{"\[Delta]tratio", "=", RowBox[{"Import", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"dtratio.wxf\""}], "}"}], "]"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"FileExistsQ", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"time.wxf\""}], "}"}], "]"}], "]"}], ",", RowBox[{"times", "=", RowBox[{"Import", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"time.wxf\""}], "}"}], "]"}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"FileExistsQ", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"Energy.wxf\""}], "}"}], "]"}], "]"}], ",", RowBox[{"etab", "=", RowBox[{"Import", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"Energy.wxf\""}], "}"}], "]"}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"FileExistsQ", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"QK0.wxf\""}], "}"}], "]"}], "]"}], ",", RowBox[{"QK0", "=", RowBox[{"Import", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"QK0.wxf\""}], "}"}], "]"}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"FileExistsQ", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"QR0.wxf\""}], "}"}], "]"}], "]"}], ",", RowBox[{"QR0", "=", RowBox[{"Import", "[", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"dir", ",", "\"QR0.wxf\""}], "}"}], "]"}], "]"}]}]}], "]"}], ";", RowBox[{"QK", "=", RowBox[{"QK", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", RowBox[{"(", RowBox[{"padding", "+", "1"}], ")"}]}]}], "]"}], "]"}]}], ";", RowBox[{"QR", "=", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", RowBox[{"(", RowBox[{"padding", "+", "1"}], ")"}]}]}], "]"}], "]"}]}], ";", RowBox[{"dQK", "=", RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", RowBox[{"(", RowBox[{"padding", "+", "1"}], ")"}]}]}], "]"}], "]"}]}], ";", RowBox[{"dQR", "=", RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", RowBox[{"(", RowBox[{"padding", "+", "1"}], ")"}]}]}], "]"}], "]"}]}], ";", RowBox[{"t1grid", "=", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", RowBox[{"(", RowBox[{"padding", "+", "1"}], ")"}]}]}], "]"}], "]"}]}], ";", RowBox[{"rvec", "=", RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", RowBox[{"(", RowBox[{"padding", "+", "1"}], ")"}]}]}], "]"}], "]"}]}], ";", RowBox[{"drvec", "=", RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", RowBox[{"(", RowBox[{"padding", "+", "1"}], ")"}]}]}], "]"}], "]"}]}], ";", RowBox[{"\[Delta]tratio", "=", RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", RowBox[{"(", RowBox[{"padding", "+", "1"}], ")"}]}]}], "]"}], "]"}]}], ";", RowBox[{"\[Delta]t", "=", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"ValueQ", "[", "append", "]"}], ",", RowBox[{RowBox[{"buildLowMem", "[", "]"}], ";", RowBox[{"\[CapitalSigma]KA1int", "=", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], ";", RowBox[{"\[CapitalSigma]RA1int", "=", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], ";", RowBox[{"\[CapitalSigma]KB1int", "=", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], ";", RowBox[{"\[CapitalSigma]RB1int", "=", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], ";", RowBox[{"\[CapitalSigma]RA2int", "=", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], ";", RowBox[{"\[CapitalSigma]KB2int", "=", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], ";", RowBox[{"\[CapitalSigma]RB2int", "=", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}]}]}], "]"}], ";", RowBox[{"tstart", "=", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}]}], ")"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"buildLowMem", "[", RowBox[{"fac_", ":", "1"}], "]"}], ":=", RowBox[{"(", RowBox[{RowBox[{"buildOne", "[", RowBox[{"QK", ",", "1"}], "]"}], ";", RowBox[{"QK", "=", RowBox[{"QK", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{"buildOne", "[", RowBox[{"QR", ",", "2"}], "]"}], ";", RowBox[{"QR", "=", RowBox[{"QR", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{"buildOne", "[", RowBox[{RowBox[{"fac", "dQK"}], ",", "3"}], "]"}], ";", RowBox[{"dQK", "=", RowBox[{"dQK", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{"buildOne", "[", RowBox[{RowBox[{"fac", "dQR"}], ",", "4"}], "]"}], ";", RowBox[{"dQR", "=", RowBox[{"dQR", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";"}], ")"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "loadLibrary", "]"}], ";"}]
RowBox[{RowBox[{"loadLibrary", ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"libname", "=", RowBox[{RowBox[{"If", "[", RowBox[{"multithread", ",", "\"Interpol-mt.\"", ",", "\"Interpol-st.\""}], "]"}], "<>", RowBox[{"Switch", "[", RowBox[{"$OperatingSystem", ",", "\"Unix\"", ",", "\"so\"", ",", "\"Windows\"", ",", "\"dll\"", ",", "\"MacOSX\"", ",", "\"dylib\""}], "]"}]}]}], ",", "filename"}], "}"}], ",", RowBox[{RowBox[{"filename", "=", RowBox[{"FileNames", "[", RowBox[{"libname", ",", "dir", ",", "2"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "filename", "]"}], "!=", "0"}], ",", RowBox[{RowBox[{"filename", "=", RowBox[{"filename", "[", RowBox[{"[", "1", "]"}], "]"}]}], ";", RowBox[{"Quiet", "[", RowBox[{RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Head", "[", "#", "]"}], "===", "LibraryFunction"}], ",", RowBox[{"LibraryFunctionUnload", "[", "#", "]"}]}], "]"}], "&"}], "/@", RowBox[{"Unevaluated", "[", RowBox[{"{", RowBox[{"build", ",", "clearAll", ",", "clearOne", ",", "append", ",", "deleteN", ",", "replace", ",", "replaceD", ",", "prod2", ",", "clip", ",", "output", ",", "getLast", ",", "conv", ",", "index", ",", "indexVec", ",", "indexVecN", ",", "indexVecLN", ",", "Interpol1D3c", ",", "indexVecR", ",", "indexVecR2", ",", "indexVecL", ",", "indexMat", ",", "indexMatN", ",", "indexMatN3", ",", "indexMatAll", ",", "indexMatMerge", ",", "\[CapitalSigma]Rnum", ",", "\[CapitalSigma]Knum"}], "}"}], "]"}]}], ";"}], "]"}], ";", RowBox[{"build", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"build\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"buildOne", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"buildOne\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", "Integer"}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"clearAll", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"clearAll\"", ",", RowBox[{"{", "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"clearOne", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"clearOne\"", ",", RowBox[{"{", "Integer", "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"append", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"append\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"deleteN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"deleteN\"", ",", RowBox[{"{", "Integer", "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"replace", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"replace\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"replaceD", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"replaceD\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"output", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"output\"", ",", RowBox[{"{", "Integer", "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"getLast", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"getLast\"", ",", RowBox[{"{", RowBox[{"Integer", ",", "Integer"}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"prod2", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"prod2\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"clip", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"clip\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"\[CapitalSigma]Rnum", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"sigmaR\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"\[CapitalSigma]Knum", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"sigmaK\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"conv", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"conv\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"index", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"index\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVec", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVec\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecN\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"indexVecR", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecR\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecR2", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecR2\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecL", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecL\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecLN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecLN\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"Interpol1D3c", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"Interpol1D3c\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"indexMat", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMat\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatN\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatN3", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatN3\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatAll", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatAll\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatMerge", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatMerge\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}]}], ",", RowBox[{"Clear", "[", RowBox[{"build", ",", "buildOne", ",", "clearAll", ",", "clearOne", ",", "deleteN", ",", "append", ",", "replace", ",", "replaceD", ",", "output", ",", "getLast", ",", "conv", ",", "index", ",", "indexVec", ",", "indexVecN", ",", "indexVecLN", ",", "Interpol1D3c", ",", "indexVecR", ",", "indexVecR2", ",", "indexVecL", ",", "indexMat", ",", "indexMatN", ",", "indexMatN3", ",", "indexMatAll", ",", "indexMatMerge"}], "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "conv", "]"}]}], ",", RowBox[{RowBox[{"conv", "[", RowBox[{"int_", ",", "m1_", ",", "m2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"m1", "*", "m2"}], ")"}], ".", "int"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "index", "]"}]}], ",", RowBox[{RowBox[{"index", "[", RowBox[{"list_", ",", "inds_"}], "]"}], ":=", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecL", "]"}]}], ",", RowBox[{RowBox[{"indexVecL", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "1"}], "]"}], "]"}]}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecL3", "]"}]}], ",", RowBox[{RowBox[{"indexVecL3", "[", RowBox[{"list_", ",", "weightsIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"weights", "=", RowBox[{"ArrayReshape", "[", RowBox[{"weightsIn", ",", RowBox[{"{", RowBox[{RowBox[{"len", "^", "2"}], ",", RowBox[{RowBox[{"Length", "[", "weightsIn", "]"}], "/", RowBox[{"len", "^", "2"}]}]}], "}"}]}], "]"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{"Sum", "[", RowBox[{RowBox[{RowBox[{"weights", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"n", "+", "1"}]}], "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "n"}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", RowBox[{"weights", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVec", "]"}]}], ",", RowBox[{RowBox[{"indexVec", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "indsIn", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecR", "]"}]}], ",", RowBox[{RowBox[{"indexVecR", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "indsIn", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecR2", "]"}]}], ",", RowBox[{RowBox[{"indexVecR2", "[", RowBox[{"list_", ",", "dlist_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_", ",", "\[Delta]tratio_"}], "]"}], ":=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"\[CapitalDelta]xvecIn", "^", "2"}]}], ")"}], "*", RowBox[{"list", "[", RowBox[{"[", "indsIn", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "^", "2"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"\[CapitalDelta]xvecIn", "-", RowBox[{"\[CapitalDelta]xvecIn", "^", "2"}]}], ")"}], "*", RowBox[{"dlist", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexMat", "]"}]}], ",", RowBox[{RowBox[{"indexMat", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "\[CapitalDelta]yvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}], ",", RowBox[{"\[CapitalDelta]yvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]yvecIn"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "1"}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "len"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", RowBox[{"(", RowBox[{"len", "+", "1"}], ")"}]}], "]"}], "]"}]}]}], ")"}]}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexMat3", "]"}]}], ",", RowBox[{RowBox[{"indexMat3", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "weightsyIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}], ",", RowBox[{"weightsy", "=", RowBox[{"ArrayReshape", "[", RowBox[{"weightsyIn", ",", RowBox[{"{", RowBox[{RowBox[{"len", "^", "2"}], ",", RowBox[{RowBox[{"Length", "[", "weightsyIn", "]"}], "/", RowBox[{"len", "^", "2"}]}]}], "}"}]}], "]"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"Sum", "[", RowBox[{RowBox[{RowBox[{"weightsy", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"n", "+", "1"}]}], "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "n"}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", RowBox[{"weightsy", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"Sum", "[", RowBox[{RowBox[{RowBox[{"weightsy", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"n", "+", "1"}]}], "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", RowBox[{"(", RowBox[{"n", "+", "len"}], ")"}]}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", RowBox[{"weightsy", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}]}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexMatMerge", "]"}]}], ",", RowBox[{RowBox[{"indexMatMerge", "[", RowBox[{"list_", ",", "defaultlist_", ",", "\[CapitalDelta]xvecIn_", ",", "\[CapitalDelta]yvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"mask", "=", RowBox[{"Subtract", "[", RowBox[{"1", ",", RowBox[{"UnitStep", "[", RowBox[{"-", "indsIn"}], "]"}]}], "]"}]}], ",", RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}], ",", RowBox[{"\[CapitalDelta]yvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]yvecIn"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{"mask", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "1"}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "len"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", RowBox[{"(", RowBox[{"len", "+", "1"}], ")"}]}], "]"}], "]"}]}]}], ")"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"1", "-", "mask"}], ")"}], "defaultlist"}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"interactions", "[", "]"}], ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"qk", ",", "qr"}], "}"}], ",", RowBox[{RowBox[{"Clear", "[", RowBox[{"\[CapitalSigma]R", ",", "\[CapitalSigma]K", ",", "\[CapitalSigma]R1", ",", "\[CapitalSigma]K1", ",", "\[CapitalSigma]R2", ",", "\[CapitalSigma]K2"}], "]"}], ";", RowBox[{RowBox[{"fK", "[", RowBox[{"qk_", ",", "qr_", ",", "\[Lambda]_"}], "]"}], ":=", RowBox[{"If", "[", RowBox[{"quantum", ",", RowBox[{"FullSimplify", "[", RowBox[{RowBox[{"1", "/", "2"}], RowBox[{"(", RowBox[{RowBox[{"\[Lambda]", "p", RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{"qk", "-", "qr"}], ")"}], "^", RowBox[{"(", RowBox[{RowBox[{"-", "1"}], "+", "p"}], ")"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"qk", "+", "qr"}], ")"}], "^", RowBox[{"(", RowBox[{RowBox[{"-", "1"}], "+", "p"}], ")"}]}]}], ")"}]}], "+", RowBox[{"If", "[", RowBox[{RowBox[{"p2", "!=", "0"}], ",", RowBox[{RowBox[{"(", RowBox[{"1", "-", "\[Lambda]"}], ")"}], "p2", RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{"qk", "-", "qr"}], ")"}], "^", RowBox[{"(", RowBox[{RowBox[{"-", "1"}], "+", "p2"}], ")"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"qk", "+", "qr"}], ")"}], "^", RowBox[{"(", RowBox[{RowBox[{"-", "1"}], "+", "p2"}], ")"}]}]}], ")"}]}], ",", "0"}], "]"}]}], ")"}]}], "]"}], ",", RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "qk", "]"}]}], "]"}]}], ";", RowBox[{RowBox[{"fR", "[", RowBox[{"qk_", ",", "qr_", ",", "\[Lambda]_"}], "]"}], ":=", RowBox[{"If", "[", RowBox[{"quantum", ",", RowBox[{"FullSimplify", "[", RowBox[{RowBox[{RowBox[{"1", "/", "2"}], RowBox[{"(", RowBox[{RowBox[{"\[Lambda]", "p", RowBox[{"(", RowBox[{RowBox[{"-", RowBox[{RowBox[{"(", RowBox[{"qk", "-", "qr"}], ")"}], "^", RowBox[{"(", RowBox[{RowBox[{"-", "1"}], "+", "p"}], ")"}]}]}], "+", RowBox[{RowBox[{"(", RowBox[{"qk", "+", "qr"}], ")"}], "^", RowBox[{"(", RowBox[{RowBox[{"-", "1"}], "+", "p"}], ")"}]}]}], ")"}]}], "+", RowBox[{"If", "[", RowBox[{RowBox[{"p2", "!=", "0"}], ",", RowBox[{RowBox[{"(", RowBox[{"1", "-", "\[Lambda]"}], ")"}], "p2", RowBox[{"(", RowBox[{RowBox[{"-", RowBox[{RowBox[{"(", RowBox[{"qk", "-", "qr"}], ")"}], "^", RowBox[{"(", RowBox[{RowBox[{"-", "1"}], "+", "p2"}], ")"}]}]}], "+", RowBox[{RowBox[{"(", RowBox[{"qk", "+", "qr"}], ")"}], "^", RowBox[{"(", RowBox[{RowBox[{"-", "1"}], "+", "p2"}], ")"}]}]}], ")"}]}], ",", "0"}], "]"}]}], ")"}]}], ",", RowBox[{"Assumptions", "->", RowBox[{"{", RowBox[{"If", "[", RowBox[{RowBox[{"!", "quantum"}], ",", RowBox[{RowBox[{"qr", "^", "2"}], "==", "0"}]}], "]"}], "}"}]}]}], "]"}], ",", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "qk", "]"}], "qr"}]}], "]"}]}], ";", RowBox[{RowBox[{"\[CapitalSigma]R", "[", RowBox[{"Ktab_", ",", "Rtab_"}], "]"}], ":=", RowBox[{"\[Kappa]", RowBox[{"fR", "[", RowBox[{"Ktab", ",", "Rtab", ",", "\[Lambda]"}], "]"}]}]}], ";", RowBox[{RowBox[{"\[CapitalSigma]K", "[", RowBox[{"Ktab_", ",", "Rtab_"}], "]"}], ":=", RowBox[{"\[Kappa]", RowBox[{"fK", "[", RowBox[{"Ktab", ",", "Rtab", ",", "\[Lambda]"}], "]"}]}]}], ";", RowBox[{RowBox[{"\[CapitalSigma]K10", "[", RowBox[{"qk_", ",", "qr_"}], "]"}], "=", RowBox[{SuperscriptBox["\[CapitalSigma]K", TagBox[RowBox[{"(", RowBox[{"1", ",", "0"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"qk", ",", "qr"}], "]"}]}], ";", RowBox[{RowBox[{"\[CapitalSigma]K01", "[", RowBox[{"qk_", ",", "qr_"}], "]"}], "=", RowBox[{SuperscriptBox["\[CapitalSigma]K", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"qk", ",", "qr"}], "]"}]}], ";", RowBox[{RowBox[{"\[CapitalSigma]R10", "[", RowBox[{"qk_", ",", "qr_"}], "]"}], "=", RowBox[{SuperscriptBox["\[CapitalSigma]R", TagBox[RowBox[{"(", RowBox[{"1", ",", "0"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"qk", ",", "qr"}], "]"}]}], ";", RowBox[{RowBox[{"\[CapitalSigma]R01", "[", RowBox[{"qk_", ",", "qr_"}], "]"}], "=", RowBox[{SuperscriptBox["\[CapitalSigma]R", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"qk", ",", "qr"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"ValueQ", "[", "append", "]"}], ",", RowBox[{RowBox[{"prefK", "=", RowBox[{"{", RowBox[{RowBox[{"p", "\[Lambda]"}], ",", RowBox[{"p2", RowBox[{"(", RowBox[{"1", "-", "\[Lambda]"}], ")"}]}]}], "}"}]}], ";", RowBox[{"prefR", "=", RowBox[{"{", RowBox[{RowBox[{"p", RowBox[{"(", RowBox[{"p", "-", "1"}], ")"}], "\[Lambda]"}], ",", RowBox[{"p2", RowBox[{"(", RowBox[{"p2", "-", "1"}], ")"}], RowBox[{"(", RowBox[{"1", "-", "\[Lambda]"}], ")"}]}]}], "}"}]}], ";", RowBox[{RowBox[{"\[CapitalSigma]R", "[", RowBox[{"qk_", ",", "qr_", ",", "out_"}], "]"}], ":=", RowBox[{"\[CapitalSigma]Rnum", "[", RowBox[{"qk", ",", "qr", ",", RowBox[{"1.", "prefR"}], ",", "out"}], "]"}]}], ";", RowBox[{RowBox[{"\[CapitalSigma]K", "[", RowBox[{"qk_", ",", "qr_", ",", "out_"}], "]"}], ":=", RowBox[{"\[CapitalSigma]Knum", "[", RowBox[{"qk", ",", RowBox[{"1.", "prefK"}], ",", "out"}], "]"}]}]}]}], "]"}], ";", RowBox[{RowBox[{"\[CapitalSigma]R1", "[", RowBox[{"Ktab_", ",", "Rtab_", ",", "t1_"}], "]"}], ":=", RowBox[{"\[Kappa]", RowBox[{"fR", "[", RowBox[{RowBox[{"Ktab", "[", RowBox[{"[", "t1", "]"}], "]"}], ",", RowBox[{"Rtab", "[", RowBox[{"[", "t1", "]"}], "]"}], ",", "\[Lambda]"}], "]"}]}]}], ";", RowBox[{RowBox[{"\[CapitalSigma]K1", "[", RowBox[{"Ktab_", ",", "Rtab_", ",", "t1_"}], "]"}], ":=", RowBox[{"\[Kappa]", RowBox[{"fK", "[", RowBox[{RowBox[{"Ktab", "[", RowBox[{"[", "t1", "]"}], "]"}], ",", RowBox[{"Rtab", "[", RowBox[{"[", "t1", "]"}], "]"}], ",", "\[Lambda]"}], "]"}]}]}], ";", RowBox[{RowBox[{"\[CapitalSigma]R2", "[", RowBox[{"Ktab_", ",", "Rtab_", ",", "t2_"}], "]"}], ":=", RowBox[{"\[Kappa]", RowBox[{"fR", "[", RowBox[{RowBox[{"Ktab", "[", RowBox[{"[", RowBox[{"All", ",", "t2"}], "]"}], "]"}], ",", RowBox[{"Rtab", "[", RowBox[{"[", RowBox[{"All", ",", "t2"}], "]"}], "]"}], ",", "\[Lambda]"}], "]"}]}]}], ";", RowBox[{RowBox[{"\[CapitalSigma]K2", "[", RowBox[{"Ktab_", ",", "Rtab_", ",", "t2_"}], "]"}], ":=", RowBox[{"\[Kappa]", RowBox[{"fK", "[", RowBox[{RowBox[{"Ktab", "[", RowBox[{"[", RowBox[{"All", ",", "t2"}], "]"}], "]"}], ",", RowBox[{"Rtab", "[", RowBox[{"[", RowBox[{"All", ",", "t2"}], "]"}], "]"}], ",", "\[Lambda]"}], "]"}]}]}], ";", RowBox[{RowBox[{"f\[Lambda]", "[", "q_", "]"}], ":=", RowBox[{RowBox[{"\[Lambda]", RowBox[{"q", "^", "p"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"1", "-", "\[Lambda]"}], ")"}], RowBox[{"q", "^", "p2"}]}]}]}], ";", RowBox[{RowBox[{"EIS", "[", "\[Chi]_", "]"}], ":=", RowBox[{RowBox[{RowBox[{"-", RowBox[{"f\[Lambda]", "[", "1", "]"}]}], RowBox[{"(", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{"\[Chi]", RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}], ")"}]}], "-", "\[Chi]"}], ")"}]}], "-", RowBox[{"\[Chi]", RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}]}]}], ";", RowBox[{RowBox[{"\[CapitalDelta]E", "[", "\[Lambda]_", "]"}], ":=", RowBox[{RowBox[{"EIS", "[", RowBox[{RowBox[{"Sqrt", "[", RowBox[{"f\[Lambda]", "[", "1", "]"}], "]"}], "/", RowBox[{"Sqrt", "[", RowBox[{RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "^", "2"}], "-", RowBox[{RowBox[{"f\[Lambda]", "[", "1", "]"}], RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}]}], "]"}]}], "]"}], "-", RowBox[{"EIS", "[", RowBox[{"1", "/", RowBox[{"Sqrt", "[", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "]"}]}], "]"}]}]}], ";", RowBox[{"q1", ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", "q", "}"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"\[Gamma]", "!=", "0"}], ",", RowBox[{"q", "/.", RowBox[{RowBox[{"NSolve", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{RowBox[{RowBox[{"1", "/", RowBox[{RowBox[{"(", RowBox[{"1", "-", "q"}], ")"}], "^", "2"}]}], "-", RowBox[{RowBox[{RowBox[{"(", RowBox[{"f\[Lambda]", "^", "\[Prime]\[Prime]"}], ")"}], "[", "q", "]"}], "/", RowBox[{"\[Gamma]", "^", "2"}]}]}], "==", "0"}], ",", RowBox[{"1", ">", "q", ">", "0"}]}], "}"}], ",", "q"}], "]"}], "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], ",", "1"}], "]"}]}], "]"}]}], ";", RowBox[{"\[Mu]\[Infinity]", ":=", RowBox[{"If", "[", RowBox[{RowBox[{"\[Gamma]", "!=", "0"}], ",", RowBox[{"\[Gamma]", RowBox[{"(", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{"1", "-", "q1"}], ")"}]}], "-", RowBox[{RowBox[{"1", "/", RowBox[{"\[Gamma]", "^", "2"}]}], RowBox[{"(", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "q1", "]"}], "-", RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}], ")"}]}]}], ")"}]}], ",", RowBox[{"2", RowBox[{"Sqrt", "[", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "]"}]}]}], "]"}]}], ";", RowBox[{"xth", ":=", RowBox[{"If", "[", RowBox[{RowBox[{"\[Gamma]", "!=", "0"}], ",", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"1", "/", "\[Gamma]"}], RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "q1", "]"}], RowBox[{"(", RowBox[{"1", "-", "q1"}], ")"}]}], ")"}]}], "+", RowBox[{RowBox[{"1", "/", "\[Gamma]"}], RowBox[{RowBox[{"(", RowBox[{"q1", "-", "1"}], ")"}], "/", "q1"}]}]}], ",", RowBox[{"(", RowBox[{RowBox[{RowBox[{"Sqrt", "[", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}], "-", RowBox[{"1", "/", RowBox[{"Sqrt", "[", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "]"}]}]}], ")"}]}], "]"}]}], ";", RowBox[{RowBox[{"Observable", "[", RowBox[{"n_", ",", "QK_", ",", "QR_", ",", "t_"}], "]"}], ":=", RowBox[{RowBox[{"t", RowBox[{RowBox[{"(", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "n", "]"}], "[", "f\[Lambda]", "]"}], "[", "QK", "]"}], "*", "QR"}], ")"}], ".", "int"}]}], "+", RowBox[{RowBox[{"1", "/", "T0"}], RowBox[{RowBox[{RowBox[{"Derivative", "[", RowBox[{"n", "-", "1"}], "]"}], "[", "f\[Lambda]", "]"}], "[", RowBox[{"If", "[", RowBox[{RowBox[{"MatrixQ", "[", "QK", "]"}], ",", RowBox[{"QK", "[", RowBox[{"[", RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", RowBox[{"QK", "[", RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}]}]}], ";", RowBox[{RowBox[{"Obs\[Infinity]", "[", "n_", "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{"\[Gamma]", "!=", "0"}], ",", RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{RowBox[{"1", "/", "\[Gamma]"}], RowBox[{RowBox[{RowBox[{"Derivative", "[", RowBox[{"n", "-", "1"}], "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"xth", "-", RowBox[{"1", "/", "\[Gamma]"}]}], ")"}], RowBox[{RowBox[{RowBox[{"Derivative", "[", RowBox[{"n", "-", "1"}], "]"}], "[", "f\[Lambda]", "]"}], "[", "q1", "]"}]}], "-", RowBox[{"xth", RowBox[{RowBox[{RowBox[{"Derivative", "[", RowBox[{"n", "-", "1"}], "]"}], "[", "f\[Lambda]", "]"}], "[", "0", "]"}]}]}], ")"}]}], ",", RowBox[{RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "n", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "/", RowBox[{"Sqrt", "[", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "]"}]}], "+", RowBox[{"xth", RowBox[{"(", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", RowBox[{"n", "-", "1"}], "]"}], "[", "f\[Lambda]", "]"}], "[", "q1", "]"}], "-", RowBox[{RowBox[{RowBox[{"Derivative", "[", RowBox[{"n", "-", "1"}], "]"}], "[", "f\[Lambda]", "]"}], "[", "0", "]"}]}], ")"}]}]}]}], "]"}]}], ";", RowBox[{RowBox[{"Energy", "[", RowBox[{"QK_", ",", "QR_", ",", "t_", ",", "\[Beta]_"}], "]"}], ":=", RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"t", RowBox[{RowBox[{"(", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "QK", "]"}], "*", "QR"}], ")"}], ".", "int"}]}], "+", RowBox[{"\[Beta]", RowBox[{"f\[Lambda]", "[", RowBox[{"If", "[", RowBox[{RowBox[{"MatrixQ", "[", "QK", "]"}], ",", RowBox[{"QK", "[", RowBox[{"[", RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", RowBox[{"QK", "[", RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}]}], ")"}]}]}], ";", RowBox[{"Eth", ":=", RowBox[{RowBox[{"Sqrt", "[", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{RowBox[{"f\[Lambda]", "[", "1", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}], "-", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}], "-", RowBox[{RowBox[{"f\[Lambda]", "[", "1", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}]}], ")"}]}]}], ";", RowBox[{"Tsf", ":=", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", RowBox[{"Sqrt", "[", RowBox[{"1", "-", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}]}], "]"}], "]"}], "/", RowBox[{"Sqrt", "[", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "-", RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}], "]"}]}]}], ";", RowBox[{"TMCT", ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", "q1", "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"sol", "=", RowBox[{"NSolve", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{RowBox[{RowBox[{"\[Beta]mct", "^", "2"}], RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "q1", "]"}], RowBox[{"(", RowBox[{"1", "-", "q1"}], ")"}]}], "==", "q1"}], ",", RowBox[{RowBox[{RowBox[{"\[Beta]mct", "^", "2"}], RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "q1", "]"}], RowBox[{RowBox[{"(", RowBox[{"1", "-", "q1"}], ")"}], "^", "2"}]}], "==", "1"}], ",", RowBox[{"q1", ">", "0"}], ",", RowBox[{"\[Beta]mct", ">", "0"}]}], "}"}], ",", RowBox[{"{", RowBox[{"q1", ",", "\[Beta]mct"}], "}"}], ",", "Reals"}], "]"}]}], "}"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"sol", "===", RowBox[{"{", "}"}]}], ",", "1", ",", RowBox[{RowBox[{"1", "/", "\[Beta]mct"}], "/.", RowBox[{"sol", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}], "]"}]}], "]"}]}], ";", RowBox[{"Block", "[", RowBox[{RowBox[{"{", "\[Lambda]", "}"}], ",", RowBox[{RowBox[{"\[Lambda]tab", "=", RowBox[{"Table", "[", RowBox[{RowBox[{"\[Lambda]", "/.", RowBox[{RowBox[{"NMaximize", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"\[CapitalDelta]E", "[", "\[Lambda]", "]"}], ",", RowBox[{"0", "<", "\[Lambda]", "<", "1"}]}], "}"}], ",", "\[Lambda]", ",", RowBox[{"Method", "->", "\"NelderMead\""}]}], "]"}], "[", RowBox[{"[", "2", "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"p2", ",", "p", ",", RowBox[{"p", "+", "12"}]}], "}"}], ",", RowBox[{"{", RowBox[{"p", ",", "2", ",", "3"}], "}"}]}], "]"}]}], ";", RowBox[{RowBox[{"\[Lambda]tab", "[", RowBox[{"[", "1", "]"}], "]"}], "=", RowBox[{"{", RowBox[{"0.5", ",", "0.5"}], "}"}]}]}]}], "]"}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"grad", "[", "n_", "]"}], ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"sgm", "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"-", "1"}], ")"}], "^", RowBox[{"Range", "[", RowBox[{"0", ",", "n"}], "]"}]}], RowBox[{"Binomial", "[", RowBox[{"n", ",", RowBox[{"Range", "[", RowBox[{"0", ",", "n"}], "]"}]}], "]"}]}]}], ",", "temp"}], "}"}], ",", RowBox[{RowBox[{"temp", "=", RowBox[{RowBox[{"1.", "/", RowBox[{"Total", "[", RowBox[{"Abs", "[", "sgm", "]"}], "]"}]}], RowBox[{"SparseArray", "[", RowBox[{RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Band", "[", RowBox[{"{", RowBox[{RowBox[{"Max", "[", RowBox[{RowBox[{RowBox[{RowBox[{"1", "/", "2"}], RowBox[{"(", RowBox[{RowBox[{"Length", "[", "sgm", "]"}], "+", "3"}], ")"}]}], "-", "x"}], ",", "1"}], "]"}], ",", RowBox[{"Max", "[", RowBox[{RowBox[{RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{"1", "/", "2"}], ")"}]}], RowBox[{"(", RowBox[{RowBox[{"Length", "[", "sgm", "]"}], "-", "1"}], ")"}]}], "+", "x"}], ",", "1"}], "]"}]}], "}"}], "]"}], "->", RowBox[{"sgm", "[", RowBox[{"[", "x", "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"x", ",", RowBox[{"Length", "[", "sgm", "]"}]}], "}"}]}], "]"}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}]}], ";", RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"temp", "[", RowBox[{"[", "m", "]"}], "]"}], "=", RowBox[{"temp", "[", RowBox[{"[", RowBox[{RowBox[{"n", "/", "2"}], "+", "1"}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"m", ",", "1", ",", RowBox[{"n", "/", "2"}]}], "}"}]}], "]"}], ";", RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"temp", "[", RowBox[{"[", RowBox[{"-", "m"}], "]"}], "]"}], "=", RowBox[{"temp", "[", RowBox[{"[", RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"n", "/", "2"}], "+", "1"}], ")"}]}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"m", ",", "1", ",", RowBox[{"n", "/", "2"}]}], "}"}]}], "]"}], ";", "temp"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"outer", "[", RowBox[{"x_", ",", "y_"}], "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{"AllTrue", "[", RowBox[{RowBox[{"{", RowBox[{"x", ",", "y"}], "}"}], ",", RowBox[{RowBox[{RowBox[{"Dimensions", "[", "#", "]"}], "!=", RowBox[{"{", "}"}]}], "&"}]}], "]"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{"KroneckerProduct", "[", RowBox[{"x", ",", "y"}], "]"}], ",", RowBox[{"Join", "[", RowBox[{RowBox[{"Dimensions", "[", "x", "]"}], ",", RowBox[{"Dimensions", "[", "y", "]"}]}], "]"}]}], "]"}], ",", RowBox[{"x", "y"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"diff", ":=", RowBox[{RowBox[{RowBox[{"Rest", "[", "#", "]"}], "-", RowBox[{"Most", "[", "#", "]"}]}], "&"}]}], ";"}]
RowBox[{RowBox[{"dot", ":=", RowBox[{RowBox[{"Append", "[", RowBox[{RowBox[{"#1", ".", RowBox[{"#2", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"1", ";;", "2"}]}], "]"}], "]"}]}], ",", RowBox[{"#1", ".", RowBox[{"#2", "[", RowBox[{"[", RowBox[{"All", ",", "3"}], "]"}], "]"}]}]}], "]"}], "&"}]}], ";"}]
RowBox[{RowBox[{"bsearch", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Complex", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", "0"}], ",", "diff1"}], "}"}], ",", RowBox[{RowBox[{"While", "[", RowBox[{RowBox[{"n0", "<=", "n1"}], ",", RowBox[{RowBox[{"m", "=", RowBox[{"Quotient", "[", RowBox[{RowBox[{"n0", "+", "n1"}], ",", "2"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "==", "elem"}], ",", RowBox[{"Return", "[", "m", "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}], ";", RowBox[{"diff1", "=", RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "-", "elem"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"diff1", "<=", RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"Min", "[", RowBox[{RowBox[{"m", "+", "1"}], ",", RowBox[{"Length", "[", "list", "]"}]}], "]"}], "]"}], "]"}], "-", "elem"}], "]"}]}], ",", "m", ",", RowBox[{"m", "+", "1"}]}], "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"diff1", "<=", RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"Max", "[", RowBox[{RowBox[{"m", "-", "1"}], ",", "1"}], "]"}], "]"}], "]"}], "-", "elem"}], "]"}]}], ",", "m", ",", RowBox[{"m", "-", "1"}]}], "]"}]}], "]"}]}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"bsearchMin", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Complex", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", "0"}]}], "}"}], ",", RowBox[{RowBox[{"While", "[", RowBox[{RowBox[{"n0", "<=", "n1"}], ",", RowBox[{RowBox[{"m", "=", RowBox[{"Quotient", "[", RowBox[{RowBox[{"n0", "+", "n1"}], ",", "2"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "==", "elem"}], ",", RowBox[{"Return", "[", RowBox[{"m", "-", "1."}], "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"m", "+", RowBox[{"1", "/", "2"}]}], ",", RowBox[{"m", "-", RowBox[{"1", "/", "2"}]}]}], "]"}]}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"bsearchVal", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", "0"}]}], "}"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"elem", ">", RowBox[{"list", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], ",", "elem", ",", RowBox[{RowBox[{"While", "[", RowBox[{RowBox[{"n0", "<=", "n1"}], ",", RowBox[{RowBox[{"m", "=", RowBox[{"Quotient", "[", RowBox[{RowBox[{"n0", "+", "n1"}], ",", "2"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "==", "elem"}], ",", RowBox[{"Return", "[", RowBox[{"list", "[", RowBox[{"[", RowBox[{"Min", "[", RowBox[{"m", ",", RowBox[{RowBox[{"Length", "[", "list", "]"}], "-", "1"}]}], "]"}], "]"}], "]"}], "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"list", "[", RowBox[{"[", RowBox[{"Min", "[", RowBox[{"m", ",", RowBox[{RowBox[{"Length", "[", "list", "]"}], "-", "1"}]}], "]"}], "]"}], "]"}], ",", RowBox[{"list", "[", RowBox[{"[", RowBox[{"Max", "[", RowBox[{RowBox[{"m", "-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "]"}]}]}], "]"}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}], ",", RowBox[{"RuntimeOptions", "->", "\"Speed\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"bsearchInd", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", "0"}]}], "}"}], ",", RowBox[{RowBox[{"While", "[", RowBox[{RowBox[{"n0", "<=", "n1"}], ",", RowBox[{RowBox[{"m", "=", RowBox[{"Quotient", "[", RowBox[{RowBox[{"n0", "+", "n1"}], ",", "2"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "==", "elem"}], ",", RowBox[{"Return", "[", RowBox[{"Min", "[", RowBox[{"m", ",", RowBox[{RowBox[{"Length", "[", "list", "]"}], "-", "1"}]}], "]"}], "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"Min", "[", RowBox[{"m", ",", RowBox[{RowBox[{"Length", "[", "list", "]"}], "-", "1"}]}], "]"}], ",", RowBox[{"Max", "[", RowBox[{RowBox[{"m", "-", "1"}], ",", "1"}], "]"}]}], "]"}]}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}], ",", RowBox[{"RuntimeOptions", "->", "\"Speed\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"bsearchInd2", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", "0"}]}], "}"}], ",", RowBox[{RowBox[{"While", "[", RowBox[{RowBox[{"n0", "<=", "n1"}], ",", RowBox[{RowBox[{"m", "=", RowBox[{"Quotient", "[", RowBox[{RowBox[{"n0", "+", "n1"}], ",", "2"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "==", "elem"}], ",", RowBox[{"Return", "[", RowBox[{"Min", "[", RowBox[{"m", ",", RowBox[{"Length", "[", "list", "]"}]}], "]"}], "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"Min", "[", RowBox[{"m", ",", RowBox[{"Length", "[", "list", "]"}]}], "]"}], ",", RowBox[{"Max", "[", RowBox[{RowBox[{"m", "-", "1"}], ",", "1"}], "]"}]}], "]"}]}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}], ",", RowBox[{"RuntimeOptions", "->", "\"Speed\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"bsearchIndSorted", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", "1"}]}], "}"}], ",", RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", RowBox[{"elem", "[", RowBox[{"[", "l", "]"}], "]"}]}], ",", RowBox[{"While", "[", RowBox[{RowBox[{"n0", "<=", "n1"}], ",", RowBox[{RowBox[{"m", "=", RowBox[{"Quotient", "[", RowBox[{RowBox[{"n0", "+", "n1"}], ",", "2"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "==", RowBox[{"elem", "[", RowBox[{"[", "l", "]"}], "]"}]}], ",", RowBox[{RowBox[{"n0", "=", "m"}], ";", RowBox[{"Min", "[", RowBox[{"m", ",", RowBox[{RowBox[{"Length", "[", "list", "]"}], "-", "1"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", RowBox[{"elem", "[", RowBox[{"[", "l", "]"}], "]"}]}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}]}], "]"}], ";", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", RowBox[{"elem", "[", RowBox[{"[", "l", "]"}], "]"}]}], ",", RowBox[{"Min", "[", RowBox[{"m", ",", RowBox[{RowBox[{"Length", "[", "list", "]"}], "-", "1"}]}], "]"}], ",", RowBox[{"Max", "[", RowBox[{RowBox[{"m", "-", "1"}], ",", "1"}], "]"}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"l", ",", RowBox[{"Length", "[", "elem", "]"}]}], "}"}]}], "]"}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}], ",", RowBox[{"RuntimeOptions", "->", "\"Speed\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"bsearchPosSorted", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", "1"}], ",", RowBox[{"Lm", "=", "1."}], ",", RowBox[{"El", "=", "1."}]}], "}"}], ",", RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"El", "=", RowBox[{"elem", "[", RowBox[{"[", "l", "]"}], "]"}]}], ";", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "El"}], ",", RowBox[{"While", "[", RowBox[{RowBox[{"n0", "<=", "n1"}], ",", RowBox[{RowBox[{"m", "=", RowBox[{"Quotient", "[", RowBox[{RowBox[{"n0", "+", "n1"}], ",", "2"}], "]"}]}], ";", RowBox[{"Lm", "=", RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "==", "El"}], ",", RowBox[{"n0", "=", "m"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "<", "El"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}]}], "]"}], ";", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "<=", "El"}], ",", RowBox[{"m", "+", RowBox[{"If", "[", RowBox[{RowBox[{"m", "==", RowBox[{"Length", "[", "list", "]"}]}], ",", "0.", ",", RowBox[{RowBox[{"(", RowBox[{"El", "-", "Lm"}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"m", "+", "1"}], "]"}], "]"}], "-", "Lm"}], ")"}]}]}], "]"}]}], ",", RowBox[{"m", "-", RowBox[{"If", "[", RowBox[{RowBox[{"m", ">", "1"}], ",", RowBox[{RowBox[{"(", RowBox[{"El", "-", "Lm"}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"m", "-", "1"}], "]"}], "]"}], "-", "Lm"}], ")"}]}], ",", "0."}], "]"}]}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"l", ",", RowBox[{"Length", "[", "elem", "]"}]}], "}"}]}], "]"}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}], ",", RowBox[{"RuntimeOptions", "->", "\"Speed\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"isearchPosSorted", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"l0", "=", "1."}], ",", RowBox[{"l1", "=", "1."}], ",", RowBox[{"len", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", "1"}], ",", RowBox[{"Lm", "=", "1."}], ",", RowBox[{"El", "=", "1."}], ",", RowBox[{"end", "=", RowBox[{"list", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], ",", "loop"}], "}"}], ",", RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"El", "=", RowBox[{"elem", "[", RowBox[{"[", "l", "]"}], "]"}]}], ";", RowBox[{"n1", "=", "len"}], ";", RowBox[{"loop", "=", "0"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "El"}], ",", RowBox[{"While", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{"l0", "=", RowBox[{"list", "[", RowBox[{"[", "n0", "]"}], "]"}]}], ")"}], "<=", "El", "<=", RowBox[{"(", RowBox[{"l1", "=", RowBox[{"list", "[", RowBox[{"[", "n1", "]"}], "]"}]}], ")"}]}], ",", RowBox[{RowBox[{"loop", "++"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"EvenQ", "[", "loop", "]"}], ",", RowBox[{"m", "=", RowBox[{"n0", "+", RowBox[{"Round", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{"El", "-", "l0"}], ")"}], "/", RowBox[{"(", RowBox[{"l1", "-", "l0"}], ")"}]}], RowBox[{"(", RowBox[{"n1", "-", "n0"}], ")"}]}], "]"}]}]}], ",", RowBox[{"m", "=", RowBox[{"Quotient", "[", RowBox[{RowBox[{"n0", "+", "n1"}], ",", "2"}], "]"}]}]}], "]"}], ";", RowBox[{"Lm", "=", RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "==", "El"}], ",", RowBox[{RowBox[{"n0", "=", "m"}], ";", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "<", "El"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}]}], "]"}], ";", RowBox[{"n1", "=", "len"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "<=", "El"}], ",", RowBox[{"m", "+", RowBox[{"If", "[", RowBox[{RowBox[{"m", "==", "len"}], ",", "0.", ",", RowBox[{RowBox[{"(", RowBox[{"El", "-", "Lm"}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"m", "+", "1"}], "]"}], "]"}], "-", "Lm"}], ")"}]}]}], "]"}]}], ",", RowBox[{"m", "-", RowBox[{"If", "[", RowBox[{RowBox[{"m", ">", "1"}], ",", RowBox[{RowBox[{"(", RowBox[{"El", "-", "Lm"}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"m", "-", "1"}], "]"}], "]"}], "-", "Lm"}], ")"}]}], ",", "0."}], "]"}]}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"l", ",", RowBox[{"Length", "[", "elem", "]"}]}], "}"}]}], "]"}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}], ",", RowBox[{"RuntimeOptions", "->", "\"Speed\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"bsearchPosSortedInit", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"init", ",", "_Integer", ",", "1"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"len", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"Lm", "=", "1."}], ",", RowBox[{"El", "=", "1."}], ",", RowBox[{"out", "=", RowBox[{"1.", RowBox[{"Length", "[", "list", "]"}]}]}]}], "}"}], ",", RowBox[{"Reverse", "[", RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"El", "=", RowBox[{"elem", "[", RowBox[{"[", "l", "]"}], "]"}]}], ";", RowBox[{"n1", "=", RowBox[{"Min", "[", RowBox[{RowBox[{"Ceiling", "[", "out", "]"}], ",", "len"}], "]"}]}], ";", RowBox[{"n0", "=", RowBox[{"init", "[", RowBox[{"[", "l", "]"}], "]"}]}], ";", RowBox[{"m", "=", RowBox[{"Min", "[", RowBox[{RowBox[{"n0", "+", "1"}], ",", "len"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{"Lm", "=", RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}]}], ")"}], ">", "El"}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "2"}]}]}], "]"}], ";", RowBox[{"While", "[", RowBox[{RowBox[{"n0", "<=", "n1"}], ",", RowBox[{RowBox[{"m", "=", RowBox[{"Quotient", "[", RowBox[{RowBox[{"n0", "+", "n1"}], ",", "2"}], "]"}]}], ";", RowBox[{"Lm", "=", RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "==", "El"}], ",", RowBox[{"n0", "=", "m"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "<", "El"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}], ";", RowBox[{"out", "=", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "<=", "El"}], ",", RowBox[{"m", "+", RowBox[{"If", "[", RowBox[{RowBox[{"m", "==", "len"}], ",", "0.", ",", RowBox[{RowBox[{"(", RowBox[{"El", "-", "Lm"}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"m", "+", "1"}], "]"}], "]"}], "-", "Lm"}], ")"}]}]}], "]"}]}], ",", RowBox[{"m", "-", RowBox[{"If", "[", RowBox[{RowBox[{"m", ">", "1"}], ",", RowBox[{RowBox[{"(", RowBox[{"El", "-", "Lm"}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"m", "-", "1"}], "]"}], "]"}], "-", "Lm"}], ")"}]}], ",", "0."}], "]"}]}]}], "]"}]}]}], ",", RowBox[{"{", RowBox[{"l", ",", RowBox[{"Length", "[", "elem", "]"}], ",", "1", ",", RowBox[{"-", "1"}]}], "}"}]}], "]"}], "]"}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}], ",", RowBox[{"RuntimeOptions", "->", "\"Speed\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"isearchPosSortedInit", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"init", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"l0", "=", "1."}], ",", RowBox[{"l1", "=", "1."}], ",", RowBox[{"len", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"Lm", "=", "1."}], ",", RowBox[{"El", "=", "1."}], ",", RowBox[{"even", "=", "True"}], ",", RowBox[{"out", "=", RowBox[{"1.", RowBox[{"Length", "[", "list", "]"}]}]}]}], "}"}], ",", RowBox[{"Reverse", "[", RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"El", "=", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], RowBox[{"elem", "[", RowBox[{"[", "l", "]"}], "]"}]}]}], ";", RowBox[{"n1", "=", RowBox[{"Min", "[", RowBox[{RowBox[{"Ceiling", "[", "out", "]"}], ",", "len"}], "]"}]}], ";", RowBox[{"n0", "=", RowBox[{"IntegerPart", "[", RowBox[{"init", "[", RowBox[{"[", "l", "]"}], "]"}], "]"}]}], ";", RowBox[{"m", "=", RowBox[{"Min", "[", RowBox[{RowBox[{"n0", "+", "1"}], ",", "len"}], "]"}]}], ";", RowBox[{"even", "=", "True"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{"Lm", "=", RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}]}], ")"}], ">", "El"}], ",", RowBox[{"n1", "=", RowBox[{"Max", "[", RowBox[{RowBox[{"m", "-", "2"}], ",", "1"}], "]"}]}]}], "]"}], ";", RowBox[{"While", "[", RowBox[{RowBox[{RowBox[{RowBox[{"(", RowBox[{"l0", "=", RowBox[{"list", "[", RowBox[{"[", "n0", "]"}], "]"}]}], ")"}], "<=", "El", "<=", RowBox[{"(", RowBox[{"l1", "=", RowBox[{"list", "[", RowBox[{"[", "n1", "]"}], "]"}]}], ")"}]}], "&&", RowBox[{"n0", "<", "n1"}]}], ",", RowBox[{RowBox[{"even", "=", RowBox[{"(", RowBox[{"!", "even"}], ")"}]}], ";", RowBox[{"If", "[", RowBox[{"even", ",", RowBox[{"m", "=", RowBox[{"n0", "+", RowBox[{"Round", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{"El", "-", "l0"}], ")"}], "/", RowBox[{"(", RowBox[{"l1", "-", "l0"}], ")"}]}], RowBox[{"(", RowBox[{"n1", "-", "n0"}], ")"}]}], "]"}]}]}], ",", RowBox[{"m", "=", RowBox[{"Quotient", "[", RowBox[{RowBox[{"n0", "+", "n1"}], ",", "2"}], "]"}]}]}], "]"}], ";", RowBox[{"Lm", "=", RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "==", "El"}], ",", RowBox[{RowBox[{"n0", "=", "m"}], ";", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "<", "El"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}], ";", RowBox[{"out", "=", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "<=", "El"}], ",", RowBox[{"m", "+", RowBox[{"If", "[", RowBox[{RowBox[{"m", "==", "len"}], ",", "0.", ",", RowBox[{RowBox[{"(", RowBox[{"El", "-", "Lm"}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"m", "+", "1"}], "]"}], "]"}], "-", "Lm"}], ")"}]}]}], "]"}]}], ",", RowBox[{"m", "-", RowBox[{"If", "[", RowBox[{RowBox[{"m", ">", "1"}], ",", RowBox[{RowBox[{"(", RowBox[{"El", "-", "Lm"}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"m", "-", "1"}], "]"}], "]"}], "-", "Lm"}], ")"}]}], ",", "0."}], "]"}]}]}], "]"}]}]}], ",", RowBox[{"{", RowBox[{"l", ",", RowBox[{"Length", "[", "elem", "]"}], ",", "1", ",", RowBox[{"-", "1"}]}], "}"}]}], "]"}], "]"}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}], ",", RowBox[{"RuntimeOptions", "->", "\"Speed\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "createInterpolation", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"SyntaxInformation", "[", "createInterpolation", "]"}], "=", RowBox[{"{", RowBox[{"\"ArgumentsPattern\"", "->", RowBox[{"{", RowBox[{"_", ",", RowBox[{"OptionsPattern", "[", "]"}]}], "}"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{"SetAttributes", "[", RowBox[{"createInterpolation", ",", "HoldAll"}], "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "createInterpolation", "]"}], "=", RowBox[{"{", RowBox[{RowBox[{"\"Mult\"", "->", "0"}], ",", RowBox[{"\"precision\"", "->", "precision"}], ",", RowBox[{"\"t1\"", "->", "False"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"createInterpolation", "[", RowBox[{RowBox[{"{", RowBox[{"points_", ",", RowBox[{"padding", ":", RowBox[{"_", "?", "NumericQ"}], ":", "0"}], ",", RowBox[{"cmatIn_", ":", "0"}]}], "}"}], ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"temp", "=", RowBox[{"splineCoeffs", "[", RowBox[{RowBox[{"{", RowBox[{"points", ",", "cmatIn", ",", RowBox[{"OptionValue", "[", "\"precision\"", "]"}], ",", "padding"}], "}"}], ",", RowBox[{"\"All\"", "->", "True"}], ",", RowBox[{"\"Mixed\"", "->", "False"}]}], "]"}]}], "}"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"t1\"", "]"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "temp", "]"}], "]"}], "===", "1"}], ",", RowBox[{RowBox[{"temp", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "=", RowBox[{"Rest", "[", RowBox[{"temp", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "]"}]}]}], "]"}], ";", RowBox[{"Interpolt1", "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"points", "+", RowBox[{"10.", "^", RowBox[{"-", "200"}]}]}], ")"}], "^", RowBox[{"OptionValue", "[", "\"Mult\"", "]"}]}], "*", RowBox[{"Transpose", "[", RowBox[{RowBox[{"temp", "+", RowBox[{"10.", "^", RowBox[{"-", "200"}]}]}], ",", RowBox[{"{", RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"Interpolt1T", "=", RowBox[{"Table", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"1.", RowBox[{"Chop", "[", RowBox[{RowBox[{"Interpolt1", "[", RowBox[{"[", RowBox[{"All", ",", "All", ",", "n"}], "]"}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", "20"}]}]}], "]"}]}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", RowBox[{"Length", "[", RowBox[{"Interpolt1", "[", RowBox[{"[", RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "temp", "]"}], "]"}], "===", "1"}], ",", RowBox[{RowBox[{"temp", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "=", RowBox[{"Rest", "[", RowBox[{"temp", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "]"}]}]}], "]"}], ";", RowBox[{"Interpolt", "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"points", "+", RowBox[{"10.", "^", RowBox[{"-", "200"}]}]}], ")"}], "^", RowBox[{"OptionValue", "[", "\"Mult\"", "]"}]}], "*", RowBox[{"Transpose", "[", RowBox[{RowBox[{"temp", "+", RowBox[{"10.", "^", RowBox[{"-", "200"}]}]}], ",", RowBox[{"{", RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"InterpoltT", "=", RowBox[{"Table", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"1.", RowBox[{"Chop", "[", RowBox[{RowBox[{"Interpolt", "[", RowBox[{"[", RowBox[{"All", ",", "All", ",", "n"}], "]"}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", "20"}]}]}], "]"}]}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", RowBox[{"Length", "[", RowBox[{"Interpolt", "[", RowBox[{"[", RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}]}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "createHermite", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"createHermite", "[", RowBox[{"points_", ",", "ord_"}], "]"}], ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"y", ",", "d1", ",", "d2", ",", "poly", ",", "df", ",", "dx", ",", "dfmat", ",", RowBox[{"l", "=", "0"}], ",", "f"}], "}"}], ",", RowBox[{RowBox[{"poly", "=", RowBox[{"FullSimplify", "[", RowBox[{"CoefficientList", "[", RowBox[{RowBox[{"InterpolatingPolynomial", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"Prepend", "[", RowBox[{RowBox[{"Map", "[", RowBox[{"d1", ",", RowBox[{"Range", "[", RowBox[{"0", ",", RowBox[{"Round", "[", RowBox[{RowBox[{"(", RowBox[{"ord", "-", "1"}], ")"}], "/", "2"}], "]"}]}], "]"}]}], "]"}], ",", "0"}], "]"}], ",", RowBox[{"Prepend", "[", RowBox[{RowBox[{"Map", "[", RowBox[{"d2", ",", RowBox[{"Range", "[", RowBox[{"0", ",", RowBox[{"Round", "[", RowBox[{RowBox[{"(", RowBox[{"ord", "-", "1"}], ")"}], "/", "2"}], "]"}]}], "]"}]}], "]"}], ",", "dx"}], "]"}]}], "}"}], ",", "y"}], "]"}], ",", "y"}], "]"}], "]"}]}], ";", RowBox[{"df", "=", RowBox[{"Table", "[", RowBox[{RowBox[{"NDSolve`FiniteDifferenceDerivative", "[", RowBox[{"n", ",", "points", ",", RowBox[{"Map", "[", RowBox[{"f", ",", RowBox[{"Range", "[", RowBox[{"Length", "[", "points", "]"}], "]"}]}], "]"}], ",", RowBox[{"\"DifferenceOrder\"", "->", RowBox[{"ord", "+", "l", "-", "n"}]}]}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", "1", ",", RowBox[{"Round", "[", RowBox[{RowBox[{"(", RowBox[{"ord", "-", "1"}], ")"}], "/", "2"}], "]"}]}], "}"}]}], "]"}]}], ";", RowBox[{"dfmat", "=", RowBox[{"Table", "[", RowBox[{RowBox[{"Sum", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"{", RowBox[{"#", ",", RowBox[{RowBox[{"Clip", "[", RowBox[{RowBox[{"#", "-", RowBox[{"Ceiling", "[", RowBox[{RowBox[{"(", RowBox[{"ord", "+", "l", "-", "1"}], ")"}], "/", "2"}], "]"}]}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", "ord", "+", "1", "-", "l"}]}], "}"}]}], "]"}], "+", "n"}]}], "}"}], "->", RowBox[{"Coefficient", "[", RowBox[{RowBox[{"df", "[", RowBox[{"[", RowBox[{"m", ",", "#"}], "]"}], "]"}], ",", RowBox[{"f", "[", RowBox[{RowBox[{"Clip", "[", RowBox[{RowBox[{"#", "-", RowBox[{"Ceiling", "[", RowBox[{RowBox[{"(", RowBox[{"ord", "+", "l", "-", "1"}], ")"}], "/", "2"}], "]"}]}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", "ord", "+", "1", "-", "l"}]}], "}"}]}], "]"}], "+", "n"}], "]"}]}], "]"}]}], ")"}], "&"}], "/@", RowBox[{"Range", "[", "len", "]"}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{"ord", "+", "l", "-", "1"}]}], "}"}]}], "]"}], ",", RowBox[{"{", RowBox[{"m", ",", RowBox[{"Length", "[", "df", "]"}]}], "}"}]}], "]"}]}], ";", RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"d1", "[", "n", "]"}], "=", RowBox[{"Transpose", "[", RowBox[{"Most", "[", RowBox[{"dfmat", "[", RowBox[{"[", "n", "]"}], "]"}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", RowBox[{"Length", "[", "dfmat", "]"}]}], "}"}]}], "]"}], ";", RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"d2", "[", "n", "]"}], "=", RowBox[{"Transpose", "[", RowBox[{"Rest", "[", RowBox[{"dfmat", "[", RowBox[{"[", "n", "]"}], "]"}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", RowBox[{"Length", "[", "dfmat", "]"}]}], "}"}]}], "]"}], ";", RowBox[{RowBox[{"d1", "[", "0", "]"}], "=", RowBox[{"Transpose", "[", RowBox[{"Most", "[", RowBox[{"IdentityMatrix", "[", RowBox[{"Length", "[", "points", "]"}], "]"}], "]"}], "]"}]}], ";", RowBox[{RowBox[{"d2", "[", "0", "]"}], "=", RowBox[{"Transpose", "[", RowBox[{"Rest", "[", RowBox[{"IdentityMatrix", "[", RowBox[{"Length", "[", "points", "]"}], "]"}], "]"}], "]"}]}], ";", RowBox[{"dx", "=", RowBox[{"ConstantArray", "[", RowBox[{RowBox[{"diff", "[", "points", "]"}], ",", RowBox[{"Length", "[", "points", "]"}]}], "]"}]}], ";", RowBox[{"InterpoltT", "=", RowBox[{RowBox[{RowBox[{"SparseArray", "[", "#", "]"}], "&"}], "/@", "poly"}]}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"cInterpol", "[", RowBox[{"points_", ",", RowBox[{"F_", "/;", RowBox[{"VectorQ", "[", RowBox[{"F", ",", "realvaluedQ"}], "]"}]}]}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"inds", "=", RowBox[{"bsearchIndSorted", "[", RowBox[{"\[Theta]points", ",", "points"}], "]"}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"diff", "=", RowBox[{"Max", "[", RowBox[{"diff", "[", "\[Theta]points", "]"}], "]"}]}], "}"}], ",", RowBox[{"Total", "[", RowBox[{RowBox[{"(", RowBox[{RowBox[{RowBox[{"F", ".", "#"}], "&"}], "/@", RowBox[{"InterpoltT", "[", RowBox[{"[", RowBox[{"All", ",", "All", ",", "inds"}], "]"}], "]"}]}], ")"}], "*", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"Clip", "[", RowBox[{RowBox[{"points", "-", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[Theta]points", "[", RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "inds"}], ")"}]}], ",", RowBox[{"{", RowBox[{RowBox[{"-", "diff"}], ",", "diff"}], "}"}]}], "]"}], "+", RowBox[{"10.", "^", RowBox[{"-", "80"}]}]}], ")"}], "^", "n"}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", "InterpoltT", "]"}], "-", "1"}]}], "}"}]}], "]"}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"cInterpol", "[", "add_", "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"inds", "=", RowBox[{"bsearchIndSorted", "[", RowBox[{"\[Theta]points", ",", "add"}], "]"}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"diff", "=", RowBox[{"Max", "[", RowBox[{"diff", "[", "\[Theta]points", "]"}], "]"}]}], "}"}], ",", RowBox[{"Total", "[", RowBox[{RowBox[{"Developer`ToPackedArray", "[", RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"Clip", "[", RowBox[{RowBox[{"add", "-", RowBox[{"\[Theta]points", "[", RowBox[{"[", "inds", "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{RowBox[{"-", "diff"}], ",", "diff"}], "}"}]}], "]"}], "+", RowBox[{"10.", "^", RowBox[{"-", "80"}]}]}], ")"}], "^", "n"}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", "InterpoltT", "]"}], "-", "1"}]}], "}"}]}], "]"}], "]"}], "*", RowBox[{"Transpose", "[", RowBox[{RowBox[{"InterpoltT", "[", RowBox[{"[", RowBox[{"All", ",", "All", ",", "inds"}], "]"}], "]"}], ",", RowBox[{"{", RowBox[{"1", ",", "3", ",", "2"}], "}"}]}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"resort2", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Real", ",", "2"}], "}"}], ",", RowBox[{"{", RowBox[{"inds", ",", "_Integer", ",", "1"}], "}"}]}], "}"}], ",", RowBox[{"Table", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{RowBox[{"inds", "[", RowBox[{"[", "n", "]"}], "]"}], ",", "n"}], "]"}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", RowBox[{"Length", "[", "inds", "]"}]}], "}"}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}], ",", RowBox[{"RuntimeOptions", "->", "\"Speed\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"resort3", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Real", ",", "3"}], "}"}], ",", RowBox[{"{", RowBox[{"inds", ",", "_Integer", ",", "1"}], "}"}]}], "}"}], ",", RowBox[{"Table", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"inds", "[", RowBox[{"[", "n", "]"}], "]"}], ",", "n"}], "]"}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", RowBox[{"Length", "[", "inds", "]"}]}], "}"}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}], ",", RowBox[{"RuntimeOptions", "->", "\"Speed\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"resort3M", "[", RowBox[{"list_", ",", "inds_"}], "]"}], ":=", RowBox[{"Table", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"inds", "[", RowBox[{"[", "n", "]"}], "]"}], ",", "n"}], "]"}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", RowBox[{"Length", "[", "inds", "]"}]}], "}"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"logfit", "[", RowBox[{"x_", ",", "y_"}], "]"}], ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"A", ",", "\[Alpha]", ",", "f0", ",", "\[Tau]", ",", "inter", ",", "x1", ",", "\[Alpha]0", ",", RowBox[{"xpoints", "=", RowBox[{"bsearch", "[", RowBox[{"x", ",", RowBox[{"Exp", "[", RowBox[{"Subdivide", "[", RowBox[{RowBox[{"Log", "[", RowBox[{"x", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", RowBox[{"Log", "[", RowBox[{"x", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "]"}], ",", "100"}], "]"}], "]"}]}], "]"}]}]}], "}"}], ",", RowBox[{RowBox[{RowBox[{"inter", "[", "x1_", "]"}], "=", RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{"x", ",", "y"}], "}"}], "]"}], ",", RowBox[{"InterpolationOrder", "->", "3"}], ",", RowBox[{"Method", "->", "\"Spline\""}]}], "]"}], "[", "x1", "]"}]}], ";", RowBox[{"\[Alpha]0", "=", RowBox[{"Mean", "[", RowBox[{RowBox[{"x", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "inter", "]"}], "[", "x", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "inter", "]"}], "[", "x", "]"}]}]}], "+", "1"}], "]"}]}], ";", RowBox[{"FindFit", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"Log", "[", RowBox[{"x", "[", RowBox[{"[", "xpoints", "]"}], "]"}], "]"}], ",", RowBox[{"Log", "[", RowBox[{"y", "[", RowBox[{"[", "xpoints", "]"}], "]"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"{", RowBox[{RowBox[{"Log", "[", RowBox[{RowBox[{"A", RowBox[{"Exp", "[", RowBox[{"\[Alpha]", "\[Tau]"}], "]"}]}], "+", "f0"}], "]"}], ",", RowBox[{RowBox[{"-", "1"}], "<", "\[Alpha]", "<", "0"}], ",", RowBox[{"f0", ">", "0"}], ",", RowBox[{"A", ">", "0"}]}], "}"}], ",", RowBox[{"{", RowBox[{"A", ",", RowBox[{"{", RowBox[{"\[Alpha]", ",", "\[Alpha]0"}], "}"}], ",", RowBox[{"{", RowBox[{"f0", ",", RowBox[{"y", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}]}], "}"}], ",", "\[Tau]", ",", RowBox[{"NormFunction", "->", RowBox[{"(", RowBox[{RowBox[{"Norm", "[", RowBox[{"#", ",", "2"}], "]"}], "&"}], ")"}]}]}], "]"}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "sectionInt", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"sectionInt", "[", RowBox[{"{", RowBox[{"points_", ",", RowBox[{"prec_", ":", "MachinePrecision"}]}], "}"}], "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"interp3", ",", "interp5", ",", "I1", ",", "I2", ",", "d\[Omega]", ",", "pts"}], "}"}], ",", RowBox[{RowBox[{"pts", "=", RowBox[{"SetPrecision", "[", RowBox[{"points", ",", "prec"}], "]"}]}], ";", RowBox[{"d\[Omega]", "=", RowBox[{"diff", "[", "pts", "]"}]}], ";", RowBox[{"interp3", "=", RowBox[{"splineCoeffs", "[", RowBox[{"{", RowBox[{"pts", ",", "0", ",", "prec", ",", "0"}], "}"}], "]"}]}], ";", RowBox[{"interp5", "=", RowBox[{"splineCoeffs", "[", RowBox[{RowBox[{"{", RowBox[{"pts", ",", "0", ",", "prec", ",", "0"}], "}"}], ",", RowBox[{"\"Five\"", "->", "True"}]}], "]"}]}], ";", RowBox[{"I1", "=", RowBox[{RowBox[{RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{"#", "+", "1"}], ")"}]}], RowBox[{"Power", "[", RowBox[{"d\[Omega]", ",", RowBox[{"#", "+", "1"}]}], "]"}]}], "&"}], "/@", RowBox[{"Range", "[", RowBox[{"0", ",", "5"}], "]"}]}]}], ";", RowBox[{"Chop", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"Transpose", "[", RowBox[{"Total", "[", RowBox[{RowBox[{"I1", "[", RowBox[{"[", RowBox[{";;", "4"}], "]"}], "]"}], "interp3"}], "]"}], "]"}], ",", RowBox[{"Transpose", "[", RowBox[{"Total", "[", RowBox[{"I1", "interp5"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"10", "^", RowBox[{"-", "20"}]}]}], "]"}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", RowBox[{"Int\[Theta]3", ",", "Int\[Theta]5"}], "]"}], ";"}]
RowBox[{RowBox[{"Int\[Theta]3", ":=", RowBox[{RowBox[{"Prepend", "[", RowBox[{RowBox[{"Accumulate", "[", RowBox[{"#", ".", "secInt3"}], "]"}], ",", "0"}], "]"}], "&"}]}], ";"}]
RowBox[{RowBox[{"Int\[Theta]5", ":=", RowBox[{RowBox[{"Prepend", "[", RowBox[{RowBox[{"Accumulate", "[", RowBox[{"#", ".", "secInt5"}], "]"}], ",", "0"}], "]"}], "&"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "createInt", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "createInt", "]"}], "=", RowBox[{"{", RowBox[{"\"Five\"", "->", "False"}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"createInt", "[", RowBox[{RowBox[{"{", RowBox[{"\[Tau]pts_", ",", RowBox[{"cmatIn_", ":", "0"}], ",", RowBox[{"prec_", ":", "precision"}]}], "}"}], ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Quiet", "[", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"IL4jk", ",", "IL6jk", ",", "f0", ",", "f1", ",", "f2", ",", "f3", ",", "f4", ",", "f5", ",", RowBox[{"Len", "=", RowBox[{"Length", "[", "\[Tau]pts", "]"}]}]}], "}"}], ",", RowBox[{RowBox[{RowBox[{"f0", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"-", "\[Omega]1"}], "+", "\[Omega]2"}]}], ";", RowBox[{RowBox[{"f1", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "2"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "2"}]}]}], ";", RowBox[{RowBox[{"f2", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "3"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "3"}]}]}], ";", RowBox[{RowBox[{"f3", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "4"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "4"}]}]}], ";", RowBox[{RowBox[{"f4", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "5"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "5"}]}]}], ";", RowBox[{RowBox[{"f5", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "6"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "6"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", RowBox[{"IL6jk", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"f0", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f1", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f2", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f3", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f4", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f5", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}]}], "}"}], ",", "prec"}], "]"}]}], ",", RowBox[{"IL4jk", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"f0", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f1", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f2", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f3", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}]}], "}"}], ",", "prec"}], "]"}]}]}], "]"}], ";", RowBox[{"Integrator", "=", RowBox[{"Accumulate", "[", RowBox[{"Prepend", "[", RowBox[{RowBox[{"Total", "[", RowBox[{"MapThread", "[", RowBox[{"Times", ",", RowBox[{"{", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", "IL6jk", ",", "IL4jk"}], "]"}], ",", RowBox[{RowBox[{"splineCoeffs", "[", RowBox[{RowBox[{"{", RowBox[{"\[Tau]pts", ",", "cmatIn", ",", "prec", ",", "0"}], "}"}], ",", RowBox[{"\"Five\"", "->", RowBox[{"OptionValue", "[", "\"Five\"", "]"}]}]}], "]"}], "+", RowBox[{"10.", "^", RowBox[{"-", "200"}]}]}]}], "}"}]}], "]"}], "]"}], ",", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{"Length", "[", "\[Tau]pts", "]"}]}], "]"}]}], "]"}], "]"}]}], ";", RowBox[{"int", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"Integrator", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "]"}]}]}]}], "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "splineCoeffs", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"SyntaxInformation", "[", "splineCoeffs", "]"}], "=", RowBox[{"{", RowBox[{"\"ArgumentsPattern\"", "->", RowBox[{"{", RowBox[{"_", ",", RowBox[{"OptionsPattern", "[", "]"}]}], "}"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{"SetAttributes", "[", RowBox[{"splineCoeffs", ",", "HoldAll"}], "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "splineCoeffs", "]"}], "=", RowBox[{"{", RowBox[{RowBox[{"\"Five\"", "->", "False"}], ",", RowBox[{"\"Last\"", "->", "False"}], ",", RowBox[{"\"All\"", "->", "False"}], ",", RowBox[{"\"Mixed\"", "->", "True"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"splineCoeffs", "::", "padInput"}], "=", "\"interpolation matrices cannot be generated from a precomputed second-highest coefficient matrix when the padding is set to be non-zero.\""}], ";"}]
RowBox[{RowBox[{RowBox[{"splineCoeffs", "[", RowBox[{RowBox[{"{", RowBox[{"points_", ",", RowBox[{"cmatIn_", ":", "0"}], ",", RowBox[{"precIn_", ":", "precision"}], ",", RowBox[{"padding_", ":", "15"}]}], "}"}], ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"pts", ",", "h", ",", "rot", ",", "n", ",", "id", ",", "amat", ",", "bmat", ",", "cmat", ",", "cmat2", ",", "dmat", ",", "emat", ",", "emat2", ",", "fmat", ",", "prec", ",", "padfc", ",", "padfcT", ",", "mixed"}], "}"}], ",", RowBox[{RowBox[{"mixed", "=", RowBox[{RowBox[{"OptionValue", "[", "\"Mixed\"", "]"}], "&&", RowBox[{"(", RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ")"}], "&&", RowBox[{"(", RowBox[{"padding", "!=", "0"}], ")"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"!", RowBox[{"(", RowBox[{"cmatIn", "===", "0"}], ")"}]}], "&&", RowBox[{"padding", "!=", "0"}]}], ",", RowBox[{RowBox[{"Message", "[", RowBox[{"splineCoeffs", "::", "padInput"}], "]"}], ";"}], ",", RowBox[{RowBox[{RowBox[{"padfc", "[", "x_", "]"}], ":=", RowBox[{"x", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], ";", RowBox[{RowBox[{"padfcT", "[", "x_", "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "x", "]"}], ">", RowBox[{"Length", "[", "points", "]"}]}], ",", RowBox[{"x", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], "]"}], "]"}], ",", "x"}], "]"}]}], ";", RowBox[{"prec", "=", RowBox[{"If", "[", RowBox[{RowBox[{"cmatIn", "===", "0"}], ",", "precIn", ",", RowBox[{"Precision", "[", "cmatIn", "]"}]}], "]"}]}], ";", RowBox[{"pts", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"Join", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "points", ",", RowBox[{"Join", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], "-", RowBox[{"Reverse", "[", RowBox[{"Range", "[", "padding", "]"}], "]"}]}], ",", "points"}], "]"}]}], "]"}], ",", RowBox[{RowBox[{"points", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{"Range", "[", "padding", "]"}]}]}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"h", "=", RowBox[{"Subtract", "[", RowBox[{RowBox[{"RotateLeft", "[", "pts", "]"}], ",", "pts"}], "]"}]}], ";", RowBox[{"n", "=", RowBox[{"Length", "[", "pts", "]"}]}], ";", RowBox[{"rot", "=", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{RowBox[{"Band", "[", RowBox[{"{", RowBox[{"1", ",", "1"}], "}"}], "]"}], "->", RowBox[{"-", "1"}]}], ",", RowBox[{RowBox[{"Band", "[", RowBox[{"{", RowBox[{"1", ",", "2"}], "}"}], "]"}], "->", "1"}]}], "}"}], ",", RowBox[{"{", RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", RowBox[{"id", "=", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"Band", "[", RowBox[{"{", RowBox[{"1", ",", "1"}], "}"}], "]"}], "->", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Five\"", "]"}]}], ",", RowBox[{RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"g0c", ",", "g1c", ",", "coefc", ",", "coefc2", ",", "Bc", ",", "Bc2", ",", "\[CapitalDelta]\[Omega]"}], "}"}], ",", RowBox[{RowBox[{"g0c", "=", RowBox[{RowBox[{"1", "/", "3"}], "rot"}]}], ";", RowBox[{"g1c", "=", RowBox[{RowBox[{"(", RowBox[{"id", "+", "g0c"}], ")"}], RowBox[{"(", RowBox[{"3", "h"}], ")"}]}]}], ";", RowBox[{"coefc", "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"Most", "[", RowBox[{RowBox[{"(", RowBox[{"6", "h"}], ")"}], "id"}], "]"}], "+", RowBox[{"Most", "[", RowBox[{RowBox[{"(", RowBox[{"9", "h"}], ")"}], "g0c"}], "]"}], "+", RowBox[{"diff", "[", "g1c", "]"}]}], ")"}], "/", RowBox[{"Most", "[", "h", "]"}]}]}], ";", RowBox[{"Bc", "=", RowBox[{RowBox[{"diff", "[", RowBox[{"rot", "/", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "/", "3"}], ")"}], "h"}], ")"}]}], "]"}], "/", RowBox[{"Most", "[", "h", "]"}]}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{RowBox[{"coefc2", "=", RowBox[{"coefc", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], ";", RowBox[{"coefc2", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], "+", RowBox[{"RotateRight", "[", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"Most", "[", "coefc2", "]"}], ",", RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"-", "padding"}], "-", "1"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], "+", RowBox[{"RotateLeft", "[", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"-", "padding"}], "-", "1"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}], "]"}]}], "}"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";"}]}], "]"}], ";", RowBox[{"coefc", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", "1", "]"}], "]"}]}], "+", RowBox[{"RotateRight", "[", RowBox[{"id", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"Most", "[", "coefc", "]"}], ",", RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "+", RowBox[{"RotateLeft", "[", RowBox[{"id", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bc", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"zer", "=", RowBox[{"ConstantArray", "[", RowBox[{"0", ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", RowBox[{"n", "-", "padding"}], ",", RowBox[{"n", "-", RowBox[{"2", "padding"}]}]}], "]"}]}], "]"}]}], "}"}], ",", RowBox[{"Catenate", "[", RowBox[{"{", RowBox[{RowBox[{"{", "zer", "}"}], ",", RowBox[{"Most", "[", RowBox[{"padfc", "[", RowBox[{"Normal", "[", "Bc", "]"}], "]"}], "]"}], ",", RowBox[{"{", "zer", "}"}]}], "}"}], "]"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bc2", "=", RowBox[{"Bc", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{RowBox[{"Bc2", "[", RowBox[{"[", RowBox[{"{", RowBox[{RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], "]"}], "*=", "0"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"cmatIn", "===", "0"}], ",", RowBox[{RowBox[{"cmat", "=", RowBox[{"LinearSolve", "[", RowBox[{"coefc", ",", "Bc"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{"cmat2", "=", RowBox[{"LinearSolve", "[", RowBox[{"coefc2", ",", "Bc2"}], "]"}]}]}], "]"}]}], ",", RowBox[{RowBox[{"cmat", "=", "cmatIn"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"SquareMatrixQ", "[", "cmat", "]"}]}], ",", RowBox[{"cmat", "=", RowBox[{"ArrayFlatten", "[", RowBox[{"{", RowBox[{RowBox[{"{", "cmat", "}"}], ",", RowBox[{"{", RowBox[{"{", RowBox[{RowBox[{"-", RowBox[{"cmat", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "/", "2"}], "}"}], "}"}]}], "}"}], "]"}]}]}], "]"}], ";"}]}], "]"}], ";", RowBox[{"dmat", "=", RowBox[{RowBox[{"diff", "[", "cmat", "]"}], "/", RowBox[{"(", RowBox[{"3", RowBox[{"Most", "[", "h", "]"}]}], ")"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ",", RowBox[{RowBox[{"rot", "=", RowBox[{"padfc", "[", "rot", "]"}]}], ";", RowBox[{"id", "=", RowBox[{"padfc", "[", "id", "]"}]}], ";", RowBox[{"\[CapitalDelta]\[Omega]", "=", RowBox[{"Most", "[", "h", "]"}]}], ";", RowBox[{"bmat", "=", RowBox[{RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "-", RowBox[{"\[CapitalDelta]\[Omega]", RowBox[{"(", RowBox[{RowBox[{"Most", "[", "cmat", "]"}], "+", RowBox[{RowBox[{"diff", "[", "cmat", "]"}], "/", "3"}]}], ")"}]}]}]}], ";", RowBox[{"amat", "=", RowBox[{"Most", "[", "id", "]"}]}], ";", RowBox[{"cmat", "=", RowBox[{"If", "[", RowBox[{"mixed", ",", "cmat2", ",", RowBox[{"Most", "[", "cmat", "]"}]}], "]"}]}]}]}], "]"}]}]}], "]"}], ";"}], ",", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"g0q", ",", "g1q", ",", "g2q", ",", "g3q", ",", "coefq", ",", "coefq2", ",", "Bq", ",", "Bq2", ",", "\[CapitalDelta]\[Omega]"}], "}"}], ",", RowBox[{RowBox[{"g0q", "=", RowBox[{RowBox[{"1", "/", "5"}], "rot"}]}], ";", RowBox[{"g1q", "=", RowBox[{"g0q", "+", "id"}]}], ";", RowBox[{"g2q", "=", RowBox[{RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"2", RowBox[{"h", "^", "2"}]}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"3", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], "+", RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"5", RowBox[{"h", "^", "2"}]}], ")"}], "g0q"}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], ")"}]}], "+", RowBox[{"diff", "[", RowBox[{"g1q", RowBox[{"h", "^", "3"}]}], "]"}]}]}], ";", RowBox[{"g3q", "=", RowBox[{RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"2", "h"}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"3", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], "+", RowBox[{"4", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], "+", RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"g0q", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"10", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], ")"}], RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], ")"}]}], "+", RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"4", "h"}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{RowBox[{"g0q", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{"10", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], ")"}]}]}], ")"}], RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}], "^", "2"}]}], "+", "g2q"}], ")"}]}], "]"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"cmatIn", "===", "0"}], ",", RowBox[{RowBox[{"coefq", "=", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"4", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"4", "h"}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], "+", RowBox[{RowBox[{"g0q", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{"10", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}]}], ")"}]}], "+", RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], "g3q"}], "]"}]}], ")"}]}]}], ";", RowBox[{"Bq", "=", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"4", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"diff", "[", RowBox[{"rot", "/", "h"}], "]"}]}], "]"}]}], "]"}]}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{RowBox[{"coefq2", "=", RowBox[{"coefq", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], ";", RowBox[{"coefq2", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], "+", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}], ",", RowBox[{"Most", "[", "coefq2", "]"}], ",", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{RowBox[{"-", "padding"}], "-", "2"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";"}]}], "]"}], ";", RowBox[{"coefq", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"id", "[", RowBox[{"[", RowBox[{";;", "2"}], "]"}], "]"}], ",", RowBox[{"coefq", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], ",", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{"-", "2"}], ";;"}], "]"}], "]"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bq", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"zer", "=", RowBox[{"ConstantArray", "[", RowBox[{"0", ",", RowBox[{"{", RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], "}"}], ",", RowBox[{"padfc", "[", RowBox[{"Catenate", "[", RowBox[{"{", RowBox[{RowBox[{"zer", "[", RowBox[{"[", RowBox[{";;", "2"}], "]"}], "]"}], ",", RowBox[{"Normal", "[", RowBox[{"Bq", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "]"}], ",", RowBox[{"zer", "[", RowBox[{"[", RowBox[{RowBox[{"-", "2"}], ";;"}], "]"}], "]"}]}], "}"}], "]"}], "]"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bq2", "=", RowBox[{"Bq", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{RowBox[{"Bq2", "[", RowBox[{"[", RowBox[{"1", ";;", "2"}], "]"}], "]"}], "*=", "0"}], ";", RowBox[{RowBox[{"Bq2", "[", RowBox[{"[", RowBox[{RowBox[{"-", "2"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}], "*=", "0"}], ";", RowBox[{"emat", "=", RowBox[{"Chop", "[", RowBox[{RowBox[{"LinearSolve", "[", RowBox[{"coefq", ",", "Bq"}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{"emat2", "=", RowBox[{"Chop", "[", RowBox[{RowBox[{"LinearSolve", "[", RowBox[{"coefq2", ",", "Bq2"}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], "]"}]}]}], "]"}], ";"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"SquareMatrixQ", "[", "emat", "]"}]}], ",", RowBox[{"emat", "=", RowBox[{"ArrayFlatten", "[", RowBox[{"{", RowBox[{RowBox[{"{", "cmatIn", "}"}], ",", RowBox[{"{", RowBox[{"{", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{"{", "n", "}"}]}], "]"}], "}"}], "}"}]}], "}"}], "]"}]}]}], "]"}], ";"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ",", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "=", RowBox[{"Most", "[", "h", "]"}]}], ";", RowBox[{"fmat", "=", RowBox[{RowBox[{"diff", "[", "emat", "]"}], "/", RowBox[{"(", RowBox[{"5", "\[CapitalDelta]\[Omega]"}], ")"}]}]}], ";", RowBox[{"rot", "=", RowBox[{"padfc", "[", "rot", "]"}]}], ";", RowBox[{"id", "=", RowBox[{"padfc", "[", "id", "]"}]}], ";", RowBox[{"dmat", "=", RowBox[{"Catenate", "[", RowBox[{RowBox[{RowBox[{"FoldList", "[", RowBox[{RowBox[{RowBox[{"{", RowBox[{"(", RowBox[{RowBox[{"#1", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"(", RowBox[{"4", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}]}], ")"}], RowBox[{"emat", "[", RowBox[{"[", RowBox[{"#2", "-", "1"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"10", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}], "^", "2"}]}], ")"}], RowBox[{"fmat", "[", RowBox[{"[", "#2", "]"}], "]"}]}]}], ")"}], "}"}], "&"}], ",", "#", ",", RowBox[{"{", RowBox[{RowBox[{"-", "3"}], ",", RowBox[{"-", "2"}]}], "}"}]}], "]"}], "&"}], "@", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"diff", "[", RowBox[{RowBox[{"diff", "[", RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "]"}], "/", RowBox[{"(", RowBox[{RowBox[{"Most", "[", "\[CapitalDelta]\[Omega]", "]"}], "+", RowBox[{"Rest", "[", "\[CapitalDelta]\[Omega]", "]"}]}], ")"}]}], "]"}], "-", RowBox[{"Most", "[", RowBox[{"g3q", ".", "emat"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], ")"}]}], "]"}]}], ";", RowBox[{"cmat", "=", RowBox[{"Catenate", "[", RowBox[{RowBox[{RowBox[{"FoldList", "[", RowBox[{RowBox[{RowBox[{"{", RowBox[{"(", RowBox[{RowBox[{"#1", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"(", RowBox[{"3", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}]}], ")"}], RowBox[{"dmat", "[", RowBox[{"[", "#2", "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"6", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}], "^", "2"}]}], ")"}], RowBox[{"emat", "[", RowBox[{"[", RowBox[{"#2", "-", "1"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"10", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}], "^", "3"}]}], ")"}], RowBox[{"fmat", "[", RowBox[{"[", "#2", "]"}], "]"}]}]}], ")"}], "}"}], "&"}], ",", "#", ",", RowBox[{"{", RowBox[{"-", "2"}], "}"}]}], "]"}], "&"}], "@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"diff", "[", RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "]"}], "-", RowBox[{"diff", "[", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "^", "2"}], "dmat"}], "]"}], "-", RowBox[{"Most", "[", RowBox[{"g2q", ".", "emat"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"Most", "[", "\[CapitalDelta]\[Omega]", "]"}], "+", RowBox[{"Rest", "[", "\[CapitalDelta]\[Omega]", "]"}]}], ")"}]}], "-", RowBox[{RowBox[{"(", RowBox[{"3", RowBox[{"Most", "[", "\[CapitalDelta]\[Omega]", "]"}]}], ")"}], RowBox[{"Most", "[", "dmat", "]"}]}]}], ")"}]}], "]"}]}], ";", RowBox[{"bmat", "=", RowBox[{RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "-", RowBox[{"\[CapitalDelta]\[Omega]", "cmat"}], "-", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "^", "2"}], "dmat"}], "-", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "^", "3"}], RowBox[{"Most", "[", RowBox[{"g1q", ".", "emat"}], "]"}]}]}]}], ";", RowBox[{"amat", "=", RowBox[{"Most", "[", "id", "]"}]}], ";", RowBox[{"emat", "=", RowBox[{"If", "[", RowBox[{"mixed", ",", "emat2", ",", RowBox[{"Most", "[", "emat", "]"}]}], "]"}]}], ";"}], ",", RowBox[{RowBox[{"fmat", "=", RowBox[{RowBox[{"diff", "[", "emat", "]"}], "/", RowBox[{"(", RowBox[{"5", RowBox[{"Most", "[", "h", "]"}]}], ")"}]}]}], ";", RowBox[{"emat", "=", RowBox[{"Most", "[", "emat", "]"}]}], ";"}]}], "]"}]}]}], "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", RowBox[{RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "#", ",", RowBox[{"padfcT", "[", "#", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}], "&"}], "/@", RowBox[{"{", RowBox[{"amat", ",", "bmat", ",", "cmat", ",", "dmat", ",", "emat", ",", "fmat"}], "}"}]}], ",", RowBox[{RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "#", ",", RowBox[{"padfcT", "[", "#", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}], "&"}], "/@", RowBox[{"{", RowBox[{"amat", ",", "bmat", ",", "cmat", ",", "dmat"}], "}"}]}]}], "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "fmat", ",", RowBox[{"padfcT", "[", "fmat", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}], ",", RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "dmat", ",", RowBox[{"padfcT", "[", "dmat", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}]}], "]"}]}], "]"}]}]}], "]"}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "Interpol2D", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Interpol2D", "[", RowBox[{"Q_", ",", "posBx_", ",", "posBy_"}], "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{RowBox[{"Dimensions", "[", "Q", "]"}], "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "===", "1"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "Q", "]"}], "]"}], "==", "3"}], ",", RowBox[{RowBox[{RowBox[{"ConstantArray", "[", RowBox[{RowBox[{"#", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"Length", "[", "posBy", "]"}]}], "]"}], "&"}], "/@", "Q"}], ",", RowBox[{"ConstantArray", "[", RowBox[{RowBox[{"Q", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"Length", "[", "posBy", "]"}]}], "]"}]}], "]"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"posBx1", "=", RowBox[{"Clip", "[", RowBox[{RowBox[{"Floor", "[", "posBx", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"Max", "[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "Q", "]"}], "]"}], "==", "3"}], ",", RowBox[{"Length", "[", RowBox[{"Q", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", RowBox[{"Length", "[", "Q", "]"}]}], "]"}], "-", "1"}], ",", "1"}], "]"}]}], "}"}]}], "]"}]}], ",", RowBox[{"posBy1", "=", RowBox[{"Clip", "[", RowBox[{RowBox[{"Floor", "[", "posBy", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"Max", "[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "Q", "]"}], "]"}], "==", "3"}], ",", RowBox[{RowBox[{"Dimensions", "[", "Q", "]"}], "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"Length", "[", RowBox[{"Q", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "-", "1"}], ",", "1"}], "]"}]}], "}"}]}], "]"}]}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{RowBox[{RowBox[{"Subtract", "[", RowBox[{"posBx1", ",", "1"}], "]"}], RowBox[{"Length", "[", "posBy", "]"}]}], "+", "posBy1"}]}], ",", RowBox[{"Qf", "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "Q", "]"}], "]"}], "==", "3"}], ",", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "Q"}], ",", RowBox[{"Flatten", "[", "Q", "]"}]}], "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"diff", "=", RowBox[{"Subtract", "[", RowBox[{"posBx1", ",", "posBx"}], "]"}]}], "}"}], ",", RowBox[{"{", RowBox[{RowBox[{"diff", "+", "1"}], ",", RowBox[{"-", "diff"}]}], "}"}]}], "]"}], "]"}]}], ",", RowBox[{"\[CapitalDelta]yvec", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"diff", "=", RowBox[{"Subtract", "[", RowBox[{"posBy1", ",", "posBy"}], "]"}]}], "}"}], ",", RowBox[{"{", RowBox[{RowBox[{"diff", "+", "1"}], ",", RowBox[{"-", "diff"}]}], "}"}]}], "]"}], "]"}]}]}], "}"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "Q", "]"}], "]"}], "==", "3"}], ",", RowBox[{RowBox[{RowBox[{"Transpose", "[", RowBox[{"indexMat", "[", RowBox[{"#", ",", "\[CapitalDelta]xvec", ",", "\[CapitalDelta]yvec", ",", "inds"}], "]"}], "]"}], "&"}], "/@", "Qf"}], ",", RowBox[{"Transpose", "[", RowBox[{"indexMat", "[", RowBox[{"Qf", ",", "\[CapitalDelta]xvec", ",", "\[CapitalDelta]yvec", ",", "inds"}], "]"}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Interpol2D", "[", RowBox[{"Q_", ",", "default_", ",", "posBx_", ",", "posBy_"}], "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{RowBox[{"Dimensions", "[", "Q", "]"}], "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "===", "1"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "Q", "]"}], "]"}], "==", "3"}], ",", RowBox[{RowBox[{RowBox[{"ConstantArray", "[", RowBox[{RowBox[{"#", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"Length", "[", "posBy", "]"}]}], "]"}], "&"}], "/@", "Q"}], ",", RowBox[{"ConstantArray", "[", RowBox[{RowBox[{"Q", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"Length", "[", "posBy", "]"}]}], "]"}]}], "]"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"posBx1", "=", RowBox[{"Clip", "[", RowBox[{RowBox[{"Floor", "[", "posBx", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"Max", "[", RowBox[{RowBox[{RowBox[{"Ceiling", "[", RowBox[{"Max", "[", "posBx", "]"}], "]"}], "-", "1"}], ",", "1"}], "]"}]}], "}"}]}], "]"}]}], ",", RowBox[{"posBy1", "=", RowBox[{"Clip", "[", RowBox[{RowBox[{"Floor", "[", "posBy", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"Max", "[", RowBox[{RowBox[{RowBox[{"Ceiling", "[", RowBox[{"Max", "[", "posBy", "]"}], "]"}], "-", "1"}], ",", "1"}], "]"}]}], "}"}]}], "]"}]}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{RowBox[{RowBox[{"Subtract", "[", RowBox[{"posBx1", ",", "1"}], "]"}], RowBox[{"Length", "[", "posBy", "]"}]}], "+", "posBy1"}]}], ",", RowBox[{"Qf", "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "Q", "]"}], "]"}], "==", "3"}], ",", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "Q"}], ",", RowBox[{"Flatten", "[", "Q", "]"}]}], "]"}]}], ",", RowBox[{"defaultList", "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "default", "]"}], "]"}], "==", "3"}], ",", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "default"}], ",", RowBox[{"Flatten", "[", "default", "]"}]}], "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"diff", "=", RowBox[{"Subtract", "[", RowBox[{"posBx1", ",", "posBx"}], "]"}]}], "}"}], ",", RowBox[{"{", RowBox[{RowBox[{"diff", "+", "1"}], ",", RowBox[{"-", "diff"}]}], "}"}]}], "]"}], "]"}]}], ",", RowBox[{"\[CapitalDelta]yvec", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"diff", "=", RowBox[{"Subtract", "[", RowBox[{"posBy1", ",", "posBy"}], "]"}]}], "}"}], ",", RowBox[{"{", RowBox[{RowBox[{"diff", "+", "1"}], ",", RowBox[{"-", "diff"}]}], "}"}]}], "]"}], "]"}]}]}], "}"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "Q", "]"}], "]"}], "==", "3"}], ",", RowBox[{"MapThread", "[", RowBox[{RowBox[{RowBox[{"Transpose", "[", RowBox[{"indexMatMerge", "[", RowBox[{"#1", ",", "#2", ",", "\[CapitalDelta]xvec", ",", "\[CapitalDelta]yvec", ",", "inds"}], "]"}], "]"}], "&"}], ",", RowBox[{"{", RowBox[{"Qf", ",", "defaultList"}], "}"}]}], "]"}], ",", RowBox[{"Transpose", "[", RowBox[{"indexMatMerge", "[", RowBox[{"Qf", ",", "defaultList", ",", "\[CapitalDelta]xvec", ",", "\[CapitalDelta]yvec", ",", "inds"}], "]"}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "Interpol2D3", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Interpol2D3", "[", RowBox[{"Q_", ",", "posBx_", ",", "indsy_", ",", "weightsy_"}], "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{RowBox[{"Dimensions", "[", "Q", "]"}], "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "===", "1"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "Q", "]"}], "]"}], "==", "3"}], ",", RowBox[{RowBox[{RowBox[{"ConstantArray", "[", RowBox[{RowBox[{"#", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"Length", "[", "indsy", "]"}]}], "]"}], "&"}], "/@", "Q"}], ",", RowBox[{"ConstantArray", "[", RowBox[{RowBox[{"Q", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"Length", "[", "indsy", "]"}]}], "]"}]}], "]"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"posBx1", "=", RowBox[{"Clip", "[", RowBox[{RowBox[{"Floor", "[", "posBx", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"Max", "[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "Q", "]"}], "]"}], "==", "3"}], ",", RowBox[{"Length", "[", RowBox[{"Q", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", RowBox[{"Length", "[", "Q", "]"}]}], "]"}], "-", "1"}], ",", "1"}], "]"}]}], "}"}]}], "]"}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{RowBox[{RowBox[{"Subtract", "[", RowBox[{"posBx1", ",", "1"}], "]"}], RowBox[{"Length", "[", "indsy", "]"}]}], "+", "indsy", "+", RowBox[{"If", "[", RowBox[{RowBox[{"ValueQ", "[", "append", "]"}], ",", "1", ",", "0"}], "]"}]}]}], ",", RowBox[{"Qf", "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "Q", "]"}], "]"}], "==", "3"}], ",", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "Q"}], ",", RowBox[{"Flatten", "[", "Q", "]"}]}], "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"diff", "=", RowBox[{"Subtract", "[", RowBox[{"posBx1", ",", "posBx"}], "]"}]}], "}"}], ",", RowBox[{"{", RowBox[{RowBox[{"diff", "+", "1"}], ",", RowBox[{"-", "diff"}]}], "}"}]}], "]"}], "]"}]}]}], "}"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "Q", "]"}], "]"}], "==", "3"}], ",", RowBox[{RowBox[{RowBox[{"Transpose", "[", RowBox[{"indexMat3", "[", RowBox[{"#", ",", "\[CapitalDelta]xvec", ",", "weightsy", ",", "inds"}], "]"}], "]"}], "&"}], "/@", "Qf"}], ",", RowBox[{"Transpose", "[", RowBox[{"indexMat3", "[", RowBox[{"Qf", ",", "\[CapitalDelta]xvec", ",", "weightsy", ",", "inds"}], "]"}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "Interpol2Dc", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Interpol2Dc", "[", RowBox[{"comps_", ",", "posBx_", ",", "posBy_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"posBx1", "=", RowBox[{"Clip", "[", RowBox[{RowBox[{"Floor", "[", "posBx", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"Max", "[", RowBox[{RowBox[{RowBox[{"Ceiling", "[", RowBox[{"Max", "[", "posBx", "]"}], "]"}], "-", "1"}], ",", "1"}], "]"}]}], "}"}]}], "]"}]}], ",", RowBox[{"posBy1", "=", RowBox[{"Clip", "[", RowBox[{RowBox[{"Floor", "[", "posBy", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"Max", "[", RowBox[{RowBox[{RowBox[{"Ceiling", "[", RowBox[{"Max", "[", "posBy", "]"}], "]"}], "-", "1"}], ",", "1"}], "]"}]}], "}"}]}], "]"}]}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{RowBox[{RowBox[{"Subtract", "[", RowBox[{"posBx1", ",", "1"}], "]"}], RowBox[{"Length", "[", "posBy", "]"}]}], "+", "posBy1"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"diff", "=", RowBox[{"Subtract", "[", RowBox[{"posBx1", ",", "posBx"}], "]"}]}], "}"}], ",", RowBox[{"{", RowBox[{RowBox[{"diff", "+", "1"}], ",", RowBox[{"-", "diff"}]}], "}"}]}], "]"}], "]"}]}], ",", RowBox[{"\[CapitalDelta]yvec", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"diff", "=", RowBox[{"Subtract", "[", RowBox[{"posBy1", ",", "posBy"}], "]"}]}], "}"}], ",", RowBox[{"{", RowBox[{RowBox[{"diff", "+", "1"}], ",", RowBox[{"-", "diff"}]}], "}"}]}], "]"}], "]"}]}]}], "}"}], ",", RowBox[{RowBox[{RowBox[{"indexMatN", "[", RowBox[{"#", ",", "\[CapitalDelta]xvec", ",", "\[CapitalDelta]yvec", ",", "inds"}], "]"}], "&"}], "/@", "comps"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "Interpol2D3c", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Interpol2D3c", "[", RowBox[{"posBx_", ",", "indsy_", ",", "weightsy_", ",", "\[Delta]tratio_"}], "]"}], ":=", RowBox[{"indexMatAll", "[", RowBox[{"posBx", ",", "indsy", ",", "weightsy", ",", "\[Delta]tratio"}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "Interpol1D", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "Interpol1D", "]"}], "=", RowBox[{"{", RowBox[{"\"Last\"", "->", "False"}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Interpol1D", "[", RowBox[{"Q_", ",", "pos_", ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "Q", "]"}], "]"}], "===", "1"}], "&&", RowBox[{RowBox[{"Length", "[", "Q", "]"}], "===", "1"}]}], ",", RowBox[{"ConstantArray", "[", RowBox[{RowBox[{"Q", "[", RowBox[{"[", "1", "]"}], "]"}], ",", "len"}], "]"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"floor", "=", RowBox[{"Clip", "[", RowBox[{RowBox[{"Floor", "[", "pos", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"Max", "[", RowBox[{RowBox[{RowBox[{"Ceiling", "[", RowBox[{"Max", "[", "pos", "]"}], "]"}], "-", "1"}], ",", "1"}], "]"}]}], "}"}]}], "]"}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"diff", "=", RowBox[{"Subtract", "[", RowBox[{"floor", ",", "pos"}], "]"}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"{", RowBox[{RowBox[{"diff", "+", "1"}], ",", RowBox[{"-", "diff"}]}], "}"}], "]"}]}], "}"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "Q", "]"}], "]"}], "==", "3"}], ",", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Last\"", "]"}], ",", RowBox[{"indexVecL", "[", RowBox[{RowBox[{"#", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", "\[CapitalDelta]xvec", ",", "floor"}], "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"MatrixQ", "[", "#", "]"}], ",", RowBox[{"indexVec", "[", RowBox[{"#", ",", "\[CapitalDelta]xvec", ",", "floor"}], "]"}], ",", RowBox[{"indexVecR", "[", RowBox[{"#", ",", "\[CapitalDelta]xvec", ",", "floor"}], "]"}]}], "]"}]}], "]"}], "&"}], "/@", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Q", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "===", "1"}], ",", RowBox[{RowBox[{RowBox[{"Developer`ToPackedArray", "[", RowBox[{"{", RowBox[{RowBox[{"#", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"#", "[", RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}], "&"}], "/@", "Q"}], ",", "Q"}], "]"}]}], ",", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Last\"", "]"}], ",", RowBox[{"indexVecL", "[", RowBox[{RowBox[{"#", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", "\[CapitalDelta]xvec", ",", "floor"}], "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"MatrixQ", "[", "#", "]"}], ",", RowBox[{"indexVec", "[", RowBox[{"#", ",", "\[CapitalDelta]xvec", ",", "floor"}], "]"}], ",", RowBox[{"indexVecR", "[", RowBox[{"#", ",", "\[CapitalDelta]xvec", ",", "floor"}], "]"}]}], "]"}]}], "]"}], "&"}], "[", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "Q", "]"}], "===", "1"}], ",", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"{", RowBox[{RowBox[{"Q", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"Q", "[", RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}], ",", "Q"}], "]"}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "Interpol1D2", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Interpol1D2", "[", RowBox[{"Q_", ",", "dQ_", ",", "pos_", ",", "\[Delta]tratio_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"floor", "=", RowBox[{"Clip", "[", RowBox[{RowBox[{"Floor", "[", "pos", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"Max", "[", RowBox[{RowBox[{RowBox[{"Ceiling", "[", RowBox[{"Max", "[", "pos", "]"}], "]"}], "-", "1"}], ",", "1"}], "]"}]}], "}"}]}], "]"}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"diff", "=", RowBox[{"Subtract", "[", RowBox[{"pos", ",", "floor"}], "]"}]}], "}"}], ",", RowBox[{"indexVecR2", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "Q", "]"}], "===", "1"}], ",", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"{", RowBox[{RowBox[{"Q", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"Q", "[", RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}], ",", "Q"}], "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "dQ", "]"}], "===", "1"}], ",", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"{", RowBox[{RowBox[{"dQ", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"dQ", "[", RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}], ",", "dQ"}], "]"}], ",", "diff", ",", "floor", ",", "\[Delta]tratio"}], "]"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "InterpolLast", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"InterpolLast", "[", RowBox[{"comps_", ",", "pos_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"floor", "=", RowBox[{"Clip", "[", RowBox[{RowBox[{"Floor", "[", "pos", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"Max", "[", RowBox[{RowBox[{RowBox[{"Ceiling", "[", RowBox[{"Max", "[", "pos", "]"}], "]"}], "-", "1"}], ",", "1"}], "]"}]}], "}"}]}], "]"}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"diff", "=", RowBox[{"Subtract", "[", RowBox[{"floor", ",", "pos"}], "]"}]}], "}"}], ",", RowBox[{RowBox[{RowBox[{"indexVecLN", "[", RowBox[{"#", ",", "diff", ",", "floor"}], "]"}], "&"}], "/@", "comps"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "Interpol1D3", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Interpol1D3", "[", RowBox[{"Q_", ",", "inds_", ",", "weights_"}], "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "Q", "]"}], "]"}], "===", "1"}], "&&", RowBox[{RowBox[{"Length", "[", "Q", "]"}], "===", "1"}]}], ",", RowBox[{"ConstantArray", "[", RowBox[{RowBox[{"Q", "[", RowBox[{"[", "1", "]"}], "]"}], ",", "len"}], "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Dimensions", "[", "Q", "]"}], "]"}], "==", "3"}], ",", RowBox[{RowBox[{RowBox[{"indexVecL3", "[", RowBox[{RowBox[{"#", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", "weights", ",", RowBox[{"inds", "+", RowBox[{"If", "[", RowBox[{RowBox[{"ValueQ", "[", "append", "]"}], ",", "1", ",", "0"}], "]"}]}]}], "]"}], "&"}], "/@", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", RowBox[{"Q", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "===", "1"}], ",", RowBox[{RowBox[{RowBox[{"Developer`ToPackedArray", "[", RowBox[{"{", RowBox[{RowBox[{"#", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"#", "[", RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}], "&"}], "/@", "Q"}], ",", "Q"}], "]"}]}], ",", RowBox[{RowBox[{RowBox[{"indexVecL3", "[", RowBox[{RowBox[{"#", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", "weights", ",", RowBox[{"inds", "+", RowBox[{"If", "[", RowBox[{RowBox[{"ValueQ", "[", "append", "]"}], ",", "1", ",", "0"}], "]"}]}]}], "]"}], "&"}], "[", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "Q", "]"}], "===", "1"}], ",", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"{", RowBox[{RowBox[{"Q", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"Q", "[", RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}], ",", "Q"}], "]"}], "]"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "weights", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"weights", "[", "\[Phi]_", "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"ord", "=", RowBox[{RowBox[{"Length", "[", "InterpoltT", "]"}], "-", "1"}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"matInds", "=", RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Clip", "[", RowBox[{RowBox[{RowBox[{"Range", "[", RowBox[{"len", "-", "1"}], "]"}], "-", RowBox[{RowBox[{"(", RowBox[{"ord", "+", "1"}], ")"}], "/", "2"}]}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", "ord", "-", "1"}]}], "}"}]}], "]"}], "+", "n"}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{"ord", "+", "1"}]}], "}"}]}], "]"}]}], ",", RowBox[{"inds", "=", RowBox[{"bsearchInd", "[", RowBox[{"\[Theta]points", ",", "\[Phi]"}], "]"}]}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"diags", "=", RowBox[{"Transpose", "[", RowBox[{RowBox[{RowBox[{RowBox[{"resort3M", "[", RowBox[{RowBox[{"Normal", "[", "InterpoltT", "]"}], ",", "#"}], "]"}], "&"}], "/@", "matInds"}], ",", RowBox[{"{", RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "]"}]}], ",", RowBox[{"diff", "=", RowBox[{"\[Phi]", "-", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[Theta]points", "[", RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "inds"}], ")"}]}]}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"diffvec", "=", RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{"diff", "+", RowBox[{"UnitStep", "[", RowBox[{"-", "n"}], "]"}]}], ")"}], "^", "n"}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "ord"}], "}"}]}], "]"}]}], "}"}], ",", RowBox[{"{", RowBox[{RowBox[{"Developer`ToPackedArray", "[", RowBox[{RowBox[{"Clip", "[", RowBox[{RowBox[{"inds", "-", RowBox[{RowBox[{"(", RowBox[{"ord", "+", "1"}], ")"}], "/", "2"}]}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", "ord", "-", "1"}]}], "}"}]}], "]"}], "-", RowBox[{"If", "[", RowBox[{RowBox[{"ValueQ", "[", "append", "]"}], ",", "1", ",", "0"}], "]"}]}], "]"}], ",", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"Flatten", "[", RowBox[{"1.", RowBox[{"Total", "[", RowBox[{"diffvec", "*", RowBox[{"Transpose", "[", RowBox[{RowBox[{RowBox[{"diags", "[", RowBox[{"[", RowBox[{"All", ",", "#"}], "]"}], "]"}], "&"}], "/@", "inds"}], "]"}]}], "]"}]}], "]"}], "]"}]}], "}"}]}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "trapez", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"trapez", "[", "x_", "]"}], ":=", RowBox[{RowBox[{"1", "/", "2"}], RowBox[{"(", RowBox[{RowBox[{"Append", "[", RowBox[{RowBox[{"diff", "[", "x", "]"}], ",", "0"}], "]"}], "+", RowBox[{"Prepend", "[", RowBox[{RowBox[{"diff", "[", "x", "]"}], ",", "0"}], "]"}]}], ")"}]}]}], ";"}]
RowBox[{RowBox[{RowBox[{"ConvA", "[", RowBox[{"f_", ",", "g_", ",", "t_"}], "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{"VectorQ", "[", "f", "]"}], ",", RowBox[{"t", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"f", "*", "g"}], ")"}], ".", "int"}], ")"}]}], ",", RowBox[{RowBox[{"conv", "[", RowBox[{"int", ",", "f", ",", "g"}], "]"}], "*", RowBox[{"(", RowBox[{"t", "\[Theta]points"}], ")"}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"ConvR", "[", RowBox[{"f_", ",", "g_", ",", "t_"}], "]"}], ":=", RowBox[{RowBox[{"conv", "[", RowBox[{"int", ",", "f", ",", "g"}], "]"}], "*", RowBox[{"(", RowBox[{"t", RowBox[{"Subtract", "[", RowBox[{"1", ",", "\[Theta]points"}], "]"}]}], ")"}]}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "sparsify", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"sparsify", "[", RowBox[{"QIn_", ",", RowBox[{"threshold_", ":", "1"}]}], "]"}], ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"erased", "=", "False"}], ",", RowBox[{"loop", "=", "1"}], ",", "inds", ",", RowBox[{"q", "=", RowBox[{"If", "[", RowBox[{RowBox[{"MatrixQ", "[", "QIn", "]"}], ",", RowBox[{"{", "QIn", "}"}], ",", "QIn"}], "]"}]}], ",", RowBox[{"qdiff", "=", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"MatrixQ", "[", "QIn", "]"}]}], ",", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"MatrixQ", "[", "#", "]"}], ",", "#", ",", RowBox[{RowBox[{"##", "&"}], "[", "]"}]}], "]"}], "&"}], "/@", "QIn"}]}], "]"}]}]}], "}"}], ",", RowBox[{RowBox[{"inds", "=", RowBox[{"Append", "[", RowBox[{RowBox[{"Prepend", "[", RowBox[{RowBox[{"Map", "[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"#", "<", "threshold"}], "&&", RowBox[{"!", "erased"}]}], ",", RowBox[{RowBox[{"loop", "++"}], ";", RowBox[{"erased", "=", "True"}], ";", RowBox[{RowBox[{"##", "&"}], "[", "]"}]}], ",", RowBox[{RowBox[{"erased", "=", "False"}], ";", RowBox[{"loop", "++"}], ";", "loop"}]}], "]"}], "&"}], ",", RowBox[{"Total", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"3", ";;", RowBox[{"-", "1"}]}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], ")"}], RowBox[{"Abs", "[", RowBox[{RowBox[{"#", "[", RowBox[{"[", RowBox[{"3", ";;", RowBox[{"-", "1"}]}], "]"}], "]"}], "-", RowBox[{"#", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], "]"}]}], ",", RowBox[{"{", "2", "}"}]}], "]"}], "&"}], "/@", "qdiff"}], "]"}]}], "]"}], ",", "1"}], "]"}], ",", RowBox[{"Length", "[", RowBox[{"qdiff", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"posB1xOld", "=", "0"}], ";", RowBox[{"posB2xOld", "=", "0"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"MatrixQ", "[", "QIn", "]"}], ",", RowBox[{"QIn", "[", RowBox[{"[", "inds", "]"}], "]"}], ",", RowBox[{RowBox[{RowBox[{"#", "[", RowBox[{"[", "inds", "]"}], "]"}], "&"}], "/@", "q"}]}], "]"}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "csparsify", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"csparsify", "[", RowBox[{"threshold_", ":", "1"}], "]"}], ":=", RowBox[{"(", RowBox[{RowBox[{"OutputNClear", "[", "]"}], ";", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "dQK", ",", "dQR", ",", "rvec", ",", "drvec", ",", "t1grid", ",", "times", ",", "etab", ",", "QK0", ",", "QR0"}], "}"}], "=", RowBox[{"sparsify", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "dQK", ",", "dQR", ",", "rvec", ",", "drvec", ",", "t1grid", ",", "times", ",", "etab", ",", "QK0", ",", "QR0"}], "}"}], ",", "threshold"}], "]"}]}], ";", RowBox[{"buildLowMem", "[", "]"}]}], ")"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "sparsifyNscale", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"sparsifyNscale", "[", RowBox[{"threshold_", ":", "\[Delta]max"}], "]"}], ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"erased", "=", "False"}], ",", RowBox[{"loop", "=", "1"}], ",", "inds", ",", "indsD", ",", "tfac", ",", RowBox[{"bsize", "=", "1000"}], ",", RowBox[{"lent1", "=", RowBox[{"Length", "[", "t1grid", "]"}]}]}], "}"}], ",", RowBox[{RowBox[{"OutputNClear", "[", "]"}], ";", RowBox[{"inds", "=", RowBox[{"Join", "[", RowBox[{RowBox[{"Prepend", "[", RowBox[{RowBox[{"Map", "[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"#", "<", "threshold"}], "&&", RowBox[{"!", "erased"}]}], ",", RowBox[{RowBox[{"loop", "++"}], ";", RowBox[{"erased", "=", "True"}], ";", RowBox[{RowBox[{"##", "&"}], "[", "]"}]}], ",", RowBox[{RowBox[{"erased", "=", "False"}], ";", RowBox[{"loop", "++"}], ";", "loop"}]}], "]"}], "&"}], ",", RowBox[{"Flatten", "[", RowBox[{RowBox[{"Reap", "[", RowBox[{"Do", "[", RowBox[{RowBox[{"Sow", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"max", "=", RowBox[{"If", "[", RowBox[{RowBox[{"n", "==", RowBox[{RowBox[{"Quotient", "[", RowBox[{"lent1", ",", "bsize"}], "]"}], "-", "1"}]}], ",", "lent1", ",", RowBox[{RowBox[{RowBox[{"(", RowBox[{"n", "+", "1"}], ")"}], "bsize"}], "+", "3"}]}], "]"}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"tgrid", "=", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"n", "bsize"}], "+", "1"}], ";;", "max"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"tdiff2", "=", RowBox[{"Subtract", "[", RowBox[{RowBox[{"tgrid", "[", RowBox[{"[", RowBox[{"3", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], ",", RowBox[{"tgrid", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", "4"}]}], "]"}], "]"}]}], "]"}]}], ",", RowBox[{"tdiff", "=", RowBox[{"Subtract", "[", RowBox[{RowBox[{"tgrid", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}], ",", RowBox[{"tgrid", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", "4"}]}], "]"}], "]"}]}], "]"}]}]}], "}"}], ",", RowBox[{"Total", "[", RowBox[{"MapThread", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{RowBox[{"tdiff2", "/", "12"}], RowBox[{"(", RowBox[{RowBox[{"2", RowBox[{"(", RowBox[{RowBox[{"#1", "[", RowBox[{"[", RowBox[{"3", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "-", RowBox[{"#1", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", "4"}]}], "]"}], "]"}]}], ")"}]}], "-", RowBox[{"(", RowBox[{RowBox[{RowBox[{"tdiff2", "/", "tdiff"}], RowBox[{"#2", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"tdiff2", "/", "tdiff"}], RowBox[{"#2", "[", RowBox[{"[", RowBox[{"4", ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}]}], ")"}]}], ")"}]}], "]"}], ",", RowBox[{"{", "2", "}"}]}], "]"}], "&"}], ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"n", "bsize"}], "+", "1"}], ";;", "max"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"n", "bsize"}], "+", "1"}], ";;", "max"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"{", RowBox[{RowBox[{"dQK", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"n", "bsize"}], "+", "1"}], ";;", "max"}], "]"}], "]"}], ",", RowBox[{"dQR", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"n", "bsize"}], "+", "1"}], ";;", "max"}], "]"}], "]"}]}], "}"}]}], "}"}]}], "]"}], "]"}]}], "]"}]}], "]"}]}], "]"}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Quotient", "[", RowBox[{"lent1", ",", "bsize"}], "]"}], "-", "1"}]}], "}"}]}], "]"}], "]"}], "[", RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "]"}], ",", "1"}], "]"}], ",", RowBox[{"{", RowBox[{RowBox[{"lent1", "-", "1"}], ",", "lent1"}], "}"}]}], "]"}]}], ";", RowBox[{"indsD", "=", RowBox[{"RotateRight", "[", RowBox[{RowBox[{"Mod", "[", RowBox[{"inds", ",", "lent1"}], "]"}], "+", "1"}], "]"}]}], ";", RowBox[{"tfac", "=", RowBox[{RowBox[{"Prepend", "[", RowBox[{RowBox[{"diff", "[", RowBox[{"t1grid", "[", RowBox[{"[", "inds", "]"}], "]"}], "]"}], ",", "0."}], "]"}], "/", RowBox[{RowBox[{"diff", "[", "t1grid", "]"}], "[", RowBox[{"[", RowBox[{RowBox[{"Mod", "[", RowBox[{RowBox[{"indsD", "-", "2"}], ",", RowBox[{"lent1", "-", "1"}]}], "]"}], "+", "1"}], "]"}], "]"}]}]}], ";", RowBox[{"posB1xOld", "=", "0"}], ";", RowBox[{"posB2xOld", "=", "0"}], ";", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "dQK", ",", "dQR", ",", "rvec", ",", "drvec", ",", "t1grid", ",", "times", ",", "etab", ",", "QK0", ",", "QR0"}], "}"}], "=", RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", "inds", "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", "inds", "]"}], "]"}], ",", RowBox[{"dQK", "[", RowBox[{"[", "indsD", "]"}], "]"}], ",", RowBox[{"dQR", "[", RowBox[{"[", "indsD", "]"}], "]"}], ",", RowBox[{"rvec", "[", RowBox[{"[", "inds", "]"}], "]"}], ",", RowBox[{"drvec", "[", RowBox[{"[", "indsD", "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", "inds", "]"}], "]"}], ",", RowBox[{"times", "[", RowBox[{"[", "inds", "]"}], "]"}], ",", RowBox[{"etab", "[", RowBox[{"[", "inds", "]"}], "]"}], ",", RowBox[{"QK0", "[", RowBox[{"[", "inds", "]"}], "]"}], ",", RowBox[{"QR0", "[", RowBox[{"[", "inds", "]"}], "]"}]}], "}"}]}], ";", RowBox[{"\[Delta]tratio", "=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"diff", "=", RowBox[{"diff", "[", "t1grid", "]"}]}], "}"}], ",", RowBox[{"Join", "[", RowBox[{RowBox[{"{", RowBox[{"0.", ",", "0."}], "}"}], ",", RowBox[{RowBox[{"Rest", "[", "diff", "]"}], "/", RowBox[{"Most", "[", "diff", "]"}]}]}], "]"}]}], "]"}]}], ";", RowBox[{"buildLowMem", "[", "tfac", "]"}], ";", RowBox[{"drvec", "*=", "tfac"}], ";", RowBox[{RowBox[{"{", RowBox[{"dQK", ",", "dQR"}], "}"}], "*=", RowBox[{"tfac", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "shiftAppend", "]"}], ";"}]
RowBox[{RowBox[{"SetAttributes", "[", RowBox[{"shiftAppend", ",", "HoldFirst"}], "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"shiftAppend", "[", RowBox[{"Q_", ",", "last_"}], "]"}], ":=", RowBox[{"(", RowBox[{RowBox[{"Q", "=", RowBox[{"Append", "[", RowBox[{RowBox[{"Rest", "[", "Q", "]"}], ",", "last"}], "]"}]}], ";"}], ")"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "Output", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Output", "[", "]"}], ":=", RowBox[{"(", RowBox[{RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "dQK", ",", "dQR"}], "}"}], "=", RowBox[{"Table", "[", RowBox[{RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"out", "=", RowBox[{"output", "[", "n", "]"}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{"out", ",", RowBox[{"{", RowBox[{RowBox[{RowBox[{"Length", "[", "out", "]"}], "/", "len"}], ",", "len"}], "}"}]}], "]"}]}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", "4"}], "}"}]}], "]"}]}], ";"}], ")"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "OutputNClear", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"OutputNClear", "[", "]"}], ":=", RowBox[{"(", RowBox[{RowBox[{"dQR", "=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"out", "=", RowBox[{"output", "[", "4", "]"}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{"out", ",", RowBox[{"{", RowBox[{RowBox[{RowBox[{"Length", "[", "out", "]"}], "/", "len"}], ",", "len"}], "}"}]}], "]"}]}], "]"}]}], ";", RowBox[{"clearOne", "[", "4", "]"}], ";", RowBox[{"dQK", "=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"out", "=", RowBox[{"output", "[", "3", "]"}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{"out", ",", RowBox[{"{", RowBox[{RowBox[{RowBox[{"Length", "[", "out", "]"}], "/", "len"}], ",", "len"}], "}"}]}], "]"}]}], "]"}]}], ";", RowBox[{"clearOne", "[", "3", "]"}], ";", RowBox[{"QR", "=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"out", "=", RowBox[{"output", "[", "2", "]"}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{"out", ",", RowBox[{"{", RowBox[{RowBox[{RowBox[{"Length", "[", "out", "]"}], "/", "len"}], ",", "len"}], "}"}]}], "]"}]}], "]"}]}], ";", RowBox[{"clearOne", "[", "2", "]"}], ";", RowBox[{"QK", "=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"out", "=", RowBox[{"output", "[", "1", "]"}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{"out", ",", RowBox[{"{", RowBox[{RowBox[{RowBox[{"Length", "[", "out", "]"}], "/", "len"}], ",", "len"}], "}"}]}], "]"}]}], "]"}]}], ";", RowBox[{"clearOne", "[", "1", "]"}], ";"}], ")"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "appendTo", "]"}], ";"}]
RowBox[{RowBox[{"SetAttributes", "[", RowBox[{"appendTo", ",", "HoldFirst"}], "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"appendTo", "[", RowBox[{"Q_", ",", "last_"}], "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"ValueQ", "[", "append", "]"}], "&&", RowBox[{RowBox[{"Length", "[", "Q", "]"}], ">", "4"}]}], ",", RowBox[{"shiftAppend", "[", RowBox[{"Q", ",", "last"}], "]"}], ",", RowBox[{"AppendTo", "[", RowBox[{"Q", ",", "last"}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "appendAll", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"appendAll", "[", "]"}], ":=", RowBox[{"(", RowBox[{"append", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}], ")"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "replaceAll", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"replaceAll", "[", "]"}], ":=", RowBox[{"(", RowBox[{"replace", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}], ")"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "replaceAllD", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"replaceAllD", "[", "]"}], ":=", RowBox[{"(", RowBox[{"replaceD", "[", RowBox[{RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}], ")"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"appendUpdate", "[", RowBox[{"g_", ",", "k_", ",", "dr_"}], "]"}], ":=", RowBox[{"(", RowBox[{RowBox[{"appendTo", "[", RowBox[{"QK", ",", RowBox[{"g", "[", RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"QR", ",", RowBox[{"g", "[", RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"dQK", ",", RowBox[{"k", "[", RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"dQR", ",", RowBox[{"k", "[", RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"t1grid", ",", RowBox[{"g", "[", RowBox[{"[", "3", "]"}], "]"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"\[Delta]tratio", ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"drvec", ",", RowBox[{RowBox[{"k", "[", RowBox[{"[", "3", "]"}], "]"}], "dr"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"rvec", ",", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], "]"}], ";", RowBox[{"appendAll", "[", "]"}], ";"}], ")"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"replaceUpdate", "[", RowBox[{"g_", ",", "k_", ",", "dr_"}], "]"}], ":=", RowBox[{"(", RowBox[{RowBox[{RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], "=", "g"}], ";", RowBox[{RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], ";", RowBox[{RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], RowBox[{"k", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], RowBox[{"k", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "dr"}]}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}], ";"}], ")"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"removeUpdate", "[", RowBox[{"n_", ":", "1"}], "]"}], ":=", RowBox[{"(", RowBox[{RowBox[{"deleteN", "[", RowBox[{"n", "*", "len"}], "]"}], ";", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "dQK", ",", "dQR"}], "}"}], "=", RowBox[{RowBox[{RowBox[{"{", RowBox[{"getLast", "[", RowBox[{"#", ",", "len"}], "]"}], "}"}], "&"}], "/@", RowBox[{"Range", "[", "4", "]"}]}]}], ";", RowBox[{"\[Delta]tratio", "=", RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", RowBox[{"(", RowBox[{"1", "+", "n"}], ")"}]}]}], "]"}], "]"}]}], ";", RowBox[{"t1grid", "=", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", RowBox[{"(", RowBox[{"1", "+", "n"}], ")"}]}]}], "]"}], "]"}]}], ";", RowBox[{"rvec", "=", RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", RowBox[{"(", RowBox[{"1", "+", "n"}], ")"}]}]}], "]"}], "]"}]}], ";", RowBox[{"drvec", "=", RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", RowBox[{"(", RowBox[{"1", "+", "n"}], ")"}]}]}], "]"}], "]"}]}], ";", RowBox[{"times", "=", RowBox[{"times", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", RowBox[{"(", RowBox[{"1", "+", "n"}], ")"}]}]}], "]"}], "]"}]}], ";", RowBox[{"etab", "=", RowBox[{"etab", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", RowBox[{"(", RowBox[{"1", "+", "n"}], ")"}]}]}], "]"}], "]"}]}], ";", RowBox[{"QK0", "=", RowBox[{"QK0", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", RowBox[{"(", RowBox[{"1", "+", "n"}], ")"}]}]}], "]"}], "]"}]}], ";", RowBox[{"QR0", "=", RowBox[{"QR0", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", RowBox[{"(", RowBox[{"1", "+", "n"}], ")"}]}]}], "]"}], "]"}]}], ";", RowBox[{"posB1xOld", "=", "0"}], ";", RowBox[{"posB2xOld", "=", "0"}], ";"}], ")"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"NewStep", "[", RowBox[{"\[Delta]t_", ",", "y0_", ",", "T21_", ",", "T22_"}], "]"}], ":=", RowBox[{"(", RowBox[{"\[Delta]t", RowBox[{"Min", "[", RowBox[{"facmax", ",", RowBox[{"Max", "[", RowBox[{"facmin", ",", RowBox[{"fac", RowBox[{"(", RowBox[{"1", "/", RowBox[{RowBox[{"err", "[", RowBox[{"y0", ",", "T21", ",", "T22"}], "]"}], "^", RowBox[{"(", RowBox[{"1", "/", "2"}], ")"}]}]}], ")"}]}]}], "]"}]}], "]"}]}], ")"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"err", "[", RowBox[{"y0_", ",", "T21_", ",", "T22_"}], "]"}], ":=", RowBox[{"Sqrt", "[", RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"T22", "-", "T21"}], ")"}], "/", RowBox[{"sc", "[", RowBox[{"y0", ",", "T22"}], "]"}]}], ")"}], "^", "2"}], ",", "\[Infinity]"}], "]"}], "/", RowBox[{"Times", "@@", RowBox[{"Dimensions", "[", "T22", "]"}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"sc", "[", RowBox[{"y0_", ",", "T22_"}], "]"}], ":=", RowBox[{"Atol", "+", RowBox[{RowBox[{"ThreadedMax", "[", RowBox[{RowBox[{"Abs", "[", "y0", "]"}], ",", RowBox[{"Abs", "[", "T22", "]"}]}], "]"}], "Rtol"}]}]}], ";"}]
RowBox[{RowBox[{RowBox[{"ThreadedMax", "[", RowBox[{"l1_", ",", "l2_"}], "]"}], ":=", RowBox[{RowBox[{"Ramp", "[", RowBox[{"l1", "-", "l2"}], "]"}], "+", "l2"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"rejectTest", "[", RowBox[{"\[Delta]t_", ",", "y0_", ",", "T21_", ",", "T22_"}], "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{RowBox[{"err", "[", RowBox[{"y0", ",", "T21", ",", "T22"}], "]"}], ">", "1"}], "&&", RowBox[{"\[Delta]t", ">", "\[Delta]tmin"}]}], ",", RowBox[{RowBox[{"QK", "=", RowBox[{"QK", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], ";", RowBox[{"QR", "=", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], ";", RowBox[{"t1grid", "=", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], ";", RowBox[{"rvec", "=", RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], ";", RowBox[{"drvec", "=", RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], ";", RowBox[{"{", RowBox[{RowBox[{"0.1", "*", "\[Delta]t"}], ",", "True"}], "}"}]}], ",", RowBox[{"{", RowBox[{"\[Delta]t", ",", "False"}], "}"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"initialize", "[", "]"}], ":=", RowBox[{"(", RowBox[{RowBox[{RowBox[{"Clear", "[", "\[Lambda]", "]"}], ";", RowBox[{"precision", "=", "MachinePrecision"}], ";", RowBox[{"ord", "=", "13"}], ";", RowBox[{"\[Kappa]", "=", "1"}], ";", RowBox[{"p", "=", RowBox[{"If", "[", RowBox[{RowBox[{"!", "txt"}], ",", "2", ",", RowBox[{"ToExpression", "[", RowBox[{"$CommandLine", "[", RowBox[{"[", "5", "]"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"p2", "=", RowBox[{"If", "[", RowBox[{RowBox[{"!", "txt"}], ",", "3", ",", RowBox[{RowBox[{"Mod", "[", RowBox[{RowBox[{RowBox[{"ToExpression", "[", RowBox[{"$CommandLine", "[", RowBox[{"[", "4", "]"}], "]"}], "]"}], "+", "50"}], ",", "9"}], "]"}], "+", "1", "+", "p"}]}], "]"}]}], ";", RowBox[{"\[CapitalLambda]", "=", "1"}], ";", RowBox[{"\[Beta]", "=", "1"}], ";", RowBox[{"h", "=", "0"}], ";", RowBox[{"\[Delta]h", "=", "0"}], ";", RowBox[{"\[Gamma]", "=", RowBox[{"If", "[", RowBox[{RowBox[{"!", "txt"}], ",", "0", ",", RowBox[{"ToExpression", "[", RowBox[{"$CommandLine", "[", RowBox[{"[", "6", "]"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"dnum", "=", "0"}], ";", RowBox[{"method", "=", "0"}], ";", RowBox[{"\[Delta]t", "=", RowBox[{"\[Delta]tmin", "=", RowBox[{"1", "/", "100000."}]}]}], ";", RowBox[{"tmax", "=", RowBox[{"10", "^", "6"}]}], ";", RowBox[{"\[Delta]max", "=", RowBox[{"10", "^", RowBox[{"-", "11"}]}]}], ";", RowBox[{"fac", "=", "0.8"}], ";", RowBox[{"facmin", "=", RowBox[{"10", "^", RowBox[{"-", "3"}]}]}], ";", RowBox[{"facmax", "=", "10"}], ";", RowBox[{"Rtol", "=", RowBox[{"Atol", "=", RowBox[{"10", "^", RowBox[{"-", "5"}]}]}]}], ";", RowBox[{"rejectMemory", "=", RowBox[{"ConstantArray", "[", RowBox[{"True", ",", "5"}], "]"}]}], ";", RowBox[{"loop", "=", RowBox[{"lastswitch", "=", "0"}]}], ";", RowBox[{"SERK", "=", "False"}], ";", RowBox[{"time", "=", RowBox[{"AbsoluteTime", "[", "]"}]}], ";", RowBox[{"times", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"{", "0.", "}"}], "]"}]}], ";", RowBox[{"etab", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"{", "0.", "}"}], "]"}]}], ";", RowBox[{"QK0", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"{", "0.", "}"}], "]"}]}], ";", RowBox[{"QR0", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"{", "0.", "}"}], "]"}]}], ";", RowBox[{"Clear", "[", RowBox[{"debug", ",", "B2"}], "]"}], ";", RowBox[{"fixed", "=", "False"}], ";", RowBox[{"len", "=", RowBox[{"If", "[", RowBox[{RowBox[{"!", "txt"}], ",", "512", ",", RowBox[{"ToExpression", "[", RowBox[{"$CommandLine", "[", RowBox[{"[", "7", "]"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"Tmax", "=", RowBox[{"10", "^", "5"}]}], ";", RowBox[{RowBox[{"\[Theta]func", "[", "x_", "]"}], ":=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Delta]", "=", RowBox[{"1", "/", RowBox[{"(", RowBox[{"10", "\[Pi]", "Tmax"}], ")"}]}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Eta]", "=", RowBox[{"Rationalize", "[", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{"1", "/", "len"}], ")"}]}], "2", RowBox[{"ProductLog", "[", RowBox[{RowBox[{"-", "1"}], ",", RowBox[{RowBox[{"-", "\[Pi]"}], "\[Delta]"}]}], "]"}]}], "]"}]}], "}"}], ",", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"x", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}], "-", RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}]}], ")"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}], "]"}]}], "-", RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}]}], "\[Eta]"}], ")"}]}], "]"}]}]}], ")"}]}]}], "]"}]}], "]"}], ",", "40"}], "]"}]}], ";", RowBox[{RowBox[{"inv\[Theta]", "[", "x_", "]"}], "=", RowBox[{"Quiet", "[", RowBox[{RowBox[{"InverseFunction", "[", "\[Theta]func", "]"}], "[", "x", "]"}], "]"}]}], ";", RowBox[{"\[Theta]points", "=", RowBox[{"\[Theta]func", "[", RowBox[{"Range", "[", "len", "]"}], "]"}]}], ";", RowBox[{"createInt", "[", RowBox[{RowBox[{"{", "\[Theta]points", "}"}], ",", RowBox[{"\"Five\"", "->", "True"}]}], "]"}], ";", RowBox[{RowBox[{"{", RowBox[{"secInt3", ",", "secInt5"}], "}"}], "=", RowBox[{"sectionInt", "[", RowBox[{"{", "\[Theta]points", "}"}], "]"}]}], ";", RowBox[{"Quiet", "[", RowBox[{"createLibrary", "[", RowBox[{RowBox[{"Min", "[", RowBox[{"$ProcessorCount", ",", "48"}], "]"}], ",", RowBox[{"{", RowBox[{"p", ",", "p2"}], "}"}], ",", "multithread"}], "]"}], "]"}], ";", RowBox[{"loadLibrary", "[", "]"}], ";", RowBox[{"fpa", "=", RowBox[{"Import", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{RowBox[{"ParentDirectory", "[", "dir", "]"}], ",", "\"ROCK4-Data\"", ",", "\"fpa.txt\""}], "}"}], "]"}], ",", "\"Table\""}], "]"}]}], ";", RowBox[{"fpb", "=", RowBox[{"Import", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{RowBox[{"ParentDirectory", "[", "dir", "]"}], ",", "\"ROCK4-Data\"", ",", "\"fpb.txt\""}], "}"}], "]"}], ",", "\"Table\""}], "]"}]}], ";", RowBox[{"fpbe", "=", RowBox[{"Import", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{RowBox[{"ParentDirectory", "[", "dir", "]"}], ",", "\"ROCK4-Data\"", ",", "\"fpbe.txt\""}], "}"}], "]"}], ",", "\"Table\""}], "]"}]}], ";", RowBox[{"refc", "=", RowBox[{RowBox[{"Import", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{RowBox[{"ParentDirectory", "[", "dir", "]"}], ",", "\"ROCK4-Data\"", ",", "\"refc.txt\""}], "}"}], "]"}], ",", "\"Table\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", RowBox[{"ROCKdegrees", "=", RowBox[{"{", RowBox[{"5", ",", "6", ",", "7", ",", "8", ",", "9", ",", "10", ",", "11", ",", "12", ",", "13", ",", "14", ",", "15", ",", "16", ",", "17", ",", "18", ",", "19", ",", "20", ",", "21", ",", "22", ",", "23", ",", "24", ",", "26", ",", "28", ",", "30", ",", "32", ",", "34", ",", "36", ",", "38", ",", "40", ",", "42", ",", "45", ",", "48", ",", "51", ",", "54", ",", "57", ",", "60", ",", "63", ",", "67", ",", "71", ",", "75", ",", "80", ",", "85", ",", "90", ",", "96", ",", "102", ",", "109", ",", "116", ",", "124", ",", "133", ",", "142", ",", "152"}], "}"}]}], ";", RowBox[{"amat", "=", RowBox[{"LowerTriangularize", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{RowBox[{"1", "/", "6"}], ",", RowBox[{"{", RowBox[{"10", ",", "10"}], "}"}]}], "]"}], ",", RowBox[{"-", "1"}]}], "]"}]}], ";", RowBox[{RowBox[{"amat", "[", RowBox[{"[", RowBox[{RowBox[{"6", ";;", "10"}], ",", RowBox[{"1", ";;", "5"}]}], "]"}], "]"}], "-=", RowBox[{"1", "/", "10"}]}], ";", RowBox[{"bvec", "=", RowBox[{"ConstantArray", "[", RowBox[{RowBox[{"1", "/", "10"}], ",", "10"}], "]"}]}], ";", RowBox[{"b2vec", "=", RowBox[{"{", RowBox[{"0", ",", RowBox[{"2", "/", "9"}], ",", "0", ",", "0", ",", RowBox[{"5", "/", "18"}], ",", RowBox[{"1", "/", "3"}], ",", "0", ",", "0", ",", "0", ",", RowBox[{"1", "/", "6"}]}], "}"}]}], ";", RowBox[{"createHermite", "[", RowBox[{"\[Theta]points", ",", "ord"}], "]"}], ";", RowBox[{"\[Phi]points1", "=", RowBox[{"KroneckerProduct", "[", RowBox[{"\[Theta]points", ",", "\[Theta]points"}], "]"}]}], ";", RowBox[{"\[Phi]points2", "=", RowBox[{"\[Theta]points", "+", RowBox[{"KroneckerProduct", "[", RowBox[{RowBox[{"1", "-", "\[Theta]points"}], ",", "\[Theta]points"}], "]"}]}]}], ";", RowBox[{RowBox[{"{", RowBox[{"indsA1y", ",", "weightsA1y"}], "}"}], "=", RowBox[{"weights", "[", "\[Phi]points1", "]"}]}], ";", RowBox[{RowBox[{"{", RowBox[{"indsA2y", ",", "weightsA2y"}], "}"}], "=", RowBox[{"weights", "[", "\[Phi]points2", "]"}]}], ";", RowBox[{RowBox[{"{", RowBox[{"indsB2y", ",", "weightsB2y"}], "}"}], "=", RowBox[{"weights", "[", RowBox[{"Transpose", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{"\[Theta]points", ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{"\[Phi]points2", "-", RowBox[{"10", "^", RowBox[{"-", "300"}]}]}], ")"}]}], "]"}], "]"}]}], ";", RowBox[{"posA1y", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"1.", RowBox[{"Clip", "[", RowBox[{RowBox[{"inv\[Theta]", "[", "\[Phi]points1", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", RowBox[{"10", "^", RowBox[{"-", "100"}]}]}]}], "}"}]}], "]"}]}], "]"}]}], ";", RowBox[{"posA2y", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"1.", RowBox[{"Clip", "[", RowBox[{RowBox[{"inv\[Theta]", "[", "\[Phi]points2", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", RowBox[{"10", "^", RowBox[{"-", "100"}]}]}]}], "}"}]}], "]"}]}], "]"}]}], ";", RowBox[{"posB2y", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"1.", RowBox[{"Clip", "[", RowBox[{RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{"\[Theta]points", ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{"\[Phi]points2", "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", RowBox[{"10", "^", RowBox[{"-", "100"}]}]}]}], "}"}]}], "]"}]}], "]"}]}], ";", RowBox[{"posB1xOld", "=", "0"}], ";", RowBox[{"posB2xOld", "=", "0"}], ";", RowBox[{"\[Theta]points", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"1.", "\[Theta]points"}], "]"}]}], ";", RowBox[{"\[Phi]points1", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"1.", "\[Phi]points1"}], "]"}]}], ";", RowBox[{"\[Phi]points2", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"1.", "\[Phi]points2"}], "]"}]}], ";", RowBox[{"interactions", "[", "]"}], ";", RowBox[{"\[Lambda]", "=", RowBox[{"If", "[", RowBox[{RowBox[{"!", "txt"}], ",", "0.1", ",", RowBox[{RowBox[{"Ceiling", "[", RowBox[{RowBox[{"(", RowBox[{RowBox[{"ToExpression", "[", RowBox[{"$CommandLine", "[", RowBox[{"[", "4", "]"}], "]"}], "]"}], "+", "51"}], ")"}], "/", "9"}], "]"}], "*", RowBox[{"1", "/", "10"}]}]}], "]"}]}], ";"}], ";", RowBox[{"T0", "=", RowBox[{"If", "[", RowBox[{RowBox[{"!", "txt"}], ",", "\[Infinity]", ",", "\[Infinity]"}], "]"}]}], ";", RowBox[{"specRad", "=", RowBox[{"4", RowBox[{"Sqrt", "[", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR"}], "}"}], "=", RowBox[{"{", RowBox[{RowBox[{"Developer`ToPackedArray", "[", RowBox[{"ConstantArray", "[", RowBox[{"1.", ",", RowBox[{"{", RowBox[{"1", ",", "len"}], "}"}]}], "]"}], "]"}], ",", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"ConstantArray", "[", RowBox[{"1.", ",", RowBox[{"{", RowBox[{"1", ",", "len"}], "}"}]}], "]"}], "]"}]}], "}"}]}], ";", RowBox[{RowBox[{"{", RowBox[{"dQK", ",", "dQR"}], "}"}], "=", RowBox[{"{", RowBox[{RowBox[{"Developer`ToPackedArray", "[", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"1", ",", "len"}], "}"}]}], "]"}], "]"}], ",", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"1", ",", "len"}], "}"}]}], "]"}], "]"}]}], "}"}]}], ";", RowBox[{"\[Sigma]K", "=", RowBox[{"\[CapitalSigma]K", "[", RowBox[{"QK", ",", "QR"}], "]"}]}], ";", RowBox[{"\[Sigma]R", "=", RowBox[{"\[CapitalSigma]R", "[", RowBox[{"QK", ",", "QR"}], "]"}]}], ";", RowBox[{"t1grid", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"{", "0.", "}"}], "]"}]}], ";", RowBox[{"rvec", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"{", RowBox[{"If", "[", RowBox[{"quantum", ",", "0.", ",", RowBox[{RowBox[{"1.", "\[Gamma]"}], "+", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "/", "T0"}]}]}], "]"}], "}"}], "]"}]}], ";", RowBox[{"drvec", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"{", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", "\[Delta]t"}], "]"}], "}"}], "]"}]}], ";", RowBox[{"rint", "=", RowBox[{"Interpol1D", "[", RowBox[{"rvec", ",", RowBox[{"bsearchPosSorted", "[", RowBox[{"t1grid", ",", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "\[Theta]points"}]}], "]"}]}], "]"}]}], ";", RowBox[{"\[Delta]tratio", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"{", "0.", "}"}], "]"}]}], ";", RowBox[{RowBox[{"QRana", "[", RowBox[{"t1_", ",", "\[Theta]_", ",", "f_"}], "]"}], ":=", RowBox[{RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"-", "2"}], RowBox[{"Sqrt", "[", "f", "]"}], "t1", RowBox[{"(", RowBox[{"1", "-", "\[Theta]"}], ")"}]}], ")"}]}], RowBox[{"Hypergeometric0F1Regularized", "[", RowBox[{"2", ",", RowBox[{"f", RowBox[{"t1", "^", "2"}], RowBox[{RowBox[{"(", RowBox[{"1", "-", "\[Theta]"}], ")"}], "^", "2"}]}]}], "]"}]}]}], ";", RowBox[{RowBox[{"QRanaSquare", "[", RowBox[{"t1_", ",", "\[Theta]_", ",", "f_"}], "]"}], ":=", RowBox[{RowBox[{"Sign", "[", RowBox[{"1", "-", "\[Theta]"}], "]"}], RowBox[{RowBox[{"(", RowBox[{"2", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"-", "2"}], RowBox[{"Sqrt", "[", "f", "]"}], "t1", RowBox[{"(", RowBox[{"1", "-", "\[Theta]"}], ")"}]}], ")"}]}], RowBox[{"BesselI", "[", RowBox[{"2", ",", RowBox[{"2", RowBox[{"Sqrt", "[", "f", "]"}], "t1", RowBox[{"(", RowBox[{"1", "-", "\[Theta]"}], ")"}]}]}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{"f", RowBox[{"t1", "^", "2"}], RowBox[{"(", RowBox[{"1", "-", "\[Theta]", "+", RowBox[{"Clip", "[", RowBox[{"\[Theta]", ",", RowBox[{"{", RowBox[{"1", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"0", ",", "1"}], "}"}]}], "]"}]}], ")"}]}], ")"}]}]}]}], ";", RowBox[{RowBox[{"QRst", "[", "t1_", "]"}], ":=", RowBox[{"QRana", "[", RowBox[{RowBox[{"SetPrecision", "[", RowBox[{"t1", ",", "40"}], "]"}], ",", RowBox[{"SetPrecision", "[", RowBox[{"\[Theta]points", ",", "40"}], "]"}], ",", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], ",", "40"}], "]"}]}], "]"}]}], ";", RowBox[{RowBox[{"QRst2", "[", "t1_", "]"}], ":=", RowBox[{"QRanaSquare", "[", RowBox[{RowBox[{"SetPrecision", "[", RowBox[{"t1", ",", "40"}], "]"}], ",", RowBox[{"SetPrecision", "[", RowBox[{"\[Theta]points", ",", "40"}], "]"}], ",", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], ",", "40"}], "]"}]}], "]"}]}], ";", RowBox[{"Clear", "[", "QRinter", "]"}], ";", RowBox[{RowBox[{"QRinter", "[", "\[Tau]_", "]"}], "=", RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{RowBox[{"10", "^", "10"}], RowBox[{"Prepend", "[", RowBox[{RowBox[{"Exp", "[", RowBox[{"Subdivide", "[", RowBox[{RowBox[{"Log", "[", RowBox[{"10", "^", RowBox[{"-", "20"}]}], "]"}], ",", RowBox[{"Log", "[", "1", "]"}], ",", "10000"}], "]"}], "]"}], ",", "0"}], "]"}]}], ",", RowBox[{"QRana", "[", RowBox[{RowBox[{"10", "^", "10"}], ",", RowBox[{"1", "-", RowBox[{"Prepend", "[", RowBox[{RowBox[{"Exp", "[", RowBox[{"Subdivide", "[", RowBox[{RowBox[{"Log", "[", RowBox[{"10", "^", RowBox[{"-", "20"}]}], "]"}], ",", RowBox[{"Log", "[", "1", "]"}], ",", "10000"}], "]"}], "]"}], ",", "0"}], "]"}]}], ",", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], ",", "40"}], "]"}]}], "]"}]}], "}"}], "]"}], ",", RowBox[{"InterpolationOrder", "->", "5"}], ",", RowBox[{"Method", "->", "\"Spline\""}]}], "]"}], "[", "\[Tau]", "]"}]}], ";", RowBox[{"Clear", "[", "QRinter2", "]"}], ";", RowBox[{RowBox[{"QRinter2", "[", "\[Tau]_", "]"}], "=", RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{RowBox[{"10", "^", "10"}], RowBox[{"Prepend", "[", RowBox[{RowBox[{"Exp", "[", RowBox[{"Subdivide", "[", RowBox[{RowBox[{"Log", "[", RowBox[{"10", "^", RowBox[{"-", "20"}]}], "]"}], ",", RowBox[{"Log", "[", "1", "]"}], ",", "10000"}], "]"}], "]"}], ",", "0"}], "]"}]}], ",", RowBox[{"QRanaSquare", "[", RowBox[{RowBox[{"10", "^", "10"}], ",", RowBox[{"1", "-", RowBox[{"Prepend", "[", RowBox[{RowBox[{"Exp", "[", RowBox[{"Subdivide", "[", RowBox[{RowBox[{"Log", "[", RowBox[{"10", "^", RowBox[{"-", "20"}]}], "]"}], ",", RowBox[{"Log", "[", "1", "]"}], ",", "10000"}], "]"}], "]"}], ",", "0"}], "]"}]}], ",", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], ",", "40"}], "]"}]}], "]"}]}], "}"}], "]"}], ",", RowBox[{"InterpolationOrder", "->", "5"}], ",", RowBox[{"Method", "->", "\"Spline\""}]}], "]"}], "[", "\[Tau]", "]"}]}], ";", RowBox[{"QKA1int", "=", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], ";", RowBox[{"QRA1int", "=", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], ";", RowBox[{"QKB1int", "=", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], ";", RowBox[{"QRB1int", "=", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], ";", RowBox[{"QKA2int", "=", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], ";", RowBox[{"QRA2int", "=", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], ";", RowBox[{"QKB2int", "=", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], ";", RowBox[{"QRB2int", "=", RowBox[{"ConstantArray", "[", RowBox[{"0.", ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], ";", RowBox[{RowBox[{"B", "[", "t_", "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"\[Pi]t", "=", RowBox[{"\[Pi]", RowBox[{"t", "^", "2"}]}]}], "}"}], ",", RowBox[{"2", "\[Gamma]", RowBox[{"Subtract", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{"1", "+", "\[Pi]t"}], ")"}]}], ",", RowBox[{RowBox[{"Sqrt", "[", "2", "]"}], "/", RowBox[{"(", RowBox[{"1", "+", RowBox[{"\[Pi]t", "^", "2"}]}], ")"}]}]}], "]"}]}]}], "]"}]}], ";", RowBox[{RowBox[{"ht", "[", "t_", "]"}], ":=", RowBox[{"h", "+", RowBox[{"\[Delta]h", "/", RowBox[{"(", RowBox[{"1", "+", RowBox[{"E", "^", RowBox[{"Clip", "[", RowBox[{RowBox[{"t", "-", RowBox[{"tmax", "/", "2"}]}], ",", RowBox[{"{", RowBox[{RowBox[{"-", "600"}], ",", "600"}], "}"}]}], "]"}]}]}], ")"}]}]}]}], ";", RowBox[{"grad6", "=", RowBox[{"grad", "[", "6", "]"}]}], ";", RowBox[{"grad2", "=", RowBox[{"grad", "[", "2", "]"}]}], ";", RowBox[{"pref", "=", RowBox[{RowBox[{"(", RowBox[{"1.", "/", RowBox[{"(", RowBox[{"1", "+", RowBox[{"Exp", "[", RowBox[{"15", RowBox[{"Reverse", "[", RowBox[{"1", "-", RowBox[{RowBox[{"Range", "[", "len", "]"}], "/", RowBox[{"Round", "[", RowBox[{"len", "/", "10"}], "]"}]}]}], "]"}]}], "]"}]}], ")"}]}], ")"}], RowBox[{"(", RowBox[{"1", "/", RowBox[{"(", RowBox[{"1", "+", RowBox[{"Exp", "[", RowBox[{"15", RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"Range", "[", "len", "]"}], "/", RowBox[{"Round", "[", RowBox[{"len", "/", "10"}], "]"}]}]}], ")"}]}], "]"}]}], ")"}]}], ")"}]}]}], ";", RowBox[{"params", ":=", RowBox[{"StringJoin", "[", RowBox[{RowBox[{RowBox[{RowBox[{"ToString", "[", RowBox[{"Unevaluated", "[", "#", "]"}], "]"}], "<>", "\"=\"", "<>", RowBox[{"ToString", "[", RowBox[{RowBox[{"N", "[", "#", "]"}], ",", "InputForm"}], "]"}], "<>", "\"\\n\""}], "&"}], "/@", RowBox[{"Unevaluated", "/@", RowBox[{"Unevaluated", "[", RowBox[{"{", RowBox[{"version", ",", "p", ",", "p2", ",", "T0", ",", "\[Kappa]", ",", "\[Lambda]", ",", "\[CapitalLambda]", ",", "\[Beta]", ",", "h", ",", "\[Delta]h", ",", "\[Gamma]", ",", "len", ",", "Tmax", ",", "ord", ",", "\[Delta]tmin", ",", "\[Delta]max", ",", "precision", ",", "method"}], "}"}], "]"}]}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{"load", ",", RowBox[{"import", "[", "scratch", "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"ValueQ", "[", "build", "]"}], "&&", RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], "==", "1"}]}], ",", RowBox[{"build", "[", RowBox[{"QK", ",", "QR", ",", "dQK", ",", "dQR"}], "]"}]}], "]"}], ";"}], ")"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "interpolate", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "interpolate", "]"}], "=", RowBox[{"{", RowBox[{RowBox[{"\"newTime\"", "->", "False"}], ",", RowBox[{"\"Same\"", "->", "False"}], ",", RowBox[{"\"NewPos\"", "->", "True"}], ",", RowBox[{"\"Order\"", "->", "ord"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK_", ",", "QR_", ",", RowBox[{"posA1yIn_", ":", "0"}], ",", RowBox[{"posA2yIn_", ":", "0"}], ",", RowBox[{"posB2yIn_", ":", "0"}], ",", RowBox[{"posB1xIn_", ":", "0"}], ",", RowBox[{"posB2xIn_", ":", "0"}], ",", RowBox[{"\[Phi]points1In_", ":", "0"}], ",", RowBox[{"\[Phi]points2In_", ":", "0"}]}], "}"}], ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"\[Phi]points1", "=", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"\[Phi]points1In", "===", "0"}]}], ",", "\[Phi]points1In", ",", RowBox[{"KroneckerProduct", "[", RowBox[{"\[Theta]points", ",", "\[Theta]points"}], "]"}]}], "]"}]}], ",", RowBox[{"\[Phi]points2", "=", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"\[Phi]points2In", "===", "0"}]}], ",", "\[Phi]points2In", ",", RowBox[{"\[Theta]points", "+", RowBox[{"KroneckerProduct", "[", RowBox[{RowBox[{"1", "-", "\[Theta]points"}], ",", "\[Theta]points"}], "]"}]}]}], "]"}]}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"posB1x", "=", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"posB1xIn", "===", "0"}]}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Same\"", "]"}], ",", "posB1xIn", ",", RowBox[{"isearchPosSortedInit", "[", RowBox[{"t1grid", ",", "\[Theta]points", ",", "posB1xIn"}], "]"}]}], "]"}], ",", RowBox[{"bsearchPosSorted", "[", RowBox[{"t1grid", ",", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "\[Theta]points"}]}], "]"}]}], "]"}]}], ",", RowBox[{"posB2x", "=", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"posB2xIn", "===", "0"}]}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Same\"", "]"}], ",", "posB2xIn", ",", RowBox[{"isearchPosSortedInit", "[", RowBox[{"t1grid", ",", "\[Phi]points2", ",", "posB2xIn"}], "]"}]}], "]"}], ",", RowBox[{"bsearchPosSorted", "[", RowBox[{"t1grid", ",", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "\[Phi]points2"}]}], "]"}]}], "]"}]}], ",", RowBox[{"posA1y", "=", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"posA1yIn", "===", "0"}]}], ",", "posA1yIn", ",", RowBox[{"1.", RowBox[{"Clip", "[", RowBox[{RowBox[{"inv\[Theta]", "[", "\[Phi]points1", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", RowBox[{"10.", "^", RowBox[{"-", "100"}]}]}]}], "}"}]}], "]"}]}]}], "]"}]}], ",", RowBox[{"posA2y", "=", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"posA2yIn", "===", "0"}]}], ",", "posA2yIn", ",", RowBox[{"1.", RowBox[{"Clip", "[", RowBox[{RowBox[{"inv\[Theta]", "[", "\[Phi]points2", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", RowBox[{"10.", "^", RowBox[{"-", "100"}]}]}]}], "}"}]}], "]"}]}]}], "]"}]}], ",", RowBox[{"posB2y", "=", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"posB2yIn", "===", "0"}]}], ",", "posB2yIn", ",", RowBox[{"1.", RowBox[{"Clip", "[", RowBox[{RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{"\[Theta]points", ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{"\[Phi]points2", "-", RowBox[{"10.", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", RowBox[{"10.", "^", RowBox[{"-", "100"}]}]}]}], "}"}]}], "]"}]}]}], "]"}]}]}], "}"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"NewPos\"", "]"}], ",", RowBox[{RowBox[{"{", RowBox[{"posB1xOld", ",", "posB2xOld"}], "}"}], "=", RowBox[{"{", RowBox[{"posB1x", ",", "posB2x"}], "}"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"ValueQ", "[", "append", "]"}], "&&", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ">", "0"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"OptionValue", "[", "\"Order\"", "]"}], ">", "1"}], ",", RowBox[{"Interpol1D3c", "[", RowBox[{"weightsA1y", ",", "indsA1y", ",", "QKA1int", ",", "QRA1int"}], "]"}], ",", RowBox[{RowBox[{"{", RowBox[{"QKA1int", ",", "QRA1int"}], "}"}], "=", RowBox[{"InterpolLast", "[", RowBox[{RowBox[{"{", RowBox[{"1", ",", "2"}], "}"}], ",", "posA1y"}], "]"}]}]}], "]"}], ";", RowBox[{"\[CapitalSigma]K", "[", RowBox[{"QKA1int", ",", "QRA1int", ",", "\[CapitalSigma]KA1int"}], "]"}], ";", RowBox[{"\[CapitalSigma]R", "[", RowBox[{"QKA1int", ",", "QRA1int", ",", "\[CapitalSigma]RA1int"}], "]"}]}], ",", RowBox[{RowBox[{"{", RowBox[{"QKA1int", ",", "QRA1int", ",", "\[CapitalSigma]KA1int", ",", "\[CapitalSigma]RA1int"}], "}"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"OptionValue", "[", "\"Order\"", "]"}], ">", "1"}], ",", RowBox[{"Interpol1D3", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "\[Sigma]K", ",", "\[Sigma]R"}], "}"}], ",", "indsA1y", ",", "weightsA1y"}], "]"}], ",", RowBox[{"Interpol1D", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "\[Sigma]K", ",", "\[Sigma]R"}], "}"}], ",", "posA1y", ",", RowBox[{"\"Last\"", "->", "True"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"ValueQ", "[", "append", "]"}], "&&", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ">", "0"}]}], ",", RowBox[{RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"floor", "=", RowBox[{"Clip", "[", RowBox[{RowBox[{"Floor", "[", "posB1x", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"Max", "[", RowBox[{RowBox[{RowBox[{"Ceiling", "[", RowBox[{"Max", "[", "posB1x", "]"}], "]"}], "-", "1"}], ",", "1"}], "]"}]}], "}"}]}], "]"}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"diff", "=", RowBox[{"Subtract", "[", RowBox[{"floor", ",", "posB1x"}], "]"}]}], "}"}], ",", RowBox[{"indexVecN", "[", RowBox[{"len", ",", "diff", ",", "floor", ",", "\[Delta]tratio", ",", "QKB1int", ",", "QRB1int"}], "]"}]}], "]"}]}], "]"}], ";", RowBox[{"\[CapitalSigma]K", "[", RowBox[{"QKB1int", ",", "QRB1int", ",", "\[CapitalSigma]KB1int"}], "]"}], ";", RowBox[{"\[CapitalSigma]R", "[", RowBox[{"QKB1int", ",", "QRB1int", ",", "\[CapitalSigma]RB1int"}], "]"}]}], ",", RowBox[{RowBox[{"{", RowBox[{"QKB1int", ",", "QRB1int", ",", "\[CapitalSigma]KB1int", ",", "\[CapitalSigma]RB1int"}], "}"}], "=", RowBox[{"Interpol1D", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "\[Sigma]K", ",", "\[Sigma]R"}], "}"}], ",", "posB1x"}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"ValueQ", "[", "append", "]"}], "&&", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ">", "0"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"OptionValue", "[", "\"Order\"", "]"}], ">", "1"}], ",", RowBox[{"Interpol1D3c", "[", RowBox[{"weightsA2y", ",", "indsA2y", ",", "QKA2int", ",", "QRA2int"}], "]"}], ",", RowBox[{RowBox[{"{", RowBox[{"QKA2int", ",", "QRA2int"}], "}"}], "=", RowBox[{"InterpolLast", "[", RowBox[{RowBox[{"{", RowBox[{"1", ",", "2"}], "}"}], ",", "posA2y"}], "]"}]}]}], "]"}], ";", RowBox[{"\[CapitalSigma]R", "[", RowBox[{"QKA2int", ",", "QRA2int", ",", "\[CapitalSigma]RA2int"}], "]"}]}], ",", RowBox[{RowBox[{"{", RowBox[{"QRA2int", ",", "\[CapitalSigma]RA2int"}], "}"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"OptionValue", "[", "\"Order\"", "]"}], ">", "1"}], ",", RowBox[{"Interpol1D3", "[", RowBox[{RowBox[{"{", RowBox[{"QR", ",", "\[Sigma]R"}], "}"}], ",", "indsA2y", ",", "weightsA2y"}], "]"}], ",", RowBox[{"Interpol1D", "[", RowBox[{RowBox[{"{", RowBox[{"QR", ",", "\[Sigma]R"}], "}"}], ",", "posA2y", ",", RowBox[{"\"Last\"", "->", "True"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"ValueQ", "[", "append", "]"}], "&&", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ">", "0"}]}], ",", RowBox[{RowBox[{RowBox[{"{", RowBox[{"QKB2int", ",", "QRB2int"}], "}"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"OptionValue", "[", "\"Order\"", "]"}], ">", "1"}], ",", RowBox[{"Interpol2D3c", "[", RowBox[{"posB2x", ",", "indsB2y", ",", "weightsB2y", ",", "\[Delta]tratio"}], "]"}], ",", RowBox[{"Interpol2Dc", "[", RowBox[{RowBox[{"{", RowBox[{"1", ",", "2"}], "}"}], ",", "posB2x", ",", "posB2y"}], "]"}]}], "]"}]}], ";", RowBox[{"\[CapitalSigma]K", "[", RowBox[{"QKB2int", ",", "QRB2int", ",", "\[CapitalSigma]KB2int"}], "]"}], ";", RowBox[{"\[CapitalSigma]R", "[", RowBox[{"QKB2int", ",", "QRB2int", ",", "\[CapitalSigma]RB2int"}], "]"}]}], ",", RowBox[{RowBox[{"{", RowBox[{"QKB2int", ",", "QRB2int", ",", "\[CapitalSigma]KB2int", ",", "\[CapitalSigma]RB2int"}], "}"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"OptionValue", "[", "\"Order\"", "]"}], ">", "1"}], ",", RowBox[{"Interpol2D3", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "\[Sigma]K", ",", "\[Sigma]R"}], "}"}], ",", "posB2x", ",", "indsB2y", ",", "weightsB2y"}], "]"}], ",", RowBox[{"Interpol2D", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "\[Sigma]K", ",", "\[Sigma]R"}], "}"}], ",", "posB2x", ",", "posB2y"}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"rint", "=", RowBox[{"Interpol1D2", "[", RowBox[{"rvec", ",", "drvec", ",", "posB1x", ",", "\[Delta]tratio"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"quantum", "&&", RowBox[{"(", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "BA1", "]"}]}], "||", RowBox[{"!", RowBox[{RowBox[{"BA1", "[", RowBox[{"[", RowBox[{"1", ",", "1"}], "]"}], "]"}], "===", RowBox[{"B", "[", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "]"}]}]}]}], ")"}]}], ",", RowBox[{RowBox[{"BA1", "=", RowBox[{"B", "[", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], RowBox[{"(", RowBox[{"\[Phi]points1", "-", "1"}], ")"}]}], "]"}]}], ";", RowBox[{"BB1", "=", RowBox[{"B", "[", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], RowBox[{"(", RowBox[{"\[Phi]points1", "-", "\[Theta]points"}], ")"}]}], "]"}]}], ";", RowBox[{"BB2", "=", RowBox[{"B", "[", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], RowBox[{"(", RowBox[{"\[Phi]points2", "-", "\[Theta]points"}], ")"}]}], "]"}]}], ";"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"h", "!=", "0"}], ",", RowBox[{RowBox[{"hA1", "=", RowBox[{RowBox[{"ht", "[", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "]"}], RowBox[{"ht", "[", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "\[Phi]points1"}], "]"}]}]}], ";", RowBox[{"hB1", "=", RowBox[{RowBox[{"ht", "[", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "\[Theta]points"}], "]"}], RowBox[{"ht", "[", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "\[Phi]points1"}], "]"}]}]}], ";", RowBox[{"hB2", "=", RowBox[{RowBox[{"ht", "[", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "\[Phi]points2"}], "]"}], RowBox[{"ht", "[", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "\[Theta]points"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{"quantum", ",", RowBox[{RowBox[{"{", RowBox[{"\[CapitalSigma]KA1int", ",", "\[CapitalSigma]KB1int", ",", "\[CapitalSigma]KB2int"}], "}"}], "+=", RowBox[{"{", RowBox[{"BA1", ",", "BB1", ",", "BB2"}], "}"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"h", "!=", "0"}], ",", RowBox[{RowBox[{"{", RowBox[{"\[CapitalSigma]KA1int", ",", "\[CapitalSigma]KB1int", ",", "\[CapitalSigma]KB2int"}], "}"}], "+=", RowBox[{"{", RowBox[{"hA1", ",", "hB1", ",", "hB2"}], "}"}]}]}], "]"}], ";"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"rvec\[Theta]", "[", "r_", "]"}], ":=", RowBox[{"Interpol1D", "[", RowBox[{"r", ",", RowBox[{"bsearchPosSorted", "[", RowBox[{"t1grid", ",", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "\[Theta]points"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{"Clear", "[", "QKstep", "]"}]
RowBox[{RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK_", ",", "\[Theta]points_", ",", RowBox[{"rvec0_", ":", "0"}]}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"d1QK", "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"-", RowBox[{"rint", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], ")"}], RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "+", RowBox[{"ConvR", "[", RowBox[{"\[CapitalSigma]RA2int", ",", "QKB2int", ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}], "+", RowBox[{"ConvA", "[", RowBox[{"\[CapitalSigma]RA1int", ",", "QKB1int", ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}], "+", RowBox[{"ConvA", "[", RowBox[{"\[CapitalSigma]KA1int", ",", "QRB1int", ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}], "+", RowBox[{RowBox[{"(", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", RowBox[{"QK", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}], RowBox[{"QKB1int", "[", RowBox[{"[", RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ")"}], "/", "T0"}]}]}], ",", RowBox[{"d2QK", "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"-", "rint"}], ")"}], RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "+", RowBox[{"ConvR", "[", RowBox[{"QRA2int", ",", "\[CapitalSigma]KB2int", ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}], "+", RowBox[{"ConvA", "[", RowBox[{"QRA1int", ",", "\[CapitalSigma]KB1int", ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}], "+", RowBox[{"ConvA", "[", RowBox[{"QKA1int", ",", "\[CapitalSigma]RB1int", ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}], "+", RowBox[{"If", "[", RowBox[{"quantum", ",", "0", ",", RowBox[{RowBox[{RowBox[{"(", RowBox[{"2", "\[Gamma]"}], ")"}], "/", "\[Beta]"}], RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}]}], "]"}], "-", RowBox[{"If", "[", RowBox[{RowBox[{"rvec0", "===", "0"}], ",", "0", ",", RowBox[{RowBox[{"rvec0", "[", RowBox[{"[", "1", "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"rvec0", "[", RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}]}], "]"}], "+", RowBox[{RowBox[{"(", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", RowBox[{"QKB1int", "[", RowBox[{"[", RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], RowBox[{"QK", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ")"}], "/", "T0"}]}]}]}], "}"}], ",", RowBox[{"d1QK", "+", RowBox[{"\[Theta]points", "d2QK"}]}]}], "]"}]}], ";"}]
RowBox[{"Clear", "[", "QRstep", "]"}]
RowBox[{RowBox[{RowBox[{"QRstep", "[", RowBox[{"QR_", ",", "\[Theta]points_", ",", RowBox[{"rvec0_", ":", "0"}]}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"d1QR", "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"-", RowBox[{"rint", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], ")"}], RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "+", RowBox[{"ConvR", "[", RowBox[{"\[CapitalSigma]RA2int", ",", "QRB2int", ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}], "-", RowBox[{"If", "[", RowBox[{RowBox[{"rvec0", "===", "0"}], ",", "0", ",", RowBox[{RowBox[{"rvec0", "[", RowBox[{"[", "1", "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"rvec0", "[", RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], ",", RowBox[{"d2QR", "=", RowBox[{RowBox[{"rint", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "-", RowBox[{"ConvR", "[", RowBox[{"QRA2int", ",", "\[CapitalSigma]RB2int", ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}]}]}], "}"}], ",", RowBox[{"d1QR", "+", RowBox[{"\[Theta]points", "d2QR"}]}]}], "]"}]}], ";"}]
RowBox[{"Clear", "[", "QRstep2", "]"}]
RowBox[{RowBox[{RowBox[{"QRstep2", "[", RowBox[{"QR_", ",", "\[Theta]points_", ",", RowBox[{"rvec0_", ":", "0"}]}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"d1QR", "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"-", RowBox[{"rint", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], ")"}], RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "+", RowBox[{"ConvR", "[", RowBox[{"\[CapitalSigma]RA2int", ",", "QRB2int", ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}], "-", RowBox[{"If", "[", RowBox[{RowBox[{"rvec0", "===", "0"}], ",", "0", ",", RowBox[{RowBox[{"rvec0", "[", RowBox[{"[", "1", "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"rvec0", "[", RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}], ",", RowBox[{"d2QR", "=", RowBox[{RowBox[{"rint", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "-", RowBox[{"ConvR", "[", RowBox[{"QRA2int", ",", "\[CapitalSigma]RB2int", ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}]}], ",", RowBox[{"\[Tau]", "=", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], RowBox[{"(", RowBox[{"1", "-", "\[Theta]points"}], ")"}]}]}]}], "}"}], ",", RowBox[{"d1QR", "+", RowBox[{"\[Theta]points", "d2QR"}], "-", RowBox[{RowBox[{"(", RowBox[{"1", "-", "\[Theta]points"}], ")"}], RowBox[{"(", RowBox[{RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], RowBox[{"QRinter2", "[", "\[Tau]", "]"}]}], "-", RowBox[{"2", RowBox[{"Sqrt", "[", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "]"}], RowBox[{"QRinter", "[", "\[Tau]", "]"}]}]}], ")"}]}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "rstep", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"rstep", "[", RowBox[{"QK_", ",", "QR_", ",", "t_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"\[Sigma]K", "=", RowBox[{RowBox[{"\[CapitalSigma]K", "[", RowBox[{"QK", ",", "QR"}], "]"}], "+", RowBox[{"If", "[", RowBox[{"quantum", ",", RowBox[{"B", "[", RowBox[{"t", RowBox[{"(", RowBox[{"\[Theta]points", "-", "1"}], ")"}]}], "]"}], ",", "0"}], "]"}], "+", RowBox[{"If", "[", RowBox[{RowBox[{"h", "!=", "0"}], ",", RowBox[{RowBox[{"ht", "[", "t", "]"}], RowBox[{"ht", "[", RowBox[{"t", "\[Theta]points"}], "]"}]}], ",", "0"}], "]"}]}]}], ",", RowBox[{"\[Sigma]R", "=", RowBox[{"\[CapitalSigma]R", "[", RowBox[{"QK", ",", "QR"}], "]"}]}]}], "}"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{"quantum", ",", "0", ",", "\[Gamma]"}], "]"}], "+", RowBox[{"(", RowBox[{RowBox[{"ConvA", "[", RowBox[{"\[Sigma]R", ",", "QK", ",", "t"}], "]"}], "+", RowBox[{"ConvA", "[", RowBox[{"\[Sigma]K", ",", "QR", ",", "t"}], "]"}]}], ")"}], "+", RowBox[{RowBox[{"(", RowBox[{RowBox[{"\[Sigma]K", "[", RowBox[{"[", "1", "]"}], "]"}], RowBox[{"QK", "[", RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", "T0"}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "drstep", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"drstep", "[", RowBox[{"QK_", ",", "QR_", ",", "t_", ",", "dQK_", ",", "dQR_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"\[Sigma]K", "=", RowBox[{RowBox[{"\[CapitalSigma]K", "[", RowBox[{"QK", ",", "QR"}], "]"}], "+", RowBox[{"If", "[", RowBox[{"quantum", ",", RowBox[{"B", "[", RowBox[{"t", RowBox[{"(", RowBox[{"\[Theta]points", "-", "1"}], ")"}]}], "]"}], ",", "0"}], "]"}], "+", RowBox[{"If", "[", RowBox[{RowBox[{"h", "!=", "0"}], ",", RowBox[{RowBox[{"ht", "[", "t", "]"}], RowBox[{"ht", "[", RowBox[{"t", "\[Theta]points"}], "]"}]}], ",", "0"}], "]"}]}]}], ",", RowBox[{"\[Sigma]R", "=", RowBox[{"\[CapitalSigma]R", "[", RowBox[{"QK", ",", "QR"}], "]"}]}], ",", RowBox[{"d\[Sigma]K", "=", RowBox[{RowBox[{RowBox[{"\[CapitalSigma]K10", "[", RowBox[{"QK", ",", "QR"}], "]"}], "dQK"}], "+", RowBox[{RowBox[{"\[CapitalSigma]K01", "[", RowBox[{"QK", ",", "QR"}], "]"}], "dQR"}], "+", RowBox[{"If", "[", RowBox[{"quantum", ",", RowBox[{RowBox[{"(", RowBox[{"\[Theta]points", "-", "1"}], ")"}], RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "B", "]"}], "[", RowBox[{"t", RowBox[{"(", RowBox[{"\[Theta]points", "-", "1"}], ")"}]}], "]"}]}], ",", "0"}], "]"}], "+", RowBox[{"If", "[", RowBox[{RowBox[{"h", "!=", "0"}], ",", RowBox[{RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "ht", "]"}], "[", "t", "]"}], RowBox[{"ht", "[", RowBox[{"t", "\[Theta]points"}], "]"}]}], "+", RowBox[{"\[Theta]points", RowBox[{"ht", "[", "t", "]"}], RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "ht", "]"}], "[", RowBox[{"t", "\[Theta]points"}], "]"}]}]}], ",", "0"}], "]"}]}]}], ",", RowBox[{"d\[Sigma]R", "=", RowBox[{RowBox[{RowBox[{"\[CapitalSigma]R10", "[", RowBox[{"QK", ",", "QR"}], "]"}], "dQK"}], "+", RowBox[{RowBox[{"\[CapitalSigma]R01", "[", RowBox[{"QK", ",", "QR"}], "]"}], "dQR"}]}]}]}], "}"}], ",", RowBox[{RowBox[{"ConvA", "[", RowBox[{"\[Sigma]R", ",", "QK", ",", "1"}], "]"}], "+", RowBox[{"ConvA", "[", RowBox[{"\[Sigma]K", ",", "QR", ",", "1"}], "]"}], "+", RowBox[{"ConvA", "[", RowBox[{"d\[Sigma]R", ",", "QK", ",", "t"}], "]"}], "+", RowBox[{"ConvA", "[", RowBox[{"d\[Sigma]K", ",", "QR", ",", "t"}], "]"}], "+", RowBox[{"ConvA", "[", RowBox[{"\[Sigma]R", ",", "dQK", ",", "t"}], "]"}], "+", RowBox[{"ConvA", "[", RowBox[{"\[Sigma]K", ",", "dQR", ",", "t"}], "]"}], "+", RowBox[{RowBox[{"(", RowBox[{RowBox[{"d\[Sigma]K", "[", RowBox[{"[", "1", "]"}], "]"}], RowBox[{"QK", "[", RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", "T0"}], "+", RowBox[{RowBox[{"(", RowBox[{RowBox[{"\[Sigma]K", "[", RowBox[{"[", "1", "]"}], "]"}], RowBox[{"dQK", "[", RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", "T0"}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"LK", "[", "r_", "]"}], ":=", RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"\[Theta]points", "rint"}], "+", RowBox[{"rint", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], ")"}]}]}], ";"}]
RowBox[{RowBox[{RowBox[{"LR", "[", "r_", "]"}], ":=", RowBox[{RowBox[{"\[Theta]points", "rint"}], "-", RowBox[{"rint", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}]}], ";"}]
RowBox[{RowBox[{RowBox[{"L", "[", "r_", "]"}], ":=", RowBox[{"{", RowBox[{RowBox[{"LK", "[", "r", "]"}], ",", RowBox[{"LR", "[", "r", "]"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"diag", "[", RowBox[{"f_", ",", "T_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"diagx", "=", RowBox[{"bsearchPosSorted", "[", RowBox[{"t1grid", ",", RowBox[{"T", RowBox[{"(", RowBox[{"1", "+", "\[Theta]points"}], ")"}]}]}], "]"}]}], ",", RowBox[{"diagy", "=", RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"(", RowBox[{"1", "-", "\[Theta]points"}], ")"}], "/", RowBox[{"(", RowBox[{"1", "+", "\[Theta]points"}], ")"}]}], "]"}]}]}], "}"}], ",", RowBox[{"Interpol2D", "[", RowBox[{"f", ",", "diagx", ",", "diagy"}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "X", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"X", "[", RowBox[{"t2_", ",", RowBox[{"\[Delta]2_", ":", "0.1"}]}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"t1", "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", "t2"}], ")"}], "\[Theta]points"}], "+", "t2"}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"pos1", "=", RowBox[{"bsearchPosSorted", "[", RowBox[{"t1grid", ",", "t1"}], "]"}]}], ",", RowBox[{"pos2", "=", RowBox[{"inv\[Theta]", "[", RowBox[{"t2", "/", "t1"}], "]"}]}]}], "}"}], ",", RowBox[{"LowpassFilter", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{"t1", RowBox[{"(", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"pos2", "+", "\[Delta]2"}], "]"}], "-", RowBox[{"\[Theta]func", "[", "pos2", "]"}]}], ")"}], RowBox[{"Interpol2D", "[", RowBox[{"QR", ",", "pos1", ",", "pos2"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"Interpol2D", "[", RowBox[{"QK", ",", "pos1", ",", RowBox[{"pos2", "+", "\[Delta]2"}]}], "]"}], "-", RowBox[{"Interpol2D", "[", RowBox[{"QK", ",", "pos1", ",", "pos2"}], "]"}]}], ")"}]}], ",", RowBox[{"1", "/", "10"}]}], "]"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"qana", "[", "\[Kappa]_", "]"}], ":=", RowBox[{"Re", "[", RowBox[{RowBox[{"1", "/", "12"}], RowBox[{"(", RowBox[{"8", "+", RowBox[{RowBox[{"(", RowBox[{"4", RowBox[{RowBox[{"(", RowBox[{"-", "2"}], ")"}], "^", RowBox[{"(", RowBox[{"2", "/", "3"}], ")"}]}]}], ")"}], "/", RowBox[{RowBox[{"(", RowBox[{RowBox[{"-", "4"}], "+", RowBox[{RowBox[{"1", "/", "\[Kappa]"}], "3", RowBox[{"(", RowBox[{"9", "+", RowBox[{"Sqrt", "[", RowBox[{"81", "-", RowBox[{"24", "\[Kappa]"}]}], "]"}]}], ")"}]}]}], ")"}], "^", RowBox[{"(", RowBox[{"1", "/", "3"}], ")"}]}]}], "-", RowBox[{RowBox[{"(", RowBox[{"1", "+", RowBox[{"I", RowBox[{"Sqrt", "[", "3", "]"}]}]}], ")"}], RowBox[{RowBox[{"(", RowBox[{RowBox[{"-", "8"}], "+", RowBox[{RowBox[{"1", "/", "\[Kappa]"}], "6", RowBox[{"(", RowBox[{"9", "+", RowBox[{"Sqrt", "[", RowBox[{"81", "-", RowBox[{"24", "\[Kappa]"}]}], "]"}]}], ")"}]}]}], ")"}], "^", RowBox[{"(", RowBox[{"1", "/", "3"}], ")"}]}]}]}], ")"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"rana", "[", "\[Kappa]_", "]"}], ":=", RowBox[{"Re", "[", RowBox[{"(", RowBox[{"1", "+", RowBox[{"\[Kappa]", RowBox[{"(", RowBox[{"1", "+", RowBox[{RowBox[{RowBox[{"qana", "[", "\[Kappa]", "]"}], "^", "2"}], RowBox[{"(", RowBox[{"1", "-", RowBox[{"2", RowBox[{"qana", "[", "\[Kappa]", "]"}]}]}], ")"}]}]}], ")"}]}]}], ")"}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Xana", "[", "\[Kappa]_", "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"qana", "[", "\[Kappa]", "]"}]}], ")"}], "/", RowBox[{"qana", "[", "\[Kappa]", "]"}]}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "RK32update", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"SyntaxInformation", "[", "RK32update", "]"}], "=", RowBox[{"{", RowBox[{"\"ArgumentsPattern\"", "->", RowBox[{"{", RowBox[{"___", ",", RowBox[{"OptionsPattern", "[", "]"}]}], "}"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "RK32update", "]"}], ":=", RowBox[{"{", RowBox[{RowBox[{"\"Debug\"", "->", "True"}], ",", RowBox[{"\"Order\"", "->", "ord"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"RK32update", "[", RowBox[{"\[Delta]t_", ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"k1", ",", "k2", ",", "k3", ",", "k4", ",", "\[Delta]", ",", "noise", ",", "update", ",", "fix", ",", "dr"}], "}"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "QK", "]"}], "==", "1"}], ",", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "0", ",", "0", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}]}], "]"}], ";", RowBox[{"k1", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}]}], "}"}]}], ";", RowBox[{"dr", "=", RowBox[{"\[Delta]t", RowBox[{"drstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], ";", RowBox[{"appendTo", "[", RowBox[{"QK", ",", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"\[Delta]t", "/", "2"}], RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}]}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"QR", ",", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"\[Delta]t", "/", "2"}], RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}]}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"dQK", ",", RowBox[{RowBox[{"\[Delta]t", "/", "2"}], RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"dQR", ",", RowBox[{RowBox[{"\[Delta]t", "/", "2"}], RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"t1grid", ",", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"1", "/", "2"}], "\[Delta]t"}]}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"\[Delta]tratio", ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"drvec", ",", RowBox[{RowBox[{"1", "/", "2"}], "dr"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"rvec", ",", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], "]"}], ";", RowBox[{"appendAll", "[", "]"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k2", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}]}], "}"}]}], ";", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{RowBox[{"3", "/", "4"}], "\[Delta]t", RowBox[{"k2", "[", RowBox[{"[", "1", "]"}], "]"}]}]}]}], ";", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{RowBox[{"3", "/", "4"}], "\[Delta]t", RowBox[{"k2", "[", RowBox[{"[", "2", "]"}], "]"}]}]}]}], ";", RowBox[{RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"3", "/", "4"}], "\[Delta]t", RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"3", "/", "4"}], "\[Delta]t", RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{RowBox[{"3", "/", "4"}], "\[Delta]t"}]}]}], ";", RowBox[{RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], ";", RowBox[{RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"3", "/", "4"}], "dr"}]}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k3", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}]}], "}"}]}], ";", RowBox[{"noise", "=", RowBox[{"k2", "-", "k3"}]}], ";", RowBox[{"update", "=", RowBox[{"\[Delta]t", RowBox[{"(", RowBox[{RowBox[{RowBox[{"2", "/", "9"}], "k1"}], "+", RowBox[{RowBox[{"1", "/", "3"}], "k2"}], "+", RowBox[{RowBox[{"4", "/", "9"}], "k3"}]}], ")"}]}]}], ";", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{"update", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{"update", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"\[Delta]t", RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"\[Delta]t", RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", "\[Delta]t"}]}], ";", RowBox[{RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], ";", RowBox[{RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", "dr"}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k4", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}]}], "}"}]}], ";", RowBox[{"\[Delta]", "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"5", "k1"}], ")"}], "/", "72"}], ")"}]}], "+", RowBox[{"k2", "/", "12"}], "+", RowBox[{"k3", "/", "9"}], "-", RowBox[{"k4", "/", "8"}]}], ")"}], "\[Delta]t"}]}], ";", RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", "\[Delta]", "]"}], ",", "\[Infinity]"}], "]"}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "RK54update", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"SyntaxInformation", "[", "RK54update", "]"}], "=", RowBox[{"{", RowBox[{"\"ArgumentsPattern\"", "->", RowBox[{"{", RowBox[{"___", ",", RowBox[{"OptionsPattern", "[", "]"}]}], "}"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "RK54update", "]"}], ":=", RowBox[{"{", RowBox[{RowBox[{"\"Debug\"", "->", "True"}], ",", RowBox[{"\"Order\"", "->", "ord"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"RK54update", "[", RowBox[{"\[Delta]t_", ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"k1", ",", "k2", ",", "k3", ",", "k4", ",", "k5", ",", "k6", ",", "k7", ",", "\[Delta]", ",", "update", ",", "dr"}], "}"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "QK", "]"}], "==", "1"}], ",", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "0", ",", "0", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}]}], "]"}], ";", RowBox[{"k1", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}]}], "}"}]}], ";", RowBox[{"dr", "=", RowBox[{"\[Delta]t", RowBox[{"drstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], ";", RowBox[{"appendTo", "[", RowBox[{"QK", ",", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"\[Delta]t", "/", "5"}], RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}]}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"QR", ",", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"\[Delta]t", "/", "5"}], RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}]}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"dQK", ",", RowBox[{RowBox[{"\[Delta]t", "/", "5"}], RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"dQR", ",", RowBox[{RowBox[{"\[Delta]t", "/", "5"}], RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"t1grid", ",", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"1", "/", "5"}], "\[Delta]t"}]}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"\[Delta]tratio", ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"drvec", ",", RowBox[{RowBox[{"1", "/", "5"}], "dr"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"rvec", ",", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], "]"}], ";", RowBox[{"appendAll", "[", "]"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k2", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}]}], "}"}]}], ";", RowBox[{"update", "=", RowBox[{"\[Delta]t", RowBox[{"(", RowBox[{RowBox[{RowBox[{"3", "/", "40"}], "k1"}], "+", RowBox[{RowBox[{"9", "/", "40"}], "k2"}]}], ")"}]}]}], ";", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{"update", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{"update", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"3", "\[Delta]t"}], ")"}], "/", "10"}], RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"3", "\[Delta]t"}], ")"}], "/", "10"}], RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{RowBox[{"3", "/", "10"}], "\[Delta]t"}]}]}], ";", RowBox[{RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], ";", RowBox[{RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"3", "/", "10"}], "dr"}]}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k3", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}]}], "}"}]}], ";", RowBox[{"update", "=", RowBox[{"\[Delta]t", RowBox[{"(", RowBox[{RowBox[{RowBox[{"44", "/", "45"}], "k1"}], "-", RowBox[{RowBox[{"56", "/", "15"}], "k2"}], "+", RowBox[{RowBox[{"32", "/", "9"}], "k3"}]}], ")"}]}]}], ";", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{"update", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{"update", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"4", "\[Delta]t"}], ")"}], "/", "5"}], RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"4", "\[Delta]t"}], ")"}], "/", "5"}], RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{RowBox[{"4", "/", "5"}], "\[Delta]t"}]}]}], ";", RowBox[{RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], ";", RowBox[{RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"4", "/", "5"}], "dr"}]}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k4", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}]}], "}"}]}], ";", RowBox[{"update", "=", RowBox[{"\[Delta]t", RowBox[{"(", RowBox[{RowBox[{RowBox[{"19372", "/", "6561"}], "k1"}], "-", RowBox[{RowBox[{"25360", "/", "2187"}], "k2"}], "+", RowBox[{RowBox[{"64448", "/", "6561"}], "k3"}], "-", RowBox[{RowBox[{"212", "/", "729"}], "k4"}]}], ")"}]}]}], ";", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{"update", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{"update", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"8", "\[Delta]t"}], ")"}], "/", "9"}], RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"8", "\[Delta]t"}], ")"}], "/", "9"}], RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{RowBox[{"8", "/", "9"}], "\[Delta]t"}]}]}], ";", RowBox[{RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], ";", RowBox[{RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"8", "/", "9"}], "dr"}]}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k5", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}]}], "}"}]}], ";", RowBox[{"update", "=", RowBox[{"\[Delta]t", RowBox[{"(", RowBox[{RowBox[{RowBox[{"9017", "/", "3168"}], "k1"}], "-", RowBox[{RowBox[{"355", "/", "33"}], "k2"}], "+", RowBox[{RowBox[{"46732", "/", "5247"}], "k3"}], "+", RowBox[{RowBox[{"49", "/", "176"}], "k4"}], "-", RowBox[{RowBox[{"5103", "/", "18656"}], "k5"}]}], ")"}]}]}], ";", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{"update", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{"update", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"\[Delta]t", RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"\[Delta]t", RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", "\[Delta]t"}]}], ";", RowBox[{RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], ";", RowBox[{RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", "dr"}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k6", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}]}], "}"}]}], ";", RowBox[{"update", "=", RowBox[{"\[Delta]t", RowBox[{"(", RowBox[{RowBox[{RowBox[{"35", "/", "384"}], "k1"}], "+", RowBox[{RowBox[{"500", "/", "1113"}], "k3"}], "+", RowBox[{RowBox[{"125", "/", "192"}], "k4"}], "-", RowBox[{RowBox[{"2187", "/", "6784"}], "k5"}], "+", RowBox[{RowBox[{"11", "/", "84"}], "k6"}]}], ")"}]}]}], ";", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{"update", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{"update", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"\[Delta]t", RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"\[Delta]t", RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", "\[Delta]t"}]}], ";", RowBox[{RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], ";", RowBox[{RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", "dr"}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k7", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}]}], "}"}]}], ";", RowBox[{"\[Delta]", "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{"71", "k1"}], ")"}], "/", "57600"}], "-", RowBox[{RowBox[{"(", RowBox[{"71", "k3"}], ")"}], "/", "16695"}], "+", RowBox[{RowBox[{"(", RowBox[{"71", "k4"}], ")"}], "/", "1920"}], "-", RowBox[{RowBox[{"(", RowBox[{"17253", "k5"}], ")"}], "/", "339200"}], "+", RowBox[{RowBox[{"(", RowBox[{"22", "k6"}], ")"}], "/", "525"}], "-", RowBox[{"k7", "/", "40"}]}], ")"}], "\[Delta]t"}]}], ";", RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", "\[Delta]", "]"}], ",", "\[Infinity]"}], "]"}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "ETDRK43", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"SyntaxInformation", "[", "ETDRK43", "]"}], "=", RowBox[{"{", RowBox[{"\"ArgumentsPattern\"", "->", RowBox[{"{", RowBox[{"___", ",", RowBox[{"OptionsPattern", "[", "]"}]}], "}"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "ETDRK43", "]"}], ":=", RowBox[{"{", RowBox[{RowBox[{"\"Decay\"", "->", "True"}], ",", RowBox[{"\"Order\"", "->", "ord"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"ETDRK43", "[", RowBox[{"step_", ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"rvec0", "=", RowBox[{"L", "[", "rvec", "]"}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"Ls", "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"2", RowBox[{"UnitStep", "[", "rvec0", "]"}]}], "-", "1"}], ")"}], RowBox[{"Clip", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{"rvec0", "step"}], "]"}], ",", RowBox[{"{", RowBox[{RowBox[{"10", "^", RowBox[{"-", "10"}]}], ",", "\[Infinity]"}], "}"}]}], "]"}]}]}], "}"}], ",", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"mask", "=", RowBox[{"Clip", "[", RowBox[{RowBox[{"Abs", "[", "Ls", "]"}], ",", RowBox[{"{", RowBox[{RowBox[{"10", "^", RowBox[{"-", "2"}]}], ",", RowBox[{"10", "^", RowBox[{"-", "2"}]}]}], "}"}], ",", RowBox[{"{", RowBox[{"0", ",", "1"}], "}"}]}], "]"}]}], ",", "\[Alpha]0", ",", "\[Alpha]1", ",", "\[Alpha]2", ",", "\[Alpha]3", ",", "\[Alpha]12", ",", RowBox[{"exp2", "=", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Decay\"", "]"}], ",", RowBox[{"Exp", "[", RowBox[{"Ls", "/", "2"}], "]"}], ",", RowBox[{"{", RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], ",", "k1", ",", "k2", ",", "k3", ",", "k4", ",", "k5", ",", "aQ", ",", RowBox[{"Q0", "=", RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}]}], ",", "change", ",", "\[Delta]", ",", "dr"}], "}"}], ",", RowBox[{RowBox[{"\[Alpha]12", "=", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Decay\"", "]"}], ",", RowBox[{RowBox[{"mask", RowBox[{RowBox[{"(", RowBox[{"exp2", "-", "1"}], ")"}], "/", "Ls"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"1", "-", "mask"}], ")"}], RowBox[{"(", RowBox[{RowBox[{"1", "/", "2"}], "+", RowBox[{RowBox[{"1", "/", "3840"}], "Ls", RowBox[{"(", RowBox[{"480", "+", RowBox[{"Ls", RowBox[{"(", RowBox[{"80", "+", RowBox[{"Ls", RowBox[{"(", RowBox[{"10", "+", "Ls"}], ")"}]}]}], ")"}]}]}], ")"}]}]}], ")"}]}]}], ",", RowBox[{"{", RowBox[{RowBox[{"1", "/", "2"}], ",", RowBox[{"1", "/", "2"}]}], "}"}]}], "]"}]}], ";", RowBox[{"\[Alpha]0", "=", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Decay\"", "]"}], ",", RowBox[{"Exp", "[", "Ls", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], ";", RowBox[{"\[Alpha]1", "=", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Decay\"", "]"}], ",", RowBox[{RowBox[{"mask", RowBox[{RowBox[{"(", RowBox[{"\[Alpha]0", "-", "1"}], ")"}], "/", "Ls"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"1", "-", "mask"}], ")"}], RowBox[{"(", RowBox[{"1", "+", RowBox[{RowBox[{"1", "/", "5040"}], "Ls", RowBox[{"(", RowBox[{"2520", "+", RowBox[{"Ls", RowBox[{"(", RowBox[{"840", "+", RowBox[{"Ls", RowBox[{"(", RowBox[{"210", "+", RowBox[{"Ls", RowBox[{"(", RowBox[{"42", "+", RowBox[{"Ls", RowBox[{"(", RowBox[{"7", "+", "Ls"}], ")"}]}]}], ")"}]}]}], ")"}]}]}], ")"}]}]}], ")"}]}]}], ")"}]}]}], ",", RowBox[{"{", RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], ";", RowBox[{"\[Alpha]2", "=", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Decay\"", "]"}], ",", RowBox[{RowBox[{"mask", RowBox[{RowBox[{"(", RowBox[{"\[Alpha]1", "-", "1"}], ")"}], "/", "Ls"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"1", "-", "mask"}], ")"}], RowBox[{"(", RowBox[{RowBox[{"1", "/", "2"}], "+", RowBox[{RowBox[{"1", "/", "40320"}], "Ls", RowBox[{"(", RowBox[{"6720", "+", RowBox[{"Ls", RowBox[{"(", RowBox[{"1680", "+", RowBox[{"Ls", RowBox[{"(", RowBox[{"336", "+", RowBox[{"Ls", RowBox[{"(", RowBox[{"56", "+", RowBox[{"Ls", RowBox[{"(", RowBox[{"8", "+", "Ls"}], ")"}]}]}], ")"}]}]}], ")"}]}]}], ")"}]}]}], ")"}]}]}], ")"}]}]}], ",", RowBox[{"{", RowBox[{RowBox[{"1", "/", "2"}], ",", RowBox[{"1", "/", "2"}]}], "}"}]}], "]"}]}], ";", RowBox[{"\[Alpha]3", "=", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Decay\"", "]"}], ",", RowBox[{RowBox[{"mask", RowBox[{RowBox[{"(", RowBox[{"\[Alpha]2", "-", RowBox[{"1", "/", "2"}]}], ")"}], "/", "Ls"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"1", "-", "mask"}], ")"}], RowBox[{"(", RowBox[{RowBox[{"1", "/", "6"}], "+", RowBox[{RowBox[{"(", RowBox[{"Ls", RowBox[{"(", RowBox[{"15120", "+", RowBox[{"Ls", RowBox[{"(", RowBox[{"3024", "+", RowBox[{"Ls", RowBox[{"(", RowBox[{"504", "+", RowBox[{"Ls", RowBox[{"(", RowBox[{"72", "+", RowBox[{"Ls", RowBox[{"(", RowBox[{"9", "+", "Ls"}], ")"}]}]}], ")"}]}]}], ")"}]}]}], ")"}]}]}], ")"}]}], ")"}], "/", "362880"}]}], ")"}]}]}], ",", RowBox[{"{", RowBox[{RowBox[{"1", "/", "6"}], ",", RowBox[{"1", "/", "6"}]}], "}"}]}], "]"}]}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Same\"", "->", "True"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k1", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points", ",", RowBox[{"{", RowBox[{RowBox[{"rvec0", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"Q0", "[", RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"rvec", ",", "QR", ",", "\[Theta]points", ",", RowBox[{"{", RowBox[{RowBox[{"rvec0", "[", RowBox[{"[", "2", "]"}], "]"}], ",", RowBox[{"Q0", "[", RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}]}], ";", RowBox[{"change", "=", RowBox[{RowBox[{"step", "\[Alpha]12", "k1"}], "+", "Q0"}]}], ";", RowBox[{"aQ", "=", "change"}], ";", RowBox[{"dr", "=", RowBox[{"step", RowBox[{"drstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], ";", RowBox[{"appendTo", "[", RowBox[{"QK", ",", RowBox[{"aQ", "[", RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"QR", ",", RowBox[{"aQ", "[", RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"dQK", ",", RowBox[{RowBox[{"step", "/", "2"}], RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"dQR", ",", RowBox[{RowBox[{"step", "/", "2"}], RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"t1grid", ",", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"1", "/", "2"}], "step"}]}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"\[Delta]tratio", ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"drvec", ",", RowBox[{RowBox[{"1", "/", "2"}], "dr"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"rvec", ",", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], "]"}], ";", RowBox[{"appendAll", "[", "]"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k2", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points", ",", RowBox[{"{", RowBox[{RowBox[{"rvec0", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"Q0", "[", RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"rvec", ",", "QR", ",", "\[Theta]points", ",", RowBox[{"{", RowBox[{RowBox[{"rvec0", "[", RowBox[{"[", "2", "]"}], "]"}], ",", RowBox[{"Q0", "[", RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}]}], ";", RowBox[{"change", "=", RowBox[{RowBox[{"step", "\[Alpha]12", "k2"}], "+", "Q0"}]}], ";", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"change", "[", RowBox[{"[", "1", "]"}], "]"}]}], ";", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"change", "[", RowBox[{"[", "2", "]"}], "]"}]}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Same\"", "->", "True"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k3", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points", ",", RowBox[{"{", RowBox[{RowBox[{"rvec0", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"Q0", "[", RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"rvec", ",", "QR", ",", "\[Theta]points", ",", RowBox[{"{", RowBox[{RowBox[{"rvec0", "[", RowBox[{"[", "2", "]"}], "]"}], ",", RowBox[{"Q0", "[", RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}]}], ";", RowBox[{"change", "=", RowBox[{RowBox[{"step", "\[Alpha]1", RowBox[{"(", RowBox[{RowBox[{"2", "k2"}], "-", "k1"}], ")"}]}], "+", "Q0"}]}], ";", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"change", "[", RowBox[{"[", "1", "]"}], "]"}]}], ";", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"change", "[", RowBox[{"[", "2", "]"}], "]"}]}], ";", RowBox[{RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"step", RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"step", RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", "step"}]}], ";", RowBox[{RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], ";", RowBox[{RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", "dr"}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k4", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points", ",", RowBox[{"{", RowBox[{RowBox[{"rvec0", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"Q0", "[", RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"rvec", ",", "QR", ",", "\[Theta]points", ",", RowBox[{"{", RowBox[{RowBox[{"rvec0", "[", RowBox[{"[", "2", "]"}], "]"}], ",", RowBox[{"Q0", "[", RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}]}], ";", RowBox[{"change", "=", RowBox[{RowBox[{"step", "\[Alpha]12", RowBox[{"(", RowBox[{RowBox[{"2", "k3"}], "-", "k1"}], ")"}]}], "+", "Q0"}]}], ";", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"aQ", "[", RowBox[{"[", "1", "]"}], "]"}], "-", RowBox[{"Q0", "[", RowBox[{"[", "1", "]"}], "]"}]}], ")"}], RowBox[{"exp2", "[", RowBox[{"[", "1", "]"}], "]"}]}], "+", RowBox[{"change", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"aQ", "[", RowBox[{"[", "2", "]"}], "]"}], "-", RowBox[{"Q0", "[", RowBox[{"[", "2", "]"}], "]"}]}], ")"}], RowBox[{"exp2", "[", RowBox[{"[", "2", "]"}], "]"}]}], "+", RowBox[{"change", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Same\"", "->", "True"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k5", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points", ",", RowBox[{"{", RowBox[{RowBox[{"rvec0", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"Q0", "[", RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"rvec", ",", "QR", ",", "\[Theta]points", ",", RowBox[{"{", RowBox[{RowBox[{"rvec0", "[", RowBox[{"[", "2", "]"}], "]"}], ",", RowBox[{"Q0", "[", RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}]}], ";", RowBox[{"change", "=", RowBox[{RowBox[{"step", RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"4", "\[Alpha]3"}], "-", RowBox[{"3", "\[Alpha]2"}], "+", "\[Alpha]1"}], ")"}], "k1"}], "+", RowBox[{"4", "k2", RowBox[{"(", RowBox[{RowBox[{RowBox[{"-", "2"}], "\[Alpha]3"}], "+", "\[Alpha]2"}], ")"}]}], "+", RowBox[{"k4", RowBox[{"(", RowBox[{RowBox[{"4", "\[Alpha]3"}], "-", "\[Alpha]2"}], ")"}]}]}], ")"}]}], "+", "Q0"}]}], ";", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"change", "[", RowBox[{"[", "1", "]"}], "]"}]}], ";", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"change", "[", RowBox[{"[", "2", "]"}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}], ";", RowBox[{"\[Delta]", "=", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{RowBox[{"-", "2"}], "k2"}], "+", RowBox[{"2", "k3"}], "+", "k4", "-", "k5"}], ")"}], "step", "\[Alpha]2"}], "+", RowBox[{"4", RowBox[{"(", RowBox[{"k2", "-", "k3", "-", "k4", "+", "k5"}], ")"}], "step", "\[Alpha]3"}]}]}], ";", RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", "\[Delta]", "]"}], ",", "\[Infinity]"}], "]"}]}]}], "]"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "PECEupdate", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"SyntaxInformation", "[", "PECEupdate", "]"}], "=", RowBox[{"{", RowBox[{"\"ArgumentsPattern\"", "->", RowBox[{"{", RowBox[{"___", ",", RowBox[{"OptionsPattern", "[", "]"}]}], "}"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "PECEupdate", "]"}], ":=", RowBox[{"{", RowBox[{RowBox[{"\"Debug\"", "->", "True"}], ",", RowBox[{"\"Correction\"", "->", "False"}], ",", RowBox[{"\"Order\"", "->", "ord"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"PECEupdate", "[", RowBox[{"\[Delta]t_", ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"k1", ",", "k2", ",", "\[Delta]", ",", "noise", ",", "update", ",", "dr"}], "}"}], ",", RowBox[{RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Same\"", "->", "True"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k1", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}]}], "}"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Correction\"", "]"}], ",", RowBox[{RowBox[{"dr", "=", RowBox[{"\[Delta]t", RowBox[{"drstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], ";", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+=", RowBox[{"\[Delta]t", RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+=", RowBox[{"\[Delta]t", RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+=", "\[Delta]t"}], ";", RowBox[{RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}]}], ",", RowBox[{RowBox[{"appendTo", "[", RowBox[{"QK", ",", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{"\[Delta]t", RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}]}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"QR", ",", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{"\[Delta]t", RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}]}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"dQK", ",", RowBox[{"\[Delta]t", RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"dQR", ",", RowBox[{"\[Delta]t", RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"t1grid", ",", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", "\[Delta]t"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"\[Delta]tratio", ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"drvec", ",", "dr"}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"rvec", ",", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], "]"}], ";", RowBox[{"appendAll", "[", "]"}]}]}], "]"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k2", "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}]}], "}"}]}], ";", RowBox[{"update", "=", RowBox[{RowBox[{"\[Delta]t", "/", "2"}], RowBox[{"(", RowBox[{"k1", "+", "k2"}], ")"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Correction\"", "]"}], ",", RowBox[{RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+=", RowBox[{RowBox[{"\[Delta]t", "/", "2"}], RowBox[{"(", RowBox[{RowBox[{"k2", "[", RowBox[{"[", "1", "]"}], "]"}], "-", RowBox[{"k1", "[", RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], ";", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+=", RowBox[{RowBox[{"\[Delta]t", "/", "2"}], RowBox[{"(", RowBox[{RowBox[{"k2", "[", RowBox[{"[", "2", "]"}], "]"}], "-", RowBox[{"k1", "[", RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}]}]}], ",", RowBox[{RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{"update", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "+", RowBox[{"update", "[", RowBox[{"[", "2", "]"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}], ";", RowBox[{"\[Delta]", "=", RowBox[{RowBox[{"(", RowBox[{"k1", "-", "k2"}], ")"}], "\[Delta]t"}]}], ";", RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", "\[Delta]", "]"}], ",", "\[Infinity]"}], "]"}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "SERKcoeffs", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"SERKcoeffs", "[", "q_", "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"m", "=", "2"}], ",", RowBox[{"\[Mu]p", "=", RowBox[{"19", "/", "20"}]}]}], "}"}], ",", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"s", "=", RowBox[{"m", "*", "q"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"\[Alpha]2", "=", RowBox[{"q", "/", RowBox[{"s", "^", "2"}]}]}], ",", "bvec", ",", "b", ",", RowBox[{"w0", "=", RowBox[{"1", "+", RowBox[{"\[Mu]p", "/", RowBox[{"s", "^", "2"}]}]}]}], ",", "w1", ",", "T", ",", "R", ",", "eq"}], "}"}], ",", RowBox[{RowBox[{"bvec", "=", RowBox[{"Map", "[", RowBox[{"b", ",", RowBox[{"Range", "[", RowBox[{"0", ",", "s"}], "]"}]}], "]"}]}], ";", RowBox[{RowBox[{"T", "[", RowBox[{"i_", ",", "z_"}], "]"}], ":=", RowBox[{"ChebyshevT", "[", RowBox[{"i", ",", RowBox[{"1", "+", RowBox[{"\[Alpha]2", "z"}]}]}], "]"}]}], ";", RowBox[{"w1", "=", RowBox[{RowBox[{"ChebyshevT", "[", RowBox[{"s", ",", "w0"}], "]"}], "/", RowBox[{"(", RowBox[{"s", RowBox[{"ChebyshevU", "[", RowBox[{RowBox[{RowBox[{"-", "1"}], "+", "s"}], ",", "w0"}], "]"}]}], ")"}]}]}], ";", RowBox[{RowBox[{"R", "[", "z_", "]"}], ":=", RowBox[{RowBox[{"ChebyshevT", "[", RowBox[{"s", ",", RowBox[{"w0", "+", RowBox[{"w1", "z"}]}]}], "]"}], "/", RowBox[{"ChebyshevT", "[", RowBox[{"s", ",", "w0"}], "]"}]}]}], ";", RowBox[{RowBox[{"eq", "[", "z_", "]"}], ":=", RowBox[{"(", RowBox[{RowBox[{"R", "[", "z", "]"}], "==", RowBox[{RowBox[{RowBox[{"bvec", "[", RowBox[{"[", "1", "]"}], "]"}], RowBox[{"T", "[", RowBox[{"0", ",", "z"}], "]"}]}], "+", RowBox[{"Sum", "[", RowBox[{RowBox[{"Sum", "[", RowBox[{RowBox[{RowBox[{"bvec", "[", RowBox[{"[", RowBox[{"1", "+", "i", "+", RowBox[{"m", RowBox[{"(", RowBox[{"j", "-", "1"}], ")"}]}]}], "]"}], "]"}], RowBox[{"T", "[", RowBox[{"i", ",", "z"}], "]"}], RowBox[{RowBox[{"T", "[", RowBox[{"m", ",", "z"}], "]"}], "^", RowBox[{"(", RowBox[{"j", "-", "1"}], ")"}]}]}], ",", RowBox[{"{", RowBox[{"i", ",", "1", ",", "m"}], "}"}]}], "]"}], ",", RowBox[{"{", RowBox[{"j", ",", "1", ",", "q"}], "}"}]}], "]"}]}]}], ")"}]}], ";", RowBox[{"B2", "=", RowBox[{RowBox[{"1.", "bvec"}], "/.", RowBox[{RowBox[{"Solve", "[", RowBox[{RowBox[{"eq", "[", RowBox[{"Range", "[", RowBox[{"1", ",", RowBox[{"s", "+", "1"}]}], "]"}], "]"}], ",", "bvec"}], "]"}], "[", RowBox[{"[", "1", "]"}], "]"}]}]}]}]}], "]"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "SERK2", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"SyntaxInformation", "[", "SERK2", "]"}], "=", RowBox[{"{", RowBox[{"\"ArgumentsPattern\"", "->", RowBox[{"{", RowBox[{"___", ",", RowBox[{"OptionsPattern", "[", "]"}]}], "}"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "SERK2", "]"}], ":=", RowBox[{"{", RowBox[{"\"Order\"", "->", "ord"}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"SERK2", "[", RowBox[{"h_", ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"SERK2", "[", RowBox[{RowBox[{"{", RowBox[{"h", ",", "2"}], "}"}], ",", "opts"}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"SERK2", "[", RowBox[{RowBox[{"{", RowBox[{"h_", ",", RowBox[{"q_", ":", "2"}]}], "}"}], ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"k", ",", "g", ",", RowBox[{"\[Alpha]2", "=", RowBox[{"1", "/", RowBox[{"(", RowBox[{"4", "q"}], ")"}]}]}], ",", "dr"}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"kvec", "=", RowBox[{"Map", "[", RowBox[{"k", ",", RowBox[{"Range", "[", RowBox[{"1", ",", RowBox[{"2", "*", "q"}]}], "]"}]}], "]"}]}], ",", RowBox[{"gvec", "=", RowBox[{"Map", "[", RowBox[{"g", ",", RowBox[{"Range", "[", RowBox[{"0", ",", RowBox[{"2", "q"}]}], "]"}]}], "]"}]}]}], "}"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "B2", "]"}]}], ",", RowBox[{"SERKcoeffs", "[", "q", "]"}]}], "]"}], ";", RowBox[{RowBox[{"g", "[", "0", "]"}], "=", RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}]}], ";", RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{RowBox[{"k", "[", "n", "]"}], "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}], ",", "1"}], "}"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"OddQ", "[", "n", "]"}], ",", RowBox[{RowBox[{"g", "[", "n", "]"}], "=", RowBox[{RowBox[{"g", "[", RowBox[{"n", "-", "1"}], "]"}], "+", RowBox[{"\[Alpha]2", "h", RowBox[{"k", "[", "n", "]"}]}]}]}], ",", RowBox[{RowBox[{"g", "[", "n", "]"}], "=", RowBox[{RowBox[{"2", RowBox[{"g", "[", RowBox[{"n", "-", "1"}], "]"}]}], "-", RowBox[{"g", "[", RowBox[{"n", "-", "2"}], "]"}], "+", RowBox[{"2", "\[Alpha]2", "h", RowBox[{"k", "[", "n", "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"n", "==", "1"}], ",", RowBox[{RowBox[{"dr", "=", RowBox[{"drstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{RowBox[{"k", "[", "n", "]"}], "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{RowBox[{"k", "[", "n", "]"}], "[", RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", RowBox[{"appendTo", "[", RowBox[{"QK", ",", RowBox[{RowBox[{"g", "[", "n", "]"}], "[", RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"QR", ",", RowBox[{RowBox[{"g", "[", "n", "]"}], "[", RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"dQK", ",", RowBox[{"\[Alpha]2", "h", RowBox[{RowBox[{"k", "[", "n", "]"}], "[", RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"dQR", ",", RowBox[{"\[Alpha]2", "h", RowBox[{RowBox[{"k", "[", "n", "]"}], "[", RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"t1grid", ",", RowBox[{RowBox[{"g", "[", "n", "]"}], "[", RowBox[{"[", "3", "]"}], "]"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"\[Delta]tratio", ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"drvec", ",", RowBox[{"\[Alpha]2", "h", "dr"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"rvec", ",", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], "]"}], ";", RowBox[{"appendAll", "[", "]"}]}], ",", RowBox[{RowBox[{RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], "=", RowBox[{"g", "[", "n", "]"}]}], ";", RowBox[{RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], ";", RowBox[{RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"(", RowBox[{"\[Alpha]2", RowBox[{"(", RowBox[{RowBox[{"2", "n"}], "-", RowBox[{"If", "[", RowBox[{RowBox[{"OddQ", "[", "n", "]"}], ",", "1", ",", "0"}], "]"}]}], ")"}], "h"}], ")"}], RowBox[{RowBox[{"k", "[", "1", "]"}], "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"(", RowBox[{"\[Alpha]2", RowBox[{"(", RowBox[{RowBox[{"2", "n"}], "-", RowBox[{"If", "[", RowBox[{RowBox[{"OddQ", "[", "n", "]"}], ",", "1", ",", "0"}], "]"}]}], ")"}], "h"}], ")"}], RowBox[{RowBox[{"k", "[", "1", "]"}], "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"(", RowBox[{"\[Alpha]2", RowBox[{"(", RowBox[{RowBox[{"2", "n"}], "-", RowBox[{"If", "[", RowBox[{RowBox[{"OddQ", "[", "n", "]"}], ",", "1", ",", "0"}], "]"}]}], ")"}], "h"}], ")"}], "dr"}]}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}]}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", RowBox[{"2", "q"}]}], "}"}]}], "]"}], ";", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"B2", ".", RowBox[{"gvec", "[", RowBox[{"[", RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"B2", ".", RowBox[{"gvec", "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"B2", ".", RowBox[{"gvec", "[", RowBox[{"[", RowBox[{"All", ",", "3"}], "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}], ";", RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{"\[Delta]2", "=", RowBox[{RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], "-", RowBox[{RowBox[{"g", "[", RowBox[{"2", "q"}], "]"}], "[", RowBox[{"[", RowBox[{"1", ";;", "2"}], "]"}], "]"}]}]}], "]"}], ",", "\[Infinity]"}], "]"}]}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "ESERK2", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"SyntaxInformation", "[", "ESERK2", "]"}], "=", RowBox[{"{", RowBox[{"\"ArgumentsPattern\"", "->", RowBox[{"{", RowBox[{"___", ",", RowBox[{"OptionsPattern", "[", "]"}]}], "}"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "ESERK2", "]"}], ":=", RowBox[{"{", RowBox[{"\"Order\"", "->", "ord"}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"ESERK2", "[", RowBox[{"hIn_", ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"temp", ",", "\[Delta]", ",", RowBox[{"y0", "=", RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "dQK", ",", "dQR"}], "}"}]}]}], "}"}], ",", RowBox[{RowBox[{"SERK2", "[", RowBox[{RowBox[{"hIn", "/", "2"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"SERK2", "[", RowBox[{RowBox[{"hIn", "/", "2"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"temp", "=", RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}]}], ";", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "dQK", ",", "dQR"}], "}"}], "=", "y0"}], ";", RowBox[{"t1grid", "=", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], ";", RowBox[{"\[Delta]tratio", "=", RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], ";", RowBox[{"rvec", "=", RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], ";", RowBox[{"drvec", "=", RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], ";", RowBox[{"deleteN", "[", RowBox[{"2", "*", "len"}], "]"}], ";", RowBox[{"posB1xOld", "=", "0"}], ";", RowBox[{"posB2xOld", "=", "0"}], ";", RowBox[{"SERK2", "[", RowBox[{"hIn", ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], "=", RowBox[{RowBox[{"2", "temp"}], "-", RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}]}]}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}], ";", RowBox[{"\[Delta]", "=", RowBox[{RowBox[{"(", RowBox[{"temp", "-", RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}]}], ")"}], "hIn"}]}], ";", RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", "\[Delta]", "]"}], ",", "\[Infinity]"}], "]"}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "Euler", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"SyntaxInformation", "[", "Euler", "]"}], "=", RowBox[{"{", RowBox[{"\"ArgumentsPattern\"", "->", RowBox[{"{", RowBox[{"___", ",", RowBox[{"OptionsPattern", "[", "]"}]}], "}"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "Euler", "]"}], ":=", RowBox[{"{", RowBox[{"\"Order\"", "->", "ord"}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Euler", "[", RowBox[{RowBox[{"{", RowBox[{"\[Delta]t_", ",", "m_", ",", "deriv_", ",", "dr_", ",", RowBox[{"posB1x_", ":", "0"}], ",", RowBox[{"posB2x_", ":", "0"}]}], "}"}], ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"k", "=", "0"}], ",", RowBox[{"start", "=", RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}]}]}], "}"}], ",", RowBox[{RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1x", ",", "posB2x", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k", "=", RowBox[{RowBox[{"1", "/", "m"}], RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}], ",", "1"}], "}"}]}]}], ";", RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], "=", RowBox[{"start", "+", RowBox[{"\[Delta]t", "k"}]}]}], ";", RowBox[{RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], ";", RowBox[{RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], RowBox[{"deriv", "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], RowBox[{"deriv", "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "dr"}]}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1x", ",", "posB2x", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"k", "+=", RowBox[{RowBox[{"1", "/", "m"}], RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}], ",", "1"}], "}"}]}]}]}], ",", RowBox[{"{", RowBox[{"m", "-", "1"}], "}"}]}], "]"}], ";", "k"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "ROCK4", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"SyntaxInformation", "[", "ROCK4", "]"}], "=", RowBox[{"{", RowBox[{"\"ArgumentsPattern\"", "->", RowBox[{"{", RowBox[{"___", ",", RowBox[{"OptionsPattern", "[", "]"}]}], "}"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "ROCK4", "]"}], ":=", RowBox[{"{", RowBox[{"\"Order\"", "->", "ord"}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"ROCK4", "[", RowBox[{"h_", ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"ROCK4", "[", RowBox[{RowBox[{"{", RowBox[{"h", ",", "5"}], "}"}], ",", "opts"}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"ROCK4", "[", RowBox[{RowBox[{"{", RowBox[{"h_", ",", RowBox[{"s_", ":", "5"}]}], "}"}], ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"k", ",", "g", ",", "dr", ",", RowBox[{"ind", "=", RowBox[{"bsearch", "[", RowBox[{"ROCKdegrees", ",", "s"}], "]"}]}], ",", RowBox[{"posB1xbegin", "=", "posB1xOld"}], ",", RowBox[{"posB2xbegin", "=", "posB2xOld"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"indshift", "=", RowBox[{RowBox[{"Total", "[", RowBox[{"2", RowBox[{"(", RowBox[{RowBox[{"ROCKdegrees", "[", RowBox[{"[", RowBox[{"1", ";;", RowBox[{"ind", "-", "1"}]}], "]"}], "]"}], "-", "4"}], ")"}]}], "]"}], "-", "ind", "+", "2"}]}], ",", RowBox[{"kvec", "=", RowBox[{"Map", "[", RowBox[{"k", ",", RowBox[{"Range", "[", RowBox[{"1", ",", RowBox[{"s", "+", "1"}]}], "]"}]}], "]"}]}], ",", RowBox[{"gvec", "=", RowBox[{"Map", "[", RowBox[{"g", ",", RowBox[{"Range", "[", RowBox[{"0", ",", "s"}], "]"}]}], "]"}]}], ",", "ge"}], "}"}], ",", RowBox[{RowBox[{RowBox[{"g", "[", "0", "]"}], "=", RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}]}], ";", RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{RowBox[{"Length", "[", "QK", "]"}], "==", "1"}], "||", RowBox[{"n", "!=", "1"}]}], ",", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", RowBox[{"If", "[", RowBox[{RowBox[{"n", "==", "1"}], ",", "0", ",", "posB1xOld"}], "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"n", "==", "1"}], ",", "0", ",", "posB2xOld"}], "]"}], ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}]}], "]"}], ";", RowBox[{RowBox[{"k", "[", "n", "]"}], "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}], ",", "1"}], "}"}]}], ";", RowBox[{RowBox[{"g", "[", "n", "]"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{"n", "==", "1"}], ",", RowBox[{RowBox[{"g", "[", "0", "]"}], "+", RowBox[{RowBox[{"refc", "[", RowBox[{"[", "indshift", "]"}], "]"}], "h", RowBox[{"k", "[", "1", "]"}]}]}], ",", RowBox[{RowBox[{RowBox[{"(", RowBox[{"1", "+", RowBox[{"refc", "[", RowBox[{"[", RowBox[{"indshift", "+", RowBox[{"2", RowBox[{"(", RowBox[{"n", "-", "1"}], ")"}]}]}], "]"}], "]"}]}], ")"}], RowBox[{"g", "[", RowBox[{"n", "-", "1"}], "]"}]}], "-", RowBox[{RowBox[{"refc", "[", RowBox[{"[", RowBox[{"indshift", "+", RowBox[{"2", RowBox[{"(", RowBox[{"n", "-", "1"}], ")"}]}]}], "]"}], "]"}], RowBox[{"g", "[", RowBox[{"n", "-", "2"}], "]"}]}], "+", RowBox[{RowBox[{"refc", "[", RowBox[{"[", RowBox[{"indshift", "+", RowBox[{"2", "n"}], "-", "3"}], "]"}], "]"}], "h", RowBox[{"k", "[", "n", "]"}]}]}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"n", "==", "1"}], ",", RowBox[{RowBox[{"dr", "=", RowBox[{"drstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{RowBox[{"k", "[", "n", "]"}], "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{RowBox[{"k", "[", "n", "]"}], "[", RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", RowBox[{"appendTo", "[", RowBox[{"QK", ",", RowBox[{RowBox[{"g", "[", "n", "]"}], "[", RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"QR", ",", RowBox[{RowBox[{"g", "[", "n", "]"}], "[", RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"dQK", ",", RowBox[{RowBox[{"refc", "[", RowBox[{"[", "indshift", "]"}], "]"}], "h", RowBox[{RowBox[{"k", "[", "n", "]"}], "[", RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"appendTo", "[", RowBox[{"dQR", ",", RowBox[{RowBox[{"refc", "[", RowBox[{"[", "indshift", "]"}], "]"}], "h", RowBox[{RowBox[{"k", "[", "n", "]"}], "[", RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"t1grid", ",", RowBox[{RowBox[{"g", "[", "n", "]"}], "[", RowBox[{"[", "3", "]"}], "]"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"\[Delta]tratio", ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"drvec", ",", RowBox[{RowBox[{"refc", "[", RowBox[{"[", "indshift", "]"}], "]"}], "h", "dr"}]}], "]"}], ";", RowBox[{"AppendTo", "[", RowBox[{"rvec", ",", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], "]"}], ";", RowBox[{"appendAll", "[", "]"}]}], ",", RowBox[{RowBox[{RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], "=", RowBox[{"g", "[", "n", "]"}]}], ";", RowBox[{RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], ";", RowBox[{RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], RowBox[{RowBox[{"k", "[", "1", "]"}], "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], RowBox[{RowBox[{"k", "[", "1", "]"}], "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "dr"}]}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}]}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", RowBox[{"s", "-", "4"}]}], "}"}]}], "]"}], ";", RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", RowBox[{"If", "[", RowBox[{RowBox[{"n", "==", RowBox[{"s", "-", "2"}]}], ",", "posB1xbegin", ",", "posB1xOld"}], "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"n", "==", RowBox[{"s", "-", "2"}]}], ",", "posB2xbegin", ",", "posB2xOld"}], "]"}], ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{RowBox[{"k", "[", "n", "]"}], "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}], ",", "1"}], "}"}]}], ";", RowBox[{RowBox[{"g", "[", "n", "]"}], "=", RowBox[{"Switch", "[", RowBox[{"n", ",", RowBox[{"s", "-", "3"}], ",", RowBox[{RowBox[{"g", "[", RowBox[{"s", "-", "4"}], "]"}], "+", RowBox[{"h", RowBox[{"fpa", "[", RowBox[{"[", RowBox[{"ind", ",", "1"}], "]"}], "]"}], RowBox[{"k", "[", "n", "]"}]}]}], ",", RowBox[{"s", "-", "2"}], ",", RowBox[{RowBox[{"g", "[", RowBox[{"s", "-", "4"}], "]"}], "+", RowBox[{"h", RowBox[{"(", RowBox[{RowBox[{RowBox[{"fpa", "[", RowBox[{"[", RowBox[{"ind", ",", "2"}], "]"}], "]"}], RowBox[{"k", "[", RowBox[{"n", "-", "1"}], "]"}]}], "+", RowBox[{RowBox[{"fpa", "[", RowBox[{"[", RowBox[{"ind", ",", "3"}], "]"}], "]"}], RowBox[{"k", "[", "n", "]"}]}]}], ")"}]}]}], ",", RowBox[{"s", "-", "1"}], ",", RowBox[{RowBox[{"g", "[", RowBox[{"s", "-", "4"}], "]"}], "+", RowBox[{"h", RowBox[{"(", RowBox[{RowBox[{RowBox[{"fpa", "[", RowBox[{"[", RowBox[{"ind", ",", "4"}], "]"}], "]"}], RowBox[{"k", "[", RowBox[{"n", "-", "2"}], "]"}]}], "+", RowBox[{RowBox[{"fpa", "[", RowBox[{"[", RowBox[{"ind", ",", "5"}], "]"}], "]"}], RowBox[{"k", "[", RowBox[{"n", "-", "1"}], "]"}]}], "+", RowBox[{RowBox[{"fpa", "[", RowBox[{"[", RowBox[{"ind", ",", "6"}], "]"}], "]"}], RowBox[{"k", "[", "n", "]"}]}]}], ")"}]}]}], ",", "s", ",", RowBox[{RowBox[{"g", "[", RowBox[{"s", "-", "4"}], "]"}], "+", RowBox[{"h", RowBox[{"(", RowBox[{RowBox[{RowBox[{"fpb", "[", RowBox[{"[", RowBox[{"ind", ",", "1"}], "]"}], "]"}], RowBox[{"k", "[", RowBox[{"n", "-", "3"}], "]"}]}], "+", RowBox[{RowBox[{"fpb", "[", RowBox[{"[", RowBox[{"ind", ",", "2"}], "]"}], "]"}], RowBox[{"k", "[", RowBox[{"n", "-", "2"}], "]"}]}], "+", RowBox[{RowBox[{"fpb", "[", RowBox[{"[", RowBox[{"ind", ",", "3"}], "]"}], "]"}], RowBox[{"k", "[", RowBox[{"n", "-", "1"}], "]"}]}], "+", RowBox[{RowBox[{"fpb", "[", RowBox[{"[", RowBox[{"ind", ",", "4"}], "]"}], "]"}], RowBox[{"k", "[", "n", "]"}]}]}], ")"}]}]}]}], "]"}]}], ";", RowBox[{RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], "=", RowBox[{"g", "[", "n", "]"}]}], ";", RowBox[{RowBox[{"\[Delta]tratio", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "t1grid", "]"}], ">", "2"}], ",", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "3"}], "]"}], "]"}]}], ")"}]}], ",", "0."}], "]"}]}], ";", RowBox[{RowBox[{"dQK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], RowBox[{RowBox[{"k", "[", "1", "]"}], "[", RowBox[{"[", "1", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"dQR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], RowBox[{RowBox[{"k", "[", "1", "]"}], "[", RowBox[{"[", "2", "]"}], "]"}]}]}], ";", RowBox[{RowBox[{"drvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "-", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "2"}], "]"}], "]"}]}], ")"}], "dr"}]}], ";", RowBox[{RowBox[{"rvec", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "=", RowBox[{"rstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "]"}]}], ";", RowBox[{"replaceAll", "[", "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", RowBox[{"s", "-", "3"}], ",", "s"}], "}"}]}], "]"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{RowBox[{"k", "[", RowBox[{"s", "+", "1"}], "]"}], "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}], ",", "1"}], "}"}]}], ";", RowBox[{"ge", "=", RowBox[{RowBox[{"g", "[", RowBox[{"s", "-", "4"}], "]"}], "+", RowBox[{"h", RowBox[{"(", RowBox[{RowBox[{RowBox[{"fpbe", "[", RowBox[{"[", RowBox[{"ind", ",", "1"}], "]"}], "]"}], RowBox[{"k", "[", RowBox[{"s", "-", "3"}], "]"}]}], "+", RowBox[{RowBox[{"fpbe", "[", RowBox[{"[", RowBox[{"ind", ",", "2"}], "]"}], "]"}], RowBox[{"k", "[", RowBox[{"s", "-", "2"}], "]"}]}], "+", RowBox[{RowBox[{"fpbe", "[", RowBox[{"[", RowBox[{"ind", ",", "3"}], "]"}], "]"}], RowBox[{"k", "[", RowBox[{"s", "-", "1"}], "]"}]}], "+", RowBox[{RowBox[{"fpbe", "[", RowBox[{"[", RowBox[{"ind", ",", "4"}], "]"}], "]"}], RowBox[{"k", "[", "s", "]"}]}], "+", RowBox[{RowBox[{"fpbe", "[", RowBox[{"[", RowBox[{"ind", ",", "5"}], "]"}], "]"}], RowBox[{"k", "[", RowBox[{"s", "+", "1"}], "]"}]}]}], ")"}]}]}]}], ";", RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{"\[Delta]2", "=", RowBox[{RowBox[{"ge", "[", RowBox[{"[", RowBox[{"1", ";;", "2"}], "]"}], "]"}], "-", RowBox[{RowBox[{"g", "[", "s", "]"}], "[", RowBox[{"[", RowBox[{"1", ";;", "2"}], "]"}], "]"}]}]}], "]"}], ",", "\[Infinity]"}], "]"}]}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "SSPERK104", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"SyntaxInformation", "[", "SSPERK104", "]"}], "=", RowBox[{"{", RowBox[{"\"ArgumentsPattern\"", "->", RowBox[{"{", RowBox[{"___", ",", RowBox[{"OptionsPattern", "[", "]"}]}], "}"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "SSPERK104", "]"}], ":=", RowBox[{"{", RowBox[{RowBox[{"\"Debug\"", "->", "True"}], ",", RowBox[{"\"Order\"", "->", "ord"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"SSPERK104", "[", RowBox[{"\[Delta]t_", ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"k", ",", "g"}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"kvec", "=", RowBox[{"Map", "[", RowBox[{"k", ",", RowBox[{"Range", "[", "10", "]"}]}], "]"}]}], ",", RowBox[{"gvec", "=", RowBox[{"Map", "[", RowBox[{"g", ",", RowBox[{"Range", "[", RowBox[{"0", ",", "10"}], "]"}]}], "]"}]}], ",", "ge", ",", "dr", ",", RowBox[{"posB1xvec", "=", RowBox[{"{", RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ",", RowBox[{"posB2xvec", "=", RowBox[{"{", RowBox[{"0", ",", "0", ",", "0"}], "}"}]}]}], "}"}], ",", RowBox[{RowBox[{RowBox[{"g", "[", "0", "]"}], "=", RowBox[{"{", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}]}], ";", RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{RowBox[{"Length", "[", "QK", "]"}], "==", "1"}], "||", RowBox[{"n", "!=", "1"}]}], ",", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", RowBox[{"Switch", "[", RowBox[{"n", ",", "1", ",", "0", ",", "6", ",", RowBox[{"posB1xvec", "[", RowBox[{"[", "1", "]"}], "]"}], ",", "7", ",", RowBox[{"posB1xvec", "[", RowBox[{"[", "2", "]"}], "]"}], ",", "8", ",", RowBox[{"posB1xvec", "[", RowBox[{"[", "3", "]"}], "]"}], ",", "_", ",", "posB1xOld"}], "]"}], ",", RowBox[{"Switch", "[", RowBox[{"n", ",", "1", ",", "0", ",", "6", ",", RowBox[{"posB2xvec", "[", RowBox[{"[", "1", "]"}], "]"}], ",", "7", ",", RowBox[{"posB2xvec", "[", RowBox[{"[", "2", "]"}], "]"}], ",", "8", ",", RowBox[{"posB2xvec", "[", RowBox[{"[", "3", "]"}], "]"}], ",", "_", ",", "posB2xOld"}], "]"}], ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}], ",", RowBox[{"\"Same\"", "->", RowBox[{"MemberQ", "[", RowBox[{RowBox[{"{", RowBox[{"6", ",", "7", ",", "8"}], "}"}], ",", "n"}], "]"}]}]}], "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"n", "==", "3"}], ",", RowBox[{RowBox[{RowBox[{"posB1xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "=", "posB1xOld"}], ";", RowBox[{RowBox[{"posB2xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "=", "posB2xOld"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"n", "==", "4"}], ",", RowBox[{RowBox[{RowBox[{"posB1xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "=", "posB1xOld"}], ";", RowBox[{RowBox[{"posB2xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "=", "posB2xOld"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"n", "==", "5"}], ",", RowBox[{RowBox[{RowBox[{"posB1xvec", "[", RowBox[{"[", "3", "]"}], "]"}], "=", "posB1xOld"}], ";", RowBox[{RowBox[{"posB2xvec", "[", RowBox[{"[", "3", "]"}], "]"}], "=", "posB2xOld"}]}]}], "]"}], ";", RowBox[{RowBox[{"k", "[", "n", "]"}], "=", RowBox[{"{", RowBox[{RowBox[{"QKstep", "[", RowBox[{"QK", ",", "\[Theta]points"}], "]"}], ",", RowBox[{"QRstep", "[", RowBox[{"QR", ",", "\[Theta]points"}], "]"}], ",", "1"}], "}"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"n", "==", "1"}], ",", RowBox[{RowBox[{"dr", "=", RowBox[{"drstep", "[", RowBox[{RowBox[{"QK", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"QR", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], ",", RowBox[{RowBox[{"k", "[", "1", "]"}], "[", RowBox[{"[", "1", "]"}], "]"}], ",", RowBox[{RowBox[{"k", "[", "1", "]"}], "[", RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";", RowBox[{"appendUpdate", "[", RowBox[{RowBox[{RowBox[{"g", "[", "1", "]"}], "=", RowBox[{RowBox[{"g", "[", "0", "]"}], "+", RowBox[{RowBox[{"(", RowBox[{"\[Delta]t", RowBox[{"amat", "[", RowBox[{"[", RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ")"}], RowBox[{"k", "[", "1", "]"}]}]}]}], ",", RowBox[{RowBox[{"(", RowBox[{"\[Delta]t", RowBox[{"amat", "[", RowBox[{"[", RowBox[{"2", ",", "1"}], "]"}], "]"}]}], ")"}], RowBox[{"k", "[", "1", "]"}]}], ",", "dr"}], "]"}]}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"n", "==", "10"}], ",", RowBox[{"replaceUpdate", "[", RowBox[{RowBox[{RowBox[{"g", "[", "n", "]"}], "=", RowBox[{RowBox[{"g", "[", "0", "]"}], "+", RowBox[{"dot", "[", RowBox[{RowBox[{"\[Delta]t", "bvec"}], ",", "kvec"}], "]"}]}]}], ",", RowBox[{"k", "[", "1", "]"}], ",", "dr"}], "]"}], ",", RowBox[{"replaceUpdate", "[", RowBox[{RowBox[{RowBox[{"g", "[", "n", "]"}], "=", RowBox[{RowBox[{"g", "[", "0", "]"}], "+", RowBox[{"dot", "[", RowBox[{RowBox[{"\[Delta]t", RowBox[{"amat", "[", RowBox[{"[", RowBox[{RowBox[{"n", "+", "1"}], ",", RowBox[{"1", ";;", "n"}]}], "]"}], "]"}]}], ",", RowBox[{"kvec", "[", RowBox[{"[", RowBox[{"1", ";;", "n"}], "]"}], "]"}]}], "]"}]}]}], ",", RowBox[{"k", "[", "1", "]"}], ",", "dr"}], "]"}]}], "]"}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "10"}], "}"}]}], "]"}], ";", RowBox[{"kvecOut", "=", "kvec"}], ";", RowBox[{"gvecOut", "=", "gvec"}], ";", RowBox[{"interpolate", "[", RowBox[{RowBox[{"{", RowBox[{"QK", ",", "QR", ",", "posA1y", ",", "posA2y", ",", "posB2y", ",", "posB1xOld", ",", "posB2xOld", ",", "\[Phi]points1", ",", "\[Phi]points2"}], "}"}], ",", RowBox[{"\"Order\"", "->", RowBox[{"OptionValue", "[", "\"Order\"", "]"}]}]}], "]"}], ";", RowBox[{"ge", "=", RowBox[{RowBox[{"g", "[", "0", "]"}], "+", RowBox[{"dot", "[", RowBox[{RowBox[{"\[Delta]t", "b2vec"}], ",", "kvec"}], "]"}]}]}], ";", RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{RowBox[{"g", "[", "10", "]"}], "-", "ge"}], "]"}], ",", "\[Infinity]"}], "]"}]}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"rmax", "[", "x_", "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{"x", "==", "0"}], ",", "3", ",", RowBox[{"If", "[", RowBox[{RowBox[{"x", "==", "1"}], ",", "13", ",", RowBox[{"If", "[", RowBox[{"SERK", ",", RowBox[{"20", RowBox[{RowBox[{"(", RowBox[{"x", "-", "1"}], ")"}], "^", "2"}]}], ",", RowBox[{RowBox[{"(", RowBox[{"0.2", "+", RowBox[{"0.1", RowBox[{"Min", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{"x", "+", "2"}], ")"}], "/", "5"}], ",", "1"}], "]"}]}]}], ")"}], RowBox[{RowBox[{"ROCKdegrees", "[", RowBox[{"[", RowBox[{"x", "+", "2"}], "]"}], "]"}], "^", "2"}]}]}], "]"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"update", "[", RowBox[{"\[Delta]t_", ",", "method_"}], "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{"method", "==", "0"}], ",", RowBox[{"RK54update", "[", "\[Delta]t", "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"method", "==", "1"}], ",", RowBox[{"SSPERK104", "[", "\[Delta]t", "]"}], ",", RowBox[{"If", "[", RowBox[{"SERK", ",", RowBox[{"SERK2", "[", RowBox[{"{", RowBox[{"\[Delta]t", ",", RowBox[{"2", RowBox[{"(", RowBox[{"method", "-", "1"}], ")"}]}]}], "}"}], "]"}], ",", RowBox[{"ROCK4", "[", RowBox[{"{", RowBox[{"\[Delta]t", ",", RowBox[{"ROCKdegrees", "[", RowBox[{"[", RowBox[{"method", "+", "2"}], "]"}], "]"}]}], "}"}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"quantum", "=", "False"}], ";"}]
RowBox[{RowBox[{"load", "=", "True"}], ";"}]
RowBox[{RowBox[{"versionCheck", "=", "False"}], ";"}]
RowBox[{RowBox[{"PhysParamsOnly", "=", "False"}], ";"}]
RowBox[{RowBox[{"initialize", "[", "]"}], ";"}]
RowBox[{RowBox[{"Sin", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], ".", "int"}]
RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", SuperscriptBox["\[Theta]points", "n"], ",", "1"}], "]"}], ".", "int"}], "]"}], "-", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}]
RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", SuperscriptBox["\[Theta]points", "n"], ",", "1"}], "]"}], ".", "int"}], "-", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}]
RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", SuperscriptBox["\[Theta]points", "n"], ",", RowBox[{"1", "+", RowBox[{"0", "\[Theta]points"}]}]}], "]"}], ".", "int"}], "-", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}]
RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", SuperscriptBox["\[Theta]points", "n"], ",", RowBox[{"1", "+", RowBox[{"0", "\[Theta]points"}]}]}], "]"}], ".", "int"}], "-", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}]
RowBox[{RowBox[{"data", "=", RowBox[{"Flatten", "[", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/int.dat\"", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", SuperscriptBox["\[Theta]points", "n"], ",", "1"}], "]"}], "*", "data"}], "]"}], "-", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}], "//", "Chop"}]
RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", SuperscriptBox["\[Theta]points", "n"], ",", "1"}], "]"}], "*", "data"}], "]"}], "-", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}]
RowBox[{RowBox[{"Sin", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], ".", "data"}]
RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", RowBox[{"1", "-", SuperscriptBox["\[Theta]points", "n"]}], ",", "1"}], "]"}], "*", "data"}], "]"}], "-", "1", "+", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}]
RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", RowBox[{"1", "-", SuperscriptBox["\[Theta]points", "n"]}], ",", "0"}], "]"}], "*", "data"}], "]"}], "-", "1", "+", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}]
RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", RowBox[{"1", "-", SuperscriptBox["\[Theta]points", "n"]}], ",", "0"}], "]"}], "*", "int"}], "]"}], "-", "1", "+", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}]
RowBox[{RowBox[{"Cos", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], ".", "data"}]
RowBox[{RowBox[{"Cos", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], ".", "int"}]
RowBox[{"ListPlot", "[", RowBox[{"Cos", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], "]"}]
RowBox[{"ListPlot", "[", RowBox[{RowBox[{"Cos", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], ",", RowBox[{"PlotRange", "->", "Full"}]}], "]"}]
RowBox[{"ListPlot", "[", RowBox[{RowBox[{"Sin", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], ",", RowBox[{"PlotRange", "->", "Full"}]}], "]"}]
RowBox[{"ListPlot", "[", RowBox[{RowBox[{"Cos", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], ",", RowBox[{"PlotRange", "->", "Full"}]}], "]"}]
RowBox[{"ListPlot", "[", RowBox[{SuperscriptBox["\[Theta]points", "7"], ",", RowBox[{"PlotRange", "->", "Full"}]}], "]"}]
RowBox[{RowBox[{"data", "=", RowBox[{"Flatten", "[", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/int.dat\"", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"Cos", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], ".", "data"}]
RowBox[{RowBox[{"data", "=", RowBox[{"Flatten", "[", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/int.dat\"", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"Cos", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], ".", "data"}]
RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", RowBox[{"1", "-", SuperscriptBox["\[Theta]points", "n"]}], ",", "0"}], "]"}], "*", "data"}], "]"}], "-", "1", "+", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}]
RowBox[{RowBox[{"data", "=", RowBox[{"Flatten", "[", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/int.dat\"", "]"}], "]"}]}], ";"}]
RowBox[{"ListPlot", "[", RowBox[{SuperscriptBox["\[Theta]points", "7"], ",", RowBox[{"PlotRange", "->", "Full"}]}], "]"}]
RowBox[{RowBox[{"Cos", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], ".", "data"}]
RowBox[{RowBox[{"data", "=", RowBox[{"Flatten", "[", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/int.dat\"", "]"}], "]"}]}], ";"}]
RowBox[{"ListPlot", "[", RowBox[{SuperscriptBox["\[Theta]points", "7"], ",", RowBox[{"PlotRange", "->", "Full"}]}], "]"}]
RowBox[{RowBox[{"Cos", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], ".", "data"}]
RowBox[{RowBox[{"data", "=", RowBox[{"Flatten", "[", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/int.dat\"", "]"}], "]"}]}], ";"}]
RowBox[{"ListPlot", "[", RowBox[{SuperscriptBox["\[Theta]points", "7"], ",", RowBox[{"PlotRange", "->", "Full"}]}], "]"}]
RowBox[{RowBox[{"Cos", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], ".", "data"}]
RowBox[{RowBox[{"data", "=", RowBox[{"Flatten", "[", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/int.dat\"", "]"}], "]"}]}], ";"}]
RowBox[{"ListPlot", "[", RowBox[{SuperscriptBox["\[Theta]points", "7"], ",", RowBox[{"PlotRange", "->", "Full"}]}], "]"}]
RowBox[{RowBox[{"Cos", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], ".", "data"}]
RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", RowBox[{"1", "-", SuperscriptBox["\[Theta]points", "n"]}], ",", "0"}], "]"}], "*", "data"}], "]"}], "-", "1", "+", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}]
RowBox[{RowBox[{"Cos", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], ".", "int"}]
RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", RowBox[{"1", "-", SuperscriptBox["\[Theta]points", "n"]}], ",", "0"}], "]"}], "*", "data"}], "]"}], "-", "1", "+", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}]
RowBox[{RowBox[{"Cos", "[", RowBox[{"2", "\[Pi]", "\[Theta]points"}], "]"}], ".", "data"}]
RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", RowBox[{"1", "-", SuperscriptBox["\[Theta]points", "n"]}], ",", "0"}], "]"}], "*", "data"}], "]"}], "-", "1", "+", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}]
RowBox[{"ListPlot", "[", RowBox[{SuperscriptBox["\[Theta]points", "11"], ",", RowBox[{"PlotRange", "->", "Full"}]}], "]"}]
RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"Total", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"n", ">", "0"}], ",", SuperscriptBox["\[Theta]points", "n"], ",", "1"}], "]"}], "*", "data"}], "]"}], "-", FractionBox["1", RowBox[{"n", "+", "1"}]]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", "10"}], "}"}]}], "]"}]
RowBox[{"Dimensions", "[", "weightsA1y", "]"}]
RowBox[{"Dimensions", "[", "indsA1y", "]"}]
RowBox[{"indsA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"indsA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"Dimensions", "[", "posA1y", "]"}]
RowBox[{RowBox[{"data", "=", RowBox[{"Flatten", "[", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}], "]"}]}], ";"}]
RowBox[{"data", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"phi12", "=", RowBox[{"Flatten", "[", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{"Dimensions", "[", "posA1y2", "]"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", "37.9803"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"\[Theta]points2", "=", RowBox[{"Flatten", "[", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/theta.dat\"", "]"}], "]"}]}], ";"}]
RowBox[{"\[Theta]points", "==", "\[Theta]points2"}]
RowBox[{"phi12", "==", "phi1"}]
RowBox[{"phi12", "==", "\[Phi]points1"}]
RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{"phi12", "-", "\[Phi]points1"}], "]"}], ",", "\[Infinity]"}], "]"}]
RowBox[{"Dimensions", "[", "\[Phi]points1", "]"}]
RowBox[{"Dimensions", "[", "phi12", "]"}]
RowBox[{RowBox[{"phi12", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{"Dimensions", "[", "phi12", "]"}]
RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{"phi12", "-", "\[Phi]points1"}], "]"}], ",", "\[Infinity]"}], "]"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"\[Theta]points", "[", RowBox[{"[", "100", "]"}], "]"}], RowBox[{"\[Theta]points", "[", RowBox[{"[", "200", "]"}], "]"}]}]
RowBox[{RowBox[{"\[Theta]points", "[", RowBox[{"[", "100", "]"}], "]"}], RowBox[{"\[Theta]points", "[", RowBox[{"[", "200", "]"}], "]"}]}]
RowBox[{"\[Phi]points1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"\[Theta]points", "[", RowBox[{"[", "100", "]"}], "]"}], RowBox[{"\[Theta]points", "[", RowBox[{"[", "200", "]"}], "]"}]}]
RowBox[{"\[Phi]points1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"\[Theta]points", "[", RowBox[{"[", "100", "]"}], "]"}], RowBox[{"\[Theta]points", "[", RowBox[{"[", "200", "]"}], "]"}]}]
RowBox[{"\[Phi]points1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"2", "*", RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"\[Theta]points", "[", RowBox[{"[", "100", "]"}], "]"}], RowBox[{"\[Theta]points", "[", RowBox[{"[", "200", "]"}], "]"}]}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"\[Phi]points1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"inv\[Theta]", "[", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"\[Phi]points1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}], "]"}]
RowBox[{"\[Theta]func", "[", RowBox[{"inv\[Theta]", "[", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"\[Phi]points1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}], "]"}], "]"}]
RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"inv\[Theta]", "[", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"\[Phi]points1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}], "]"}], "]"}], "-", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"\[Phi]points1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]}]
RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"inv\[Theta]", "[", RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}], "]"}], "-", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"\[Phi]points1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]}]
RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"inv\[Theta]", "[", RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}], "]"}], "-", RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}], "-", RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}], "-", RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"1.", RowBox[{"Clip", "[", RowBox[{RowBox[{"inv\[Theta]", "[", "\[Phi]points1", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", RowBox[{"10", "^", RowBox[{"-", "100"}]}]}]}], "}"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posB2y", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"1.", RowBox[{"Clip", "[", RowBox[{RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{"\[Theta]points", ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{"\[Phi]points2", "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", RowBox[{"10", "^", RowBox[{"-", "100"}]}]}]}], "}"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posB2y", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"1.", RowBox[{"Clip", "[", RowBox[{RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{RowBox[{"SetPrecision", "[", RowBox[{"\[Theta]points", ",", "40"}], "]"}], ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{RowBox[{"SetPrecision", "[", RowBox[{"\[Phi]points2", ",", "40"}], "]"}], "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", RowBox[{"10", "^", RowBox[{"-", "100"}]}]}]}], "}"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"phi12", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"\[Theta]points2", "=", RowBox[{"Flatten", "[", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/theta.dat\"", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"\[Theta]points", "[", RowBox[{"[", "100", "]"}], "]"}], RowBox[{"\[Theta]points", "[", RowBox[{"[", "200", "]"}], "]"}]}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"\[Phi]points1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}], "-", RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{RowBox[{"phi12", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"\[Theta]points2", "=", RowBox[{"Flatten", "[", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/theta.dat\"", "]"}], "]"}]}], ";"}]
RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{"phi12", "-", "\[Phi]points1"}], "]"}], ",", "\[Infinity]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"\[Theta]points", "[", RowBox[{"[", "100", "]"}], "]"}], RowBox[{"\[Theta]points", "[", RowBox[{"[", "200", "]"}], "]"}]}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"\[Phi]points1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}], "-", RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posB2y", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"1.", RowBox[{"Clip", "[", RowBox[{RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{RowBox[{"SetPrecision", "[", RowBox[{"\[Theta]points", ",", "40"}], "]"}], ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{RowBox[{"SetPrecision", "[", RowBox[{"\[Phi]points2", ",", "40"}], "]"}], "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", RowBox[{"10", "^", RowBox[{"-", "100"}]}]}]}], "}"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}], "]"}], "-", RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "40"}], "]"}], "]"}], "-", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "40"}], "]"}]}]
RowBox[{"\[Theta]func", "[", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "40"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"\[Theta]points", "[", RowBox[{"[", "100", "]"}], "]"}], RowBox[{"\[Theta]points", "[", RowBox[{"[", "200", "]"}], "]"}]}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"\[Phi]points1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "40"}], "]"}], "]"}], "-", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "40"}], "]"}]}]
RowBox[{RowBox[{"posB2y", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"1.", RowBox[{"Clip", "[", RowBox[{RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{RowBox[{"SetPrecision", "[", RowBox[{"\[Theta]points", ",", "40"}], "]"}], ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{RowBox[{"SetPrecision", "[", RowBox[{"\[Phi]points2", ",", "40"}], "]"}], "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", RowBox[{"10", "^", RowBox[{"-", "100"}]}]}]}], "}"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y3", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"1.", RowBox[{"Clip", "[", RowBox[{RowBox[{"inv\[Theta]", "[", "phi12", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", RowBox[{"10", "^", RowBox[{"-", "100"}]}]}]}], "}"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y3", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"1.", RowBox[{"Clip", "[", RowBox[{RowBox[{"inv\[Theta]", "[", "phi12", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", RowBox[{"10", "^", RowBox[{"-", "100"}]}]}]}], "}"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{RowBox[{RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "--"}], "1.6129320101754274`*^-12"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", "1.6129320101754274`*^-12"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"1.6129320101754274", "*", SuperscriptBox["10", RowBox[{"-", "12"}]]}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"-", "1.6129320101754274"}], "*", SuperscriptBox["10", RowBox[{"-", "12"}]]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"1.6129320101754274", "*", SuperscriptBox["10", RowBox[{"-", "12"}]]}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"1.", RowBox[{"Clip", "[", RowBox[{RowBox[{"inv\[Theta]", "[", "\[Phi]points1", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", RowBox[{"10", "^", RowBox[{"-", "100"}]}]}]}], "}"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"1.6129320101754274", "*", SuperscriptBox["10", RowBox[{"-", "12"}]]}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "+", RowBox[{"1.6129320101754274", "*", SuperscriptBox["10", RowBox[{"-", "12"}]]}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"phi12", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"\[Theta]points2", "=", RowBox[{"Flatten", "[", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/theta.dat\"", "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y3", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"1.", RowBox[{"Clip", "[", RowBox[{RowBox[{"inv\[Theta]", "[", "phi12", "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"len", "-", RowBox[{"10", "^", RowBox[{"-", "100"}]}]}]}], "}"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}]
RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}]}]
RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}]}]
RowBox[{"phi12", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y3", "[", RowBox[{"[", RowBox[{"300", ",", "200"}], "]"}], "]"}]}]
RowBox[{"FindRoot", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x", "]"}], "-", "0.5"}], "==", "0"}], ",", "x", ",", RowBox[{"Method", "->", "\"Newton\""}]}], "]"}]
RowBox[{"FindRoot", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x", "]"}], "-", "0.5"}], "==", "0"}], ",", RowBox[{"{", RowBox[{"x", ",", "0.2"}], "}"}], ",", RowBox[{"Method", "->", "\"Newton\""}]}], "]"}]
RowBox[{"FindRoot", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x", "]"}], "-", RowBox[{"5", "/", "10"}]}], "==", "0"}], ",", RowBox[{"{", RowBox[{"x", ",", RowBox[{"2", "/", "10"}]}], "}"}], ",", RowBox[{"Method", "->", "\"Newton\""}]}], "]"}]
RowBox[{"\[Theta]func", "[", "0.2", "]"}]
RowBox[{"\[Theta]func", "[", "100", "]"}]
RowBox[{"FindRoot", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x", "]"}], "-", RowBox[{"5", "/", "10"}]}], "==", "0"}], ",", RowBox[{"{", RowBox[{"x", ",", "250"}], "}"}], ",", RowBox[{"Method", "->", "\"Newton\""}]}], "]"}]
RowBox[{"FindRoot", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x", "]"}], "-", RowBox[{"5", "/", "10"}]}], "==", "0"}], ",", RowBox[{"{", RowBox[{"x", ",", "250"}], "}"}], ",", RowBox[{"Method", "->", "\"Newton\""}], ",", RowBox[{"WorkingPrecision", "->", "20"}]}], "]"}]
RowBox[{"FindRoot", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x", "]"}], "-", RowBox[{"5", "/", "10"}]}], "==", "0"}], ",", RowBox[{"{", RowBox[{"x", ",", "100"}], "}"}], ",", RowBox[{"Method", "->", "\"Newton\""}], ",", RowBox[{"WorkingPrecision", "->", "20"}]}], "]"}]
RowBox[{"FindRoot", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x", "]"}], "-", RowBox[{"1", "/", "10"}]}], "==", "0"}], ",", RowBox[{"{", RowBox[{"x", ",", "100"}], "}"}], ",", RowBox[{"Method", "->", "\"Newton\""}], ",", RowBox[{"WorkingPrecision", "->", "20"}]}], "]"}]
RowBox[{"AbsoluteTiming", "[", RowBox[{"Do", "[", RowBox[{RowBox[{"FindRoot", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x", "]"}], "-", RowBox[{"1", "/", "10"}]}], "==", "0"}], ",", RowBox[{"{", RowBox[{"x", ",", "100"}], "}"}], ",", RowBox[{"Method", "->", "\"Newton\""}], ",", RowBox[{"WorkingPrecision", "->", "20"}]}], "]"}], ",", RowBox[{"{", "1000", "}"}]}], "]"}], "]"}]
RowBox[{"AbsoluteTiming", "[", RowBox[{"Do", "[", RowBox[{RowBox[{"FindRoot", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x", "]"}], "-", RowBox[{"1", "/", "10"}]}], "==", "0"}], ",", RowBox[{"{", RowBox[{"x", ",", "100"}], "}"}], ",", RowBox[{"Method", "->", "\"Newton\""}], ",", RowBox[{"WorkingPrecision", "->", "20"}]}], "]"}], ",", RowBox[{"{", "10000", "}"}]}], "]"}], "]"}]
RowBox[{"AbsoluteTiming", "[", RowBox[{"Do", "[", RowBox[{RowBox[{"FindRoot", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x", "]"}], "-", RowBox[{"1", "/", "10"}]}], "==", "0"}], ",", RowBox[{"{", RowBox[{"x", ",", "100"}], "}"}], ",", RowBox[{"Method", "->", "\"Brent\""}], ",", RowBox[{"WorkingPrecision", "->", "20"}]}], "]"}], ",", RowBox[{"{", "10000", "}"}]}], "]"}], "]"}]
RowBox[{"AbsoluteTiming", "[", RowBox[{"Do", "[", RowBox[{RowBox[{"FindRoot", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x", "]"}], "-", RowBox[{"1", "/", "10"}]}], "==", "0"}], ",", RowBox[{"{", RowBox[{"x", ",", "1", ",", "512"}], "}"}], ",", RowBox[{"Method", "->", "\"Brent\""}], ",", RowBox[{"WorkingPrecision", "->", "20"}]}], "]"}], ",", RowBox[{"{", "10000", "}"}]}], "]"}], "]"}]
RowBox[{"FindRoot", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x", "]"}], "-", RowBox[{"1", "/", "10"}]}], "==", "0"}], ",", RowBox[{"{", RowBox[{"x", ",", "1", ",", "512"}], "}"}], ",", RowBox[{"Method", "->", "\"Brent\""}], ",", RowBox[{"WorkingPrecision", "->", "20"}]}], "]"}]
RowBox[{"FindRoot", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x", "]"}], "-", RowBox[{"5", "/", "10"}]}], "==", "0"}], ",", RowBox[{"{", RowBox[{"x", ",", "1", ",", "512"}], "}"}], ",", RowBox[{"Method", "->", "\"Brent\""}], ",", RowBox[{"WorkingPrecision", "->", "20"}]}], "]"}]
RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], ",", RowBox[{"Method", "->", "\"Spline\""}]}], "]"}], "[", "256", "]"}]
RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}]}], "]"}], "[", "256", "]"}]
RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "100"}], "]"}], "]"}]
RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}]}], "]"}], "[", ".5", "]"}]
RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}]}], "]"}], "[", RowBox[{"5", "/", "10"}], "]"}]
RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "5"}]}], "]"}], "[", RowBox[{"5", "/", "10"}], "]"}]
RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "5"}]}], "]"}], "[", RowBox[{"2", "/", "10"}], "]"}]
RowBox[{RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "5"}]}], "]"}], "[", RowBox[{"2", "/", "10"}], "]"}], "-", RowBox[{"inv\[Theta]", "[", RowBox[{"2", "/", "10"}], "]"}]}]
RowBox[{RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "5"}]}], "]"}], "[", RowBox[{"1", "/", "10"}], "]"}], "-", RowBox[{"inv\[Theta]", "[", RowBox[{"1", "/", "10"}], "]"}]}]
RowBox[{RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "5"}]}], "]"}], "[", RowBox[{"1", "/", "1000"}], "]"}], "-", RowBox[{"inv\[Theta]", "[", RowBox[{"1", "/", "1000"}], "]"}]}]
RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "5"}]}], "]"}], "[", RowBox[{"1", "/", "1000"}], "]"}]
RowBox[{"inv\[Theta]", "[", RowBox[{"1", "/", "1000"}], "]"}]
RowBox[{RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "5"}]}], "]"}], "[", RowBox[{"1", "/", "1000"}], "]"}], "-", RowBox[{"inv\[Theta]", "[", RowBox[{"1", "/", "1000"}], "]"}]}]
RowBox[{RowBox[{"func", "=", RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "5"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"func", "[", RowBox[{"1", "/", "1000"}], "]"}], "-", RowBox[{"inv\[Theta]", "[", RowBox[{"1", "/", "1000"}], "]"}]}]
RowBox[{"AbsoluteTiming", "[", RowBox[{"func", "[", "\[Phi]points1", "]"}], "]"}]
RowBox[{"AbsoluteTiming", "[", RowBox[{RowBox[{"func", "[", "\[Phi]points1", "]"}], ";"}], "]"}]
RowBox[{"Max", "[", RowBox[{"func", "[", "\[Phi]points1", "]"}], "]"}]
RowBox[{RowBox[{"func", "=", RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "5"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y", "=", RowBox[{"func", "[", "\[Phi]points1", "]"}]}], ";"}]
RowBox[{RowBox[{"posA2y", "=", RowBox[{"func", "[", "\[Phi]points2", "]"}]}], ";"}]
RowBox[{RowBox[{"posB2y", "=", RowBox[{"func", "[", RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{"\[Theta]points", ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{"\[Phi]points2", "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{"posA1y2", "-", "posA1y"}], "]"}], ",", "\[Infinity]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{"posA1y2", "-", "posA1y"}], "]"}], ",", "\[Infinity]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{"posA1y2", "-", "posA1y"}], "]"}], ",", "\[Infinity]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{"posA1y2", "-", "posA1y"}], "]"}], ",", "\[Infinity]"}], "]"}]
RowBox[{RowBox[{"func", "=", RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y", "=", RowBox[{"func", "[", "\[Phi]points1", "]"}]}], ";"}]
RowBox[{RowBox[{"posA2y", "=", RowBox[{"func", "[", "\[Phi]points2", "]"}]}], ";"}]
RowBox[{RowBox[{"posB2y", "=", RowBox[{"func", "[", RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{"\[Theta]points", ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{"\[Phi]points2", "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], "]"}]}], ";"}]
RowBox[{"AbsoluteTiming", "[", RowBox[{RowBox[{"func", "[", "\[Phi]points1", "]"}], ";"}], "]"}]
RowBox[{RowBox[{"func", "[", RowBox[{"1", "/", "1000"}], "]"}], "-", RowBox[{"inv\[Theta]", "[", RowBox[{"1", "/", "1000"}], "]"}]}]
RowBox[{RowBox[{"func", "=", RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Hermite\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y", "=", RowBox[{"func", "[", "\[Phi]points1", "]"}]}], ";"}]
RowBox[{RowBox[{"posA2y", "=", RowBox[{"func", "[", "\[Phi]points2", "]"}]}], ";"}]
RowBox[{RowBox[{"posB2y", "=", RowBox[{"func", "[", RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{"\[Theta]points", ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{"\[Phi]points2", "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"func", "[", RowBox[{"1", "/", "1000"}], "]"}], "-", RowBox[{"inv\[Theta]", "[", RowBox[{"1", "/", "1000"}], "]"}]}]
RowBox[{RowBox[{"func", "[", RowBox[{"1", "/", "1000"}], "]"}], "-", RowBox[{"inv\[Theta]", "[", RowBox[{"1", "/", "1000"}], "]"}]}]
RowBox[{RowBox[{"func", "[", RowBox[{"1", "/", "1000"}], "]"}], "-", RowBox[{"inv\[Theta]", "[", RowBox[{"1", "/", "1000"}], "]"}]}]
RowBox[{RowBox[{"func", "=", RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y", "=", RowBox[{"func", "[", "\[Phi]points1", "]"}]}], ";"}]
RowBox[{RowBox[{"posA2y", "=", RowBox[{"func", "[", "\[Phi]points2", "]"}]}], ";"}]
RowBox[{RowBox[{"posB2y", "=", RowBox[{"func", "[", RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{"\[Theta]points", ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{"\[Phi]points2", "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], "]"}]}], ";"}]
RowBox[{"AbsoluteTiming", "[", RowBox[{RowBox[{"func", "[", "\[Phi]points1", "]"}], ";"}], "]"}]
RowBox[{RowBox[{"func", "[", RowBox[{"1", "/", "1000"}], "]"}], "-", RowBox[{"inv\[Theta]", "[", RowBox[{"1", "/", "1000"}], "]"}]}]
RowBox[{RowBox[{"func", "=", RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "1000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "1000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y", "=", RowBox[{"func", "[", "\[Phi]points1", "]"}]}], ";"}]
RowBox[{RowBox[{"posA2y", "=", RowBox[{"func", "[", "\[Phi]points2", "]"}]}], ";"}]
RowBox[{RowBox[{"posB2y", "=", RowBox[{"func", "[", RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{"\[Theta]points", ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{"\[Phi]points2", "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], "]"}]}], ";"}]
RowBox[{"AbsoluteTiming", "[", RowBox[{RowBox[{"func", "[", "\[Phi]points1", "]"}], ";"}], "]"}]
RowBox[{RowBox[{"func", "[", RowBox[{"1", "/", "1000"}], "]"}], "-", RowBox[{"inv\[Theta]", "[", RowBox[{"1", "/", "1000"}], "]"}]}]
RowBox[{RowBox[{"func", "=", RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "1000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "1000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Hermite\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y", "=", RowBox[{"func", "[", "\[Phi]points1", "]"}]}], ";"}]
RowBox[{RowBox[{"posA2y", "=", RowBox[{"func", "[", "\[Phi]points2", "]"}]}], ";"}]
RowBox[{RowBox[{"posB2y", "=", RowBox[{"func", "[", RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{"\[Theta]points", ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{"\[Phi]points2", "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"func", "=", RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "513", ",", "1000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "513", ",", "1000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Hermite\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y", "=", RowBox[{"func", "[", "\[Phi]points1", "]"}]}], ";"}]
RowBox[{RowBox[{"posA2y", "=", RowBox[{"func", "[", "\[Phi]points2", "]"}]}], ";"}]
RowBox[{RowBox[{"posB2y", "=", RowBox[{"func", "[", RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{"\[Theta]points", ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{"\[Phi]points2", "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "func", "]"}], ";"}]
RowBox[{RowBox[{"func", "=", RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "513", ",", "1000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "513", ",", "1000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Hermite\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"func", "[", RowBox[{"1", "/", "1000"}], "]"}], "-", RowBox[{"inv\[Theta]", "[", RowBox[{"1", "/", "1000"}], "]"}]}]
RowBox[{RowBox[{"Clear", "[", "func", "]"}], ";"}]
RowBox[{RowBox[{"func", "=", RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"1.", RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "1000"}], "]"}], "]"}]}], ",", RowBox[{"1.", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "1000"}], "]"}]}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Hermite\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y", "=", RowBox[{"func", "[", "\[Phi]points1", "]"}]}], ";"}]
RowBox[{RowBox[{"posA2y", "=", RowBox[{"func", "[", "\[Phi]points2", "]"}]}], ";"}]
RowBox[{RowBox[{"posB2y", "=", RowBox[{"func", "[", RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{"\[Theta]points", ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{"\[Phi]points2", "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], "]"}]}], ";"}]
RowBox[{"AbsoluteTiming", "[", RowBox[{RowBox[{"func", "[", "\[Phi]points1", "]"}], ";"}], "]"}]
RowBox[{RowBox[{"func", "[", RowBox[{"1", "/", "1000"}], "]"}], "-", RowBox[{"inv\[Theta]", "[", RowBox[{"1", "/", "1000"}], "]"}]}]
RowBox[{RowBox[{"Clear", "[", "func", "]"}], ";"}]
RowBox[{RowBox[{"func", "=", RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "1000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "1000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Hermite\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y", "=", RowBox[{"func", "[", "\[Phi]points1", "]"}]}], ";"}]
RowBox[{RowBox[{"posA2y", "=", RowBox[{"func", "[", "\[Phi]points2", "]"}]}], ";"}]
RowBox[{RowBox[{"posB2y", "=", RowBox[{"func", "[", RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{"\[Theta]points", ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{"\[Phi]points2", "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], "]"}]}], ";"}]
RowBox[{"AbsoluteTiming", "[", RowBox[{RowBox[{"func", "[", "\[Phi]points1", "]"}], ";"}], "]"}]
RowBox[{RowBox[{"Clear", "[", "func", "]"}], ";"}]
RowBox[{RowBox[{"func", "=", RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "1000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "1000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y", "=", RowBox[{"func", "[", "\[Phi]points1", "]"}]}], ";"}]
RowBox[{RowBox[{"posA2y", "=", RowBox[{"func", "[", "\[Phi]points2", "]"}]}], ";"}]
RowBox[{RowBox[{"posB2y", "=", RowBox[{"func", "[", RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{"\[Theta]points", ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{"\[Phi]points2", "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], "]"}]}], ";"}]
RowBox[{"AbsoluteTiming", "[", RowBox[{RowBox[{"func", "[", "\[Phi]points1", "]"}], ";"}], "]"}]
RowBox[{RowBox[{"func", "[", RowBox[{"1", "/", "1000"}], "]"}], "-", RowBox[{"inv\[Theta]", "[", RowBox[{"1", "/", "1000"}], "]"}]}]
RowBox[{RowBox[{"Clear", "[", "func", "]"}], ";"}]
RowBox[{RowBox[{"func", "=", RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "100000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "100000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y", "=", RowBox[{"func", "[", "\[Phi]points1", "]"}]}], ";"}]
RowBox[{RowBox[{"posA2y", "=", RowBox[{"func", "[", "\[Phi]points2", "]"}]}], ";"}]
RowBox[{RowBox[{"posB2y", "=", RowBox[{"func", "[", RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{"\[Theta]points", ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{"\[Phi]points2", "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], "]"}]}], ";"}]
RowBox[{"AbsoluteTiming", "[", RowBox[{RowBox[{"func", "[", "\[Phi]points1", "]"}], ";"}], "]"}]
RowBox[{RowBox[{"func", "[", RowBox[{"1", "/", "1000"}], "]"}], "-", RowBox[{"inv\[Theta]", "[", RowBox[{"1", "/", "1000"}], "]"}]}]
RowBox[{RowBox[{"Clear", "[", "func", "]"}], ";"}]
RowBox[{RowBox[{"func", "=", RowBox[{"Interpolation", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}], "]"}], ",", RowBox[{"Subdivide", "[", RowBox[{"1", ",", "512", ",", "10000"}], "]"}]}], "}"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y", "=", RowBox[{"func", "[", "\[Phi]points1", "]"}]}], ";"}]
RowBox[{RowBox[{"posA2y", "=", RowBox[{"func", "[", "\[Phi]points2", "]"}]}], ";"}]
RowBox[{RowBox[{"posB2y", "=", RowBox[{"func", "[", RowBox[{"inv\[Theta]", "[", RowBox[{RowBox[{"ConstantArray", "[", RowBox[{"\[Theta]points", ",", "len"}], "]"}], "/", RowBox[{"(", RowBox[{"\[Phi]points2", "-", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], ")"}]}], "]"}], "]"}]}], ";"}]
RowBox[{"AbsoluteTiming", "[", RowBox[{RowBox[{"func", "[", "\[Phi]points1", "]"}], ";"}], "]"}]
RowBox[{RowBox[{"func", "[", RowBox[{"1", "/", "1000"}], "]"}], "-", RowBox[{"inv\[Theta]", "[", RowBox[{"1", "/", "1000"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{"posA1y2", "-", "posA1y"}], "]"}], ",", "\[Infinity]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{"posA1y2", "-", "posA1y"}], "]"}], ",", "\[Infinity]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{"posA1y2", "-", "posA1y"}], "]"}], ",", "\[Infinity]"}], "]"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{"posA1y2", "-", "posA1y"}], "]"}], ",", "\[Infinity]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"\[Theta]func", "[", RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"phi1", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{"\[Theta]func", "[", RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}]
RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"phi1", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{"\[Theta]func", "[", RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}]
RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"phi1", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{"\[Theta]func", "[", RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}]
RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"phi1", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{"\[Theta]func", "[", RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}]
RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"phi1", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{"\[Theta]func", "[", RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}]
RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"phi1", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"\[Theta]func", "[", RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}]
RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"phi1", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"\[Theta]func", "[", RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}]
RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"512", ",", "200"}], "]"}], "]"}]
RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"512", ",", "200"}], "]"}], "]"}]
RowBox[{"\[Theta]points", "[", RowBox[{"[", "200", "]"}], "]"}]
RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"512", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"\[Theta]points", "[", RowBox[{"[", "200", "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"512", ",", "250"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"phi1", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"512", ",", "250"}], "]"}], "]"}]
RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"512", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"\[Theta]points", "[", RowBox[{"[", "200", "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"phi1", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"512", ",", "250"}], "]"}], "]"}]
RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"512", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"\[Theta]points", "[", RowBox[{"[", "200", "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"phi1", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"512", ",", "250"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"phi1", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"512", ",", "250"}], "]"}], "]"}]
RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"512", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"\[Theta]points", "[", RowBox[{"[", "200", "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"\[Theta]func", "[", RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}]
RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"phi1", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"512", ",", "250"}], "]"}], "]"}]
RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"512", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"\[Theta]points", "[", RowBox[{"[", "200", "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"\[Theta]func", "[", RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}]
RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}], "-", RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"phi1", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}], "-", RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{"posA1y2", "-", "posA1y"}], "]"}], ",", "\[Infinity]"}], "]"}]
RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{RowBox[{"\[Theta]func", "[", "posA1y2", "]"}], "-", "phi1"}], "]"}], ",", "\[Infinity]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"phi1", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{RowBox[{"\[Theta]func", "[", "posA1y2", "]"}], "-", "phi1"}], "]"}], ",", "\[Infinity]"}], "]"}]
RowBox[{RowBox[{"posA1y2", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/posA1y.dat\"", "]"}]}], ";"}]
RowBox[{RowBox[{"phi1", "=", RowBox[{"Import", "[", "\"/home/jlang/Nextcloud/Spin-glass/Codes/DMFE/Grid_data/512_new/phi1.dat\"", "]"}]}], ";"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"512", ",", "250"}], "]"}], "]"}]
RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"512", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"\[Theta]points", "[", RowBox[{"[", "200", "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{RowBox[{"\[Theta]func", "[", RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "]"}], "-", RowBox[{"phi1", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], "-", RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]}]
RowBox[{"posA1y2", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}]
RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"posA1y", "[", RowBox[{"[", RowBox[{"100", ",", "200"}], "]"}], "]"}], ",", "20"}], "]"}]
RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{"posA1y2", "-", "posA1y"}], "]"}], ",", "\[Infinity]"}], "]"}]
RowBox[{"Total", "[", RowBox[{RowBox[{"Abs", "[", RowBox[{RowBox[{"\[Theta]func", "[", "posA1y2", "]"}], "-", "phi1"}], "]"}], ",", "\[Infinity]"}], "]"}]
RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Mu]", "=", "0.81"}], "}"}], ",", RowBox[{"Plot", "[", RowBox[{RowBox[{"Exp", "[", RowBox[{FractionBox["1", RowBox[{"1", "-", "\[Mu]"}]], RowBox[{"(", RowBox[{SuperscriptBox[RowBox[{"(", "x", ")"}], RowBox[{"1", "-", "\[Mu]"}]], "-", SuperscriptBox[RowBox[{"(", "1", ")"}], RowBox[{"1", "-", "\[Mu]"}]]}], ")"}]}], "]"}], ",", RowBox[{"{", RowBox[{"x", ",", "0", ",", "1"}], "}"}]}], "]"}]}], "]"}]
