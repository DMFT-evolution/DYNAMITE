RowBox[{RowBox[{"scratch1", "=", "\"/mnt/\""}], ";"}]
RowBox[{RowBox[{"scratch2", "=", "\"/nobackups/jlang/\""}], ";"}]
RowBox[{RowBox[{"outdir", "=", "\"~/Nextcloud/Spin-glass/Codes/Compressed/\""}], ";"}]
RowBox[{RowBox[{"paramnames", "=", RowBox[{"Union", "[", RowBox[{RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch1", ",", "\"Results_new\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results_new\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results_new2\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results_HPC\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "loadparams", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"loadparams", "[", "file_", "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{RowBox[{"Import", "[", "file", "]"}], ",", "1"}], "]"}], "==", "\"#\""}], ",", RowBox[{"Module", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{RowBox[{"Clear", "[", RowBox[{"{", RowBox[{"p", ",", "p2", ",", "\[Lambda]", ",", "\[CapitalGamma]", ",", "T0", ",", "\[Delta]tMin", ",", "\[Delta]tMax", ",", "len"}], "}"}], "]"}], ";", RowBox[{RowBox[{"{", RowBox[{"p", ",", "p2", ",", "\[Lambda]", ",", "\[CapitalGamma]", ",", "T0", ",", "\[Delta]tMin", ",", "\[Delta]tMax", ",", "len"}], "}"}], "=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"data", ",", "lines", ",", "p", ",", "p2", ",", "\[Lambda]", ",", "\[CapitalGamma]", ",", "T0", ",", "\[Delta]tMin", ",", "\[Delta]tMax", ",", "len"}], "}"}], ",", RowBox[{RowBox[{"data", "=", RowBox[{"Import", "[", RowBox[{"file", ",", "\"String\""}], "]"}]}], ";", RowBox[{"lines", "=", RowBox[{"StringSplit", "[", RowBox[{"data", ",", "\"\\n\""}], "]"}]}], ";", RowBox[{RowBox[{"extractValue", "[", RowBox[{"line_", ",", "key_"}], "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"valStr", ",", "parsed"}], "}"}], ",", RowBox[{RowBox[{"valStr", "=", RowBox[{"StringReplace", "[", RowBox[{"line", ",", RowBox[{RowBox[{"key", "<>", "\" = \""}], "->", "\"\""}]}], "]"}]}], ";", RowBox[{"valStr", "=", RowBox[{"StringTrim", "[", "valStr", "]"}]}], ";", RowBox[{"parsed", "=", RowBox[{"ToExpression", "[", RowBox[{"StringReplace", "[", RowBox[{"valStr", ",", RowBox[{RowBox[{"RegularExpression", "[", "\"([eE])\"", "]"}], "->", "\"*10^\""}]}], "]"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Head", "[", "parsed", "]"}], "===", "List"}], ",", "parsed", ",", RowBox[{"N", "[", "parsed", "]"}]}], "]"}]}]}], "]"}]}], ";", RowBox[{"p", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"p = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"p\""}], "]"}]}], ";", RowBox[{"p2", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"p2 = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"p2\""}], "]"}]}], ";", RowBox[{"\[Lambda]", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"lambda = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"lambda\""}], "]"}]}], ";", RowBox[{"\[CapitalGamma]", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"Gamma = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"Gamma\""}], "]"}]}], ";", RowBox[{"T0", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"T0 = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"T0\""}], "]"}]}], ";", RowBox[{"\[Delta]tMin", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"delta_t_min = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"delta_t_min\""}], "]"}]}], ";", RowBox[{"\[Delta]tMax", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"delta_max = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"delta_max\""}], "]"}]}], ";", RowBox[{"len", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"len = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"len\""}], "]"}]}], ";", RowBox[{"{", RowBox[{"p", ",", "p2", ",", "\[Lambda]", ",", "\[CapitalGamma]", ",", "T0", ",", "\[Delta]tMin", ",", "\[Delta]tMax", ",", "len"}], "}"}]}]}], "]"}]}], ";"}]}], "]"}], ",", RowBox[{RowBox[{"Module", "[", RowBox[{RowBox[{"{", "params", "}"}], ",", RowBox[{RowBox[{"Clear", "[", "T0", "]"}], ";", RowBox[{"params", "=", RowBox[{"Import", "[", "file", "]"}]}], ";", RowBox[{"Clear", "@@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"StringTrim", "[", "#", "]"}], "&"}], "/@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{"params", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{RowBox[{"Prepend", "[", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"\\n\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "0"}], "]"}], "+", "1"}], ",", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"=\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", "1"}]}], "}"}], "]"}]}], ")"}]}], ")"}]}], ";", RowBox[{RowBox[{"Evaluate", "[", RowBox[{"ToExpression", "[", RowBox[{RowBox[{RowBox[{"StringTrim", "[", "#", "]"}], "&"}], "/@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{"params", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{RowBox[{"Prepend", "[", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"\\n\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "0"}], "]"}], "+", "1"}], ",", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"=\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", "1"}]}], "}"}], "]"}]}], ")"}]}], "]"}], "]"}], "=", RowBox[{"ToExpression", "[", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{"params", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"=\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], "+", "1"}], ",", RowBox[{"Append", "[", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"\\n\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", RowBox[{"-", "1"}]}], "]"}]}], "}"}], "]"}]}], "]"}]}], ";", RowBox[{"len", "=", RowBox[{"Round", "[", "len", "]"}]}], ";", RowBox[{"ord", "=", RowBox[{"Round", "[", "ord", "]"}]}], ";", RowBox[{"method", "=", RowBox[{"Round", "[", "method", "]"}]}], ";"}]}], "]"}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"bsearch", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Complex", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", "0"}]}], "}"}], ",", RowBox[{RowBox[{"While", "[", RowBox[{RowBox[{"n0", "<=", "n1"}], ",", RowBox[{RowBox[{"m", "=", RowBox[{"Floor", "[", RowBox[{RowBox[{"(", RowBox[{"n0", "+", "n1"}], ")"}], "/", "2"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "==", "elem"}], ",", RowBox[{"Return", "[", "m", "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "-", "elem"}], "]"}], "<=", RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"Min", "[", RowBox[{RowBox[{"m", "+", "1"}], ",", RowBox[{"Length", "[", "list", "]"}]}], "]"}], "]"}], "]"}], "-", "elem"}], "]"}]}], ",", "m", ",", RowBox[{"m", "+", "1"}]}], "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "-", "elem"}], "]"}], "<=", RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"Max", "[", RowBox[{RowBox[{"m", "-", "1"}], ",", "1"}], "]"}], "]"}], "]"}], "-", "elem"}], "]"}]}], ",", "m", ",", RowBox[{"m", "-", "1"}]}], "]"}]}], "]"}]}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"diff", ":=", RowBox[{RowBox[{RowBox[{"Rest", "[", "#", "]"}], "-", RowBox[{"Most", "[", "#", "]"}]}], "&"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x_", "]"}], ":=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Delta]", "=", RowBox[{"1", "/", RowBox[{"(", RowBox[{"10", "\[Pi]", "Tmax"}], ")"}]}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Eta]", "=", RowBox[{"Rationalize", "[", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{"1", "/", "len"}], ")"}]}], "2", RowBox[{"ProductLog", "[", RowBox[{RowBox[{"-", "1"}], ",", RowBox[{RowBox[{"-", "\[Pi]"}], "\[Delta]"}]}], "]"}]}], "]"}]}], "}"}], ",", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"x", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}], "-", RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}]}], ")"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}], "]"}]}], "-", RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}]}], "\[Eta]"}], ")"}]}], "]"}]}]}], ")"}]}]}], "]"}]}], "]"}], ",", "40"}], "]"}]}], ";"}]
RowBox[{RowBox[{"bsearchPosSorted", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", "1"}], ",", RowBox[{"Lm", "=", "1."}], ",", RowBox[{"El", "=", "1."}]}], "}"}], ",", RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"El", "=", RowBox[{"elem", "[", RowBox[{"[", "l", "]"}], "]"}]}], ";", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "El"}], ",", RowBox[{"While", "[", RowBox[{RowBox[{"n0", "<=", "n1"}], ",", RowBox[{RowBox[{"m", "=", RowBox[{"Quotient", "[", RowBox[{RowBox[{"n0", "+", "n1"}], ",", "2"}], "]"}]}], ";", RowBox[{"Lm", "=", RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "==", "El"}], ",", RowBox[{"n0", "=", "m"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "<", "El"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}]}], "]"}], ";", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "<=", "El"}], ",", RowBox[{"m", "+", RowBox[{"If", "[", RowBox[{RowBox[{"m", "==", RowBox[{"Length", "[", "list", "]"}]}], ",", "0.", ",", RowBox[{RowBox[{"(", RowBox[{"El", "-", "Lm"}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"m", "+", "1"}], "]"}], "]"}], "-", "Lm"}], ")"}]}]}], "]"}]}], ",", RowBox[{"m", "-", RowBox[{"If", "[", RowBox[{RowBox[{"m", ">", "1"}], ",", RowBox[{RowBox[{"(", RowBox[{"El", "-", "Lm"}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"m", "-", "1"}], "]"}], "]"}], "-", "Lm"}], ")"}]}], ",", "0."}], "]"}]}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"l", ",", RowBox[{"Length", "[", "elem", "]"}]}], "}"}]}], "]"}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}], ",", RowBox[{"RuntimeOptions", "->", "\"Speed\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"loadLibrary", ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"libname", "=", RowBox[{"\"Interpol-mt.\"", "<>", RowBox[{"Switch", "[", RowBox[{"$OperatingSystem", ",", "\"Unix\"", ",", "\"so\"", ",", "\"Windows\"", ",", "\"dll\"", ",", "\"MacOSX\"", ",", "\"dylib\""}], "]"}]}]}], ",", "filename"}], "}"}], ",", RowBox[{RowBox[{"filename", "=", RowBox[{"FileNames", "[", RowBox[{"libname", ",", RowBox[{"NotebookDirectory", "[", "]"}], ",", "2"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "filename", "]"}], "!=", "0"}], ",", RowBox[{RowBox[{"filename", "=", RowBox[{"filename", "[", RowBox[{"[", "1", "]"}], "]"}]}], ";", RowBox[{"Quiet", "[", RowBox[{RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Head", "[", "#", "]"}], "===", "LibraryFunction"}], ",", RowBox[{"LibraryFunctionUnload", "[", "#", "]"}]}], "]"}], "&"}], "/@", RowBox[{"Unevaluated", "[", RowBox[{"{", RowBox[{"build", ",", "clearAll", ",", "clearOne", ",", "append", ",", "deleteN", ",", "replace", ",", "replaceD", ",", "prod2", ",", "clip", ",", "output", ",", "getLast", ",", "conv", ",", "index", ",", "indexVec", ",", "indexVecN", ",", "indexVecLN", ",", "Interpol1D3c", ",", "indexVecR", ",", "indexVecR2", ",", "indexVecL", ",", "indexMat", ",", "indexMatN", ",", "indexMatN3", ",", "indexMatAll", ",", "indexMatMerge", ",", "\[CapitalSigma]Rnum", ",", "\[CapitalSigma]Knum"}], "}"}], "]"}]}], ";"}], "]"}], ";", RowBox[{"build", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"build\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"buildOne", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"buildOne\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", "Integer"}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"clearAll", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"clearAll\"", ",", RowBox[{"{", "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"clearOne", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"clearOne\"", ",", RowBox[{"{", "Integer", "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"append", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"append\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"deleteN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"deleteN\"", ",", RowBox[{"{", "Integer", "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"replace", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"replace\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"replaceD", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"replaceD\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"output", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"output\"", ",", RowBox[{"{", "Integer", "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"getLast", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"getLast\"", ",", RowBox[{"{", RowBox[{"Integer", ",", "Integer"}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"prod2", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"prod2\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"clip", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"clip\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"\[CapitalSigma]Rnum", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"sigmaR\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"\[CapitalSigma]Knum", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"sigmaK\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"conv", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"conv\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"index", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"index\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVec", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVec\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecN\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"indexVecR", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecR\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecR2", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecR2\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecL", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecL\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecLN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecLN\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"Interpol1D3c", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"Interpol1D3c\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"indexMat", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMat\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatN\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatN3", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatN3\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatAll", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatAll\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatMerge", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatMerge\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}]}], ",", RowBox[{"Clear", "[", RowBox[{"build", ",", "buildOne", ",", "clearAll", ",", "clearOne", ",", "deleteN", ",", "append", ",", "replace", ",", "replaceD", ",", "output", ",", "getLast", ",", "conv", ",", "index", ",", "indexVec", ",", "indexVecN", ",", "indexVecLN", ",", "Interpol1D3c", ",", "indexVecR", ",", "indexVecR2", ",", "indexVecL", ",", "indexMat", ",", "indexMatN", ",", "indexMatN3", ",", "indexMatAll", ",", "indexMatMerge"}], "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "conv", "]"}]}], ",", RowBox[{RowBox[{"conv", "[", RowBox[{"int_", ",", "m1_", ",", "m2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"m1", "*", "m2"}], ")"}], ".", "int"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "index", "]"}]}], ",", RowBox[{RowBox[{"index", "[", RowBox[{"list_", ",", "inds_"}], "]"}], ":=", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecL", "]"}]}], ",", RowBox[{RowBox[{"indexVecL", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "1"}], "]"}], "]"}]}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecL3", "]"}]}], ",", RowBox[{RowBox[{"indexVecL3", "[", RowBox[{"list_", ",", "weightsIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"weights", "=", RowBox[{"ArrayReshape", "[", RowBox[{"weightsIn", ",", RowBox[{"{", RowBox[{RowBox[{"len", "^", "2"}], ",", RowBox[{RowBox[{"Length", "[", "weightsIn", "]"}], "/", RowBox[{"len", "^", "2"}]}]}], "}"}]}], "]"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{"Sum", "[", RowBox[{RowBox[{RowBox[{"weights", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"n", "+", "1"}]}], "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "n"}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", RowBox[{"weights", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVec", "]"}]}], ",", RowBox[{RowBox[{"indexVec", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "indsIn", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecR", "]"}]}], ",", RowBox[{RowBox[{"indexVecR", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "indsIn", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecR2", "]"}]}], ",", RowBox[{RowBox[{"indexVecR2", "[", RowBox[{"list_", ",", "dlist_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_", ",", "\[Delta]tratio_"}], "]"}], ":=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"\[CapitalDelta]xvecIn", "^", "2"}]}], ")"}], "*", RowBox[{"list", "[", RowBox[{"[", "indsIn", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "^", "2"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"\[CapitalDelta]xvecIn", "-", RowBox[{"\[CapitalDelta]xvecIn", "^", "2"}]}], ")"}], "*", RowBox[{"dlist", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexMat", "]"}]}], ",", RowBox[{RowBox[{"indexMat", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "\[CapitalDelta]yvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}], ",", RowBox[{"\[CapitalDelta]yvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]yvecIn"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "1"}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "len"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", RowBox[{"(", RowBox[{"len", "+", "1"}], ")"}]}], "]"}], "]"}]}]}], ")"}]}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexMat3", "]"}]}], ",", RowBox[{RowBox[{"indexMat3", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "weightsyIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}], ",", RowBox[{"weightsy", "=", RowBox[{"ArrayReshape", "[", RowBox[{"weightsyIn", ",", RowBox[{"{", RowBox[{RowBox[{"len", "^", "2"}], ",", RowBox[{RowBox[{"Length", "[", "weightsyIn", "]"}], "/", RowBox[{"len", "^", "2"}]}]}], "}"}]}], "]"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"Sum", "[", RowBox[{RowBox[{RowBox[{"weightsy", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"n", "+", "1"}]}], "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "n"}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", RowBox[{"weightsy", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"Sum", "[", RowBox[{RowBox[{RowBox[{"weightsy", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"n", "+", "1"}]}], "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", RowBox[{"(", RowBox[{"n", "+", "len"}], ")"}]}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", RowBox[{"weightsy", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}]}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexMatMerge", "]"}]}], ",", RowBox[{RowBox[{"indexMatMerge", "[", RowBox[{"list_", ",", "defaultlist_", ",", "\[CapitalDelta]xvecIn_", ",", "\[CapitalDelta]yvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"mask", "=", RowBox[{"Subtract", "[", RowBox[{"1", ",", RowBox[{"UnitStep", "[", RowBox[{"-", "indsIn"}], "]"}]}], "]"}]}], ",", RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}], ",", RowBox[{"\[CapitalDelta]yvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]yvecIn"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{"mask", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "1"}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "len"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", RowBox[{"(", RowBox[{"len", "+", "1"}], ")"}]}], "]"}], "]"}]}]}], ")"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"1", "-", "mask"}], ")"}], "defaultlist"}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"buildLowMem", "[", RowBox[{"fac_", ":", "1"}], "]"}], ":=", RowBox[{"(", RowBox[{RowBox[{"buildOne", "[", RowBox[{"QK", ",", "1"}], "]"}], ";", RowBox[{"QK", "=", RowBox[{"QK", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{"buildOne", "[", RowBox[{"QR", ",", "2"}], "]"}], ";", RowBox[{"QR", "=", RowBox[{"QR", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{"buildOne", "[", RowBox[{RowBox[{"fac", "dQK"}], ",", "3"}], "]"}], ";", RowBox[{"dQK", "=", RowBox[{"dQK", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{"buildOne", "[", RowBox[{RowBox[{"fac", "dQR"}], ",", "4"}], "]"}], ";", RowBox[{"dQR", "=", RowBox[{"dQR", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";"}], ")"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"SaveCompressed", "[", RowBox[{"file_String", ",", RowBox[{"mat_", "?", "MatrixQ"}]}], "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"rows", "=", RowBox[{"Length", "[", "mat", "]"}]}], ",", RowBox[{"cols", "=", RowBox[{"Length", "[", RowBox[{"First", "@", "mat"}], "]"}]}], ",", "htype", ",", "s"}], "}"}], ",", RowBox[{RowBox[{"htype", "=", RowBox[{"If", "[", RowBox[{RowBox[{"$SystemWordLength", "==", "64"}], ",", "\"UnsignedInteger64\"", ",", "\"UnsignedInteger32\""}], "]"}]}], ";", RowBox[{"s", "=", RowBox[{"OpenWrite", "[", RowBox[{"file", ",", RowBox[{"BinaryFormat", "->", "True"}]}], "]"}]}], ";", RowBox[{"BinaryWrite", "[", RowBox[{"s", ",", "rows", ",", "htype", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}], ";", RowBox[{"BinaryWrite", "[", RowBox[{"s", ",", "cols", ",", "htype", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}], ";", RowBox[{"BinaryWrite", "[", RowBox[{"s", ",", RowBox[{"N", "@", RowBox[{"Flatten", "[", "mat", "]"}]}], ",", "\"Real64\"", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}], ";", RowBox[{"Close", "[", "s", "]"}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"LoadCompressed", "[", "file_String", "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"try", ",", "rows", ",", "cols", ",", "cnt", ",", "data", ",", "s", ",", "headerBytes", ",", "fileBytes"}], "}"}], ",", RowBox[{RowBox[{RowBox[{"try", "[", "htype_", "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{RowBox[{"s", "=", RowBox[{"OpenRead", "[", RowBox[{"file", ",", RowBox[{"BinaryFormat", "->", "True"}]}], "]"}]}], ";", RowBox[{"rows", "=", RowBox[{"BinaryRead", "[", RowBox[{"s", ",", "htype", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}]}], ";", RowBox[{"cols", "=", RowBox[{"BinaryRead", "[", RowBox[{"s", ",", "htype", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"!", RowBox[{"IntegerQ", "[", "rows", "]"}]}], "||", RowBox[{"!", RowBox[{"IntegerQ", "[", "cols", "]"}]}], "||", RowBox[{"rows", "<=", "0"}], "||", RowBox[{"cols", "<=", "0"}]}], ",", RowBox[{RowBox[{"Close", "[", "s", "]"}], ";", RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", RowBox[{"headerBytes", "=", RowBox[{"2", "*", RowBox[{"If", "[", RowBox[{RowBox[{"htype", "===", "\"UnsignedInteger64\""}], ",", "8", ",", "4"}], "]"}]}]}], ";", RowBox[{"fileBytes", "=", RowBox[{"FileByteCount", "[", "file", "]"}]}], ";", RowBox[{"cnt", "=", RowBox[{"rows", "*", "cols"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"fileBytes", "<", RowBox[{"headerBytes", "+", RowBox[{"8", "cnt"}]}]}], ",", RowBox[{RowBox[{"Close", "[", "s", "]"}], ";", RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", RowBox[{"data", "=", RowBox[{"BinaryReadList", "[", RowBox[{"s", ",", "\"Real64\"", ",", "cnt", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}]}], ";", RowBox[{"Close", "[", "s", "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "data", "]"}], "==", "cnt"}], ",", RowBox[{"Partition", "[", RowBox[{"data", ",", "cols"}], "]"}], ",", "$Failed"}], "]"}]}]}], "]"}]}], ";", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"m64", "=", RowBox[{"try", "[", "\"UnsignedInteger64\"", "]"}]}], "}"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"m64", "=!=", "$Failed"}], ",", "m64", ",", RowBox[{"try", "[", "\"UnsignedInteger32\"", "]"}]}], "]"}]}], "]"}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "splineCoeffs", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"SyntaxInformation", "[", "splineCoeffs", "]"}], "=", RowBox[{"{", RowBox[{"\"ArgumentsPattern\"", "->", RowBox[{"{", RowBox[{"_", ",", RowBox[{"OptionsPattern", "[", "]"}]}], "}"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{"SetAttributes", "[", RowBox[{"splineCoeffs", ",", "HoldAll"}], "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "splineCoeffs", "]"}], "=", RowBox[{"{", RowBox[{RowBox[{"\"Five\"", "->", "False"}], ",", RowBox[{"\"Last\"", "->", "False"}], ",", RowBox[{"\"All\"", "->", "False"}], ",", RowBox[{"\"Mixed\"", "->", "True"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"splineCoeffs", "::", "padInput"}], "=", "\"interpolation matrices cannot be generated from a precomputed second-highest coefficient matrix when the padding is set to be non-zero.\""}], ";"}]
RowBox[{RowBox[{"splineCoeffs", "[", RowBox[{RowBox[{"{", RowBox[{"points_", ",", RowBox[{"cmatIn_", ":", "0"}], ",", RowBox[{"precIn_", ":", "precision"}], ",", RowBox[{"padding_", ":", "15"}]}], "}"}], ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"pts", ",", "h", ",", "rot", ",", "n", ",", "id", ",", "amat", ",", "bmat", ",", "cmat", ",", "cmat2", ",", "dmat", ",", "emat", ",", "emat2", ",", "fmat", ",", "prec", ",", "padfc", ",", "padfcT", ",", "mixed"}], "}"}], ",", RowBox[{RowBox[{"mixed", "=", RowBox[{RowBox[{"OptionValue", "[", "\"Mixed\"", "]"}], "&&", RowBox[{"(", RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ")"}], "&&", RowBox[{"(", RowBox[{"padding", "!=", "0"}], ")"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"!", RowBox[{"(", RowBox[{"cmatIn", "===", "0"}], ")"}]}], "&&", RowBox[{"padding", "!=", "0"}]}], ",", RowBox[{RowBox[{"Message", "[", RowBox[{"splineCoeffs", "::", "padInput"}], "]"}], ";"}], ",", RowBox[{RowBox[{RowBox[{"padfc", "[", "x_", "]"}], ":=", RowBox[{"x", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], ";", RowBox[{RowBox[{"padfcT", "[", "x_", "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "x", "]"}], ">", RowBox[{"Length", "[", "points", "]"}]}], ",", RowBox[{"x", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], "]"}], "]"}], ",", "x"}], "]"}]}], ";", RowBox[{"prec", "=", RowBox[{"If", "[", RowBox[{RowBox[{"cmatIn", "===", "0"}], ",", "precIn", ",", RowBox[{"Precision", "[", "cmatIn", "]"}]}], "]"}]}], ";", RowBox[{"pts", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"Join", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "points", ",", RowBox[{"Join", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], "-", RowBox[{"Reverse", "[", RowBox[{"Range", "[", "padding", "]"}], "]"}]}], ",", "points"}], "]"}]}], "]"}], ",", RowBox[{RowBox[{"points", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{"Range", "[", "padding", "]"}]}]}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"h", "=", RowBox[{"Subtract", "[", RowBox[{RowBox[{"RotateLeft", "[", "pts", "]"}], ",", "pts"}], "]"}]}], ";", RowBox[{"n", "=", RowBox[{"Length", "[", "pts", "]"}]}], ";", RowBox[{"rot", "=", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{RowBox[{"Band", "[", RowBox[{"{", RowBox[{"1", ",", "1"}], "}"}], "]"}], "->", RowBox[{"-", "1"}]}], ",", RowBox[{RowBox[{"Band", "[", RowBox[{"{", RowBox[{"1", ",", "2"}], "}"}], "]"}], "->", "1"}]}], "}"}], ",", RowBox[{"{", RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", RowBox[{"id", "=", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"Band", "[", RowBox[{"{", RowBox[{"1", ",", "1"}], "}"}], "]"}], "->", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Five\"", "]"}]}], ",", RowBox[{RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"g0c", ",", "g1c", ",", "coefc", ",", "coefc2", ",", "Bc", ",", "Bc2", ",", "\[CapitalDelta]\[Omega]"}], "}"}], ",", RowBox[{RowBox[{"g0c", "=", RowBox[{RowBox[{"1", "/", "3"}], "rot"}]}], ";", RowBox[{"g1c", "=", RowBox[{RowBox[{"(", RowBox[{"id", "+", "g0c"}], ")"}], RowBox[{"(", RowBox[{"3", "h"}], ")"}]}]}], ";", RowBox[{"coefc", "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"Most", "[", RowBox[{RowBox[{"(", RowBox[{"6", "h"}], ")"}], "id"}], "]"}], "+", RowBox[{"Most", "[", RowBox[{RowBox[{"(", RowBox[{"9", "h"}], ")"}], "g0c"}], "]"}], "+", RowBox[{"diff", "[", "g1c", "]"}]}], ")"}], "/", RowBox[{"Most", "[", "h", "]"}]}]}], ";", RowBox[{"Bc", "=", RowBox[{RowBox[{"diff", "[", RowBox[{"rot", "/", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "/", "3"}], ")"}], "h"}], ")"}]}], "]"}], "/", RowBox[{"Most", "[", "h", "]"}]}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{RowBox[{"coefc2", "=", RowBox[{"coefc", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], ";", RowBox[{"coefc2", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], "+", RowBox[{"RotateRight", "[", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"Most", "[", "coefc2", "]"}], ",", RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"-", "padding"}], "-", "1"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], "+", RowBox[{"RotateLeft", "[", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"-", "padding"}], "-", "1"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}], "]"}]}], "}"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";"}]}], "]"}], ";", RowBox[{"coefc", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", "1", "]"}], "]"}]}], "+", RowBox[{"RotateRight", "[", RowBox[{"id", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"Most", "[", "coefc", "]"}], ",", RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "+", RowBox[{"RotateLeft", "[", RowBox[{"id", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bc", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"zer", "=", RowBox[{"ConstantArray", "[", RowBox[{"0", ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", RowBox[{"n", "-", "padding"}], ",", RowBox[{"n", "-", RowBox[{"2", "padding"}]}]}], "]"}]}], "]"}]}], "}"}], ",", RowBox[{"Catenate", "[", RowBox[{"{", RowBox[{RowBox[{"{", "zer", "}"}], ",", RowBox[{"Most", "[", RowBox[{"padfc", "[", RowBox[{"Normal", "[", "Bc", "]"}], "]"}], "]"}], ",", RowBox[{"{", "zer", "}"}]}], "}"}], "]"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bc2", "=", RowBox[{"Bc", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{RowBox[{"Bc2", "[", RowBox[{"[", RowBox[{"{", RowBox[{RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], "]"}], "*=", "0"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"cmatIn", "===", "0"}], ",", RowBox[{RowBox[{"cmat", "=", RowBox[{"LinearSolve", "[", RowBox[{"coefc", ",", "Bc"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{"cmat2", "=", RowBox[{"LinearSolve", "[", RowBox[{"coefc2", ",", "Bc2"}], "]"}]}]}], "]"}]}], ",", RowBox[{RowBox[{"cmat", "=", "cmatIn"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"SquareMatrixQ", "[", "cmat", "]"}]}], ",", RowBox[{"cmat", "=", RowBox[{"ArrayFlatten", "[", RowBox[{"{", RowBox[{RowBox[{"{", "cmat", "}"}], ",", RowBox[{"{", RowBox[{"{", RowBox[{RowBox[{"-", RowBox[{"cmat", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "/", "2"}], "}"}], "}"}]}], "}"}], "]"}]}]}], "]"}], ";"}]}], "]"}], ";", RowBox[{"dmat", "=", RowBox[{RowBox[{"diff", "[", "cmat", "]"}], "/", RowBox[{"(", RowBox[{"3", RowBox[{"Most", "[", "h", "]"}]}], ")"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ",", RowBox[{RowBox[{"rot", "=", RowBox[{"padfc", "[", "rot", "]"}]}], ";", RowBox[{"id", "=", RowBox[{"padfc", "[", "id", "]"}]}], ";", RowBox[{"\[CapitalDelta]\[Omega]", "=", RowBox[{"Most", "[", "h", "]"}]}], ";", RowBox[{"bmat", "=", RowBox[{RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "-", RowBox[{"\[CapitalDelta]\[Omega]", RowBox[{"(", RowBox[{RowBox[{"Most", "[", "cmat", "]"}], "+", RowBox[{RowBox[{"diff", "[", "cmat", "]"}], "/", "3"}]}], ")"}]}]}]}], ";", RowBox[{"amat", "=", RowBox[{"Most", "[", "id", "]"}]}], ";", RowBox[{"cmat", "=", RowBox[{"If", "[", RowBox[{"mixed", ",", "cmat2", ",", RowBox[{"Most", "[", "cmat", "]"}]}], "]"}]}]}]}], "]"}]}]}], "]"}], ";"}], ",", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"g0q", ",", "g1q", ",", "g2q", ",", "g3q", ",", "coefq", ",", "coefq2", ",", "Bq", ",", "Bq2", ",", "\[CapitalDelta]\[Omega]"}], "}"}], ",", RowBox[{RowBox[{"g0q", "=", RowBox[{RowBox[{"1", "/", "5"}], "rot"}]}], ";", RowBox[{"g1q", "=", RowBox[{"g0q", "+", "id"}]}], ";", RowBox[{"g2q", "=", RowBox[{RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"2", RowBox[{"h", "^", "2"}]}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"3", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], "+", RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"5", RowBox[{"h", "^", "2"}]}], ")"}], "g0q"}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], ")"}]}], "+", RowBox[{"diff", "[", RowBox[{"g1q", RowBox[{"h", "^", "3"}]}], "]"}]}]}], ";", RowBox[{"g3q", "=", RowBox[{RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"2", "h"}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"3", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], "+", RowBox[{"4", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], "+", RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"g0q", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"10", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], ")"}], RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], ")"}]}], "+", RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"4", "h"}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{RowBox[{"g0q", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{"10", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], ")"}]}]}], ")"}], RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}], "^", "2"}]}], "+", "g2q"}], ")"}]}], "]"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"cmatIn", "===", "0"}], ",", RowBox[{RowBox[{"coefq", "=", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"4", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"4", "h"}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], "+", RowBox[{RowBox[{"g0q", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{"10", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}]}], ")"}]}], "+", RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], "g3q"}], "]"}]}], ")"}]}]}], ";", RowBox[{"Bq", "=", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"4", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"diff", "[", RowBox[{"rot", "/", "h"}], "]"}]}], "]"}]}], "]"}]}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{RowBox[{"coefq2", "=", RowBox[{"coefq", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], ";", RowBox[{"coefq2", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], "+", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}], ",", RowBox[{"Most", "[", "coefq2", "]"}], ",", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{RowBox[{"-", "padding"}], "-", "2"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";"}]}], "]"}], ";", RowBox[{"coefq", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"id", "[", RowBox[{"[", RowBox[{";;", "2"}], "]"}], "]"}], ",", RowBox[{"coefq", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], ",", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{"-", "2"}], ";;"}], "]"}], "]"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bq", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"zer", "=", RowBox[{"ConstantArray", "[", RowBox[{"0", ",", RowBox[{"{", RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], "}"}], ",", RowBox[{"padfc", "[", RowBox[{"Catenate", "[", RowBox[{"{", RowBox[{RowBox[{"zer", "[", RowBox[{"[", RowBox[{";;", "2"}], "]"}], "]"}], ",", RowBox[{"Normal", "[", RowBox[{"Bq", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "]"}], ",", RowBox[{"zer", "[", RowBox[{"[", RowBox[{RowBox[{"-", "2"}], ";;"}], "]"}], "]"}]}], "}"}], "]"}], "]"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bq2", "=", RowBox[{"Bq", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{RowBox[{"Bq2", "[", RowBox[{"[", RowBox[{"1", ";;", "2"}], "]"}], "]"}], "*=", "0"}], ";", RowBox[{RowBox[{"Bq2", "[", RowBox[{"[", RowBox[{RowBox[{"-", "2"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}], "*=", "0"}], ";", RowBox[{"emat", "=", RowBox[{"Chop", "[", RowBox[{RowBox[{"LinearSolve", "[", RowBox[{"coefq", ",", "Bq"}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{"emat2", "=", RowBox[{"Chop", "[", RowBox[{RowBox[{"LinearSolve", "[", RowBox[{"coefq2", ",", "Bq2"}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], "]"}]}]}], "]"}], ";"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"SquareMatrixQ", "[", "emat", "]"}]}], ",", RowBox[{"emat", "=", RowBox[{"ArrayFlatten", "[", RowBox[{"{", RowBox[{RowBox[{"{", "cmatIn", "}"}], ",", RowBox[{"{", RowBox[{"{", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{"{", "n", "}"}]}], "]"}], "}"}], "}"}]}], "}"}], "]"}]}]}], "]"}], ";"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ",", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "=", RowBox[{"Most", "[", "h", "]"}]}], ";", RowBox[{"fmat", "=", RowBox[{RowBox[{"diff", "[", "emat", "]"}], "/", RowBox[{"(", RowBox[{"5", "\[CapitalDelta]\[Omega]"}], ")"}]}]}], ";", RowBox[{"rot", "=", RowBox[{"padfc", "[", "rot", "]"}]}], ";", RowBox[{"id", "=", RowBox[{"padfc", "[", "id", "]"}]}], ";", RowBox[{"dmat", "=", RowBox[{"Catenate", "[", RowBox[{RowBox[{RowBox[{"FoldList", "[", RowBox[{RowBox[{RowBox[{"{", RowBox[{"(", RowBox[{RowBox[{"#1", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"(", RowBox[{"4", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}]}], ")"}], RowBox[{"emat", "[", RowBox[{"[", RowBox[{"#2", "-", "1"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"10", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}], "^", "2"}]}], ")"}], RowBox[{"fmat", "[", RowBox[{"[", "#2", "]"}], "]"}]}]}], ")"}], "}"}], "&"}], ",", "#", ",", RowBox[{"{", RowBox[{RowBox[{"-", "3"}], ",", RowBox[{"-", "2"}]}], "}"}]}], "]"}], "&"}], "@", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"diff", "[", RowBox[{RowBox[{"diff", "[", RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "]"}], "/", RowBox[{"(", RowBox[{RowBox[{"Most", "[", "\[CapitalDelta]\[Omega]", "]"}], "+", RowBox[{"Rest", "[", "\[CapitalDelta]\[Omega]", "]"}]}], ")"}]}], "]"}], "-", RowBox[{"Most", "[", RowBox[{"g3q", ".", "emat"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], ")"}]}], "]"}]}], ";", RowBox[{"cmat", "=", RowBox[{"Catenate", "[", RowBox[{RowBox[{RowBox[{"FoldList", "[", RowBox[{RowBox[{RowBox[{"{", RowBox[{"(", RowBox[{RowBox[{"#1", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"(", RowBox[{"3", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}]}], ")"}], RowBox[{"dmat", "[", RowBox[{"[", "#2", "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"6", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}], "^", "2"}]}], ")"}], RowBox[{"emat", "[", RowBox[{"[", RowBox[{"#2", "-", "1"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"10", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}], "^", "3"}]}], ")"}], RowBox[{"fmat", "[", RowBox[{"[", "#2", "]"}], "]"}]}]}], ")"}], "}"}], "&"}], ",", "#", ",", RowBox[{"{", RowBox[{"-", "2"}], "}"}]}], "]"}], "&"}], "@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"diff", "[", RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "]"}], "-", RowBox[{"diff", "[", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "^", "2"}], "dmat"}], "]"}], "-", RowBox[{"Most", "[", RowBox[{"g2q", ".", "emat"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"Most", "[", "\[CapitalDelta]\[Omega]", "]"}], "+", RowBox[{"Rest", "[", "\[CapitalDelta]\[Omega]", "]"}]}], ")"}]}], "-", RowBox[{RowBox[{"(", RowBox[{"3", RowBox[{"Most", "[", "\[CapitalDelta]\[Omega]", "]"}]}], ")"}], RowBox[{"Most", "[", "dmat", "]"}]}]}], ")"}]}], "]"}]}], ";", RowBox[{"bmat", "=", RowBox[{RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "-", RowBox[{"\[CapitalDelta]\[Omega]", "cmat"}], "-", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "^", "2"}], "dmat"}], "-", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "^", "3"}], RowBox[{"Most", "[", RowBox[{"g1q", ".", "emat"}], "]"}]}]}]}], ";", RowBox[{"amat", "=", RowBox[{"Most", "[", "id", "]"}]}], ";", RowBox[{"emat", "=", RowBox[{"If", "[", RowBox[{"mixed", ",", "emat2", ",", RowBox[{"Most", "[", "emat", "]"}]}], "]"}]}], ";"}], ",", RowBox[{RowBox[{"fmat", "=", RowBox[{RowBox[{"diff", "[", "emat", "]"}], "/", RowBox[{"(", RowBox[{"5", RowBox[{"Most", "[", "h", "]"}]}], ")"}]}]}], ";", RowBox[{"emat", "=", RowBox[{"Most", "[", "emat", "]"}]}], ";"}]}], "]"}]}]}], "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", RowBox[{RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "#", ",", RowBox[{"padfcT", "[", "#", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}], "&"}], "/@", RowBox[{"{", RowBox[{"amat", ",", "bmat", ",", "cmat", ",", "dmat", ",", "emat", ",", "fmat"}], "}"}]}], ",", RowBox[{RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "#", ",", RowBox[{"padfcT", "[", "#", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}], "&"}], "/@", RowBox[{"{", RowBox[{"amat", ",", "bmat", ",", "cmat", ",", "dmat"}], "}"}]}]}], "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "fmat", ",", RowBox[{"padfcT", "[", "fmat", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}], ",", RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "dmat", ",", RowBox[{"padfcT", "[", "dmat", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}]}], "]"}]}], "]"}]}]}], "]"}]}]}], "]"}]}]
RowBox[{RowBox[{"Clear", "[", "createInt", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "createInt", "]"}], "=", RowBox[{"{", RowBox[{"\"Five\"", "->", "False"}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"createInt", "[", RowBox[{RowBox[{"{", RowBox[{"\[Tau]pts_", ",", RowBox[{"cmatIn_", ":", "0"}], ",", RowBox[{"prec_", ":", "precision"}]}], "}"}], ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Quiet", "[", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"IL4jk", ",", "IL6jk", ",", "f0", ",", "f1", ",", "f2", ",", "f3", ",", "f4", ",", "f5", ",", RowBox[{"Len", "=", RowBox[{"Length", "[", "\[Tau]pts", "]"}]}]}], "}"}], ",", RowBox[{RowBox[{RowBox[{"f0", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"-", "\[Omega]1"}], "+", "\[Omega]2"}]}], ";", RowBox[{RowBox[{"f1", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "2"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "2"}]}]}], ";", RowBox[{RowBox[{"f2", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "3"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "3"}]}]}], ";", RowBox[{RowBox[{"f3", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "4"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "4"}]}]}], ";", RowBox[{RowBox[{"f4", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "5"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "5"}]}]}], ";", RowBox[{RowBox[{"f5", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "6"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "6"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", RowBox[{"IL6jk", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"f0", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f1", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f2", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f3", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f4", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f5", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}]}], "}"}], ",", "prec"}], "]"}]}], ",", RowBox[{"IL4jk", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"f0", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f1", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f2", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f3", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}]}], "}"}], ",", "prec"}], "]"}]}]}], "]"}], ";", RowBox[{"Integrator", "=", RowBox[{"Accumulate", "[", RowBox[{"Prepend", "[", RowBox[{RowBox[{"Total", "[", RowBox[{"MapThread", "[", RowBox[{"Times", ",", RowBox[{"{", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", "IL6jk", ",", "IL4jk"}], "]"}], ",", RowBox[{RowBox[{"splineCoeffs", "[", RowBox[{RowBox[{"{", RowBox[{"\[Tau]pts", ",", "cmatIn", ",", "prec", ",", "0"}], "}"}], ",", RowBox[{"\"Five\"", "->", RowBox[{"OptionValue", "[", "\"Five\"", "]"}]}]}], "]"}], "+", RowBox[{"10.", "^", RowBox[{"-", "200"}]}]}]}], "}"}]}], "]"}], "]"}], ",", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{"Length", "[", "\[Tau]pts", "]"}]}], "]"}]}], "]"}], "]"}]}], ";", RowBox[{"int", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"Integrator", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "]"}]}]}]}], "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"f\[Lambda]", "[", "q_", "]"}], ":=", RowBox[{RowBox[{"\[Lambda]", RowBox[{"q", "^", "p"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"1", "-", "\[Lambda]"}], ")"}], RowBox[{"q", "^", "p2"}]}]}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Energy", "[", RowBox[{"QK_", ",", "QR_", ",", "t_", ",", "\[Beta]_"}], "]"}], ":=", RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"t", RowBox[{RowBox[{"(", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "QK", "]"}], "*", "QR"}], ")"}], ".", "int"}]}], "+", RowBox[{"\[Beta]", RowBox[{"f\[Lambda]", "[", RowBox[{"If", "[", RowBox[{RowBox[{"MatrixQ", "[", "QK", "]"}], ",", RowBox[{"QK", "[", RowBox[{"[", RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", RowBox[{"QK", "[", RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}]}], ")"}]}]}], ";"}]
RowBox[{RowBox[{"Eth", ":=", RowBox[{RowBox[{"Sqrt", "[", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{RowBox[{"f\[Lambda]", "[", "1", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}], "-", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}], "-", RowBox[{RowBox[{"f\[Lambda]", "[", "1", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}]}], ")"}]}]}], ";"}]
RowBox[{RowBox[{"outparamnames", "=", RowBox[{"Union", "[", RowBox[{RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", "outdir", ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{"outparamnames", "[", RowBox[{"[", RowBox[{"-", "8"}], "]"}], "]"}]
RowBox[{RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"loadparams", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "i", "]"}], "]"}], "]"}], ";", RowBox[{"dir", "=", RowBox[{"FileNameTake", "[", RowBox[{RowBox[{"outparamnames", "[", RowBox[{"[", "i", "]"}], "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"-", "2"}]}], "}"}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "T0", "]"}]}], "||", RowBox[{"T0", ">=", SuperscriptBox["10", "50"]}]}], ")"}], "&&", RowBox[{"p", "==", "3"}], "&&", RowBox[{"p2", "==", "3"}], "&&", RowBox[{"\[Gamma]", "==", "0"}]}], ",", RowBox[{"Print", "[", RowBox[{"{", RowBox[{"i", ",", "T0", ",", "len", ",", "\[Lambda]"}], "}"}], "]"}], ",", RowBox[{RowBox[{"##", "&"}], "[", "]"}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"i", ",", RowBox[{"Length", "[", "outparamnames", "]"}]}], "}"}]}], "]"}], ";"}]
{295, T0, 512, 0.5}
{321, T0, 512, 0.5}
{327, T0, 1024, 0.5}
{707, Infinity, 512, 0.5}
           50
{731, 1. 10  , 512., 0.3}
           50
{732, 1. 10  , 512., 0.3}
           50
{733, 1. 10  , 512., 0.3}
           50
{734, 1. 10  , 2048., 0.3}
           50
{735, 1. 10  , 1024., 0.3}
           50
{736, 1. 10  , 1024., 0.3}
           50
{737, 1. 10  , 512., 0.3}
           50
{738, 1. 10  , 2048., 0.3}
           50
{739, 1. 10  , 1024., 0.3}
           50
{740, 1. 10  , 2048., 0.3}
RowBox[{RowBox[{"corrs", "=", RowBox[{"Table", "[", RowBox[{RowBox[{"Most", "[", RowBox[{"Import", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{RowBox[{"DirectoryName", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "n", "]"}], "]"}], "]"}], ",", "\"correlation.txt\""}], "}"}], "]"}], ",", "\"Table\""}], "]"}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", "731", ",", "740"}], "}"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"n", ",", "x_"}], "]"}], "=", RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"DeleteDuplicatesBy", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "1"}], "]"}], "]"}], ",", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "2"}], "]"}], "]"}], "-", "Eth"}]}], "}"}], "]"}], ",", "First"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}], "[", "x", "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "1", ",", RowBox[{"Length", "[", "corrs", "]"}]}], "}"}]}], "]"}], ";"}]
RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "2"}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", "\[Prime]"], "[", RowBox[{"1", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"t1grid", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", "\[Prime]"], "[", RowBox[{"1", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", "\[Prime]"], "[", RowBox[{"1", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Min", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
FractionBox[RowBox[{"10000", RowBox[{SuperscriptBox["\[Delta]E", "\[Prime]"], "[", RowBox[{"1", ",", "10000"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "10000"}], "]"}]]
RowBox[{"D", "[", RowBox[{RowBox[{"f", "[", RowBox[{"x", ",", "y"}], "]"}], ",", "y"}], "]"}]
FractionBox[RowBox[{"10000", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative]], "[", RowBox[{"1", ",", "10000"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "10000"}], "]"}]]
FractionBox[RowBox[{"10000", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"1", ",", "10000"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "10000"}], "]"}]]
RowBox[{RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"n_", ",", "x_"}], "]"}], "=", RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"DeleteDuplicatesBy", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "1"}], "]"}], "]"}], ",", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "2"}], "]"}], "]"}], "-", "Eth"}]}], "}"}], "]"}], ",", "First"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}], "[", "x", "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "1", ",", RowBox[{"Length", "[", "corrs", "]"}]}], "}"}]}], "]"}], ";"}]
FractionBox[RowBox[{"10000", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"1", ",", "10000"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "10000"}], "]"}]]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"1", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"1", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}]]
FractionBox[RowBox[{"90000", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"1", ",", "90000"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "90000"}], "]"}]]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Eth"}]
RowBox[{"p"}]
RowBox[{"p2"}]
RowBox[{RowBox[{"p2", "=", "3"}], ";"}]
RowBox[{RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"n_", ",", "x_"}], "]"}], "=", RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"DeleteDuplicatesBy", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "1"}], "]"}], "]"}], ",", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "2"}], "]"}], "]"}], "-", "Eth"}]}], "}"}], "]"}], ",", "First"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}], "[", "x", "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "1", ",", RowBox[{"Length", "[", "corrs", "]"}]}], "}"}]}], "]"}], ";"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Eth"}]
RowBox[{RowBox[{"p2", "=", "3"}], ";"}]
RowBox[{RowBox[{"Clear", "[", "\[Delta]E", "]"}], ";"}]
RowBox[{RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"n_", ",", "x_"}], "]"}], "=", RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"DeleteDuplicatesBy", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "1"}], "]"}], "]"}], ",", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "2"}], "]"}], "]"}], "-", "Eth"}]}], "}"}], "]"}], ",", "First"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}], "[", "x", "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "1", ",", RowBox[{"Length", "[", "corrs", "]"}]}], "}"}]}], "]"}], ";"}]
RowBox[{"Eth"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"1", ",", "All", ",", "1"}], "]"}], "]"}]
RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"1", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]
RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", RowBox[{"-", "1"}], ",", "2"}], "]"}], "]"}], "-", "Eth"}]
RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "2"}], "]"}], "]"}], "-", "Eth"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{RowBox[{"p2", "=", "3"}], ";"}]
RowBox[{RowBox[{"Clear", "[", "\[Delta]E", "]"}], ";"}]
RowBox[{RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"n", ",", "x_"}], "]"}], "=", RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"DeleteDuplicatesBy", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "1"}], "]"}], "]"}], ",", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "2"}], "]"}], "]"}], "-", "Eth"}]}], "}"}], "]"}], ",", "First"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}], "[", "x", "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "1", ",", RowBox[{"Length", "[", "corrs", "]"}]}], "}"}]}], "]"}], ";"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"1", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"1", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"1", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"3", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"3", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
RowBox[{RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"loadparams", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "i", "]"}], "]"}], "]"}], ";", RowBox[{"dir", "=", RowBox[{"FileNameTake", "[", RowBox[{RowBox[{"outparamnames", "[", RowBox[{"[", "i", "]"}], "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"-", "2"}]}], "}"}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "T0", "]"}]}], "||", RowBox[{"T0", ">=", SuperscriptBox["10", "50"]}]}], ")"}], "&&", RowBox[{"p", "==", "3"}], "&&", RowBox[{"p2", "==", "3"}], "&&", RowBox[{"\[Gamma]", "==", "0"}]}], ",", RowBox[{"Print", "[", RowBox[{"{", RowBox[{"i", ",", "T0", ",", "len", ",", "\[Lambda]", ",", "\[Delta]max"}], "}"}], "]"}], ",", RowBox[{RowBox[{"##", "&"}], "[", "]"}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"i", ",", RowBox[{"Length", "[", "outparamnames", "]"}]}], "}"}]}], "]"}], ";"}]
                         -10
{295, T0, 512, 0.5, 1. 10   }
                         -10
{321, T0, 512, 0.5, 1. 10   }
                          -10
{327, T0, 1024, 0.5, 1. 10   }
                               -10
{707, Infinity, 512, 0.5, 1. 10   }
           50                  -11
{731, 1. 10  , 512., 0.3, 1. 10   }
           50                  -11
{732, 1. 10  , 512., 0.3, 1. 10   }
           50                  -11
{733, 1. 10  , 512., 0.3, 1. 10   }
           50                   -11
{734, 1. 10  , 2048., 0.3, 1. 10   }
           50                   -11
{735, 1. 10  , 1024., 0.3, 1. 10   }
           50                   -11
{736, 1. 10  , 1024., 0.3, 1. 10   }
           50                  -11
{737, 1. 10  , 512., 0.3, 1. 10   }
           50                   -11
{738, 1. 10  , 2048., 0.3, 1. 10   }
           50                   -11
{739, 1. 10  , 1024., 0.3, 1. 10   }
           50                   -11
{740, 1. 10  , 2048., 0.3, 1. 10   }
RowBox[{RowBox[{"scratch1", "=", "\"/mnt/\""}], ";"}]
RowBox[{RowBox[{"scratch2", "=", "\"/nobackups/jlang/\""}], ";"}]
RowBox[{RowBox[{"outdir", "=", "\"~/Nextcloud/Spin-glass/Codes/Compressed/\""}], ";"}]
RowBox[{RowBox[{"paramnames", "=", RowBox[{"Union", "[", RowBox[{RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch1", ",", "\"Results_new\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results_new\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results_new2\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results_HPC\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "loadparams", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"loadparams", "[", "file_", "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{RowBox[{"Import", "[", "file", "]"}], ",", "1"}], "]"}], "==", "\"#\""}], ",", RowBox[{"Module", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{RowBox[{"Clear", "[", RowBox[{"{", RowBox[{"p", ",", "p2", ",", "\[Lambda]", ",", "\[CapitalGamma]", ",", "T0", ",", "\[Delta]tMin", ",", "\[Delta]max", ",", "len"}], "}"}], "]"}], ";", RowBox[{RowBox[{"{", RowBox[{"p", ",", "p2", ",", "\[Lambda]", ",", "\[CapitalGamma]", ",", "T0", ",", "\[Delta]tMin", ",", "\[Delta]tMax", ",", "len"}], "}"}], "=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"data", ",", "lines", ",", "p", ",", "p2", ",", "\[Lambda]", ",", "\[CapitalGamma]", ",", "T0", ",", "\[Delta]tMin", ",", "\[Delta]max", ",", "len"}], "}"}], ",", RowBox[{RowBox[{"data", "=", RowBox[{"Import", "[", RowBox[{"file", ",", "\"String\""}], "]"}]}], ";", RowBox[{"lines", "=", RowBox[{"StringSplit", "[", RowBox[{"data", ",", "\"\\n\""}], "]"}]}], ";", RowBox[{RowBox[{"extractValue", "[", RowBox[{"line_", ",", "key_"}], "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"valStr", ",", "parsed"}], "}"}], ",", RowBox[{RowBox[{"valStr", "=", RowBox[{"StringReplace", "[", RowBox[{"line", ",", RowBox[{RowBox[{"key", "<>", "\" = \""}], "->", "\"\""}]}], "]"}]}], ";", RowBox[{"valStr", "=", RowBox[{"StringTrim", "[", "valStr", "]"}]}], ";", RowBox[{"parsed", "=", RowBox[{"ToExpression", "[", RowBox[{"StringReplace", "[", RowBox[{"valStr", ",", RowBox[{RowBox[{"RegularExpression", "[", "\"([eE])\"", "]"}], "->", "\"*10^\""}]}], "]"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Head", "[", "parsed", "]"}], "===", "List"}], ",", "parsed", ",", RowBox[{"N", "[", "parsed", "]"}]}], "]"}]}]}], "]"}]}], ";", RowBox[{"p", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"p = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"p\""}], "]"}]}], ";", RowBox[{"p2", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"p2 = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"p2\""}], "]"}]}], ";", RowBox[{"\[Lambda]", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"lambda = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"lambda\""}], "]"}]}], ";", RowBox[{"\[CapitalGamma]", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"Gamma = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"Gamma\""}], "]"}]}], ";", RowBox[{"T0", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"T0 = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"T0\""}], "]"}]}], ";", RowBox[{"\[Delta]tMin", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"delta_t_min = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"delta_t_min\""}], "]"}]}], ";", RowBox[{"\[Delta]max", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"delta_max = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"delta_max\""}], "]"}]}], ";", RowBox[{"len", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"len = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"len\""}], "]"}]}], ";", RowBox[{"{", RowBox[{"p", ",", "p2", ",", "\[Lambda]", ",", "\[CapitalGamma]", ",", "T0", ",", "\[Delta]tMin", ",", "\[Delta]tMax", ",", "len"}], "}"}]}]}], "]"}]}], ";"}]}], "]"}], ",", RowBox[{RowBox[{"Module", "[", RowBox[{RowBox[{"{", "params", "}"}], ",", RowBox[{RowBox[{"Clear", "[", "T0", "]"}], ";", RowBox[{"params", "=", RowBox[{"Import", "[", "file", "]"}]}], ";", RowBox[{"Clear", "@@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"StringTrim", "[", "#", "]"}], "&"}], "/@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{"params", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{RowBox[{"Prepend", "[", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"\\n\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "0"}], "]"}], "+", "1"}], ",", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"=\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", "1"}]}], "}"}], "]"}]}], ")"}]}], ")"}]}], ";", RowBox[{RowBox[{"Evaluate", "[", RowBox[{"ToExpression", "[", RowBox[{RowBox[{RowBox[{"StringTrim", "[", "#", "]"}], "&"}], "/@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{"params", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{RowBox[{"Prepend", "[", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"\\n\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "0"}], "]"}], "+", "1"}], ",", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"=\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", "1"}]}], "}"}], "]"}]}], ")"}]}], "]"}], "]"}], "=", RowBox[{"ToExpression", "[", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{"params", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"=\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], "+", "1"}], ",", RowBox[{"Append", "[", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"\\n\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", RowBox[{"-", "1"}]}], "]"}]}], "}"}], "]"}]}], "]"}]}], ";", RowBox[{"len", "=", RowBox[{"Round", "[", "len", "]"}]}], ";", RowBox[{"ord", "=", RowBox[{"Round", "[", "ord", "]"}]}], ";", RowBox[{"method", "=", RowBox[{"Round", "[", "method", "]"}]}], ";"}]}], "]"}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"bsearch", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Complex", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", "0"}]}], "}"}], ",", RowBox[{RowBox[{"While", "[", RowBox[{RowBox[{"n0", "<=", "n1"}], ",", RowBox[{RowBox[{"m", "=", RowBox[{"Floor", "[", RowBox[{RowBox[{"(", RowBox[{"n0", "+", "n1"}], ")"}], "/", "2"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "==", "elem"}], ",", RowBox[{"Return", "[", "m", "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "-", "elem"}], "]"}], "<=", RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"Min", "[", RowBox[{RowBox[{"m", "+", "1"}], ",", RowBox[{"Length", "[", "list", "]"}]}], "]"}], "]"}], "]"}], "-", "elem"}], "]"}]}], ",", "m", ",", RowBox[{"m", "+", "1"}]}], "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "-", "elem"}], "]"}], "<=", RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"Max", "[", RowBox[{RowBox[{"m", "-", "1"}], ",", "1"}], "]"}], "]"}], "]"}], "-", "elem"}], "]"}]}], ",", "m", ",", RowBox[{"m", "-", "1"}]}], "]"}]}], "]"}]}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"diff", ":=", RowBox[{RowBox[{RowBox[{"Rest", "[", "#", "]"}], "-", RowBox[{"Most", "[", "#", "]"}]}], "&"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x_", "]"}], ":=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Delta]", "=", RowBox[{"1", "/", RowBox[{"(", RowBox[{"10", "\[Pi]", "Tmax"}], ")"}]}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Eta]", "=", RowBox[{"Rationalize", "[", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{"1", "/", "len"}], ")"}]}], "2", RowBox[{"ProductLog", "[", RowBox[{RowBox[{"-", "1"}], ",", RowBox[{RowBox[{"-", "\[Pi]"}], "\[Delta]"}]}], "]"}]}], "]"}]}], "}"}], ",", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"x", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}], "-", RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}]}], ")"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}], "]"}]}], "-", RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}]}], "\[Eta]"}], ")"}]}], "]"}]}]}], ")"}]}]}], "]"}]}], "]"}], ",", "40"}], "]"}]}], ";"}]
RowBox[{RowBox[{"bsearchPosSorted", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", "1"}], ",", RowBox[{"Lm", "=", "1."}], ",", RowBox[{"El", "=", "1."}]}], "}"}], ",", RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"El", "=", RowBox[{"elem", "[", RowBox[{"[", "l", "]"}], "]"}]}], ";", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "El"}], ",", RowBox[{"While", "[", RowBox[{RowBox[{"n0", "<=", "n1"}], ",", RowBox[{RowBox[{"m", "=", RowBox[{"Quotient", "[", RowBox[{RowBox[{"n0", "+", "n1"}], ",", "2"}], "]"}]}], ";", RowBox[{"Lm", "=", RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "==", "El"}], ",", RowBox[{"n0", "=", "m"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "<", "El"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}]}], "]"}], ";", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "<=", "El"}], ",", RowBox[{"m", "+", RowBox[{"If", "[", RowBox[{RowBox[{"m", "==", RowBox[{"Length", "[", "list", "]"}]}], ",", "0.", ",", RowBox[{RowBox[{"(", RowBox[{"El", "-", "Lm"}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"m", "+", "1"}], "]"}], "]"}], "-", "Lm"}], ")"}]}]}], "]"}]}], ",", RowBox[{"m", "-", RowBox[{"If", "[", RowBox[{RowBox[{"m", ">", "1"}], ",", RowBox[{RowBox[{"(", RowBox[{"El", "-", "Lm"}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"m", "-", "1"}], "]"}], "]"}], "-", "Lm"}], ")"}]}], ",", "0."}], "]"}]}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"l", ",", RowBox[{"Length", "[", "elem", "]"}]}], "}"}]}], "]"}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}], ",", RowBox[{"RuntimeOptions", "->", "\"Speed\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"loadLibrary", ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"libname", "=", RowBox[{"\"Interpol-mt.\"", "<>", RowBox[{"Switch", "[", RowBox[{"$OperatingSystem", ",", "\"Unix\"", ",", "\"so\"", ",", "\"Windows\"", ",", "\"dll\"", ",", "\"MacOSX\"", ",", "\"dylib\""}], "]"}]}]}], ",", "filename"}], "}"}], ",", RowBox[{RowBox[{"filename", "=", RowBox[{"FileNames", "[", RowBox[{"libname", ",", RowBox[{"NotebookDirectory", "[", "]"}], ",", "2"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "filename", "]"}], "!=", "0"}], ",", RowBox[{RowBox[{"filename", "=", RowBox[{"filename", "[", RowBox[{"[", "1", "]"}], "]"}]}], ";", RowBox[{"Quiet", "[", RowBox[{RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Head", "[", "#", "]"}], "===", "LibraryFunction"}], ",", RowBox[{"LibraryFunctionUnload", "[", "#", "]"}]}], "]"}], "&"}], "/@", RowBox[{"Unevaluated", "[", RowBox[{"{", RowBox[{"build", ",", "clearAll", ",", "clearOne", ",", "append", ",", "deleteN", ",", "replace", ",", "replaceD", ",", "prod2", ",", "clip", ",", "output", ",", "getLast", ",", "conv", ",", "index", ",", "indexVec", ",", "indexVecN", ",", "indexVecLN", ",", "Interpol1D3c", ",", "indexVecR", ",", "indexVecR2", ",", "indexVecL", ",", "indexMat", ",", "indexMatN", ",", "indexMatN3", ",", "indexMatAll", ",", "indexMatMerge", ",", "\[CapitalSigma]Rnum", ",", "\[CapitalSigma]Knum"}], "}"}], "]"}]}], ";"}], "]"}], ";", RowBox[{"build", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"build\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"buildOne", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"buildOne\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", "Integer"}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"clearAll", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"clearAll\"", ",", RowBox[{"{", "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"clearOne", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"clearOne\"", ",", RowBox[{"{", "Integer", "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"append", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"append\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"deleteN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"deleteN\"", ",", RowBox[{"{", "Integer", "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"replace", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"replace\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"replaceD", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"replaceD\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"output", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"output\"", ",", RowBox[{"{", "Integer", "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"getLast", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"getLast\"", ",", RowBox[{"{", RowBox[{"Integer", ",", "Integer"}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"prod2", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"prod2\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"clip", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"clip\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"\[CapitalSigma]Rnum", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"sigmaR\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"\[CapitalSigma]Knum", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"sigmaK\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"conv", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"conv\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"index", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"index\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVec", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVec\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecN\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"indexVecR", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecR\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecR2", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecR2\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecL", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecL\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecLN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecLN\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"Interpol1D3c", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"Interpol1D3c\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"indexMat", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMat\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatN\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatN3", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatN3\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatAll", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatAll\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatMerge", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatMerge\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}]}], ",", RowBox[{"Clear", "[", RowBox[{"build", ",", "buildOne", ",", "clearAll", ",", "clearOne", ",", "deleteN", ",", "append", ",", "replace", ",", "replaceD", ",", "output", ",", "getLast", ",", "conv", ",", "index", ",", "indexVec", ",", "indexVecN", ",", "indexVecLN", ",", "Interpol1D3c", ",", "indexVecR", ",", "indexVecR2", ",", "indexVecL", ",", "indexMat", ",", "indexMatN", ",", "indexMatN3", ",", "indexMatAll", ",", "indexMatMerge"}], "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "conv", "]"}]}], ",", RowBox[{RowBox[{"conv", "[", RowBox[{"int_", ",", "m1_", ",", "m2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"m1", "*", "m2"}], ")"}], ".", "int"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "index", "]"}]}], ",", RowBox[{RowBox[{"index", "[", RowBox[{"list_", ",", "inds_"}], "]"}], ":=", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecL", "]"}]}], ",", RowBox[{RowBox[{"indexVecL", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "1"}], "]"}], "]"}]}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecL3", "]"}]}], ",", RowBox[{RowBox[{"indexVecL3", "[", RowBox[{"list_", ",", "weightsIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"weights", "=", RowBox[{"ArrayReshape", "[", RowBox[{"weightsIn", ",", RowBox[{"{", RowBox[{RowBox[{"len", "^", "2"}], ",", RowBox[{RowBox[{"Length", "[", "weightsIn", "]"}], "/", RowBox[{"len", "^", "2"}]}]}], "}"}]}], "]"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{"Sum", "[", RowBox[{RowBox[{RowBox[{"weights", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"n", "+", "1"}]}], "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "n"}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", RowBox[{"weights", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVec", "]"}]}], ",", RowBox[{RowBox[{"indexVec", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "indsIn", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecR", "]"}]}], ",", RowBox[{RowBox[{"indexVecR", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "indsIn", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecR2", "]"}]}], ",", RowBox[{RowBox[{"indexVecR2", "[", RowBox[{"list_", ",", "dlist_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_", ",", "\[Delta]tratio_"}], "]"}], ":=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"\[CapitalDelta]xvecIn", "^", "2"}]}], ")"}], "*", RowBox[{"list", "[", RowBox[{"[", "indsIn", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "^", "2"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"\[CapitalDelta]xvecIn", "-", RowBox[{"\[CapitalDelta]xvecIn", "^", "2"}]}], ")"}], "*", RowBox[{"dlist", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexMat", "]"}]}], ",", RowBox[{RowBox[{"indexMat", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "\[CapitalDelta]yvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}], ",", RowBox[{"\[CapitalDelta]yvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]yvecIn"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "1"}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "len"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", RowBox[{"(", RowBox[{"len", "+", "1"}], ")"}]}], "]"}], "]"}]}]}], ")"}]}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexMat3", "]"}]}], ",", RowBox[{RowBox[{"indexMat3", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "weightsyIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}], ",", RowBox[{"weightsy", "=", RowBox[{"ArrayReshape", "[", RowBox[{"weightsyIn", ",", RowBox[{"{", RowBox[{RowBox[{"len", "^", "2"}], ",", RowBox[{RowBox[{"Length", "[", "weightsyIn", "]"}], "/", RowBox[{"len", "^", "2"}]}]}], "}"}]}], "]"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"Sum", "[", RowBox[{RowBox[{RowBox[{"weightsy", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"n", "+", "1"}]}], "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "n"}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", RowBox[{"weightsy", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"Sum", "[", RowBox[{RowBox[{RowBox[{"weightsy", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"n", "+", "1"}]}], "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", RowBox[{"(", RowBox[{"n", "+", "len"}], ")"}]}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", RowBox[{"weightsy", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}]}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexMatMerge", "]"}]}], ",", RowBox[{RowBox[{"indexMatMerge", "[", RowBox[{"list_", ",", "defaultlist_", ",", "\[CapitalDelta]xvecIn_", ",", "\[CapitalDelta]yvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"mask", "=", RowBox[{"Subtract", "[", RowBox[{"1", ",", RowBox[{"UnitStep", "[", RowBox[{"-", "indsIn"}], "]"}]}], "]"}]}], ",", RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}], ",", RowBox[{"\[CapitalDelta]yvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]yvecIn"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{"mask", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "1"}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "len"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", RowBox[{"(", RowBox[{"len", "+", "1"}], ")"}]}], "]"}], "]"}]}]}], ")"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"1", "-", "mask"}], ")"}], "defaultlist"}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"buildLowMem", "[", RowBox[{"fac_", ":", "1"}], "]"}], ":=", RowBox[{"(", RowBox[{RowBox[{"buildOne", "[", RowBox[{"QK", ",", "1"}], "]"}], ";", RowBox[{"QK", "=", RowBox[{"QK", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{"buildOne", "[", RowBox[{"QR", ",", "2"}], "]"}], ";", RowBox[{"QR", "=", RowBox[{"QR", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{"buildOne", "[", RowBox[{RowBox[{"fac", "dQK"}], ",", "3"}], "]"}], ";", RowBox[{"dQK", "=", RowBox[{"dQK", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{"buildOne", "[", RowBox[{RowBox[{"fac", "dQR"}], ",", "4"}], "]"}], ";", RowBox[{"dQR", "=", RowBox[{"dQR", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";"}], ")"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"SaveCompressed", "[", RowBox[{"file_String", ",", RowBox[{"mat_", "?", "MatrixQ"}]}], "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"rows", "=", RowBox[{"Length", "[", "mat", "]"}]}], ",", RowBox[{"cols", "=", RowBox[{"Length", "[", RowBox[{"First", "@", "mat"}], "]"}]}], ",", "htype", ",", "s"}], "}"}], ",", RowBox[{RowBox[{"htype", "=", RowBox[{"If", "[", RowBox[{RowBox[{"$SystemWordLength", "==", "64"}], ",", "\"UnsignedInteger64\"", ",", "\"UnsignedInteger32\""}], "]"}]}], ";", RowBox[{"s", "=", RowBox[{"OpenWrite", "[", RowBox[{"file", ",", RowBox[{"BinaryFormat", "->", "True"}]}], "]"}]}], ";", RowBox[{"BinaryWrite", "[", RowBox[{"s", ",", "rows", ",", "htype", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}], ";", RowBox[{"BinaryWrite", "[", RowBox[{"s", ",", "cols", ",", "htype", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}], ";", RowBox[{"BinaryWrite", "[", RowBox[{"s", ",", RowBox[{"N", "@", RowBox[{"Flatten", "[", "mat", "]"}]}], ",", "\"Real64\"", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}], ";", RowBox[{"Close", "[", "s", "]"}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"LoadCompressed", "[", "file_String", "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"try", ",", "rows", ",", "cols", ",", "cnt", ",", "data", ",", "s", ",", "headerBytes", ",", "fileBytes"}], "}"}], ",", RowBox[{RowBox[{RowBox[{"try", "[", "htype_", "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{RowBox[{"s", "=", RowBox[{"OpenRead", "[", RowBox[{"file", ",", RowBox[{"BinaryFormat", "->", "True"}]}], "]"}]}], ";", RowBox[{"rows", "=", RowBox[{"BinaryRead", "[", RowBox[{"s", ",", "htype", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}]}], ";", RowBox[{"cols", "=", RowBox[{"BinaryRead", "[", RowBox[{"s", ",", "htype", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"!", RowBox[{"IntegerQ", "[", "rows", "]"}]}], "||", RowBox[{"!", RowBox[{"IntegerQ", "[", "cols", "]"}]}], "||", RowBox[{"rows", "<=", "0"}], "||", RowBox[{"cols", "<=", "0"}]}], ",", RowBox[{RowBox[{"Close", "[", "s", "]"}], ";", RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", RowBox[{"headerBytes", "=", RowBox[{"2", "*", RowBox[{"If", "[", RowBox[{RowBox[{"htype", "===", "\"UnsignedInteger64\""}], ",", "8", ",", "4"}], "]"}]}]}], ";", RowBox[{"fileBytes", "=", RowBox[{"FileByteCount", "[", "file", "]"}]}], ";", RowBox[{"cnt", "=", RowBox[{"rows", "*", "cols"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"fileBytes", "<", RowBox[{"headerBytes", "+", RowBox[{"8", "cnt"}]}]}], ",", RowBox[{RowBox[{"Close", "[", "s", "]"}], ";", RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", RowBox[{"data", "=", RowBox[{"BinaryReadList", "[", RowBox[{"s", ",", "\"Real64\"", ",", "cnt", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}]}], ";", RowBox[{"Close", "[", "s", "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "data", "]"}], "==", "cnt"}], ",", RowBox[{"Partition", "[", RowBox[{"data", ",", "cols"}], "]"}], ",", "$Failed"}], "]"}]}]}], "]"}]}], ";", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"m64", "=", RowBox[{"try", "[", "\"UnsignedInteger64\"", "]"}]}], "}"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"m64", "=!=", "$Failed"}], ",", "m64", ",", RowBox[{"try", "[", "\"UnsignedInteger32\"", "]"}]}], "]"}]}], "]"}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "splineCoeffs", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"SyntaxInformation", "[", "splineCoeffs", "]"}], "=", RowBox[{"{", RowBox[{"\"ArgumentsPattern\"", "->", RowBox[{"{", RowBox[{"_", ",", RowBox[{"OptionsPattern", "[", "]"}]}], "}"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{"SetAttributes", "[", RowBox[{"splineCoeffs", ",", "HoldAll"}], "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "splineCoeffs", "]"}], "=", RowBox[{"{", RowBox[{RowBox[{"\"Five\"", "->", "False"}], ",", RowBox[{"\"Last\"", "->", "False"}], ",", RowBox[{"\"All\"", "->", "False"}], ",", RowBox[{"\"Mixed\"", "->", "True"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"splineCoeffs", "::", "padInput"}], "=", "\"interpolation matrices cannot be generated from a precomputed second-highest coefficient matrix when the padding is set to be non-zero.\""}], ";"}]
RowBox[{RowBox[{"splineCoeffs", "[", RowBox[{RowBox[{"{", RowBox[{"points_", ",", RowBox[{"cmatIn_", ":", "0"}], ",", RowBox[{"precIn_", ":", "precision"}], ",", RowBox[{"padding_", ":", "15"}]}], "}"}], ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"pts", ",", "h", ",", "rot", ",", "n", ",", "id", ",", "amat", ",", "bmat", ",", "cmat", ",", "cmat2", ",", "dmat", ",", "emat", ",", "emat2", ",", "fmat", ",", "prec", ",", "padfc", ",", "padfcT", ",", "mixed"}], "}"}], ",", RowBox[{RowBox[{"mixed", "=", RowBox[{RowBox[{"OptionValue", "[", "\"Mixed\"", "]"}], "&&", RowBox[{"(", RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ")"}], "&&", RowBox[{"(", RowBox[{"padding", "!=", "0"}], ")"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"!", RowBox[{"(", RowBox[{"cmatIn", "===", "0"}], ")"}]}], "&&", RowBox[{"padding", "!=", "0"}]}], ",", RowBox[{RowBox[{"Message", "[", RowBox[{"splineCoeffs", "::", "padInput"}], "]"}], ";"}], ",", RowBox[{RowBox[{RowBox[{"padfc", "[", "x_", "]"}], ":=", RowBox[{"x", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], ";", RowBox[{RowBox[{"padfcT", "[", "x_", "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "x", "]"}], ">", RowBox[{"Length", "[", "points", "]"}]}], ",", RowBox[{"x", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], "]"}], "]"}], ",", "x"}], "]"}]}], ";", RowBox[{"prec", "=", RowBox[{"If", "[", RowBox[{RowBox[{"cmatIn", "===", "0"}], ",", "precIn", ",", RowBox[{"Precision", "[", "cmatIn", "]"}]}], "]"}]}], ";", RowBox[{"pts", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"Join", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "points", ",", RowBox[{"Join", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], "-", RowBox[{"Reverse", "[", RowBox[{"Range", "[", "padding", "]"}], "]"}]}], ",", "points"}], "]"}]}], "]"}], ",", RowBox[{RowBox[{"points", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{"Range", "[", "padding", "]"}]}]}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"h", "=", RowBox[{"Subtract", "[", RowBox[{RowBox[{"RotateLeft", "[", "pts", "]"}], ",", "pts"}], "]"}]}], ";", RowBox[{"n", "=", RowBox[{"Length", "[", "pts", "]"}]}], ";", RowBox[{"rot", "=", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{RowBox[{"Band", "[", RowBox[{"{", RowBox[{"1", ",", "1"}], "}"}], "]"}], "->", RowBox[{"-", "1"}]}], ",", RowBox[{RowBox[{"Band", "[", RowBox[{"{", RowBox[{"1", ",", "2"}], "}"}], "]"}], "->", "1"}]}], "}"}], ",", RowBox[{"{", RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", RowBox[{"id", "=", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"Band", "[", RowBox[{"{", RowBox[{"1", ",", "1"}], "}"}], "]"}], "->", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Five\"", "]"}]}], ",", RowBox[{RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"g0c", ",", "g1c", ",", "coefc", ",", "coefc2", ",", "Bc", ",", "Bc2", ",", "\[CapitalDelta]\[Omega]"}], "}"}], ",", RowBox[{RowBox[{"g0c", "=", RowBox[{RowBox[{"1", "/", "3"}], "rot"}]}], ";", RowBox[{"g1c", "=", RowBox[{RowBox[{"(", RowBox[{"id", "+", "g0c"}], ")"}], RowBox[{"(", RowBox[{"3", "h"}], ")"}]}]}], ";", RowBox[{"coefc", "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"Most", "[", RowBox[{RowBox[{"(", RowBox[{"6", "h"}], ")"}], "id"}], "]"}], "+", RowBox[{"Most", "[", RowBox[{RowBox[{"(", RowBox[{"9", "h"}], ")"}], "g0c"}], "]"}], "+", RowBox[{"diff", "[", "g1c", "]"}]}], ")"}], "/", RowBox[{"Most", "[", "h", "]"}]}]}], ";", RowBox[{"Bc", "=", RowBox[{RowBox[{"diff", "[", RowBox[{"rot", "/", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "/", "3"}], ")"}], "h"}], ")"}]}], "]"}], "/", RowBox[{"Most", "[", "h", "]"}]}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{RowBox[{"coefc2", "=", RowBox[{"coefc", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], ";", RowBox[{"coefc2", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], "+", RowBox[{"RotateRight", "[", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"Most", "[", "coefc2", "]"}], ",", RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"-", "padding"}], "-", "1"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], "+", RowBox[{"RotateLeft", "[", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"-", "padding"}], "-", "1"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}], "]"}]}], "}"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";"}]}], "]"}], ";", RowBox[{"coefc", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", "1", "]"}], "]"}]}], "+", RowBox[{"RotateRight", "[", RowBox[{"id", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"Most", "[", "coefc", "]"}], ",", RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "+", RowBox[{"RotateLeft", "[", RowBox[{"id", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bc", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"zer", "=", RowBox[{"ConstantArray", "[", RowBox[{"0", ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", RowBox[{"n", "-", "padding"}], ",", RowBox[{"n", "-", RowBox[{"2", "padding"}]}]}], "]"}]}], "]"}]}], "}"}], ",", RowBox[{"Catenate", "[", RowBox[{"{", RowBox[{RowBox[{"{", "zer", "}"}], ",", RowBox[{"Most", "[", RowBox[{"padfc", "[", RowBox[{"Normal", "[", "Bc", "]"}], "]"}], "]"}], ",", RowBox[{"{", "zer", "}"}]}], "}"}], "]"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bc2", "=", RowBox[{"Bc", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{RowBox[{"Bc2", "[", RowBox[{"[", RowBox[{"{", RowBox[{RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], "]"}], "*=", "0"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"cmatIn", "===", "0"}], ",", RowBox[{RowBox[{"cmat", "=", RowBox[{"LinearSolve", "[", RowBox[{"coefc", ",", "Bc"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{"cmat2", "=", RowBox[{"LinearSolve", "[", RowBox[{"coefc2", ",", "Bc2"}], "]"}]}]}], "]"}]}], ",", RowBox[{RowBox[{"cmat", "=", "cmatIn"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"SquareMatrixQ", "[", "cmat", "]"}]}], ",", RowBox[{"cmat", "=", RowBox[{"ArrayFlatten", "[", RowBox[{"{", RowBox[{RowBox[{"{", "cmat", "}"}], ",", RowBox[{"{", RowBox[{"{", RowBox[{RowBox[{"-", RowBox[{"cmat", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "/", "2"}], "}"}], "}"}]}], "}"}], "]"}]}]}], "]"}], ";"}]}], "]"}], ";", RowBox[{"dmat", "=", RowBox[{RowBox[{"diff", "[", "cmat", "]"}], "/", RowBox[{"(", RowBox[{"3", RowBox[{"Most", "[", "h", "]"}]}], ")"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ",", RowBox[{RowBox[{"rot", "=", RowBox[{"padfc", "[", "rot", "]"}]}], ";", RowBox[{"id", "=", RowBox[{"padfc", "[", "id", "]"}]}], ";", RowBox[{"\[CapitalDelta]\[Omega]", "=", RowBox[{"Most", "[", "h", "]"}]}], ";", RowBox[{"bmat", "=", RowBox[{RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "-", RowBox[{"\[CapitalDelta]\[Omega]", RowBox[{"(", RowBox[{RowBox[{"Most", "[", "cmat", "]"}], "+", RowBox[{RowBox[{"diff", "[", "cmat", "]"}], "/", "3"}]}], ")"}]}]}]}], ";", RowBox[{"amat", "=", RowBox[{"Most", "[", "id", "]"}]}], ";", RowBox[{"cmat", "=", RowBox[{"If", "[", RowBox[{"mixed", ",", "cmat2", ",", RowBox[{"Most", "[", "cmat", "]"}]}], "]"}]}]}]}], "]"}]}]}], "]"}], ";"}], ",", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"g0q", ",", "g1q", ",", "g2q", ",", "g3q", ",", "coefq", ",", "coefq2", ",", "Bq", ",", "Bq2", ",", "\[CapitalDelta]\[Omega]"}], "}"}], ",", RowBox[{RowBox[{"g0q", "=", RowBox[{RowBox[{"1", "/", "5"}], "rot"}]}], ";", RowBox[{"g1q", "=", RowBox[{"g0q", "+", "id"}]}], ";", RowBox[{"g2q", "=", RowBox[{RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"2", RowBox[{"h", "^", "2"}]}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"3", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], "+", RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"5", RowBox[{"h", "^", "2"}]}], ")"}], "g0q"}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], ")"}]}], "+", RowBox[{"diff", "[", RowBox[{"g1q", RowBox[{"h", "^", "3"}]}], "]"}]}]}], ";", RowBox[{"g3q", "=", RowBox[{RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"2", "h"}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"3", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], "+", RowBox[{"4", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], "+", RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"g0q", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"10", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], ")"}], RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], ")"}]}], "+", RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"4", "h"}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{RowBox[{"g0q", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{"10", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], ")"}]}]}], ")"}], RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}], "^", "2"}]}], "+", "g2q"}], ")"}]}], "]"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"cmatIn", "===", "0"}], ",", RowBox[{RowBox[{"coefq", "=", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"4", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"4", "h"}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], "+", RowBox[{RowBox[{"g0q", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{"10", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}]}], ")"}]}], "+", RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], "g3q"}], "]"}]}], ")"}]}]}], ";", RowBox[{"Bq", "=", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"4", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"diff", "[", RowBox[{"rot", "/", "h"}], "]"}]}], "]"}]}], "]"}]}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{RowBox[{"coefq2", "=", RowBox[{"coefq", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], ";", RowBox[{"coefq2", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], "+", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}], ",", RowBox[{"Most", "[", "coefq2", "]"}], ",", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{RowBox[{"-", "padding"}], "-", "2"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";"}]}], "]"}], ";", RowBox[{"coefq", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"id", "[", RowBox[{"[", RowBox[{";;", "2"}], "]"}], "]"}], ",", RowBox[{"coefq", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], ",", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{"-", "2"}], ";;"}], "]"}], "]"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bq", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"zer", "=", RowBox[{"ConstantArray", "[", RowBox[{"0", ",", RowBox[{"{", RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], "}"}], ",", RowBox[{"padfc", "[", RowBox[{"Catenate", "[", RowBox[{"{", RowBox[{RowBox[{"zer", "[", RowBox[{"[", RowBox[{";;", "2"}], "]"}], "]"}], ",", RowBox[{"Normal", "[", RowBox[{"Bq", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "]"}], ",", RowBox[{"zer", "[", RowBox[{"[", RowBox[{RowBox[{"-", "2"}], ";;"}], "]"}], "]"}]}], "}"}], "]"}], "]"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bq2", "=", RowBox[{"Bq", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{RowBox[{"Bq2", "[", RowBox[{"[", RowBox[{"1", ";;", "2"}], "]"}], "]"}], "*=", "0"}], ";", RowBox[{RowBox[{"Bq2", "[", RowBox[{"[", RowBox[{RowBox[{"-", "2"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}], "*=", "0"}], ";", RowBox[{"emat", "=", RowBox[{"Chop", "[", RowBox[{RowBox[{"LinearSolve", "[", RowBox[{"coefq", ",", "Bq"}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{"emat2", "=", RowBox[{"Chop", "[", RowBox[{RowBox[{"LinearSolve", "[", RowBox[{"coefq2", ",", "Bq2"}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], "]"}]}]}], "]"}], ";"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"SquareMatrixQ", "[", "emat", "]"}]}], ",", RowBox[{"emat", "=", RowBox[{"ArrayFlatten", "[", RowBox[{"{", RowBox[{RowBox[{"{", "cmatIn", "}"}], ",", RowBox[{"{", RowBox[{"{", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{"{", "n", "}"}]}], "]"}], "}"}], "}"}]}], "}"}], "]"}]}]}], "]"}], ";"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ",", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "=", RowBox[{"Most", "[", "h", "]"}]}], ";", RowBox[{"fmat", "=", RowBox[{RowBox[{"diff", "[", "emat", "]"}], "/", RowBox[{"(", RowBox[{"5", "\[CapitalDelta]\[Omega]"}], ")"}]}]}], ";", RowBox[{"rot", "=", RowBox[{"padfc", "[", "rot", "]"}]}], ";", RowBox[{"id", "=", RowBox[{"padfc", "[", "id", "]"}]}], ";", RowBox[{"dmat", "=", RowBox[{"Catenate", "[", RowBox[{RowBox[{RowBox[{"FoldList", "[", RowBox[{RowBox[{RowBox[{"{", RowBox[{"(", RowBox[{RowBox[{"#1", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"(", RowBox[{"4", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}]}], ")"}], RowBox[{"emat", "[", RowBox[{"[", RowBox[{"#2", "-", "1"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"10", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}], "^", "2"}]}], ")"}], RowBox[{"fmat", "[", RowBox[{"[", "#2", "]"}], "]"}]}]}], ")"}], "}"}], "&"}], ",", "#", ",", RowBox[{"{", RowBox[{RowBox[{"-", "3"}], ",", RowBox[{"-", "2"}]}], "}"}]}], "]"}], "&"}], "@", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"diff", "[", RowBox[{RowBox[{"diff", "[", RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "]"}], "/", RowBox[{"(", RowBox[{RowBox[{"Most", "[", "\[CapitalDelta]\[Omega]", "]"}], "+", RowBox[{"Rest", "[", "\[CapitalDelta]\[Omega]", "]"}]}], ")"}]}], "]"}], "-", RowBox[{"Most", "[", RowBox[{"g3q", ".", "emat"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], ")"}]}], "]"}]}], ";", RowBox[{"cmat", "=", RowBox[{"Catenate", "[", RowBox[{RowBox[{RowBox[{"FoldList", "[", RowBox[{RowBox[{RowBox[{"{", RowBox[{"(", RowBox[{RowBox[{"#1", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"(", RowBox[{"3", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}]}], ")"}], RowBox[{"dmat", "[", RowBox[{"[", "#2", "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"6", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}], "^", "2"}]}], ")"}], RowBox[{"emat", "[", RowBox[{"[", RowBox[{"#2", "-", "1"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"10", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}], "^", "3"}]}], ")"}], RowBox[{"fmat", "[", RowBox[{"[", "#2", "]"}], "]"}]}]}], ")"}], "}"}], "&"}], ",", "#", ",", RowBox[{"{", RowBox[{"-", "2"}], "}"}]}], "]"}], "&"}], "@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"diff", "[", RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "]"}], "-", RowBox[{"diff", "[", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "^", "2"}], "dmat"}], "]"}], "-", RowBox[{"Most", "[", RowBox[{"g2q", ".", "emat"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"Most", "[", "\[CapitalDelta]\[Omega]", "]"}], "+", RowBox[{"Rest", "[", "\[CapitalDelta]\[Omega]", "]"}]}], ")"}]}], "-", RowBox[{RowBox[{"(", RowBox[{"3", RowBox[{"Most", "[", "\[CapitalDelta]\[Omega]", "]"}]}], ")"}], RowBox[{"Most", "[", "dmat", "]"}]}]}], ")"}]}], "]"}]}], ";", RowBox[{"bmat", "=", RowBox[{RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "-", RowBox[{"\[CapitalDelta]\[Omega]", "cmat"}], "-", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "^", "2"}], "dmat"}], "-", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "^", "3"}], RowBox[{"Most", "[", RowBox[{"g1q", ".", "emat"}], "]"}]}]}]}], ";", RowBox[{"amat", "=", RowBox[{"Most", "[", "id", "]"}]}], ";", RowBox[{"emat", "=", RowBox[{"If", "[", RowBox[{"mixed", ",", "emat2", ",", RowBox[{"Most", "[", "emat", "]"}]}], "]"}]}], ";"}], ",", RowBox[{RowBox[{"fmat", "=", RowBox[{RowBox[{"diff", "[", "emat", "]"}], "/", RowBox[{"(", RowBox[{"5", RowBox[{"Most", "[", "h", "]"}]}], ")"}]}]}], ";", RowBox[{"emat", "=", RowBox[{"Most", "[", "emat", "]"}]}], ";"}]}], "]"}]}]}], "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", RowBox[{RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "#", ",", RowBox[{"padfcT", "[", "#", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}], "&"}], "/@", RowBox[{"{", RowBox[{"amat", ",", "bmat", ",", "cmat", ",", "dmat", ",", "emat", ",", "fmat"}], "}"}]}], ",", RowBox[{RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "#", ",", RowBox[{"padfcT", "[", "#", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}], "&"}], "/@", RowBox[{"{", RowBox[{"amat", ",", "bmat", ",", "cmat", ",", "dmat"}], "}"}]}]}], "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "fmat", ",", RowBox[{"padfcT", "[", "fmat", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}], ",", RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "dmat", ",", RowBox[{"padfcT", "[", "dmat", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}]}], "]"}]}], "]"}]}]}], "]"}]}]}], "]"}]}]
RowBox[{RowBox[{"Clear", "[", "createInt", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "createInt", "]"}], "=", RowBox[{"{", RowBox[{"\"Five\"", "->", "False"}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"createInt", "[", RowBox[{RowBox[{"{", RowBox[{"\[Tau]pts_", ",", RowBox[{"cmatIn_", ":", "0"}], ",", RowBox[{"prec_", ":", "precision"}]}], "}"}], ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Quiet", "[", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"IL4jk", ",", "IL6jk", ",", "f0", ",", "f1", ",", "f2", ",", "f3", ",", "f4", ",", "f5", ",", RowBox[{"Len", "=", RowBox[{"Length", "[", "\[Tau]pts", "]"}]}]}], "}"}], ",", RowBox[{RowBox[{RowBox[{"f0", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"-", "\[Omega]1"}], "+", "\[Omega]2"}]}], ";", RowBox[{RowBox[{"f1", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "2"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "2"}]}]}], ";", RowBox[{RowBox[{"f2", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "3"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "3"}]}]}], ";", RowBox[{RowBox[{"f3", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "4"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "4"}]}]}], ";", RowBox[{RowBox[{"f4", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "5"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "5"}]}]}], ";", RowBox[{RowBox[{"f5", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "6"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "6"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", RowBox[{"IL6jk", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"f0", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f1", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f2", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f3", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f4", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f5", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}]}], "}"}], ",", "prec"}], "]"}]}], ",", RowBox[{"IL4jk", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"f0", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f1", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f2", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f3", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}]}], "}"}], ",", "prec"}], "]"}]}]}], "]"}], ";", RowBox[{"Integrator", "=", RowBox[{"Accumulate", "[", RowBox[{"Prepend", "[", RowBox[{RowBox[{"Total", "[", RowBox[{"MapThread", "[", RowBox[{"Times", ",", RowBox[{"{", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", "IL6jk", ",", "IL4jk"}], "]"}], ",", RowBox[{RowBox[{"splineCoeffs", "[", RowBox[{RowBox[{"{", RowBox[{"\[Tau]pts", ",", "cmatIn", ",", "prec", ",", "0"}], "}"}], ",", RowBox[{"\"Five\"", "->", RowBox[{"OptionValue", "[", "\"Five\"", "]"}]}]}], "]"}], "+", RowBox[{"10.", "^", RowBox[{"-", "200"}]}]}]}], "}"}]}], "]"}], "]"}], ",", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{"Length", "[", "\[Tau]pts", "]"}]}], "]"}]}], "]"}], "]"}]}], ";", RowBox[{"int", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"Integrator", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "]"}]}]}]}], "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"f\[Lambda]", "[", "q_", "]"}], ":=", RowBox[{RowBox[{"\[Lambda]", RowBox[{"q", "^", "p"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"1", "-", "\[Lambda]"}], ")"}], RowBox[{"q", "^", "p2"}]}]}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Energy", "[", RowBox[{"QK_", ",", "QR_", ",", "t_", ",", "\[Beta]_"}], "]"}], ":=", RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"t", RowBox[{RowBox[{"(", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "QK", "]"}], "*", "QR"}], ")"}], ".", "int"}]}], "+", RowBox[{"\[Beta]", RowBox[{"f\[Lambda]", "[", RowBox[{"If", "[", RowBox[{RowBox[{"MatrixQ", "[", "QK", "]"}], ",", RowBox[{"QK", "[", RowBox[{"[", RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", RowBox[{"QK", "[", RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}]}], ")"}]}]}], ";"}]
RowBox[{RowBox[{"Eth", ":=", RowBox[{RowBox[{"Sqrt", "[", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{RowBox[{"f\[Lambda]", "[", "1", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}], "-", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}], "-", RowBox[{RowBox[{"f\[Lambda]", "[", "1", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}]}], ")"}]}]}], ";"}]
RowBox[{RowBox[{"outparamnames", "=", RowBox[{"Union", "[", RowBox[{RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", "outdir", ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"loadparams", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "i", "]"}], "]"}], "]"}], ";", RowBox[{"dir", "=", RowBox[{"FileNameTake", "[", RowBox[{RowBox[{"outparamnames", "[", RowBox[{"[", "i", "]"}], "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"-", "2"}]}], "}"}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "T0", "]"}]}], "||", RowBox[{"T0", ">=", SuperscriptBox["10", "50"]}]}], ")"}], "&&", RowBox[{"p", "==", "3"}], "&&", RowBox[{"p2", "==", "3"}], "&&", RowBox[{"\[Gamma]", "==", "0"}]}], ",", RowBox[{"Print", "[", RowBox[{"{", RowBox[{"i", ",", "T0", ",", "len", ",", "\[Lambda]", ",", "\[Delta]max"}], "}"}], "]"}], ",", RowBox[{RowBox[{"##", "&"}], "[", "]"}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"i", ",", RowBox[{"Length", "[", "outparamnames", "]"}]}], "}"}]}], "]"}], ";"}]
                         -10
{295, T0, 512, 0.5, 1. 10   }
                         -10
{321, T0, 512, 0.5, 1. 10   }
                          -10
{327, T0, 1024, 0.5, 1. 10   }
                               -10
{707, Infinity, 512, 0.5, 1. 10   }
           50
{731, 1. 10  , 512., 0.3, max}
           50
{732, 1. 10  , 512., 0.3, max}
           50
{733, 1. 10  , 512., 0.3, max}
           50
{734, 1. 10  , 2048., 0.3, max}
           50
{735, 1. 10  , 1024., 0.3, max}
           50
{736, 1. 10  , 1024., 0.3, max}
           50
{737, 1. 10  , 512., 0.3, max}
           50
{738, 1. 10  , 2048., 0.3, max}
           50
{739, 1. 10  , 1024., 0.3, max}
           50
{740, 1. 10  , 2048., 0.3, max}
RowBox[{RowBox[{"corrs", "=", RowBox[{"Table", "[", RowBox[{RowBox[{"Most", "[", RowBox[{"Import", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{RowBox[{"DirectoryName", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "n", "]"}], "]"}], "]"}], ",", "\"correlation.txt\""}], "}"}], "]"}], ",", "\"Table\""}], "]"}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", "731", ",", "740"}], "}"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"scratch1", "=", "\"/mnt/\""}], ";"}]
RowBox[{RowBox[{"scratch2", "=", "\"/nobackups/jlang/\""}], ";"}]
RowBox[{RowBox[{"outdir", "=", "\"~/Nextcloud/Spin-glass/Codes/Compressed/\""}], ";"}]
RowBox[{RowBox[{"paramnames", "=", RowBox[{"Union", "[", RowBox[{RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch1", ",", "\"Results_new\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results_new\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results_new2\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results_HPC\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "loadparams", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"loadparams", "[", "file_", "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{RowBox[{"Import", "[", "file", "]"}], ",", "1"}], "]"}], "==", "\"#\""}], ",", RowBox[{"Module", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{RowBox[{"Clear", "[", RowBox[{"{", RowBox[{"p", ",", "p2", ",", "\[Lambda]", ",", "\[CapitalGamma]", ",", "T0", ",", "\[Delta]tMin", ",", "\[Delta]max", ",", "len"}], "}"}], "]"}], ";", RowBox[{RowBox[{"{", RowBox[{"p", ",", "p2", ",", "\[Lambda]", ",", "\[CapitalGamma]", ",", "T0", ",", "\[Delta]tMin", ",", "\[Delta]max", ",", "len"}], "}"}], "=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"data", ",", "lines", ",", "p", ",", "p2", ",", "\[Lambda]", ",", "\[CapitalGamma]", ",", "T0", ",", "\[Delta]tMin", ",", "\[Delta]max", ",", "len"}], "}"}], ",", RowBox[{RowBox[{"data", "=", RowBox[{"Import", "[", RowBox[{"file", ",", "\"String\""}], "]"}]}], ";", RowBox[{"lines", "=", RowBox[{"StringSplit", "[", RowBox[{"data", ",", "\"\\n\""}], "]"}]}], ";", RowBox[{RowBox[{"extractValue", "[", RowBox[{"line_", ",", "key_"}], "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"valStr", ",", "parsed"}], "}"}], ",", RowBox[{RowBox[{"valStr", "=", RowBox[{"StringReplace", "[", RowBox[{"line", ",", RowBox[{RowBox[{"key", "<>", "\" = \""}], "->", "\"\""}]}], "]"}]}], ";", RowBox[{"valStr", "=", RowBox[{"StringTrim", "[", "valStr", "]"}]}], ";", RowBox[{"parsed", "=", RowBox[{"ToExpression", "[", RowBox[{"StringReplace", "[", RowBox[{"valStr", ",", RowBox[{RowBox[{"RegularExpression", "[", "\"([eE])\"", "]"}], "->", "\"*10^\""}]}], "]"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Head", "[", "parsed", "]"}], "===", "List"}], ",", "parsed", ",", RowBox[{"N", "[", "parsed", "]"}]}], "]"}]}]}], "]"}]}], ";", RowBox[{"p", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"p = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"p\""}], "]"}]}], ";", RowBox[{"p2", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"p2 = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"p2\""}], "]"}]}], ";", RowBox[{"\[Lambda]", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"lambda = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"lambda\""}], "]"}]}], ";", RowBox[{"\[CapitalGamma]", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"Gamma = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"Gamma\""}], "]"}]}], ";", RowBox[{"T0", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"T0 = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"T0\""}], "]"}]}], ";", RowBox[{"\[Delta]tMin", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"delta_t_min = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"delta_t_min\""}], "]"}]}], ";", RowBox[{"\[Delta]max", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"delta_max = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"delta_max\""}], "]"}]}], ";", RowBox[{"len", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"len = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"len\""}], "]"}]}], ";", RowBox[{"{", RowBox[{"p", ",", "p2", ",", "\[Lambda]", ",", "\[CapitalGamma]", ",", "T0", ",", "\[Delta]tMin", ",", "\[Delta]tMax", ",", "len"}], "}"}]}]}], "]"}]}], ";"}]}], "]"}], ",", RowBox[{RowBox[{"Module", "[", RowBox[{RowBox[{"{", "params", "}"}], ",", RowBox[{RowBox[{"Clear", "[", "T0", "]"}], ";", RowBox[{"params", "=", RowBox[{"Import", "[", "file", "]"}]}], ";", RowBox[{"Clear", "@@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"StringTrim", "[", "#", "]"}], "&"}], "/@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{"params", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{RowBox[{"Prepend", "[", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"\\n\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "0"}], "]"}], "+", "1"}], ",", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"=\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", "1"}]}], "}"}], "]"}]}], ")"}]}], ")"}]}], ";", RowBox[{RowBox[{"Evaluate", "[", RowBox[{"ToExpression", "[", RowBox[{RowBox[{RowBox[{"StringTrim", "[", "#", "]"}], "&"}], "/@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{"params", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{RowBox[{"Prepend", "[", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"\\n\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "0"}], "]"}], "+", "1"}], ",", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"=\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", "1"}]}], "}"}], "]"}]}], ")"}]}], "]"}], "]"}], "=", RowBox[{"ToExpression", "[", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{"params", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"=\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], "+", "1"}], ",", RowBox[{"Append", "[", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"\\n\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", RowBox[{"-", "1"}]}], "]"}]}], "}"}], "]"}]}], "]"}]}], ";", RowBox[{"len", "=", RowBox[{"Round", "[", "len", "]"}]}], ";", RowBox[{"ord", "=", RowBox[{"Round", "[", "ord", "]"}]}], ";", RowBox[{"method", "=", RowBox[{"Round", "[", "method", "]"}]}], ";"}]}], "]"}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"bsearch", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Complex", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", "0"}]}], "}"}], ",", RowBox[{RowBox[{"While", "[", RowBox[{RowBox[{"n0", "<=", "n1"}], ",", RowBox[{RowBox[{"m", "=", RowBox[{"Floor", "[", RowBox[{RowBox[{"(", RowBox[{"n0", "+", "n1"}], ")"}], "/", "2"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "==", "elem"}], ",", RowBox[{"Return", "[", "m", "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "-", "elem"}], "]"}], "<=", RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"Min", "[", RowBox[{RowBox[{"m", "+", "1"}], ",", RowBox[{"Length", "[", "list", "]"}]}], "]"}], "]"}], "]"}], "-", "elem"}], "]"}]}], ",", "m", ",", RowBox[{"m", "+", "1"}]}], "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "-", "elem"}], "]"}], "<=", RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"Max", "[", RowBox[{RowBox[{"m", "-", "1"}], ",", "1"}], "]"}], "]"}], "]"}], "-", "elem"}], "]"}]}], ",", "m", ",", RowBox[{"m", "-", "1"}]}], "]"}]}], "]"}]}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"diff", ":=", RowBox[{RowBox[{RowBox[{"Rest", "[", "#", "]"}], "-", RowBox[{"Most", "[", "#", "]"}]}], "&"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x_", "]"}], ":=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Delta]", "=", RowBox[{"1", "/", RowBox[{"(", RowBox[{"10", "\[Pi]", "Tmax"}], ")"}]}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Eta]", "=", RowBox[{"Rationalize", "[", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{"1", "/", "len"}], ")"}]}], "2", RowBox[{"ProductLog", "[", RowBox[{RowBox[{"-", "1"}], ",", RowBox[{RowBox[{"-", "\[Pi]"}], "\[Delta]"}]}], "]"}]}], "]"}]}], "}"}], ",", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"x", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}], "-", RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}]}], ")"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}], "]"}]}], "-", RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}]}], "\[Eta]"}], ")"}]}], "]"}]}]}], ")"}]}]}], "]"}]}], "]"}], ",", "40"}], "]"}]}], ";"}]
RowBox[{RowBox[{"bsearchPosSorted", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", "1"}], ",", RowBox[{"Lm", "=", "1."}], ",", RowBox[{"El", "=", "1."}]}], "}"}], ",", RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"El", "=", RowBox[{"elem", "[", RowBox[{"[", "l", "]"}], "]"}]}], ";", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "El"}], ",", RowBox[{"While", "[", RowBox[{RowBox[{"n0", "<=", "n1"}], ",", RowBox[{RowBox[{"m", "=", RowBox[{"Quotient", "[", RowBox[{RowBox[{"n0", "+", "n1"}], ",", "2"}], "]"}]}], ";", RowBox[{"Lm", "=", RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "==", "El"}], ",", RowBox[{"n0", "=", "m"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "<", "El"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}]}], "]"}], ";", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "<=", "El"}], ",", RowBox[{"m", "+", RowBox[{"If", "[", RowBox[{RowBox[{"m", "==", RowBox[{"Length", "[", "list", "]"}]}], ",", "0.", ",", RowBox[{RowBox[{"(", RowBox[{"El", "-", "Lm"}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"m", "+", "1"}], "]"}], "]"}], "-", "Lm"}], ")"}]}]}], "]"}]}], ",", RowBox[{"m", "-", RowBox[{"If", "[", RowBox[{RowBox[{"m", ">", "1"}], ",", RowBox[{RowBox[{"(", RowBox[{"El", "-", "Lm"}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"m", "-", "1"}], "]"}], "]"}], "-", "Lm"}], ")"}]}], ",", "0."}], "]"}]}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"l", ",", RowBox[{"Length", "[", "elem", "]"}]}], "}"}]}], "]"}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}], ",", RowBox[{"RuntimeOptions", "->", "\"Speed\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"loadLibrary", ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"libname", "=", RowBox[{"\"Interpol-mt.\"", "<>", RowBox[{"Switch", "[", RowBox[{"$OperatingSystem", ",", "\"Unix\"", ",", "\"so\"", ",", "\"Windows\"", ",", "\"dll\"", ",", "\"MacOSX\"", ",", "\"dylib\""}], "]"}]}]}], ",", "filename"}], "}"}], ",", RowBox[{RowBox[{"filename", "=", RowBox[{"FileNames", "[", RowBox[{"libname", ",", RowBox[{"NotebookDirectory", "[", "]"}], ",", "2"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "filename", "]"}], "!=", "0"}], ",", RowBox[{RowBox[{"filename", "=", RowBox[{"filename", "[", RowBox[{"[", "1", "]"}], "]"}]}], ";", RowBox[{"Quiet", "[", RowBox[{RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Head", "[", "#", "]"}], "===", "LibraryFunction"}], ",", RowBox[{"LibraryFunctionUnload", "[", "#", "]"}]}], "]"}], "&"}], "/@", RowBox[{"Unevaluated", "[", RowBox[{"{", RowBox[{"build", ",", "clearAll", ",", "clearOne", ",", "append", ",", "deleteN", ",", "replace", ",", "replaceD", ",", "prod2", ",", "clip", ",", "output", ",", "getLast", ",", "conv", ",", "index", ",", "indexVec", ",", "indexVecN", ",", "indexVecLN", ",", "Interpol1D3c", ",", "indexVecR", ",", "indexVecR2", ",", "indexVecL", ",", "indexMat", ",", "indexMatN", ",", "indexMatN3", ",", "indexMatAll", ",", "indexMatMerge", ",", "\[CapitalSigma]Rnum", ",", "\[CapitalSigma]Knum"}], "}"}], "]"}]}], ";"}], "]"}], ";", RowBox[{"build", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"build\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"buildOne", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"buildOne\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", "Integer"}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"clearAll", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"clearAll\"", ",", RowBox[{"{", "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"clearOne", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"clearOne\"", ",", RowBox[{"{", "Integer", "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"append", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"append\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"deleteN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"deleteN\"", ",", RowBox[{"{", "Integer", "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"replace", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"replace\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"replaceD", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"replaceD\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"output", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"output\"", ",", RowBox[{"{", "Integer", "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"getLast", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"getLast\"", ",", RowBox[{"{", RowBox[{"Integer", ",", "Integer"}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"prod2", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"prod2\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"clip", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"clip\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"\[CapitalSigma]Rnum", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"sigmaR\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"\[CapitalSigma]Knum", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"sigmaK\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"conv", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"conv\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"index", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"index\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVec", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVec\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecN\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"indexVecR", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecR\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecR2", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecR2\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecL", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecL\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecLN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecLN\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"Interpol1D3c", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"Interpol1D3c\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"indexMat", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMat\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatN\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatN3", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatN3\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatAll", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatAll\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatMerge", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatMerge\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}]}], ",", RowBox[{"Clear", "[", RowBox[{"build", ",", "buildOne", ",", "clearAll", ",", "clearOne", ",", "deleteN", ",", "append", ",", "replace", ",", "replaceD", ",", "output", ",", "getLast", ",", "conv", ",", "index", ",", "indexVec", ",", "indexVecN", ",", "indexVecLN", ",", "Interpol1D3c", ",", "indexVecR", ",", "indexVecR2", ",", "indexVecL", ",", "indexMat", ",", "indexMatN", ",", "indexMatN3", ",", "indexMatAll", ",", "indexMatMerge"}], "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "conv", "]"}]}], ",", RowBox[{RowBox[{"conv", "[", RowBox[{"int_", ",", "m1_", ",", "m2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"m1", "*", "m2"}], ")"}], ".", "int"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "index", "]"}]}], ",", RowBox[{RowBox[{"index", "[", RowBox[{"list_", ",", "inds_"}], "]"}], ":=", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecL", "]"}]}], ",", RowBox[{RowBox[{"indexVecL", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "1"}], "]"}], "]"}]}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecL3", "]"}]}], ",", RowBox[{RowBox[{"indexVecL3", "[", RowBox[{"list_", ",", "weightsIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"weights", "=", RowBox[{"ArrayReshape", "[", RowBox[{"weightsIn", ",", RowBox[{"{", RowBox[{RowBox[{"len", "^", "2"}], ",", RowBox[{RowBox[{"Length", "[", "weightsIn", "]"}], "/", RowBox[{"len", "^", "2"}]}]}], "}"}]}], "]"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{"Sum", "[", RowBox[{RowBox[{RowBox[{"weights", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"n", "+", "1"}]}], "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "n"}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", RowBox[{"weights", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVec", "]"}]}], ",", RowBox[{RowBox[{"indexVec", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "indsIn", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecR", "]"}]}], ",", RowBox[{RowBox[{"indexVecR", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "indsIn", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecR2", "]"}]}], ",", RowBox[{RowBox[{"indexVecR2", "[", RowBox[{"list_", ",", "dlist_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_", ",", "\[Delta]tratio_"}], "]"}], ":=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"\[CapitalDelta]xvecIn", "^", "2"}]}], ")"}], "*", RowBox[{"list", "[", RowBox[{"[", "indsIn", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "^", "2"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"\[CapitalDelta]xvecIn", "-", RowBox[{"\[CapitalDelta]xvecIn", "^", "2"}]}], ")"}], "*", RowBox[{"dlist", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexMat", "]"}]}], ",", RowBox[{RowBox[{"indexMat", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "\[CapitalDelta]yvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}], ",", RowBox[{"\[CapitalDelta]yvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]yvecIn"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "1"}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "len"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", RowBox[{"(", RowBox[{"len", "+", "1"}], ")"}]}], "]"}], "]"}]}]}], ")"}]}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexMat3", "]"}]}], ",", RowBox[{RowBox[{"indexMat3", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "weightsyIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}], ",", RowBox[{"weightsy", "=", RowBox[{"ArrayReshape", "[", RowBox[{"weightsyIn", ",", RowBox[{"{", RowBox[{RowBox[{"len", "^", "2"}], ",", RowBox[{RowBox[{"Length", "[", "weightsyIn", "]"}], "/", RowBox[{"len", "^", "2"}]}]}], "}"}]}], "]"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"Sum", "[", RowBox[{RowBox[{RowBox[{"weightsy", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"n", "+", "1"}]}], "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "n"}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", RowBox[{"weightsy", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"Sum", "[", RowBox[{RowBox[{RowBox[{"weightsy", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"n", "+", "1"}]}], "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", RowBox[{"(", RowBox[{"n", "+", "len"}], ")"}]}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", RowBox[{"weightsy", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}]}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexMatMerge", "]"}]}], ",", RowBox[{RowBox[{"indexMatMerge", "[", RowBox[{"list_", ",", "defaultlist_", ",", "\[CapitalDelta]xvecIn_", ",", "\[CapitalDelta]yvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"mask", "=", RowBox[{"Subtract", "[", RowBox[{"1", ",", RowBox[{"UnitStep", "[", RowBox[{"-", "indsIn"}], "]"}]}], "]"}]}], ",", RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}], ",", RowBox[{"\[CapitalDelta]yvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]yvecIn"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{"mask", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "1"}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "len"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", RowBox[{"(", RowBox[{"len", "+", "1"}], ")"}]}], "]"}], "]"}]}]}], ")"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"1", "-", "mask"}], ")"}], "defaultlist"}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"buildLowMem", "[", RowBox[{"fac_", ":", "1"}], "]"}], ":=", RowBox[{"(", RowBox[{RowBox[{"buildOne", "[", RowBox[{"QK", ",", "1"}], "]"}], ";", RowBox[{"QK", "=", RowBox[{"QK", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{"buildOne", "[", RowBox[{"QR", ",", "2"}], "]"}], ";", RowBox[{"QR", "=", RowBox[{"QR", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{"buildOne", "[", RowBox[{RowBox[{"fac", "dQK"}], ",", "3"}], "]"}], ";", RowBox[{"dQK", "=", RowBox[{"dQK", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{"buildOne", "[", RowBox[{RowBox[{"fac", "dQR"}], ",", "4"}], "]"}], ";", RowBox[{"dQR", "=", RowBox[{"dQR", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";"}], ")"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"SaveCompressed", "[", RowBox[{"file_String", ",", RowBox[{"mat_", "?", "MatrixQ"}]}], "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"rows", "=", RowBox[{"Length", "[", "mat", "]"}]}], ",", RowBox[{"cols", "=", RowBox[{"Length", "[", RowBox[{"First", "@", "mat"}], "]"}]}], ",", "htype", ",", "s"}], "}"}], ",", RowBox[{RowBox[{"htype", "=", RowBox[{"If", "[", RowBox[{RowBox[{"$SystemWordLength", "==", "64"}], ",", "\"UnsignedInteger64\"", ",", "\"UnsignedInteger32\""}], "]"}]}], ";", RowBox[{"s", "=", RowBox[{"OpenWrite", "[", RowBox[{"file", ",", RowBox[{"BinaryFormat", "->", "True"}]}], "]"}]}], ";", RowBox[{"BinaryWrite", "[", RowBox[{"s", ",", "rows", ",", "htype", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}], ";", RowBox[{"BinaryWrite", "[", RowBox[{"s", ",", "cols", ",", "htype", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}], ";", RowBox[{"BinaryWrite", "[", RowBox[{"s", ",", RowBox[{"N", "@", RowBox[{"Flatten", "[", "mat", "]"}]}], ",", "\"Real64\"", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}], ";", RowBox[{"Close", "[", "s", "]"}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"LoadCompressed", "[", "file_String", "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"try", ",", "rows", ",", "cols", ",", "cnt", ",", "data", ",", "s", ",", "headerBytes", ",", "fileBytes"}], "}"}], ",", RowBox[{RowBox[{RowBox[{"try", "[", "htype_", "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{RowBox[{"s", "=", RowBox[{"OpenRead", "[", RowBox[{"file", ",", RowBox[{"BinaryFormat", "->", "True"}]}], "]"}]}], ";", RowBox[{"rows", "=", RowBox[{"BinaryRead", "[", RowBox[{"s", ",", "htype", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}]}], ";", RowBox[{"cols", "=", RowBox[{"BinaryRead", "[", RowBox[{"s", ",", "htype", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"!", RowBox[{"IntegerQ", "[", "rows", "]"}]}], "||", RowBox[{"!", RowBox[{"IntegerQ", "[", "cols", "]"}]}], "||", RowBox[{"rows", "<=", "0"}], "||", RowBox[{"cols", "<=", "0"}]}], ",", RowBox[{RowBox[{"Close", "[", "s", "]"}], ";", RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", RowBox[{"headerBytes", "=", RowBox[{"2", "*", RowBox[{"If", "[", RowBox[{RowBox[{"htype", "===", "\"UnsignedInteger64\""}], ",", "8", ",", "4"}], "]"}]}]}], ";", RowBox[{"fileBytes", "=", RowBox[{"FileByteCount", "[", "file", "]"}]}], ";", RowBox[{"cnt", "=", RowBox[{"rows", "*", "cols"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"fileBytes", "<", RowBox[{"headerBytes", "+", RowBox[{"8", "cnt"}]}]}], ",", RowBox[{RowBox[{"Close", "[", "s", "]"}], ";", RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", RowBox[{"data", "=", RowBox[{"BinaryReadList", "[", RowBox[{"s", ",", "\"Real64\"", ",", "cnt", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}]}], ";", RowBox[{"Close", "[", "s", "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "data", "]"}], "==", "cnt"}], ",", RowBox[{"Partition", "[", RowBox[{"data", ",", "cols"}], "]"}], ",", "$Failed"}], "]"}]}]}], "]"}]}], ";", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"m64", "=", RowBox[{"try", "[", "\"UnsignedInteger64\"", "]"}]}], "}"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"m64", "=!=", "$Failed"}], ",", "m64", ",", RowBox[{"try", "[", "\"UnsignedInteger32\"", "]"}]}], "]"}]}], "]"}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "splineCoeffs", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"SyntaxInformation", "[", "splineCoeffs", "]"}], "=", RowBox[{"{", RowBox[{"\"ArgumentsPattern\"", "->", RowBox[{"{", RowBox[{"_", ",", RowBox[{"OptionsPattern", "[", "]"}]}], "}"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{"SetAttributes", "[", RowBox[{"splineCoeffs", ",", "HoldAll"}], "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "splineCoeffs", "]"}], "=", RowBox[{"{", RowBox[{RowBox[{"\"Five\"", "->", "False"}], ",", RowBox[{"\"Last\"", "->", "False"}], ",", RowBox[{"\"All\"", "->", "False"}], ",", RowBox[{"\"Mixed\"", "->", "True"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"splineCoeffs", "::", "padInput"}], "=", "\"interpolation matrices cannot be generated from a precomputed second-highest coefficient matrix when the padding is set to be non-zero.\""}], ";"}]
RowBox[{RowBox[{"splineCoeffs", "[", RowBox[{RowBox[{"{", RowBox[{"points_", ",", RowBox[{"cmatIn_", ":", "0"}], ",", RowBox[{"precIn_", ":", "precision"}], ",", RowBox[{"padding_", ":", "15"}]}], "}"}], ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"pts", ",", "h", ",", "rot", ",", "n", ",", "id", ",", "amat", ",", "bmat", ",", "cmat", ",", "cmat2", ",", "dmat", ",", "emat", ",", "emat2", ",", "fmat", ",", "prec", ",", "padfc", ",", "padfcT", ",", "mixed"}], "}"}], ",", RowBox[{RowBox[{"mixed", "=", RowBox[{RowBox[{"OptionValue", "[", "\"Mixed\"", "]"}], "&&", RowBox[{"(", RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ")"}], "&&", RowBox[{"(", RowBox[{"padding", "!=", "0"}], ")"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"!", RowBox[{"(", RowBox[{"cmatIn", "===", "0"}], ")"}]}], "&&", RowBox[{"padding", "!=", "0"}]}], ",", RowBox[{RowBox[{"Message", "[", RowBox[{"splineCoeffs", "::", "padInput"}], "]"}], ";"}], ",", RowBox[{RowBox[{RowBox[{"padfc", "[", "x_", "]"}], ":=", RowBox[{"x", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], ";", RowBox[{RowBox[{"padfcT", "[", "x_", "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "x", "]"}], ">", RowBox[{"Length", "[", "points", "]"}]}], ",", RowBox[{"x", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], "]"}], "]"}], ",", "x"}], "]"}]}], ";", RowBox[{"prec", "=", RowBox[{"If", "[", RowBox[{RowBox[{"cmatIn", "===", "0"}], ",", "precIn", ",", RowBox[{"Precision", "[", "cmatIn", "]"}]}], "]"}]}], ";", RowBox[{"pts", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"Join", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "points", ",", RowBox[{"Join", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], "-", RowBox[{"Reverse", "[", RowBox[{"Range", "[", "padding", "]"}], "]"}]}], ",", "points"}], "]"}]}], "]"}], ",", RowBox[{RowBox[{"points", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{"Range", "[", "padding", "]"}]}]}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"h", "=", RowBox[{"Subtract", "[", RowBox[{RowBox[{"RotateLeft", "[", "pts", "]"}], ",", "pts"}], "]"}]}], ";", RowBox[{"n", "=", RowBox[{"Length", "[", "pts", "]"}]}], ";", RowBox[{"rot", "=", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{RowBox[{"Band", "[", RowBox[{"{", RowBox[{"1", ",", "1"}], "}"}], "]"}], "->", RowBox[{"-", "1"}]}], ",", RowBox[{RowBox[{"Band", "[", RowBox[{"{", RowBox[{"1", ",", "2"}], "}"}], "]"}], "->", "1"}]}], "}"}], ",", RowBox[{"{", RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", RowBox[{"id", "=", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"Band", "[", RowBox[{"{", RowBox[{"1", ",", "1"}], "}"}], "]"}], "->", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Five\"", "]"}]}], ",", RowBox[{RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"g0c", ",", "g1c", ",", "coefc", ",", "coefc2", ",", "Bc", ",", "Bc2", ",", "\[CapitalDelta]\[Omega]"}], "}"}], ",", RowBox[{RowBox[{"g0c", "=", RowBox[{RowBox[{"1", "/", "3"}], "rot"}]}], ";", RowBox[{"g1c", "=", RowBox[{RowBox[{"(", RowBox[{"id", "+", "g0c"}], ")"}], RowBox[{"(", RowBox[{"3", "h"}], ")"}]}]}], ";", RowBox[{"coefc", "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"Most", "[", RowBox[{RowBox[{"(", RowBox[{"6", "h"}], ")"}], "id"}], "]"}], "+", RowBox[{"Most", "[", RowBox[{RowBox[{"(", RowBox[{"9", "h"}], ")"}], "g0c"}], "]"}], "+", RowBox[{"diff", "[", "g1c", "]"}]}], ")"}], "/", RowBox[{"Most", "[", "h", "]"}]}]}], ";", RowBox[{"Bc", "=", RowBox[{RowBox[{"diff", "[", RowBox[{"rot", "/", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "/", "3"}], ")"}], "h"}], ")"}]}], "]"}], "/", RowBox[{"Most", "[", "h", "]"}]}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{RowBox[{"coefc2", "=", RowBox[{"coefc", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], ";", RowBox[{"coefc2", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], "+", RowBox[{"RotateRight", "[", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"Most", "[", "coefc2", "]"}], ",", RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"-", "padding"}], "-", "1"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], "+", RowBox[{"RotateLeft", "[", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"-", "padding"}], "-", "1"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}], "]"}]}], "}"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";"}]}], "]"}], ";", RowBox[{"coefc", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", "1", "]"}], "]"}]}], "+", RowBox[{"RotateRight", "[", RowBox[{"id", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"Most", "[", "coefc", "]"}], ",", RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "+", RowBox[{"RotateLeft", "[", RowBox[{"id", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bc", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"zer", "=", RowBox[{"ConstantArray", "[", RowBox[{"0", ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", RowBox[{"n", "-", "padding"}], ",", RowBox[{"n", "-", RowBox[{"2", "padding"}]}]}], "]"}]}], "]"}]}], "}"}], ",", RowBox[{"Catenate", "[", RowBox[{"{", RowBox[{RowBox[{"{", "zer", "}"}], ",", RowBox[{"Most", "[", RowBox[{"padfc", "[", RowBox[{"Normal", "[", "Bc", "]"}], "]"}], "]"}], ",", RowBox[{"{", "zer", "}"}]}], "}"}], "]"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bc2", "=", RowBox[{"Bc", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{RowBox[{"Bc2", "[", RowBox[{"[", RowBox[{"{", RowBox[{RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], "]"}], "*=", "0"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"cmatIn", "===", "0"}], ",", RowBox[{RowBox[{"cmat", "=", RowBox[{"LinearSolve", "[", RowBox[{"coefc", ",", "Bc"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{"cmat2", "=", RowBox[{"LinearSolve", "[", RowBox[{"coefc2", ",", "Bc2"}], "]"}]}]}], "]"}]}], ",", RowBox[{RowBox[{"cmat", "=", "cmatIn"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"SquareMatrixQ", "[", "cmat", "]"}]}], ",", RowBox[{"cmat", "=", RowBox[{"ArrayFlatten", "[", RowBox[{"{", RowBox[{RowBox[{"{", "cmat", "}"}], ",", RowBox[{"{", RowBox[{"{", RowBox[{RowBox[{"-", RowBox[{"cmat", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "/", "2"}], "}"}], "}"}]}], "}"}], "]"}]}]}], "]"}], ";"}]}], "]"}], ";", RowBox[{"dmat", "=", RowBox[{RowBox[{"diff", "[", "cmat", "]"}], "/", RowBox[{"(", RowBox[{"3", RowBox[{"Most", "[", "h", "]"}]}], ")"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ",", RowBox[{RowBox[{"rot", "=", RowBox[{"padfc", "[", "rot", "]"}]}], ";", RowBox[{"id", "=", RowBox[{"padfc", "[", "id", "]"}]}], ";", RowBox[{"\[CapitalDelta]\[Omega]", "=", RowBox[{"Most", "[", "h", "]"}]}], ";", RowBox[{"bmat", "=", RowBox[{RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "-", RowBox[{"\[CapitalDelta]\[Omega]", RowBox[{"(", RowBox[{RowBox[{"Most", "[", "cmat", "]"}], "+", RowBox[{RowBox[{"diff", "[", "cmat", "]"}], "/", "3"}]}], ")"}]}]}]}], ";", RowBox[{"amat", "=", RowBox[{"Most", "[", "id", "]"}]}], ";", RowBox[{"cmat", "=", RowBox[{"If", "[", RowBox[{"mixed", ",", "cmat2", ",", RowBox[{"Most", "[", "cmat", "]"}]}], "]"}]}]}]}], "]"}]}]}], "]"}], ";"}], ",", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"g0q", ",", "g1q", ",", "g2q", ",", "g3q", ",", "coefq", ",", "coefq2", ",", "Bq", ",", "Bq2", ",", "\[CapitalDelta]\[Omega]"}], "}"}], ",", RowBox[{RowBox[{"g0q", "=", RowBox[{RowBox[{"1", "/", "5"}], "rot"}]}], ";", RowBox[{"g1q", "=", RowBox[{"g0q", "+", "id"}]}], ";", RowBox[{"g2q", "=", RowBox[{RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"2", RowBox[{"h", "^", "2"}]}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"3", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], "+", RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"5", RowBox[{"h", "^", "2"}]}], ")"}], "g0q"}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], ")"}]}], "+", RowBox[{"diff", "[", RowBox[{"g1q", RowBox[{"h", "^", "3"}]}], "]"}]}]}], ";", RowBox[{"g3q", "=", RowBox[{RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"2", "h"}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"3", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], "+", RowBox[{"4", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], "+", RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"g0q", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"10", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], ")"}], RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], ")"}]}], "+", RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"4", "h"}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{RowBox[{"g0q", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{"10", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], ")"}]}]}], ")"}], RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}], "^", "2"}]}], "+", "g2q"}], ")"}]}], "]"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"cmatIn", "===", "0"}], ",", RowBox[{RowBox[{"coefq", "=", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"4", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"4", "h"}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], "+", RowBox[{RowBox[{"g0q", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{"10", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}]}], ")"}]}], "+", RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], "g3q"}], "]"}]}], ")"}]}]}], ";", RowBox[{"Bq", "=", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"4", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"diff", "[", RowBox[{"rot", "/", "h"}], "]"}]}], "]"}]}], "]"}]}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{RowBox[{"coefq2", "=", RowBox[{"coefq", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], ";", RowBox[{"coefq2", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], "+", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}], ",", RowBox[{"Most", "[", "coefq2", "]"}], ",", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{RowBox[{"-", "padding"}], "-", "2"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";"}]}], "]"}], ";", RowBox[{"coefq", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"id", "[", RowBox[{"[", RowBox[{";;", "2"}], "]"}], "]"}], ",", RowBox[{"coefq", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], ",", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{"-", "2"}], ";;"}], "]"}], "]"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bq", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"zer", "=", RowBox[{"ConstantArray", "[", RowBox[{"0", ",", RowBox[{"{", RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], "}"}], ",", RowBox[{"padfc", "[", RowBox[{"Catenate", "[", RowBox[{"{", RowBox[{RowBox[{"zer", "[", RowBox[{"[", RowBox[{";;", "2"}], "]"}], "]"}], ",", RowBox[{"Normal", "[", RowBox[{"Bq", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "]"}], ",", RowBox[{"zer", "[", RowBox[{"[", RowBox[{RowBox[{"-", "2"}], ";;"}], "]"}], "]"}]}], "}"}], "]"}], "]"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bq2", "=", RowBox[{"Bq", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{RowBox[{"Bq2", "[", RowBox[{"[", RowBox[{"1", ";;", "2"}], "]"}], "]"}], "*=", "0"}], ";", RowBox[{RowBox[{"Bq2", "[", RowBox[{"[", RowBox[{RowBox[{"-", "2"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}], "*=", "0"}], ";", RowBox[{"emat", "=", RowBox[{"Chop", "[", RowBox[{RowBox[{"LinearSolve", "[", RowBox[{"coefq", ",", "Bq"}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{"emat2", "=", RowBox[{"Chop", "[", RowBox[{RowBox[{"LinearSolve", "[", RowBox[{"coefq2", ",", "Bq2"}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], "]"}]}]}], "]"}], ";"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"SquareMatrixQ", "[", "emat", "]"}]}], ",", RowBox[{"emat", "=", RowBox[{"ArrayFlatten", "[", RowBox[{"{", RowBox[{RowBox[{"{", "cmatIn", "}"}], ",", RowBox[{"{", RowBox[{"{", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{"{", "n", "}"}]}], "]"}], "}"}], "}"}]}], "}"}], "]"}]}]}], "]"}], ";"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ",", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "=", RowBox[{"Most", "[", "h", "]"}]}], ";", RowBox[{"fmat", "=", RowBox[{RowBox[{"diff", "[", "emat", "]"}], "/", RowBox[{"(", RowBox[{"5", "\[CapitalDelta]\[Omega]"}], ")"}]}]}], ";", RowBox[{"rot", "=", RowBox[{"padfc", "[", "rot", "]"}]}], ";", RowBox[{"id", "=", RowBox[{"padfc", "[", "id", "]"}]}], ";", RowBox[{"dmat", "=", RowBox[{"Catenate", "[", RowBox[{RowBox[{RowBox[{"FoldList", "[", RowBox[{RowBox[{RowBox[{"{", RowBox[{"(", RowBox[{RowBox[{"#1", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"(", RowBox[{"4", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}]}], ")"}], RowBox[{"emat", "[", RowBox[{"[", RowBox[{"#2", "-", "1"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"10", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}], "^", "2"}]}], ")"}], RowBox[{"fmat", "[", RowBox[{"[", "#2", "]"}], "]"}]}]}], ")"}], "}"}], "&"}], ",", "#", ",", RowBox[{"{", RowBox[{RowBox[{"-", "3"}], ",", RowBox[{"-", "2"}]}], "}"}]}], "]"}], "&"}], "@", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"diff", "[", RowBox[{RowBox[{"diff", "[", RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "]"}], "/", RowBox[{"(", RowBox[{RowBox[{"Most", "[", "\[CapitalDelta]\[Omega]", "]"}], "+", RowBox[{"Rest", "[", "\[CapitalDelta]\[Omega]", "]"}]}], ")"}]}], "]"}], "-", RowBox[{"Most", "[", RowBox[{"g3q", ".", "emat"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], ")"}]}], "]"}]}], ";", RowBox[{"cmat", "=", RowBox[{"Catenate", "[", RowBox[{RowBox[{RowBox[{"FoldList", "[", RowBox[{RowBox[{RowBox[{"{", RowBox[{"(", RowBox[{RowBox[{"#1", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"(", RowBox[{"3", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}]}], ")"}], RowBox[{"dmat", "[", RowBox[{"[", "#2", "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"6", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}], "^", "2"}]}], ")"}], RowBox[{"emat", "[", RowBox[{"[", RowBox[{"#2", "-", "1"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"10", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}], "^", "3"}]}], ")"}], RowBox[{"fmat", "[", RowBox[{"[", "#2", "]"}], "]"}]}]}], ")"}], "}"}], "&"}], ",", "#", ",", RowBox[{"{", RowBox[{"-", "2"}], "}"}]}], "]"}], "&"}], "@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"diff", "[", RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "]"}], "-", RowBox[{"diff", "[", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "^", "2"}], "dmat"}], "]"}], "-", RowBox[{"Most", "[", RowBox[{"g2q", ".", "emat"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"Most", "[", "\[CapitalDelta]\[Omega]", "]"}], "+", RowBox[{"Rest", "[", "\[CapitalDelta]\[Omega]", "]"}]}], ")"}]}], "-", RowBox[{RowBox[{"(", RowBox[{"3", RowBox[{"Most", "[", "\[CapitalDelta]\[Omega]", "]"}]}], ")"}], RowBox[{"Most", "[", "dmat", "]"}]}]}], ")"}]}], "]"}]}], ";", RowBox[{"bmat", "=", RowBox[{RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "-", RowBox[{"\[CapitalDelta]\[Omega]", "cmat"}], "-", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "^", "2"}], "dmat"}], "-", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "^", "3"}], RowBox[{"Most", "[", RowBox[{"g1q", ".", "emat"}], "]"}]}]}]}], ";", RowBox[{"amat", "=", RowBox[{"Most", "[", "id", "]"}]}], ";", RowBox[{"emat", "=", RowBox[{"If", "[", RowBox[{"mixed", ",", "emat2", ",", RowBox[{"Most", "[", "emat", "]"}]}], "]"}]}], ";"}], ",", RowBox[{RowBox[{"fmat", "=", RowBox[{RowBox[{"diff", "[", "emat", "]"}], "/", RowBox[{"(", RowBox[{"5", RowBox[{"Most", "[", "h", "]"}]}], ")"}]}]}], ";", RowBox[{"emat", "=", RowBox[{"Most", "[", "emat", "]"}]}], ";"}]}], "]"}]}]}], "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", RowBox[{RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "#", ",", RowBox[{"padfcT", "[", "#", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}], "&"}], "/@", RowBox[{"{", RowBox[{"amat", ",", "bmat", ",", "cmat", ",", "dmat", ",", "emat", ",", "fmat"}], "}"}]}], ",", RowBox[{RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "#", ",", RowBox[{"padfcT", "[", "#", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}], "&"}], "/@", RowBox[{"{", RowBox[{"amat", ",", "bmat", ",", "cmat", ",", "dmat"}], "}"}]}]}], "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "fmat", ",", RowBox[{"padfcT", "[", "fmat", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}], ",", RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "dmat", ",", RowBox[{"padfcT", "[", "dmat", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}]}], "]"}]}], "]"}]}]}], "]"}]}]}], "]"}]}]
RowBox[{RowBox[{"Clear", "[", "createInt", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "createInt", "]"}], "=", RowBox[{"{", RowBox[{"\"Five\"", "->", "False"}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"createInt", "[", RowBox[{RowBox[{"{", RowBox[{"\[Tau]pts_", ",", RowBox[{"cmatIn_", ":", "0"}], ",", RowBox[{"prec_", ":", "precision"}]}], "}"}], ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Quiet", "[", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"IL4jk", ",", "IL6jk", ",", "f0", ",", "f1", ",", "f2", ",", "f3", ",", "f4", ",", "f5", ",", RowBox[{"Len", "=", RowBox[{"Length", "[", "\[Tau]pts", "]"}]}]}], "}"}], ",", RowBox[{RowBox[{RowBox[{"f0", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"-", "\[Omega]1"}], "+", "\[Omega]2"}]}], ";", RowBox[{RowBox[{"f1", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "2"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "2"}]}]}], ";", RowBox[{RowBox[{"f2", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "3"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "3"}]}]}], ";", RowBox[{RowBox[{"f3", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "4"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "4"}]}]}], ";", RowBox[{RowBox[{"f4", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "5"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "5"}]}]}], ";", RowBox[{RowBox[{"f5", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "6"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "6"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", RowBox[{"IL6jk", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"f0", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f1", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f2", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f3", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f4", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f5", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}]}], "}"}], ",", "prec"}], "]"}]}], ",", RowBox[{"IL4jk", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"f0", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f1", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f2", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f3", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}]}], "}"}], ",", "prec"}], "]"}]}]}], "]"}], ";", RowBox[{"Integrator", "=", RowBox[{"Accumulate", "[", RowBox[{"Prepend", "[", RowBox[{RowBox[{"Total", "[", RowBox[{"MapThread", "[", RowBox[{"Times", ",", RowBox[{"{", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", "IL6jk", ",", "IL4jk"}], "]"}], ",", RowBox[{RowBox[{"splineCoeffs", "[", RowBox[{RowBox[{"{", RowBox[{"\[Tau]pts", ",", "cmatIn", ",", "prec", ",", "0"}], "}"}], ",", RowBox[{"\"Five\"", "->", RowBox[{"OptionValue", "[", "\"Five\"", "]"}]}]}], "]"}], "+", RowBox[{"10.", "^", RowBox[{"-", "200"}]}]}]}], "}"}]}], "]"}], "]"}], ",", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{"Length", "[", "\[Tau]pts", "]"}]}], "]"}]}], "]"}], "]"}]}], ";", RowBox[{"int", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"Integrator", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "]"}]}]}]}], "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"f\[Lambda]", "[", "q_", "]"}], ":=", RowBox[{RowBox[{"\[Lambda]", RowBox[{"q", "^", "p"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"1", "-", "\[Lambda]"}], ")"}], RowBox[{"q", "^", "p2"}]}]}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Energy", "[", RowBox[{"QK_", ",", "QR_", ",", "t_", ",", "\[Beta]_"}], "]"}], ":=", RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"t", RowBox[{RowBox[{"(", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "QK", "]"}], "*", "QR"}], ")"}], ".", "int"}]}], "+", RowBox[{"\[Beta]", RowBox[{"f\[Lambda]", "[", RowBox[{"If", "[", RowBox[{RowBox[{"MatrixQ", "[", "QK", "]"}], ",", RowBox[{"QK", "[", RowBox[{"[", RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", RowBox[{"QK", "[", RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}]}], ")"}]}]}], ";"}]
RowBox[{RowBox[{"Eth", ":=", RowBox[{RowBox[{"Sqrt", "[", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{RowBox[{"f\[Lambda]", "[", "1", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}], "-", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}], "-", RowBox[{RowBox[{"f\[Lambda]", "[", "1", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}]}], ")"}]}]}], ";"}]
RowBox[{RowBox[{"outparamnames", "=", RowBox[{"Union", "[", RowBox[{RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", "outdir", ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"loadparams", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "i", "]"}], "]"}], "]"}], ";", RowBox[{"dir", "=", RowBox[{"FileNameTake", "[", RowBox[{RowBox[{"outparamnames", "[", RowBox[{"[", "i", "]"}], "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"-", "2"}]}], "}"}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "T0", "]"}]}], "||", RowBox[{"T0", ">=", SuperscriptBox["10", "50"]}]}], ")"}], "&&", RowBox[{"p", "==", "3"}], "&&", RowBox[{"p2", "==", "3"}], "&&", RowBox[{"\[Gamma]", "==", "0"}]}], ",", RowBox[{"Print", "[", RowBox[{"{", RowBox[{"i", ",", "T0", ",", "len", ",", "\[Lambda]", ",", "\[Delta]max"}], "}"}], "]"}], ",", RowBox[{RowBox[{"##", "&"}], "[", "]"}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"i", ",", RowBox[{"Length", "[", "outparamnames", "]"}]}], "}"}]}], "]"}], ";"}]
                         -10
{295, T0, 512, 0.5, 1. 10   }
                         -10
{321, T0, 512, 0.5, 1. 10   }
                          -10
{327, T0, 1024, 0.5, 1. 10   }
                               -10
{707, Infinity, 512, 0.5, 1. 10   }
           50                  -10
{731, 1. 10  , 512., 0.3, 1. 10   }
           50                  -10
{732, 1. 10  , 512., 0.3, 1. 10   }
           50                  -10
{733, 1. 10  , 512., 0.3, 1. 10   }
           50                   -10
{734, 1. 10  , 2048., 0.3, 1. 10   }
           50                   -10
{735, 1. 10  , 1024., 0.3, 1. 10   }
           50                   -10
{736, 1. 10  , 1024., 0.3, 1. 10   }
           50                  -10
{737, 1. 10  , 512., 0.3, 1. 10   }
           50                   -10
{738, 1. 10  , 2048., 0.3, 1. 10   }
           50                   -10
{739, 1. 10  , 1024., 0.3, 1. 10   }
           50                   -10
{740, 1. 10  , 2048., 0.3, 1. 10   }
RowBox[{RowBox[{"corrs", "=", RowBox[{"Table", "[", RowBox[{RowBox[{"Most", "[", RowBox[{"Import", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{RowBox[{"DirectoryName", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "n", "]"}], "]"}], "]"}], ",", "\"correlation.txt\""}], "}"}], "]"}], ",", "\"Table\""}], "]"}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", "731", ",", "740"}], "}"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"scratch1", "=", "\"/mnt/\""}], ";"}]
RowBox[{RowBox[{"scratch2", "=", "\"/nobackups/jlang/\""}], ";"}]
RowBox[{RowBox[{"outdir", "=", "\"~/Nextcloud/Spin-glass/Codes/Compressed/\""}], ";"}]
RowBox[{RowBox[{"paramnames", "=", RowBox[{"Union", "[", RowBox[{RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch1", ",", "\"Results_new\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results_new\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results_new2\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results_HPC\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "loadparams", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"loadparams", "[", "file_", "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{RowBox[{"Import", "[", "file", "]"}], ",", "1"}], "]"}], "==", "\"#\""}], ",", RowBox[{"Module", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{RowBox[{"Clear", "[", RowBox[{"{", RowBox[{"p", ",", "p2", ",", "\[Lambda]", ",", "\[CapitalGamma]", ",", "T0", ",", "\[Delta]tMin", ",", "\[Delta]max", ",", "len"}], "}"}], "]"}], ";", RowBox[{RowBox[{"{", RowBox[{"p", ",", "p2", ",", "\[Lambda]", ",", "\[CapitalGamma]", ",", "T0", ",", "\[Delta]tMin", ",", "\[Delta]max", ",", "len"}], "}"}], "=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"data", ",", "lines", ",", "p", ",", "p2", ",", "\[Lambda]", ",", "\[CapitalGamma]", ",", "T0", ",", "\[Delta]tMin", ",", "\[Delta]max", ",", "len"}], "}"}], ",", RowBox[{RowBox[{"data", "=", RowBox[{"Import", "[", RowBox[{"file", ",", "\"String\""}], "]"}]}], ";", RowBox[{"lines", "=", RowBox[{"StringSplit", "[", RowBox[{"data", ",", "\"\\n\""}], "]"}]}], ";", RowBox[{RowBox[{"extractValue", "[", RowBox[{"line_", ",", "key_"}], "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"valStr", ",", "parsed"}], "}"}], ",", RowBox[{RowBox[{"valStr", "=", RowBox[{"StringReplace", "[", RowBox[{"line", ",", RowBox[{RowBox[{"key", "<>", "\" = \""}], "->", "\"\""}]}], "]"}]}], ";", RowBox[{"valStr", "=", RowBox[{"StringTrim", "[", "valStr", "]"}]}], ";", RowBox[{"parsed", "=", RowBox[{"ToExpression", "[", RowBox[{"StringReplace", "[", RowBox[{"valStr", ",", RowBox[{RowBox[{"RegularExpression", "[", "\"([eE])\"", "]"}], "->", "\"*10^\""}]}], "]"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Head", "[", "parsed", "]"}], "===", "List"}], ",", "parsed", ",", RowBox[{"N", "[", "parsed", "]"}]}], "]"}]}]}], "]"}]}], ";", RowBox[{"p", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"p = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"p\""}], "]"}]}], ";", RowBox[{"p2", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"p2 = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"p2\""}], "]"}]}], ";", RowBox[{"\[Lambda]", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"lambda = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"lambda\""}], "]"}]}], ";", RowBox[{"\[CapitalGamma]", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"Gamma = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"Gamma\""}], "]"}]}], ";", RowBox[{"T0", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"T0 = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"T0\""}], "]"}]}], ";", RowBox[{"\[Delta]tMin", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"delta_t_min = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"delta_t_min\""}], "]"}]}], ";", RowBox[{"\[Delta]max", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"delta_max = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"delta_max\""}], "]"}]}], ";", RowBox[{"len", "=", RowBox[{"extractValue", "[", RowBox[{RowBox[{"SelectFirst", "[", RowBox[{"lines", ",", RowBox[{RowBox[{"StringMatchQ", "[", RowBox[{"#", ",", RowBox[{"\"len = \"", "~~", "___"}]}], "]"}], "&"}]}], "]"}], ",", "\"len\""}], "]"}]}], ";", RowBox[{"{", RowBox[{"p", ",", "p2", ",", "\[Lambda]", ",", "\[CapitalGamma]", ",", "T0", ",", "\[Delta]tMin", ",", "\[Delta]max", ",", "len"}], "}"}]}]}], "]"}]}], ";"}]}], "]"}], ",", RowBox[{RowBox[{"Module", "[", RowBox[{RowBox[{"{", "params", "}"}], ",", RowBox[{RowBox[{"Clear", "[", "T0", "]"}], ";", RowBox[{"params", "=", RowBox[{"Import", "[", "file", "]"}]}], ";", RowBox[{"Clear", "@@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"StringTrim", "[", "#", "]"}], "&"}], "/@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{"params", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{RowBox[{"Prepend", "[", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"\\n\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "0"}], "]"}], "+", "1"}], ",", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"=\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", "1"}]}], "}"}], "]"}]}], ")"}]}], ")"}]}], ";", RowBox[{RowBox[{"Evaluate", "[", RowBox[{"ToExpression", "[", RowBox[{RowBox[{RowBox[{"StringTrim", "[", "#", "]"}], "&"}], "/@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{"params", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{RowBox[{"Prepend", "[", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"\\n\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "0"}], "]"}], "+", "1"}], ",", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"=\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", "1"}]}], "}"}], "]"}]}], ")"}]}], "]"}], "]"}], "=", RowBox[{"ToExpression", "[", RowBox[{RowBox[{RowBox[{"StringTake", "[", RowBox[{"params", ",", "#"}], "]"}], "&"}], "/@", RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"=\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], "+", "1"}], ",", RowBox[{"Append", "[", RowBox[{RowBox[{RowBox[{"StringPosition", "[", RowBox[{"params", ",", "\"\\n\""}], "]"}], "[", RowBox[{"[", RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", RowBox[{"-", "1"}]}], "]"}]}], "}"}], "]"}]}], "]"}]}], ";", RowBox[{"len", "=", RowBox[{"Round", "[", "len", "]"}]}], ";", RowBox[{"ord", "=", RowBox[{"Round", "[", "ord", "]"}]}], ";", RowBox[{"method", "=", RowBox[{"Round", "[", "method", "]"}]}], ";"}]}], "]"}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"bsearch", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Complex", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", "0"}]}], "}"}], ",", RowBox[{RowBox[{"While", "[", RowBox[{RowBox[{"n0", "<=", "n1"}], ",", RowBox[{RowBox[{"m", "=", RowBox[{"Floor", "[", RowBox[{RowBox[{"(", RowBox[{"n0", "+", "n1"}], ")"}], "/", "2"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "==", "elem"}], ",", RowBox[{"Return", "[", "m", "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "elem"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "-", "elem"}], "]"}], "<=", RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"Min", "[", RowBox[{RowBox[{"m", "+", "1"}], ",", RowBox[{"Length", "[", "list", "]"}]}], "]"}], "]"}], "]"}], "-", "elem"}], "]"}]}], ",", "m", ",", RowBox[{"m", "+", "1"}]}], "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "-", "elem"}], "]"}], "<=", RowBox[{"Abs", "[", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"Max", "[", RowBox[{RowBox[{"m", "-", "1"}], ",", "1"}], "]"}], "]"}], "]"}], "-", "elem"}], "]"}]}], ",", "m", ",", RowBox[{"m", "-", "1"}]}], "]"}]}], "]"}]}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"diff", ":=", RowBox[{RowBox[{RowBox[{"Rest", "[", "#", "]"}], "-", RowBox[{"Most", "[", "#", "]"}]}], "&"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"\[Theta]func", "[", "x_", "]"}], ":=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Delta]", "=", RowBox[{"1", "/", RowBox[{"(", RowBox[{"10", "\[Pi]", "Tmax"}], ")"}]}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"\[Eta]", "=", RowBox[{"Rationalize", "[", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{"1", "/", "len"}], ")"}]}], "2", RowBox[{"ProductLog", "[", RowBox[{RowBox[{"-", "1"}], ",", RowBox[{RowBox[{"-", "\[Pi]"}], "\[Delta]"}]}], "]"}]}], "]"}]}], "}"}], ",", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"x", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}], "-", RowBox[{"(", RowBox[{"1", "-", RowBox[{RowBox[{"(", RowBox[{"2", "/", "\[Pi]"}], ")"}], RowBox[{"ArcTan", "[", RowBox[{"1", "/", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}]}], "]"}]}]}], ")"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}], "\[Eta]"}], ")"}]}], "]"}]}], "-", RowBox[{RowBox[{"1", "/", "\[Pi]"}], "2", RowBox[{"ArcTan", "[", RowBox[{"E", "^", RowBox[{"(", RowBox[{RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"len", "/", "2"}], "-", RowBox[{"1", "/", "2"}]}], ")"}]}], "\[Eta]"}], ")"}]}], "]"}]}]}], ")"}]}]}], "]"}]}], "]"}], ",", "40"}], "]"}]}], ";"}]
RowBox[{RowBox[{"bsearchPosSorted", "=", RowBox[{"Compile", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"list", ",", "_Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"elem", ",", "_Real", ",", "1"}], "}"}]}], "}"}], ",", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"n0", "=", "1"}], ",", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ",", RowBox[{"m", "=", "1"}], ",", RowBox[{"Lm", "=", "1."}], ",", RowBox[{"El", "=", "1."}]}], "}"}], ",", RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"El", "=", RowBox[{"elem", "[", RowBox[{"[", "l", "]"}], "]"}]}], ";", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}], "<", "El"}], ",", RowBox[{"While", "[", RowBox[{RowBox[{"n0", "<=", "n1"}], ",", RowBox[{RowBox[{"m", "=", RowBox[{"Quotient", "[", RowBox[{RowBox[{"n0", "+", "n1"}], ",", "2"}], "]"}]}], ";", RowBox[{"Lm", "=", RowBox[{"list", "[", RowBox[{"[", "m", "]"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "==", "El"}], ",", RowBox[{"n0", "=", "m"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "<", "El"}], ",", RowBox[{"n0", "=", RowBox[{"m", "+", "1"}]}], ",", RowBox[{"n1", "=", RowBox[{"m", "-", "1"}]}]}], "]"}]}]}], "]"}]}], "]"}], ";", RowBox[{"n1", "=", RowBox[{"Length", "[", "list", "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"Lm", "<=", "El"}], ",", RowBox[{"m", "+", RowBox[{"If", "[", RowBox[{RowBox[{"m", "==", RowBox[{"Length", "[", "list", "]"}]}], ",", "0.", ",", RowBox[{RowBox[{"(", RowBox[{"El", "-", "Lm"}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"m", "+", "1"}], "]"}], "]"}], "-", "Lm"}], ")"}]}]}], "]"}]}], ",", RowBox[{"m", "-", RowBox[{"If", "[", RowBox[{RowBox[{"m", ">", "1"}], ",", RowBox[{RowBox[{"(", RowBox[{"El", "-", "Lm"}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"list", "[", RowBox[{"[", RowBox[{"m", "-", "1"}], "]"}], "]"}], "-", "Lm"}], ")"}]}], ",", "0."}], "]"}]}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"l", ",", RowBox[{"Length", "[", "elem", "]"}]}], "}"}]}], "]"}]}], "]"}], ",", RowBox[{"RuntimeAttributes", "->", RowBox[{"{", "Listable", "}"}]}], ",", RowBox[{"CompilationTarget", "->", "\"C\""}], ",", RowBox[{"RuntimeOptions", "->", "\"Speed\""}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"loadLibrary", ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"libname", "=", RowBox[{"\"Interpol-mt.\"", "<>", RowBox[{"Switch", "[", RowBox[{"$OperatingSystem", ",", "\"Unix\"", ",", "\"so\"", ",", "\"Windows\"", ",", "\"dll\"", ",", "\"MacOSX\"", ",", "\"dylib\""}], "]"}]}]}], ",", "filename"}], "}"}], ",", RowBox[{RowBox[{"filename", "=", RowBox[{"FileNames", "[", RowBox[{"libname", ",", RowBox[{"NotebookDirectory", "[", "]"}], ",", "2"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "filename", "]"}], "!=", "0"}], ",", RowBox[{RowBox[{"filename", "=", RowBox[{"filename", "[", RowBox[{"[", "1", "]"}], "]"}]}], ";", RowBox[{"Quiet", "[", RowBox[{RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Head", "[", "#", "]"}], "===", "LibraryFunction"}], ",", RowBox[{"LibraryFunctionUnload", "[", "#", "]"}]}], "]"}], "&"}], "/@", RowBox[{"Unevaluated", "[", RowBox[{"{", RowBox[{"build", ",", "clearAll", ",", "clearOne", ",", "append", ",", "deleteN", ",", "replace", ",", "replaceD", ",", "prod2", ",", "clip", ",", "output", ",", "getLast", ",", "conv", ",", "index", ",", "indexVec", ",", "indexVecN", ",", "indexVecLN", ",", "Interpol1D3c", ",", "indexVecR", ",", "indexVecR2", ",", "indexVecL", ",", "indexMat", ",", "indexMatN", ",", "indexMatN3", ",", "indexMatAll", ",", "indexMatMerge", ",", "\[CapitalSigma]Rnum", ",", "\[CapitalSigma]Knum"}], "}"}], "]"}]}], ";"}], "]"}], ";", RowBox[{"build", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"build\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"buildOne", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"buildOne\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", "Integer"}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"clearAll", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"clearAll\"", ",", RowBox[{"{", "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"clearOne", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"clearOne\"", ",", RowBox[{"{", "Integer", "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"append", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"append\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"deleteN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"deleteN\"", ",", RowBox[{"{", "Integer", "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"replace", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"replace\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"replaceD", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"replaceD\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"output", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"output\"", ",", RowBox[{"{", "Integer", "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"getLast", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"getLast\"", ",", RowBox[{"{", RowBox[{"Integer", ",", "Integer"}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"prod2", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"prod2\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"clip", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"clip\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"\[CapitalSigma]Rnum", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"sigmaR\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"\[CapitalSigma]Knum", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"sigmaK\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"conv", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"conv\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"index", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"index\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVec", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVec\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecN\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"indexVecR", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecR\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecR2", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecR2\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecL", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecL\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexVecLN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexVecLN\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"Interpol1D3c", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"Interpol1D3c\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", "\"Void\""}], "]"}]}]}], ";", RowBox[{"indexMat", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMat\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatN", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatN\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatN3", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatN3\"", ",", RowBox[{"{", RowBox[{"Integer", ",", RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatAll", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatAll\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3"}], "}"}]}], "]"}]}]}], ";", RowBox[{"indexMatMerge", "=", RowBox[{"Quiet", "@", RowBox[{"LibraryFunctionLoad", "[", RowBox[{"filename", ",", "\"indexMatMerge\"", ",", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "1", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "3", ",", "\"Shared\""}], "}"}], ",", RowBox[{"{", RowBox[{"Integer", ",", "2", ",", "\"Shared\""}], "}"}]}], "}"}], ",", RowBox[{"{", RowBox[{"Real", ",", "2"}], "}"}]}], "]"}]}]}]}], ",", RowBox[{"Clear", "[", RowBox[{"build", ",", "buildOne", ",", "clearAll", ",", "clearOne", ",", "deleteN", ",", "append", ",", "replace", ",", "replaceD", ",", "output", ",", "getLast", ",", "conv", ",", "index", ",", "indexVec", ",", "indexVecN", ",", "indexVecLN", ",", "Interpol1D3c", ",", "indexVecR", ",", "indexVecR2", ",", "indexVecL", ",", "indexMat", ",", "indexMatN", ",", "indexMatN3", ",", "indexMatAll", ",", "indexMatMerge"}], "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "conv", "]"}]}], ",", RowBox[{RowBox[{"conv", "[", RowBox[{"int_", ",", "m1_", ",", "m2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"m1", "*", "m2"}], ")"}], ".", "int"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "index", "]"}]}], ",", RowBox[{RowBox[{"index", "[", RowBox[{"list_", ",", "inds_"}], "]"}], ":=", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecL", "]"}]}], ",", RowBox[{RowBox[{"indexVecL", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "1"}], "]"}], "]"}]}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecL3", "]"}]}], ",", RowBox[{RowBox[{"indexVecL3", "[", RowBox[{"list_", ",", "weightsIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"weights", "=", RowBox[{"ArrayReshape", "[", RowBox[{"weightsIn", ",", RowBox[{"{", RowBox[{RowBox[{"len", "^", "2"}], ",", RowBox[{RowBox[{"Length", "[", "weightsIn", "]"}], "/", RowBox[{"len", "^", "2"}]}]}], "}"}]}], "]"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{"Sum", "[", RowBox[{RowBox[{RowBox[{"weights", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"n", "+", "1"}]}], "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "n"}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", RowBox[{"weights", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVec", "]"}]}], ",", RowBox[{RowBox[{"indexVec", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "indsIn", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecR", "]"}]}], ",", RowBox[{RowBox[{"indexVecR", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "indsIn", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexVecR2", "]"}]}], ",", RowBox[{RowBox[{"indexVecR2", "[", RowBox[{"list_", ",", "dlist_", ",", "\[CapitalDelta]xvecIn_", ",", "indsIn_", ",", "\[Delta]tratio_"}], "]"}], ":=", RowBox[{RowBox[{RowBox[{"(", RowBox[{"1", "-", RowBox[{"\[CapitalDelta]xvecIn", "^", "2"}]}], ")"}], "*", RowBox[{"list", "[", RowBox[{"[", "indsIn", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvecIn", "^", "2"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"\[CapitalDelta]xvecIn", "-", RowBox[{"\[CapitalDelta]xvecIn", "^", "2"}]}], ")"}], "*", RowBox[{"dlist", "[", RowBox[{"[", RowBox[{"indsIn", "+", "1"}], "]"}], "]"}]}]}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexMat", "]"}]}], ",", RowBox[{RowBox[{"indexMat", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "\[CapitalDelta]yvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}], ",", RowBox[{"\[CapitalDelta]yvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]yvecIn"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "1"}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "len"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", RowBox[{"(", RowBox[{"len", "+", "1"}], ")"}]}], "]"}], "]"}]}]}], ")"}]}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexMat3", "]"}]}], ",", RowBox[{RowBox[{"indexMat3", "[", RowBox[{"list_", ",", "\[CapitalDelta]xvecIn_", ",", "weightsyIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}], ",", RowBox[{"weightsy", "=", RowBox[{"ArrayReshape", "[", RowBox[{"weightsyIn", ",", RowBox[{"{", RowBox[{RowBox[{"len", "^", "2"}], ",", RowBox[{RowBox[{"Length", "[", "weightsyIn", "]"}], "/", RowBox[{"len", "^", "2"}]}]}], "}"}]}], "]"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"Sum", "[", RowBox[{RowBox[{RowBox[{"weightsy", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"n", "+", "1"}]}], "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "n"}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", RowBox[{"weightsy", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"Sum", "[", RowBox[{RowBox[{RowBox[{"weightsy", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"n", "+", "1"}]}], "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", RowBox[{"(", RowBox[{"n", "+", "len"}], ")"}]}], "]"}], "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "0", ",", RowBox[{RowBox[{"Length", "[", RowBox[{"weightsy", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", "1"}]}], "}"}]}], "]"}]}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "indexMatMerge", "]"}]}], ",", RowBox[{RowBox[{"indexMatMerge", "[", RowBox[{"list_", ",", "defaultlist_", ",", "\[CapitalDelta]xvecIn_", ",", "\[CapitalDelta]yvecIn_", ",", "indsIn_"}], "]"}], ":=", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"mask", "=", RowBox[{"Subtract", "[", RowBox[{"1", ",", RowBox[{"UnitStep", "[", RowBox[{"-", "indsIn"}], "]"}]}], "]"}]}], ",", RowBox[{"inds", "=", RowBox[{"Flatten", "[", "indsIn", "]"}]}], ",", RowBox[{"\[CapitalDelta]xvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]xvecIn"}]}], ",", RowBox[{"\[CapitalDelta]yvec", "=", RowBox[{RowBox[{RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", "\[CapitalDelta]yvecIn"}]}]}], "}"}], ",", RowBox[{"ArrayReshape", "[", RowBox[{RowBox[{RowBox[{"mask", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", "inds", "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "1"}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]xvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"(", RowBox[{RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "1", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", "len"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"\[CapitalDelta]yvec", "[", RowBox[{"[", "2", "]"}], "]"}], "*", RowBox[{"list", "[", RowBox[{"[", RowBox[{"inds", "+", RowBox[{"(", RowBox[{"len", "+", "1"}], ")"}]}], "]"}], "]"}]}]}], ")"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"1", "-", "mask"}], ")"}], "defaultlist"}]}], ",", RowBox[{"{", RowBox[{"len", ",", "len"}], "}"}]}], "]"}]}], "]"}]}]}], "]"}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"buildLowMem", "[", RowBox[{"fac_", ":", "1"}], "]"}], ":=", RowBox[{"(", RowBox[{RowBox[{"buildOne", "[", RowBox[{"QK", ",", "1"}], "]"}], ";", RowBox[{"QK", "=", RowBox[{"QK", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{"buildOne", "[", RowBox[{"QR", ",", "2"}], "]"}], ";", RowBox[{"QR", "=", RowBox[{"QR", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{"buildOne", "[", RowBox[{RowBox[{"fac", "dQK"}], ",", "3"}], "]"}], ";", RowBox[{"dQK", "=", RowBox[{"dQK", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{"buildOne", "[", RowBox[{RowBox[{"fac", "dQR"}], ",", "4"}], "]"}], ";", RowBox[{"dQR", "=", RowBox[{"dQR", "[", RowBox[{"[", RowBox[{RowBox[{"-", "1"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}]}], ";"}], ")"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"SaveCompressed", "[", RowBox[{"file_String", ",", RowBox[{"mat_", "?", "MatrixQ"}]}], "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"rows", "=", RowBox[{"Length", "[", "mat", "]"}]}], ",", RowBox[{"cols", "=", RowBox[{"Length", "[", RowBox[{"First", "@", "mat"}], "]"}]}], ",", "htype", ",", "s"}], "}"}], ",", RowBox[{RowBox[{"htype", "=", RowBox[{"If", "[", RowBox[{RowBox[{"$SystemWordLength", "==", "64"}], ",", "\"UnsignedInteger64\"", ",", "\"UnsignedInteger32\""}], "]"}]}], ";", RowBox[{"s", "=", RowBox[{"OpenWrite", "[", RowBox[{"file", ",", RowBox[{"BinaryFormat", "->", "True"}]}], "]"}]}], ";", RowBox[{"BinaryWrite", "[", RowBox[{"s", ",", "rows", ",", "htype", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}], ";", RowBox[{"BinaryWrite", "[", RowBox[{"s", ",", "cols", ",", "htype", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}], ";", RowBox[{"BinaryWrite", "[", RowBox[{"s", ",", RowBox[{"N", "@", RowBox[{"Flatten", "[", "mat", "]"}]}], ",", "\"Real64\"", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}], ";", RowBox[{"Close", "[", "s", "]"}], ";"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"LoadCompressed", "[", "file_String", "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"try", ",", "rows", ",", "cols", ",", "cnt", ",", "data", ",", "s", ",", "headerBytes", ",", "fileBytes"}], "}"}], ",", RowBox[{RowBox[{RowBox[{"try", "[", "htype_", "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{RowBox[{"s", "=", RowBox[{"OpenRead", "[", RowBox[{"file", ",", RowBox[{"BinaryFormat", "->", "True"}]}], "]"}]}], ";", RowBox[{"rows", "=", RowBox[{"BinaryRead", "[", RowBox[{"s", ",", "htype", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}]}], ";", RowBox[{"cols", "=", RowBox[{"BinaryRead", "[", RowBox[{"s", ",", "htype", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"!", RowBox[{"IntegerQ", "[", "rows", "]"}]}], "||", RowBox[{"!", RowBox[{"IntegerQ", "[", "cols", "]"}]}], "||", RowBox[{"rows", "<=", "0"}], "||", RowBox[{"cols", "<=", "0"}]}], ",", RowBox[{RowBox[{"Close", "[", "s", "]"}], ";", RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", RowBox[{"headerBytes", "=", RowBox[{"2", "*", RowBox[{"If", "[", RowBox[{RowBox[{"htype", "===", "\"UnsignedInteger64\""}], ",", "8", ",", "4"}], "]"}]}]}], ";", RowBox[{"fileBytes", "=", RowBox[{"FileByteCount", "[", "file", "]"}]}], ";", RowBox[{"cnt", "=", RowBox[{"rows", "*", "cols"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"fileBytes", "<", RowBox[{"headerBytes", "+", RowBox[{"8", "cnt"}]}]}], ",", RowBox[{RowBox[{"Close", "[", "s", "]"}], ";", RowBox[{"Return", "[", "$Failed", "]"}]}]}], "]"}], ";", RowBox[{"data", "=", RowBox[{"BinaryReadList", "[", RowBox[{"s", ",", "\"Real64\"", ",", "cnt", ",", RowBox[{"ByteOrdering", "->", RowBox[{"-", "1"}]}]}], "]"}]}], ";", RowBox[{"Close", "[", "s", "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "data", "]"}], "==", "cnt"}], ",", RowBox[{"Partition", "[", RowBox[{"data", ",", "cols"}], "]"}], ",", "$Failed"}], "]"}]}]}], "]"}]}], ";", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"m64", "=", RowBox[{"try", "[", "\"UnsignedInteger64\"", "]"}]}], "}"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"m64", "=!=", "$Failed"}], ",", "m64", ",", RowBox[{"try", "[", "\"UnsignedInteger32\"", "]"}]}], "]"}]}], "]"}]}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Clear", "[", "splineCoeffs", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"SyntaxInformation", "[", "splineCoeffs", "]"}], "=", RowBox[{"{", RowBox[{"\"ArgumentsPattern\"", "->", RowBox[{"{", RowBox[{"_", ",", RowBox[{"OptionsPattern", "[", "]"}]}], "}"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{"SetAttributes", "[", RowBox[{"splineCoeffs", ",", "HoldAll"}], "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "splineCoeffs", "]"}], "=", RowBox[{"{", RowBox[{RowBox[{"\"Five\"", "->", "False"}], ",", RowBox[{"\"Last\"", "->", "False"}], ",", RowBox[{"\"All\"", "->", "False"}], ",", RowBox[{"\"Mixed\"", "->", "True"}]}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"splineCoeffs", "::", "padInput"}], "=", "\"interpolation matrices cannot be generated from a precomputed second-highest coefficient matrix when the padding is set to be non-zero.\""}], ";"}]
RowBox[{RowBox[{"splineCoeffs", "[", RowBox[{RowBox[{"{", RowBox[{"points_", ",", RowBox[{"cmatIn_", ":", "0"}], ",", RowBox[{"precIn_", ":", "precision"}], ",", RowBox[{"padding_", ":", "15"}]}], "}"}], ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"pts", ",", "h", ",", "rot", ",", "n", ",", "id", ",", "amat", ",", "bmat", ",", "cmat", ",", "cmat2", ",", "dmat", ",", "emat", ",", "emat2", ",", "fmat", ",", "prec", ",", "padfc", ",", "padfcT", ",", "mixed"}], "}"}], ",", RowBox[{RowBox[{"mixed", "=", RowBox[{RowBox[{"OptionValue", "[", "\"Mixed\"", "]"}], "&&", RowBox[{"(", RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ")"}], "&&", RowBox[{"(", RowBox[{"padding", "!=", "0"}], ")"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"!", RowBox[{"(", RowBox[{"cmatIn", "===", "0"}], ")"}]}], "&&", RowBox[{"padding", "!=", "0"}]}], ",", RowBox[{RowBox[{"Message", "[", RowBox[{"splineCoeffs", "::", "padInput"}], "]"}], ";"}], ",", RowBox[{RowBox[{RowBox[{"padfc", "[", "x_", "]"}], ":=", RowBox[{"x", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], ";", RowBox[{RowBox[{"padfcT", "[", "x_", "]"}], ":=", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"Length", "[", "x", "]"}], ">", RowBox[{"Length", "[", "points", "]"}]}], ",", RowBox[{"x", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], "]"}], "]"}], ",", "x"}], "]"}]}], ";", RowBox[{"prec", "=", RowBox[{"If", "[", RowBox[{RowBox[{"cmatIn", "===", "0"}], ",", "precIn", ",", RowBox[{"Precision", "[", "cmatIn", "]"}]}], "]"}]}], ";", RowBox[{"pts", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"Join", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "points", ",", RowBox[{"Join", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], "-", RowBox[{"Reverse", "[", RowBox[{"Range", "[", "padding", "]"}], "]"}]}], ",", "points"}], "]"}]}], "]"}], ",", RowBox[{RowBox[{"points", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{"Range", "[", "padding", "]"}]}]}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"h", "=", RowBox[{"Subtract", "[", RowBox[{RowBox[{"RotateLeft", "[", "pts", "]"}], ",", "pts"}], "]"}]}], ";", RowBox[{"n", "=", RowBox[{"Length", "[", "pts", "]"}]}], ";", RowBox[{"rot", "=", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{RowBox[{"Band", "[", RowBox[{"{", RowBox[{"1", ",", "1"}], "}"}], "]"}], "->", RowBox[{"-", "1"}]}], ",", RowBox[{RowBox[{"Band", "[", RowBox[{"{", RowBox[{"1", ",", "2"}], "}"}], "]"}], "->", "1"}]}], "}"}], ",", RowBox[{"{", RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", RowBox[{"id", "=", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"Band", "[", RowBox[{"{", RowBox[{"1", ",", "1"}], "}"}], "]"}], "->", "1"}], "}"}], ",", RowBox[{"{", RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Five\"", "]"}]}], ",", RowBox[{RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"g0c", ",", "g1c", ",", "coefc", ",", "coefc2", ",", "Bc", ",", "Bc2", ",", "\[CapitalDelta]\[Omega]"}], "}"}], ",", RowBox[{RowBox[{"g0c", "=", RowBox[{RowBox[{"1", "/", "3"}], "rot"}]}], ";", RowBox[{"g1c", "=", RowBox[{RowBox[{"(", RowBox[{"id", "+", "g0c"}], ")"}], RowBox[{"(", RowBox[{"3", "h"}], ")"}]}]}], ";", RowBox[{"coefc", "=", RowBox[{RowBox[{"(", RowBox[{RowBox[{"Most", "[", RowBox[{RowBox[{"(", RowBox[{"6", "h"}], ")"}], "id"}], "]"}], "+", RowBox[{"Most", "[", RowBox[{RowBox[{"(", RowBox[{"9", "h"}], ")"}], "g0c"}], "]"}], "+", RowBox[{"diff", "[", "g1c", "]"}]}], ")"}], "/", RowBox[{"Most", "[", "h", "]"}]}]}], ";", RowBox[{"Bc", "=", RowBox[{RowBox[{"diff", "[", RowBox[{"rot", "/", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"1", "/", "3"}], ")"}], "h"}], ")"}]}], "]"}], "/", RowBox[{"Most", "[", "h", "]"}]}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{RowBox[{"coefc2", "=", RowBox[{"coefc", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], ";", RowBox[{"coefc2", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], "+", RowBox[{"RotateRight", "[", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"Most", "[", "coefc2", "]"}], ",", RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"-", "padding"}], "-", "1"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], "+", RowBox[{"RotateLeft", "[", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"-", "padding"}], "-", "1"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}], "]"}]}], "}"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";"}]}], "]"}], ";", RowBox[{"coefc", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", "1", "]"}], "]"}]}], "+", RowBox[{"RotateRight", "[", RowBox[{"id", "[", RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"Most", "[", "coefc", "]"}], ",", RowBox[{"{", RowBox[{RowBox[{"2", RowBox[{"id", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "+", RowBox[{"RotateLeft", "[", RowBox[{"id", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "]"}]}], "}"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bc", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"zer", "=", RowBox[{"ConstantArray", "[", RowBox[{"0", ",", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", RowBox[{"n", "-", "padding"}], ",", RowBox[{"n", "-", RowBox[{"2", "padding"}]}]}], "]"}]}], "]"}]}], "}"}], ",", RowBox[{"Catenate", "[", RowBox[{"{", RowBox[{RowBox[{"{", "zer", "}"}], ",", RowBox[{"Most", "[", RowBox[{"padfc", "[", RowBox[{"Normal", "[", "Bc", "]"}], "]"}], "]"}], ",", RowBox[{"{", "zer", "}"}]}], "}"}], "]"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bc2", "=", RowBox[{"Bc", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{RowBox[{"Bc2", "[", RowBox[{"[", RowBox[{"{", RowBox[{RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}], "]"}], "*=", "0"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"cmatIn", "===", "0"}], ",", RowBox[{RowBox[{"cmat", "=", RowBox[{"LinearSolve", "[", RowBox[{"coefc", ",", "Bc"}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{"cmat2", "=", RowBox[{"LinearSolve", "[", RowBox[{"coefc2", ",", "Bc2"}], "]"}]}]}], "]"}]}], ",", RowBox[{RowBox[{"cmat", "=", "cmatIn"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"SquareMatrixQ", "[", "cmat", "]"}]}], ",", RowBox[{"cmat", "=", RowBox[{"ArrayFlatten", "[", RowBox[{"{", RowBox[{RowBox[{"{", "cmat", "}"}], ",", RowBox[{"{", RowBox[{"{", RowBox[{RowBox[{"-", RowBox[{"cmat", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}]}], "/", "2"}], "}"}], "}"}]}], "}"}], "]"}]}]}], "]"}], ";"}]}], "]"}], ";", RowBox[{"dmat", "=", RowBox[{RowBox[{"diff", "[", "cmat", "]"}], "/", RowBox[{"(", RowBox[{"3", RowBox[{"Most", "[", "h", "]"}]}], ")"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ",", RowBox[{RowBox[{"rot", "=", RowBox[{"padfc", "[", "rot", "]"}]}], ";", RowBox[{"id", "=", RowBox[{"padfc", "[", "id", "]"}]}], ";", RowBox[{"\[CapitalDelta]\[Omega]", "=", RowBox[{"Most", "[", "h", "]"}]}], ";", RowBox[{"bmat", "=", RowBox[{RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "-", RowBox[{"\[CapitalDelta]\[Omega]", RowBox[{"(", RowBox[{RowBox[{"Most", "[", "cmat", "]"}], "+", RowBox[{RowBox[{"diff", "[", "cmat", "]"}], "/", "3"}]}], ")"}]}]}]}], ";", RowBox[{"amat", "=", RowBox[{"Most", "[", "id", "]"}]}], ";", RowBox[{"cmat", "=", RowBox[{"If", "[", RowBox[{"mixed", ",", "cmat2", ",", RowBox[{"Most", "[", "cmat", "]"}]}], "]"}]}]}]}], "]"}]}]}], "]"}], ";"}], ",", RowBox[{"Module", "[", RowBox[{RowBox[{"{", RowBox[{"g0q", ",", "g1q", ",", "g2q", ",", "g3q", ",", "coefq", ",", "coefq2", ",", "Bq", ",", "Bq2", ",", "\[CapitalDelta]\[Omega]"}], "}"}], ",", RowBox[{RowBox[{"g0q", "=", RowBox[{RowBox[{"1", "/", "5"}], "rot"}]}], ";", RowBox[{"g1q", "=", RowBox[{"g0q", "+", "id"}]}], ";", RowBox[{"g2q", "=", RowBox[{RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"2", RowBox[{"h", "^", "2"}]}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"3", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], "+", RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"5", RowBox[{"h", "^", "2"}]}], ")"}], "g0q"}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], ")"}]}], "+", RowBox[{"diff", "[", RowBox[{"g1q", RowBox[{"h", "^", "3"}]}], "]"}]}]}], ";", RowBox[{"g3q", "=", RowBox[{RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"2", "h"}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"3", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], "+", RowBox[{"4", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], "+", RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}]}], ")"}]}], "+", RowBox[{RowBox[{"g0q", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{"10", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}]}], ")"}], RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"2", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], ")"}]}], "+", RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"4", "h"}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{RowBox[{"g0q", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{"10", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}]}], ")"}]}]}], ")"}], RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}], "^", "2"}]}], "+", "g2q"}], ")"}]}], "]"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"cmatIn", "===", "0"}], ",", RowBox[{RowBox[{"coefq", "=", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"4", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{"id", RowBox[{"(", RowBox[{"4", "h"}], ")"}]}], ")"}], "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], "+", RowBox[{RowBox[{"g0q", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], RowBox[{"(", RowBox[{"10", RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}]}], ")"}]}], "+", RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], "g3q"}], "]"}]}], ")"}]}]}], ";", RowBox[{"Bq", "=", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "4"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"4", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"diff", "[", RowBox[{RowBox[{"1", "/", RowBox[{"(", RowBox[{RowBox[{"h", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"h", "[", RowBox[{"[", RowBox[{"2", ";;"}], "]"}], "]"}]}], ")"}]}], RowBox[{"diff", "[", RowBox[{"rot", "/", "h"}], "]"}]}], "]"}]}], "]"}]}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{RowBox[{"coefq2", "=", RowBox[{"coefq", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], ";", RowBox[{"coefq2", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], "+", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}], ",", RowBox[{"Most", "[", "coefq2", "]"}], ",", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{RowBox[{RowBox[{"-", "padding"}], "-", "2"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}]}], "]"}], "]"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";"}]}], "]"}], ";", RowBox[{"coefq", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Catenate", "[", RowBox[{"Normal", "/@", RowBox[{"{", RowBox[{RowBox[{"id", "[", RowBox[{"[", RowBox[{";;", "2"}], "]"}], "]"}], ",", RowBox[{"coefq", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], ",", RowBox[{"id", "[", RowBox[{"[", RowBox[{RowBox[{"-", "2"}], ";;"}], "]"}], "]"}]}], "}"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bq", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"SparseArray", "[", RowBox[{"With", "[", RowBox[{RowBox[{"{", RowBox[{"zer", "=", RowBox[{"ConstantArray", "[", RowBox[{"0", ",", RowBox[{"{", RowBox[{"n", ",", "n"}], "}"}]}], "]"}]}], "}"}], ",", RowBox[{"padfc", "[", RowBox[{"Catenate", "[", RowBox[{"{", RowBox[{RowBox[{"zer", "[", RowBox[{"[", RowBox[{";;", "2"}], "]"}], "]"}], ",", RowBox[{"Normal", "[", RowBox[{"Bq", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "]"}], ",", RowBox[{"zer", "[", RowBox[{"[", RowBox[{RowBox[{"-", "2"}], ";;"}], "]"}], "]"}]}], "}"}], "]"}], "]"}]}], "]"}], "]"}], ",", "prec"}], "]"}]}], ";", RowBox[{"Bq2", "=", RowBox[{"Bq", "[", RowBox[{"[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"points", "[", RowBox[{"[", "1", "]"}], "]"}], ">=", "0"}], ",", "1", ",", RowBox[{"padding", "+", "1"}]}], "]"}], ";;", RowBox[{RowBox[{"-", "padding"}], "-", "1"}]}], "]"}], "]"}]}], ";", RowBox[{RowBox[{"Bq2", "[", RowBox[{"[", RowBox[{"1", ";;", "2"}], "]"}], "]"}], "*=", "0"}], ";", RowBox[{RowBox[{"Bq2", "[", RowBox[{"[", RowBox[{RowBox[{"-", "2"}], ";;", RowBox[{"-", "1"}]}], "]"}], "]"}], "*=", "0"}], ";", RowBox[{"emat", "=", RowBox[{"Chop", "[", RowBox[{RowBox[{"LinearSolve", "[", RowBox[{"coefq", ",", "Bq"}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{"mixed", ",", RowBox[{"emat2", "=", RowBox[{"Chop", "[", RowBox[{RowBox[{"LinearSolve", "[", RowBox[{"coefq2", ",", "Bq2"}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", "200"}]}]}], "]"}]}]}], "]"}], ";"}], ",", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"SquareMatrixQ", "[", "emat", "]"}]}], ",", RowBox[{"emat", "=", RowBox[{"ArrayFlatten", "[", RowBox[{"{", RowBox[{RowBox[{"{", "cmatIn", "}"}], ",", RowBox[{"{", RowBox[{"{", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{"{", "n", "}"}]}], "]"}], "}"}], "}"}]}], "}"}], "]"}]}]}], "]"}], ";"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ",", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "=", RowBox[{"Most", "[", "h", "]"}]}], ";", RowBox[{"fmat", "=", RowBox[{RowBox[{"diff", "[", "emat", "]"}], "/", RowBox[{"(", RowBox[{"5", "\[CapitalDelta]\[Omega]"}], ")"}]}]}], ";", RowBox[{"rot", "=", RowBox[{"padfc", "[", "rot", "]"}]}], ";", RowBox[{"id", "=", RowBox[{"padfc", "[", "id", "]"}]}], ";", RowBox[{"dmat", "=", RowBox[{"Catenate", "[", RowBox[{RowBox[{RowBox[{"FoldList", "[", RowBox[{RowBox[{RowBox[{"{", RowBox[{"(", RowBox[{RowBox[{"#1", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"(", RowBox[{"4", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}]}], ")"}], RowBox[{"emat", "[", RowBox[{"[", RowBox[{"#2", "-", "1"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"10", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}], "^", "2"}]}], ")"}], RowBox[{"fmat", "[", RowBox[{"[", "#2", "]"}], "]"}]}]}], ")"}], "}"}], "&"}], ",", "#", ",", RowBox[{"{", RowBox[{RowBox[{"-", "3"}], ",", RowBox[{"-", "2"}]}], "}"}]}], "]"}], "&"}], "@", RowBox[{"(", RowBox[{RowBox[{"(", RowBox[{RowBox[{"diff", "[", RowBox[{RowBox[{"diff", "[", RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "]"}], "/", RowBox[{"(", RowBox[{RowBox[{"Most", "[", "\[CapitalDelta]\[Omega]", "]"}], "+", RowBox[{"Rest", "[", "\[CapitalDelta]\[Omega]", "]"}]}], ")"}]}], "]"}], "-", RowBox[{"Most", "[", RowBox[{"g3q", ".", "emat"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", RowBox[{";;", RowBox[{"-", "3"}]}], "]"}], "]"}], "+", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", RowBox[{"2", ";;", RowBox[{"-", "2"}]}], "]"}], "]"}], "+", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", RowBox[{"3", ";;"}], "]"}], "]"}]}], ")"}]}], ")"}]}], "]"}]}], ";", RowBox[{"cmat", "=", RowBox[{"Catenate", "[", RowBox[{RowBox[{RowBox[{"FoldList", "[", RowBox[{RowBox[{RowBox[{"{", RowBox[{"(", RowBox[{RowBox[{"#1", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "+", RowBox[{RowBox[{"(", RowBox[{"3", RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}]}], ")"}], RowBox[{"dmat", "[", RowBox[{"[", "#2", "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"6", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}], "^", "2"}]}], ")"}], RowBox[{"emat", "[", RowBox[{"[", RowBox[{"#2", "-", "1"}], "]"}], "]"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"10", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "[", RowBox[{"[", "#2", "]"}], "]"}], "^", "3"}]}], ")"}], RowBox[{"fmat", "[", RowBox[{"[", "#2", "]"}], "]"}]}]}], ")"}], "}"}], "&"}], ",", "#", ",", RowBox[{"{", RowBox[{"-", "2"}], "}"}]}], "]"}], "&"}], "@", RowBox[{"(", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"diff", "[", RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "]"}], "-", RowBox[{"diff", "[", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "^", "2"}], "dmat"}], "]"}], "-", RowBox[{"Most", "[", RowBox[{"g2q", ".", "emat"}], "]"}]}], ")"}], "/", RowBox[{"(", RowBox[{RowBox[{"Most", "[", "\[CapitalDelta]\[Omega]", "]"}], "+", RowBox[{"Rest", "[", "\[CapitalDelta]\[Omega]", "]"}]}], ")"}]}], "-", RowBox[{RowBox[{"(", RowBox[{"3", RowBox[{"Most", "[", "\[CapitalDelta]\[Omega]", "]"}]}], ")"}], RowBox[{"Most", "[", "dmat", "]"}]}]}], ")"}]}], "]"}]}], ";", RowBox[{"bmat", "=", RowBox[{RowBox[{RowBox[{"Most", "[", "rot", "]"}], "/", "\[CapitalDelta]\[Omega]"}], "-", RowBox[{"\[CapitalDelta]\[Omega]", "cmat"}], "-", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "^", "2"}], "dmat"}], "-", RowBox[{RowBox[{"\[CapitalDelta]\[Omega]", "^", "3"}], RowBox[{"Most", "[", RowBox[{"g1q", ".", "emat"}], "]"}]}]}]}], ";", RowBox[{"amat", "=", RowBox[{"Most", "[", "id", "]"}]}], ";", RowBox[{"emat", "=", RowBox[{"If", "[", RowBox[{"mixed", ",", "emat2", ",", RowBox[{"Most", "[", "emat", "]"}]}], "]"}]}], ";"}], ",", RowBox[{RowBox[{"fmat", "=", RowBox[{RowBox[{"diff", "[", "emat", "]"}], "/", RowBox[{"(", RowBox[{"5", RowBox[{"Most", "[", "h", "]"}]}], ")"}]}]}], ";", RowBox[{"emat", "=", RowBox[{"Most", "[", "emat", "]"}]}], ";"}]}], "]"}]}]}], "]"}]}], "]"}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"!", RowBox[{"OptionValue", "[", "\"Last\"", "]"}]}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", RowBox[{RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "#", ",", RowBox[{"padfcT", "[", "#", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}], "&"}], "/@", RowBox[{"{", RowBox[{"amat", ",", "bmat", ",", "cmat", ",", "dmat", ",", "emat", ",", "fmat"}], "}"}]}], ",", RowBox[{RowBox[{RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "#", ",", RowBox[{"padfcT", "[", "#", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}], "&"}], "/@", RowBox[{"{", RowBox[{"amat", ",", "bmat", ",", "cmat", ",", "dmat"}], "}"}]}]}], "]"}], ",", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "fmat", ",", RowBox[{"padfcT", "[", "fmat", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}], ",", RowBox[{"SparseArray", "[", RowBox[{"Threshold", "[", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"All\"", "]"}], ",", "dmat", ",", RowBox[{"padfcT", "[", "dmat", "]"}]}], "]"}], ",", RowBox[{"10", "^", RowBox[{"-", RowBox[{"Max", "[", RowBox[{"prec", ",", "30"}], "]"}]}]}]}], "]"}], "]"}]}], "]"}]}], "]"}]}]}], "]"}]}]}], "]"}]}]
RowBox[{RowBox[{"Clear", "[", "createInt", "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Options", "[", "createInt", "]"}], "=", RowBox[{"{", RowBox[{"\"Five\"", "->", "False"}], "}"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"createInt", "[", RowBox[{RowBox[{"{", RowBox[{"\[Tau]pts_", ",", RowBox[{"cmatIn_", ":", "0"}], ",", RowBox[{"prec_", ":", "precision"}]}], "}"}], ",", RowBox[{"opts", ":", RowBox[{"OptionsPattern", "[", "]"}]}]}], "]"}], ":=", RowBox[{"Quiet", "[", RowBox[{"Block", "[", RowBox[{RowBox[{"{", RowBox[{"IL4jk", ",", "IL6jk", ",", "f0", ",", "f1", ",", "f2", ",", "f3", ",", "f4", ",", "f5", ",", RowBox[{"Len", "=", RowBox[{"Length", "[", "\[Tau]pts", "]"}]}]}], "}"}], ",", RowBox[{RowBox[{RowBox[{"f0", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"-", "\[Omega]1"}], "+", "\[Omega]2"}]}], ";", RowBox[{RowBox[{"f1", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "2"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "2"}]}]}], ";", RowBox[{RowBox[{"f2", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "3"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "3"}]}]}], ";", RowBox[{RowBox[{"f3", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "4"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "4"}]}]}], ";", RowBox[{RowBox[{"f4", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "5"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "5"}]}]}], ";", RowBox[{RowBox[{"f5", "[", RowBox[{"\[Omega]1_", ",", "\[Omega]2_"}], "]"}], ":=", RowBox[{RowBox[{"(", RowBox[{"1", "/", "6"}], ")"}], RowBox[{RowBox[{"(", RowBox[{"\[Omega]2", "-", "\[Omega]1"}], ")"}], "^", "6"}]}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", RowBox[{"IL6jk", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"f0", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f1", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f2", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f3", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f4", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f5", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}]}], "}"}], ",", "prec"}], "]"}]}], ",", RowBox[{"IL4jk", "=", RowBox[{"SetPrecision", "[", RowBox[{RowBox[{"{", RowBox[{RowBox[{"f0", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f1", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f2", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}], ",", RowBox[{"f3", "[", RowBox[{RowBox[{"Most", "[", "\[Tau]pts", "]"}], ",", RowBox[{"Rest", "[", "\[Tau]pts", "]"}]}], "]"}]}], "}"}], ",", "prec"}], "]"}]}]}], "]"}], ";", RowBox[{"Integrator", "=", RowBox[{"Accumulate", "[", RowBox[{"Prepend", "[", RowBox[{RowBox[{"Total", "[", RowBox[{"MapThread", "[", RowBox[{"Times", ",", RowBox[{"{", RowBox[{RowBox[{"If", "[", RowBox[{RowBox[{"OptionValue", "[", "\"Five\"", "]"}], ",", "IL6jk", ",", "IL4jk"}], "]"}], ",", RowBox[{RowBox[{"splineCoeffs", "[", RowBox[{RowBox[{"{", RowBox[{"\[Tau]pts", ",", "cmatIn", ",", "prec", ",", "0"}], "}"}], ",", RowBox[{"\"Five\"", "->", RowBox[{"OptionValue", "[", "\"Five\"", "]"}]}]}], "]"}], "+", RowBox[{"10.", "^", RowBox[{"-", "200"}]}]}]}], "}"}]}], "]"}], "]"}], ",", RowBox[{"SparseArray", "[", RowBox[{RowBox[{"{", "}"}], ",", RowBox[{"Length", "[", "\[Tau]pts", "]"}]}], "]"}]}], "]"}], "]"}]}], ";", RowBox[{"int", "=", RowBox[{"Developer`ToPackedArray", "[", RowBox[{"Integrator", "[", RowBox[{"[", RowBox[{"-", "1"}], "]"}], "]"}], "]"}]}]}]}], "]"}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"f\[Lambda]", "[", "q_", "]"}], ":=", RowBox[{RowBox[{"\[Lambda]", RowBox[{"q", "^", "p"}]}], "+", RowBox[{RowBox[{"(", RowBox[{"1", "-", "\[Lambda]"}], ")"}], RowBox[{"q", "^", "p2"}]}]}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Energy", "[", RowBox[{"QK_", ",", "QR_", ",", "t_", ",", "\[Beta]_"}], "]"}], ":=", RowBox[{"-", RowBox[{"(", RowBox[{RowBox[{"t", RowBox[{RowBox[{"(", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "QK", "]"}], "*", "QR"}], ")"}], ".", "int"}]}], "+", RowBox[{"\[Beta]", RowBox[{"f\[Lambda]", "[", RowBox[{"If", "[", RowBox[{RowBox[{"MatrixQ", "[", "QK", "]"}], ",", RowBox[{"QK", "[", RowBox[{"[", RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", RowBox[{"QK", "[", RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}]}], ")"}]}]}], ";"}]
RowBox[{RowBox[{"Eth", ":=", RowBox[{RowBox[{"Sqrt", "[", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "]"}], RowBox[{"(", RowBox[{RowBox[{RowBox[{"f\[Lambda]", "[", "1", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}], "-", RowBox[{RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "2", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}], "-", RowBox[{RowBox[{"f\[Lambda]", "[", "1", "]"}], "/", RowBox[{RowBox[{RowBox[{"Derivative", "[", "1", "]"}], "[", "f\[Lambda]", "]"}], "[", "1", "]"}]}]}], ")"}]}]}], ";"}]
RowBox[{RowBox[{"outparamnames", "=", RowBox[{"Union", "[", RowBox[{RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", "outdir", ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"loadparams", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "i", "]"}], "]"}], "]"}], ";", RowBox[{"dir", "=", RowBox[{"FileNameTake", "[", RowBox[{RowBox[{"outparamnames", "[", RowBox[{"[", "i", "]"}], "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"-", "2"}]}], "}"}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "T0", "]"}]}], "||", RowBox[{"T0", ">=", SuperscriptBox["10", "50"]}]}], ")"}], "&&", RowBox[{"p", "==", "3"}], "&&", RowBox[{"p2", "==", "3"}], "&&", RowBox[{"\[Gamma]", "==", "0"}]}], ",", RowBox[{"Print", "[", RowBox[{"{", RowBox[{"i", ",", "T0", ",", "len", ",", "\[Lambda]", ",", "\[Delta]max"}], "}"}], "]"}], ",", RowBox[{RowBox[{"##", "&"}], "[", "]"}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"i", ",", RowBox[{"Length", "[", "outparamnames", "]"}]}], "}"}]}], "]"}], ";"}]
                         -10
{295, T0, 512, 0.5, 1. 10   }
                         -10
{321, T0, 512, 0.5, 1. 10   }
                          -10
{327, T0, 1024, 0.5, 1. 10   }
                               -10
{707, Infinity, 512, 0.5, 1. 10   }
           50                  -7
{731, 1. 10  , 512., 0.3, 1. 10  }
           50                  -12
{732, 1. 10  , 512., 0.3, 1. 10   }
           50                  -9
{733, 1. 10  , 512., 0.3, 1. 10  }
           50                   -12
{734, 1. 10  , 2048., 0.3, 1. 10   }
           50                   -7
{735, 1. 10  , 1024., 0.3, 1. 10  }
           50                   -9
{736, 1. 10  , 1024., 0.3, 1. 10  }
           50                  -13
{737, 1. 10  , 512., 0.3, 1. 10   }
           50                   -7
{738, 1. 10  , 2048., 0.3, 1. 10  }
           50                   -12
{739, 1. 10  , 1024., 0.3, 1. 10   }
           50                   -9
{740, 1. 10  , 2048., 0.3, 1. 10  }
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"1", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"4", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"4", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"1", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"7", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"7", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"1", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"1", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"1", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"4", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"4", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
RowBox[{RowBox[{"corrs", "=", RowBox[{"Table", "[", RowBox[{RowBox[{"Most", "[", RowBox[{"Import", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{RowBox[{"DirectoryName", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "n", "]"}], "]"}], "]"}], ",", "\"correlation.txt\""}], "}"}], "]"}], ",", "\"Table\""}], "]"}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", "731", ",", "740"}], "}"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"p2", "=", "3"}], ";"}]
RowBox[{RowBox[{"Clear", "[", "\[Delta]E", "]"}], ";"}]
RowBox[{RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"n", ",", "x_"}], "]"}], "=", RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"DeleteDuplicatesBy", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "1"}], "]"}], "]"}], ",", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "2"}], "]"}], "]"}], "-", "Eth"}]}], "}"}], "]"}], ",", "First"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "3"}]}], "]"}], "[", "x", "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "1", ",", RowBox[{"Length", "[", "corrs", "]"}]}], "}"}]}], "]"}], ";"}]
RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"1", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"4", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"4", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"4", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"4", ",", "t"}], "]"}]], ",", RowBox[{"{", RowBox[{"t", ",", "100", ",", "110"}], "}"}]}], "]"}]
RowBox[{RowBox[{"p2", "=", "3"}], ";"}]
RowBox[{RowBox[{"Clear", "[", "\[Delta]E", "]"}], ";"}]
RowBox[{RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"n", ",", "x_"}], "]"}], "=", RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"DeleteDuplicatesBy", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "1"}], "]"}], "]"}], ",", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "2"}], "]"}], "]"}], "-", "Eth"}]}], "}"}], "]"}], ",", "First"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "1"}]}], "]"}], "[", "x", "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "1", ",", RowBox[{"Length", "[", "corrs", "]"}]}], "}"}]}], "]"}], ";"}]
RowBox[{"Plot", "[", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"4", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"4", ",", "t"}], "]"}]], ",", RowBox[{"{", RowBox[{"t", ",", "100", ",", "110"}], "}"}]}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"1", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"4", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"4", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"1", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"1", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.9", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"9", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"9", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.5", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"9", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"9", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.2", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"9", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"9", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.2", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"9", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"9", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.2", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"9", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"9", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"6", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"6", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.2", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"9", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"9", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"6", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"6", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
RowBox[{RowBox[{RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", "corrs"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"7", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"7", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.2", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"7", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"7", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"7", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"7", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.8", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"7", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"7", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"7", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"7", ",", "t"}], "]"}]]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.8", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"7", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"7", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"7", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"7", ",", "t"}], "]"}]]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.8", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"7", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"7", ",", RowBox[{"-", "10"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"7", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"7", ",", "t"}], "]"}]]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.8", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"7", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"7", ",", RowBox[{"-", "100"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"7", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"7", ",", "t"}], "]"}]]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.8", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"7", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"7", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{RowBox[{"corrs", "=", RowBox[{"Table", "[", RowBox[{RowBox[{"Most", "[", RowBox[{"Import", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{RowBox[{"DirectoryName", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "n", "]"}], "]"}], "]"}], ",", "\"correlation.txt\""}], "}"}], "]"}], ",", "\"Table\""}], "]"}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", "731", ",", "740"}], "}"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"p2", "=", "3"}], ";"}]
RowBox[{RowBox[{"Clear", "[", "\[Delta]E", "]"}], ";"}]
RowBox[{RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"n", ",", "x_"}], "]"}], "=", RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"DeleteDuplicatesBy", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "1"}], "]"}], "]"}], ",", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "2"}], "]"}], "]"}], "-", "Eth"}]}], "}"}], "]"}], ",", "First"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "1"}]}], "]"}], "[", "x", "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "1", ",", RowBox[{"Length", "[", "corrs", "]"}]}], "}"}]}], "]"}], ";"}]
RowBox[{RowBox[{RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", "corrs"}]
RowBox[{RowBox[{"corrs", "=", RowBox[{"Table", "[", RowBox[{RowBox[{"Most", "[", RowBox[{"Import", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{RowBox[{"DirectoryName", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "n", "]"}], "]"}], "]"}], ",", "\"correlation.txt\""}], "}"}], "]"}], ",", "\"Table\""}], "]"}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", "731", ",", "740"}], "}"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", "corrs"}]
RowBox[{RowBox[{"corrs", "=", RowBox[{"Table", "[", RowBox[{RowBox[{"Most", "[", RowBox[{"Import", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{RowBox[{"DirectoryName", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "n", "]"}], "]"}], "]"}], ",", "\"correlation.txt\""}], "}"}], "]"}], ",", "\"Table\""}], "]"}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", "731", ",", "740"}], "}"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"outparamnames", "=", RowBox[{"Union", "[", RowBox[{RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", "outdir", ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"loadparams", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "i", "]"}], "]"}], "]"}], ";", RowBox[{"dir", "=", RowBox[{"FileNameTake", "[", RowBox[{RowBox[{"outparamnames", "[", RowBox[{"[", "i", "]"}], "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"-", "2"}]}], "}"}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "T0", "]"}]}], "||", RowBox[{"T0", ">=", SuperscriptBox["10", "50"]}]}], ")"}], "&&", RowBox[{"p", "==", "3"}], "&&", RowBox[{"p2", "==", "3"}], "&&", RowBox[{"\[Gamma]", "==", "0"}]}], ",", RowBox[{"Print", "[", RowBox[{"{", RowBox[{"i", ",", "T0", ",", "len", ",", "\[Lambda]", ",", "\[Delta]max"}], "}"}], "]"}], ",", RowBox[{RowBox[{"##", "&"}], "[", "]"}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"i", ",", RowBox[{"Length", "[", "outparamnames", "]"}]}], "}"}]}], "]"}], ";"}]
                         -10
{295, T0, 512, 0.5, 1. 10   }
                         -10
{321, T0, 512, 0.5, 1. 10   }
                          -10
{327, T0, 1024, 0.5, 1. 10   }
                               -10
{707, Infinity, 512, 0.5, 1. 10   }
           50                  -7
{731, 1. 10  , 512., 0.3, 1. 10  }
           50                  -12
{732, 1. 10  , 512., 0.3, 1. 10   }
           50                  -9
{733, 1. 10  , 512., 0.3, 1. 10  }
           50                   -12
{734, 1. 10  , 2048., 0.3, 1. 10   }
           50                   -7
{735, 1. 10  , 1024., 0.3, 1. 10  }
           50                   -9
{736, 1. 10  , 1024., 0.3, 1. 10  }
           50                   -7
{737, 1. 10  , 2048., 0.3, 1. 10  }
           50                   -12
{738, 1. 10  , 1024., 0.3, 1. 10   }
           50                   -9
{739, 1. 10  , 2048., 0.3, 1. 10  }
           50                  -13
{741, 1. 10  , 512., 0.3, 1. 10   }
RowBox[{RowBox[{"corrs", "=", RowBox[{"Table", "[", RowBox[{RowBox[{"Most", "[", RowBox[{"Import", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{RowBox[{"DirectoryName", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "n", "]"}], "]"}], "]"}], ",", "\"correlation.txt\""}], "}"}], "]"}], ",", "\"Table\""}], "]"}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", "731", ",", "740"}], "}"}]}], "]"}]}], ";"}]
RowBox[{"outparamnames", "[", RowBox[{"[", "740", "]"}], "]"}]
RowBox[{RowBox[{"outparamnames", "=", RowBox[{"Union", "[", RowBox[{RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{"scratch2", ",", "\"Results\""}], "}"}], "]"}], ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}], ",", RowBox[{"FileNames", "[", RowBox[{"\"params*\"", ",", "outdir", ",", "2", ",", RowBox[{"IgnoreCase", "->", "False"}]}], "]"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"Table", "[", RowBox[{RowBox[{RowBox[{"loadparams", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "i", "]"}], "]"}], "]"}], ";", RowBox[{"dir", "=", RowBox[{"FileNameTake", "[", RowBox[{RowBox[{"outparamnames", "[", RowBox[{"[", "i", "]"}], "]"}], ",", RowBox[{"{", RowBox[{"1", ",", RowBox[{"-", "2"}]}], "}"}]}], "]"}]}], ";", RowBox[{"If", "[", RowBox[{RowBox[{RowBox[{"(", RowBox[{RowBox[{"!", RowBox[{"ValueQ", "[", "T0", "]"}]}], "||", RowBox[{"T0", ">=", SuperscriptBox["10", "50"]}]}], ")"}], "&&", RowBox[{"p", "==", "3"}], "&&", RowBox[{"p2", "==", "3"}], "&&", RowBox[{"\[Gamma]", "==", "0"}]}], ",", RowBox[{"Print", "[", RowBox[{"{", RowBox[{"i", ",", "T0", ",", "len", ",", "\[Lambda]", ",", "\[Delta]max"}], "}"}], "]"}], ",", RowBox[{RowBox[{"##", "&"}], "[", "]"}]}], "]"}]}], ",", RowBox[{"{", RowBox[{"i", ",", RowBox[{"Length", "[", "outparamnames", "]"}]}], "}"}]}], "]"}], ";"}]
                         -10
{295, T0, 512, 0.5, 1. 10   }
                         -10
{321, T0, 512, 0.5, 1. 10   }
                          -10
{327, T0, 1024, 0.5, 1. 10   }
                               -10
{707, Infinity, 512, 0.5, 1. 10   }
           50                  -7
{731, 1. 10  , 512., 0.3, 1. 10  }
           50                  -12
{732, 1. 10  , 512., 0.3, 1. 10   }
           50                  -9
{733, 1. 10  , 512., 0.3, 1. 10  }
           50                   -12
{734, 1. 10  , 2048., 0.3, 1. 10   }
           50                   -7
{735, 1. 10  , 1024., 0.3, 1. 10  }
           50                   -9
{736, 1. 10  , 1024., 0.3, 1. 10  }
           50                   -7
{737, 1. 10  , 2048., 0.3, 1. 10  }
           50                   -12
{738, 1. 10  , 1024., 0.3, 1. 10   }
           50                   -9
{739, 1. 10  , 2048., 0.3, 1. 10  }
           50                  -13
{740, 1. 10  , 512., 0.3, 1. 10   }
RowBox[{RowBox[{"corrs", "=", RowBox[{"Table", "[", RowBox[{RowBox[{"Most", "[", RowBox[{"Import", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{RowBox[{"DirectoryName", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "n", "]"}], "]"}], "]"}], ",", "\"correlation.txt\""}], "}"}], "]"}], ",", "\"Table\""}], "]"}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", "731", ",", "740"}], "}"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", "corrs"}]
RowBox[{RowBox[{"p2", "=", "3"}], ";"}]
RowBox[{RowBox[{"Clear", "[", "\[Delta]E", "]"}], ";"}]
RowBox[{RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"n", ",", "x_"}], "]"}], "=", RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"DeleteDuplicatesBy", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "1"}], "]"}], "]"}], ",", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "2"}], "]"}], "]"}], "-", "Eth"}]}], "}"}], "]"}], ",", "First"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "1"}]}], "]"}], "[", "x", "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "1", ",", RowBox[{"Length", "[", "corrs", "]"}]}], "}"}]}], "]"}], ";"}]
RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"10", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"10", ",", "t"}], "]"}]]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.8", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"7", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"7", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]
RowBox[{RowBox[{"p2", "=", "3"}], ";"}]
RowBox[{RowBox[{"Clear", "[", "\[Delta]E", "]"}], ";"}]
RowBox[{RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"n", ",", "x_"}], "]"}], "=", RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"DeleteDuplicatesBy", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "1"}], "]"}], "]"}], ",", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "2"}], "]"}], "]"}], "-", "Eth"}]}], "}"}], "]"}], ",", "First"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "1"}]}], "]"}], "[", "x", "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "1", ",", RowBox[{"Length", "[", "corrs", "]"}]}], "}"}]}], "]"}], ";"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"8", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"8", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"10", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"10", ",", "t"}], "]"}]]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.8", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"7", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"7", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"8", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"8", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"10", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"10", ",", "t"}], "]"}]]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.8", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"10", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"10", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"9", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"9", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"10", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"10", ",", "t"}], "]"}]]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.8", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"10", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"10", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"8", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"8", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"10", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"10", ",", "t"}], "]"}]]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.8", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"10", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"10", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{RowBox[{"corrs", "=", RowBox[{"Table", "[", RowBox[{RowBox[{"Most", "[", RowBox[{"Import", "[", RowBox[{RowBox[{"FileNameJoin", "[", RowBox[{"{", RowBox[{RowBox[{"DirectoryName", "[", RowBox[{"outparamnames", "[", RowBox[{"[", "n", "]"}], "]"}], "]"}], ",", "\"correlation.txt\""}], "}"}], "]"}], ",", "\"Table\""}], "]"}], "]"}], ",", RowBox[{"{", RowBox[{"n", ",", "731", ",", "740"}], "}"}]}], "]"}]}], ";"}]
RowBox[{RowBox[{"p2", "=", "3"}], ";"}]
RowBox[{RowBox[{"Clear", "[", "\[Delta]E", "]"}], ";"}]
RowBox[{RowBox[{"Do", "[", RowBox[{RowBox[{RowBox[{"\[Delta]E", "[", RowBox[{"n", ",", "x_"}], "]"}], "=", RowBox[{RowBox[{"Interpolation", "[", RowBox[{RowBox[{"DeleteDuplicatesBy", "[", RowBox[{RowBox[{"Transpose", "[", RowBox[{"{", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "1"}], "]"}], "]"}], ",", RowBox[{RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"n", ",", "All", ",", "2"}], "]"}], "]"}], "-", "Eth"}]}], "}"}], "]"}], ",", "First"}], "]"}], ",", RowBox[{"Method", "->", "\"Spline\""}], ",", RowBox[{"InterpolationOrder", "->", "1"}]}], "]"}], "[", "x", "]"}]}], ",", RowBox[{"{", RowBox[{"n", ",", "1", ",", RowBox[{"Length", "[", "corrs", "]"}]}], "}"}]}], "]"}], ";"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"8", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"8", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"10", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"10", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.8", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"10", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"10", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"8", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"8", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"10", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"10", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.5", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"10", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"10", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"Plot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"8", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"8", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"6", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"6", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", RowBox[{"0.2", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"8", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ",", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"8", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]
RowBox[{"LogLinearPlot", "[", RowBox[{RowBox[{"{", RowBox[{FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"8", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"8", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"2", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"2", ",", "t"}], "]"}]], ",", FractionBox[RowBox[{"t", RowBox[{SuperscriptBox["\[Delta]E", TagBox[RowBox[{"(", RowBox[{"0", ",", "1"}], ")"}], Derivative], MultilineFunction -> None], "[", RowBox[{"6", ",", "t"}], "]"}]}], RowBox[{"\[Delta]E", "[", RowBox[{"6", ",", "t"}], "]"}]], ",", RowBox[{RowBox[{"-", "2"}], "/", "3"}]}], "}"}], ",", RowBox[{"{", RowBox[{"t", ",", "1", ",", RowBox[{"Max", "[", RowBox[{"corrs", "[", RowBox[{"[", RowBox[{"All", ",", RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}], "]"}]}], "}"}], ",", RowBox[{"PlotRange", "->", RowBox[{RowBox[{RowBox[{"-", "2"}], "/", "3"}], RowBox[{"{", RowBox[{".99", ",", "1.01"}], "}"}]}]}]}], "]"}]
